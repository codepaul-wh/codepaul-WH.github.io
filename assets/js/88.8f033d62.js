(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{391:function(t,s,a){"use strict";a.r(s);var e=a(26),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"spring-cloud-bus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-bus"}},[t._v("#")]),t._v(" Spring Cloud Bus")]),t._v(" "),a("p",[t._v("Spring Cloud Bus将轻量级消息代理程序链接到分布式系统的节点。然后可以使用此代理来广播状态更改（例如配置更改）或其他管理指令。一个关键思想是，总线就像是横向扩展的Spring Boot应用程序的分布式执行器。但是，它也可以用作应用之间的通信渠道。该项目为AMQP经纪人或Kafka提供了入门服务。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("Spring Cloud是根据非限制性Apache 2.0许可发布的。如果您想为文档的这一部分做出贡献或发现错误，请在{docslink} [github]上的项目中找到源代码和问题跟踪程序。")])])]),t._v(" "),a("tbody",[a("tr",[a("td"),t._v(" "),a("td")])])]),t._v(" "),a("h2",{attrs:{id:"_1-快速入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-快速入门"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#quick-start",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.快速入门"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("如果Spring Cloud Bus在类路径中检测到自身，则通过添加Spring Boot autconfiguration来工作。要启用总线，请在您的依赖项管理中添加"),a("code",[t._v("spring-cloud-starter-bus-amqp")]),t._v("或 "),a("code",[t._v("spring-cloud-starter-bus-kafka")]),t._v("。Spring Cloud负责其余的工作。确保代理（RabbitMQ或Kafka）可用并且已配置。在本地主机上运行时，您无需执行任何操作。如果您是远程运行，请使用Spring Cloud Connectors或Spring Boot约定定义代理凭据，如Rabbit的以下示例所示：")]),t._v(" "),a("p",[t._v("application.yml")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("弹簧：\n  rabbitmq：\n    主持人：mybroker.com\n    端口：5672\n    用户名：user\n    密码：秘密\n")])])]),a("p",[t._v("总线当前支持向所有侦听节点或特定服务（由Eureka定义）的所有节点发送消息。该"),a("code",[t._v("/bus/*")]),t._v("驱动器的命名空间具有一定的HTTP端点。当前，有两个已实现。首先，"),a("code",[t._v("/bus/env")]),t._v("发送键/值对以更新每个节点的Spring Environment。第二个"),a("code",[t._v("/bus/refresh")]),t._v("重新加载每个应用程序的配置，就好像它们都已在其"),a("code",[t._v("/refresh")]),t._v(" 端点上被ping一样。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("Spring Cloud Bus入门文章涵盖Rabbit和Kafka，因为它们是两个最常见的实现。但是，Spring Cloud Stream非常灵活，并且绑定程序可与一起使用"),a("code",[t._v("spring-cloud-bus")]),t._v("。")])])]),t._v(" "),a("tbody",[a("tr",[a("td"),t._v(" "),a("td")])])]),t._v(" "),a("h2",{attrs:{id:"_2-总线端点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-总线端点"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#bus-endpoints",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.总线端点"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("春云总线提供了两个端点，"),a("code",[t._v("/actuator/bus-refresh")]),t._v("以及"),a("code",[t._v("/actuator/bus-env")]),t._v(" 对应于个体传动端点春季云共享， "),a("code",[t._v("/actuator/refresh")]),t._v("并"),a("code",[t._v("/actuator/env")]),t._v("分别。")]),t._v(" "),a("h3",{attrs:{id:"_2-1。总线刷新端点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1。总线刷新端点"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#bus-refresh-endpoint",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.1。总线刷新端点"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("该"),a("code",[t._v("/actuator/bus-refresh")]),t._v("端点清除"),a("code",[t._v("RefreshScope")]),t._v("缓存和重新绑定 "),a("code",[t._v("@ConfigurationProperties")]),t._v("。有关更多信息，请参见"),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#refresh-scope",target:"_blank",rel:"noopener noreferrer"}},[t._v("刷新作用域"),a("OutboundLink")],1),t._v("文档。")]),t._v(" "),a("p",[t._v("要公开"),a("code",[t._v("/actuator/bus-refresh")]),t._v("端点，您需要在应用程序中添加以下配置：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("management.endpoints.web.exposure.include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("bus-refresh")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-2。总线环境端点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2。总线环境端点"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#bus-env-endpoint",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.2。总线环境端点"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("的"),a("code",[t._v("/actuator/bus-env")]),t._v("端点更新与在多个实例中的指定键/值对每个实例的环境。")]),t._v(" "),a("p",[t._v("要公开"),a("code",[t._v("/actuator/bus-env")]),t._v("端点，您需要在应用程序中添加以下配置：")]),t._v(" "),a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("management.endpoints.web.exposure.include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("bus-env")]),t._v("\n")])])]),a("p",[t._v("该"),a("code",[t._v("/actuator/bus-env")]),t._v("端点接受"),a("code",[t._v("POST")]),t._v("具有以下形状的要求：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"key1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"value1"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"_3-寻址实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-寻址实例"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#addressing-an-instance",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.寻址实例"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("应用程序的每个实例都有一个服务ID，该服务ID的值可以设置， "),a("code",[t._v("spring.cloud.bus.id")]),t._v("并且其值应按冒号分隔的标识符列表（从最小到最具体）排列。默认值是根据环境构造的"),a("code",[t._v("spring.application.name")]),t._v("和 "),a("code",[t._v("server.port")]),t._v("（或"),a("code",[t._v("spring.application.index")]),t._v("，如果设置）的组合。ID的默认值以的形式构造"),a("code",[t._v("app:index:id")]),t._v("，其中：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("app")]),t._v("是"),a("code",[t._v("vcap.application.name")]),t._v("，如果存在，或者"),a("code",[t._v("spring.application.name")])]),t._v(" "),a("li",[a("code",[t._v("index")]),t._v("是"),a("code",[t._v("vcap.application.instance_index")]),t._v("，如果存在的话， "),a("code",[t._v("spring.application.index")]),t._v("，"),a("code",[t._v("local.server.port")]),t._v("，"),a("code",[t._v("server.port")]),t._v("，或"),a("code",[t._v("0")]),t._v("（以该顺序）。")]),t._v(" "),a("li",[a("code",[t._v("id")]),t._v("是"),a("code",[t._v("vcap.application.instance_id")]),t._v("，（如果存在）或随机值。")])]),t._v(" "),a("p",[t._v("HTTP端点接受“目的地”路径参数，例如 "),a("code",[t._v("/bus-refresh/customers:9000")]),t._v("，其中"),a("code",[t._v("destination")]),t._v("是服务ID。如果该ID由总线上的一个实例拥有，它将处理该消息，而所有其他实例将忽略它。")]),t._v(" "),a("h2",{attrs:{id:"_4-寻址服务的所有实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-寻址服务的所有实例"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#addressing-all-instances-of-a-service",target:"_blank",rel:"noopener noreferrer"}},[t._v("4.寻址服务的所有实例"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Spring中使用“目标”参数"),a("code",[t._v("PathMatcher")]),t._v("（路径分隔符为冒号—  "),a("code",[t._v(":")]),t._v("）确定实例是否处理该消息。使用前面的示例"),a("code",[t._v("/bus-env/customers:**")]),t._v("，将“客户”服务的所有实例作为目标，而与其余服务ID无关。")]),t._v(" "),a("h2",{attrs:{id:"_5-服务id必须唯一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-服务id必须唯一"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#service-id-must-be-unique",target:"_blank",rel:"noopener noreferrer"}},[t._v("5.服务ID必须唯一"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("总线尝试两次以消除对事件的处理-一次来自原始事件 "),a("code",[t._v("ApplicationEvent")]),t._v("，一次来自队列。为此，它将对照当前服务ID检查发送服务ID。如果服务的多个实例具有相同的ID，则不会处理事件。在本地计算机上运行时，每个服务都在不同的端口上，并且该端口是ID的一部分。Cloud Foundry提供了一个区分索引。为确保该ID在Cloud Foundry之外是唯一的，请"),a("code",[t._v("spring.application.index")]),t._v("为每个服务实例设置唯一的ID 。")]),t._v(" "),a("h2",{attrs:{id:"_6-自定义消息代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-自定义消息代理"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#customizing-the-message-broker",target:"_blank",rel:"noopener noreferrer"}},[t._v("6.自定义消息代理"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Spring Cloud Bus使用"),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-stream",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud Stream"),a("OutboundLink")],1),t._v("广播消息。因此，要使消息流动，您只需要在类路径中包括您选择的活页夹实现即可。带有AMQP（RabbitMQ）和Kafka（"),a("code",[t._v("spring-cloud-starter-bus-[amqp|kafka]")]),t._v("）的总线有便捷的启动器。一般来说，Spring Cloud Stream依赖于Spring Boot自动配置约定来配置中间件。例如，可以使用"),a("code",[t._v("spring.rabbitmq.*")]),t._v("配置属性更改AMQP代理地址 。Spring Cloud Bus中具有少数本机配置属性"),a("code",[t._v("spring.cloud.bus.*")]),t._v("（例如， "),a("code",[t._v("spring.cloud.bus.destination")]),t._v("是用作外部中间件的主题名称）。通常，默认值就足够了。")]),t._v(" "),a("p",[t._v("要了解有关如何自定义消息代理设置的更多信息，请参阅Spring Cloud Stream文档。")]),t._v(" "),a("h2",{attrs:{id:"_7-追踪巴士事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-追踪巴士事件"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#tracing-bus-events",target:"_blank",rel:"noopener noreferrer"}},[t._v("7.追踪巴士事件"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("code",[t._v("RemoteApplicationEvent")]),t._v("可以通过设置跟踪总线事件（的子类） "),a("code",[t._v("spring.cloud.bus.trace.enabled=true")]),t._v("。如果这样做，Spring Boot "),a("code",[t._v("TraceRepository")]),t._v(" （如果存在）将显示发送的每个事件以及每个服务实例的所有确认。以下示例来自"),a("code",[t._v("/trace")]),t._v("端点：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2015-11-26T10:24:44.411+0000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"info"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"signal"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"spring.cloud.bus.ack"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RefreshRemoteApplicationEvent"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c4d374b7-58ea-4928-a312-31984def293b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"origin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stores:8081"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"destination"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*:**"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2015-11-26T10:24:41.864+0000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"info"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"signal"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"spring.cloud.bus.sent"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RefreshRemoteApplicationEvent"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c4d374b7-58ea-4928-a312-31984def293b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"origin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"customers:9000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"destination"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*:**"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2015-11-26T10:24:41.862+0000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"info"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"signal"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"spring.cloud.bus.ack"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RefreshRemoteApplicationEvent"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c4d374b7-58ea-4928-a312-31984def293b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"origin"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"customers:9000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"destination"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*:**"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("前面的跟踪显示a "),a("code",[t._v("RefreshRemoteApplicationEvent")]),t._v("是从发送 "),a("code",[t._v("customers:9000")]),t._v("，广播到所有服务，并由"),a("code",[t._v("customers:9000")]),t._v("和 接收（确认）的"),a("code",[t._v("stores:8081")]),t._v("。")]),t._v(" "),a("p",[t._v("自己处理的ACK信号，你可以添加一个"),a("code",[t._v("@EventListener")]),t._v("用于 "),a("code",[t._v("AckRemoteApplicationEvent")]),t._v("和"),a("code",[t._v("SentApplicationEvent")]),t._v("类型您的应用程序（并启用跟踪）。或者，您可以点击"),a("code",[t._v("TraceRepository")]),t._v("并从那里挖掘数据。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("任何Bus应用程序都可以跟踪acks。但是，有时，在中央服务中执行此操作很有用，该服务可以对数据进行更复杂的查询，或将其转发给专门的跟踪服务。")])])]),t._v(" "),a("tbody",[a("tr",[a("td"),t._v(" "),a("td")])])]),t._v(" "),a("h2",{attrs:{id:"_8-广播您自己的事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-广播您自己的事件"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#broadcasting-your-own-events",target:"_blank",rel:"noopener noreferrer"}},[t._v("8.广播您自己的事件"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("公交车可以携带任何类型的事件"),a("code",[t._v("RemoteApplicationEvent")]),t._v("。默认传输是JSON，解串器需要提前知道将要使用哪些类型。要注册新类型，您必须将其放入的子包中 "),a("code",[t._v("org.springframework.cloud.bus.event")]),t._v("。")]),t._v(" "),a("p",[t._v("要自定义事件名称，可以"),a("code",[t._v("@JsonTypeName")]),t._v("在自定义类上使用或依赖默认策略，即使用类的简单名称。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("生产者和消费者都需要访问类定义。")])])]),t._v(" "),a("tbody",[a("tr",[a("td"),t._v(" "),a("td")])])]),t._v(" "),a("h3",{attrs:{id:"_8-1。在自定义包中注册事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-1。在自定义包中注册事件"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#registering-events-in-custom-packages",target:"_blank",rel:"noopener noreferrer"}},[t._v("8.1。在自定义包中注册事件"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("如果您不能或不想使用"),a("code",[t._v("org.springframework.cloud.bus.event")]),t._v(" 自定义事件的子包，则必须"),a("code",[t._v("RemoteApplicationEvent")]),t._v("使用"),a("code",[t._v("@RemoteApplicationEventScan")]),t._v("批注指定要扫描哪些包以查找类型的事件 。用"),a("code",[t._v("@RemoteApplicationEventScan")]),t._v("include子包指定的包。")]),t._v(" "),a("p",[t._v("例如，考虑以下定制事件"),a("code",[t._v("MyEvent")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("acme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyEvent")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RemoteApplicationEvent")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("您可以通过以下方式在解串器中注册该事件：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("acme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RemoteApplicationEventScan")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BusConfiguration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在不指定值的情况下，将"),a("code",[t._v("@RemoteApplicationEventScan")]),t._v(" 注册使用该类的包。在此示例中，"),a("code",[t._v("com.acme")]),t._v("使用的包进行了注册 "),a("code",[t._v("BusConfiguration")]),t._v("。")]),t._v(" "),a("p",[t._v("您也可以明确地通过指定包扫描"),a("code",[t._v("value")]),t._v("，"),a("code",[t._v("basePackages")]),t._v(" 或"),a("code",[t._v("basePackageClasses")]),t._v("在性能"),a("code",[t._v("@RemoteApplicationEventScan")]),t._v("，如下面的例子：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("acme")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//@RemoteApplicationEventScan({"com.acme", "foo.bar"})')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//@RemoteApplicationEventScan(basePackages = {"com.acme", "foo.bar", "fizz.buzz"})')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RemoteApplicationEventScan")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("basePackageClasses "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BusConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BusConfiguration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("前面的所有示例"),a("code",[t._v("@RemoteApplicationEventScan")]),t._v("都是等效的，因为 "),a("code",[t._v("com.acme")]),t._v("通过在上显式指定软件包来注册该软件包 "),a("code",[t._v("@RemoteApplicationEventScan")]),t._v("。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("您可以指定多个要扫描的基本软件包。")])])]),t._v(" "),a("tbody",[a("tr",[a("td"),t._v(" "),a("td")])])]),t._v(" "),a("h2",{attrs:{id:"_9-配置属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-配置属性"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/#configuration-properties",target:"_blank",rel:"noopener noreferrer"}},[t._v("9.配置属性"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("要查看所有与总线相关的配置属性的列表，请检查"),a("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-bus/2.2.0.RELEASE/reference/html/appendix.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("附录页面"),a("OutboundLink")],1),t._v("。")])])}),[],!1,null,null,null);s.default=n.exports}}]);