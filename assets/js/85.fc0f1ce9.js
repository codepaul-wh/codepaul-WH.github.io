(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{390:function(t,e,a){"use strict";a.r(e);var s=a(26),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"部署spring-boot应用程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署spring-boot应用程序"}},[t._v("#")]),t._v(" 部署Spring Boot应用程序")]),t._v(" "),a("p",[t._v("在部署应用程序时，Spring Boot的灵活打包选项提供了很多选择。您可以将Spring Boot应用程序部署到各种云平台，容器映像（例如Docker）或虚拟机/真实机上。")]),t._v(" "),a("p",[t._v("本节介绍一些更常见的部署方案。")]),t._v(" "),a("h2",{attrs:{id:"_1-部署到容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-部署到容器"}},[t._v("#")]),t._v(" 1.部署到容器")]),t._v(" "),a("p",[t._v("如果从容器中运行应用程序，则可以使用可执行jar，但是将其爆炸并以其他方式运行通常也是一个优点。某些PaaS实施也可能选择在运行存档之前将其解压缩。例如，Cloud Foundry以这种方式运行。运行解压缩存档的最简单方法是启动相应的启动器，如下所示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ jar -xf myapp.jar\n$ java org.springframework.boot.loader.JarLauncher\n")])])]),a("p",[t._v("实际上，这在启动时（取决于jar的大小）比从未爆炸的存档中运行要快一些。在运行时，您不应期望任何差异。")]),t._v(" "),a("p",[t._v("解压缩jar文件后，您还可以通过使用其“自然”主方法（而不是）运行应用程序，从而额外增加启动时间"),a("code",[t._v("JarLauncher")]),t._v("。例如：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ jar -xf myapp.jar\n$ java -cp BOOT-INF / classes：BOOT-INF / lib / * com.example.MyApplication\n")])])]),a("p",[t._v("还可以通过将依赖项作为与应用程序类和资源（通常会更频繁地更改）分离的一层复制到映像中来创建更有效的容器映像。实现这一层分离的方法不止一种。例如，使用a "),a("code",[t._v("Dockerfile")]),t._v("可以将其表示为以下形式：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("来自openjdk：8-jdk-alpine AS构建器\nWORKDIR目标/依赖性\nARG APPJAR =目标/*.jar\nCOPY $ {APPJAR} app.jar\n运行jar -xf ./app.jar\n\n来自openjdk：8-jre-alpine\n音量/ tmp\nARG DEPENDENCY =目标/依赖性\n复制--from = builder $ {DEPENDENCY} / BOOT-INF / lib / app / lib\n复制--from = builder $ {DEPENDENCY} / META-INF / app / META-INF\nCOPY --from = builder $ {DEPENDENCY} / BOOT-INF / classes / app\nENTRYPOINT [“ java”，“-cp”，“ app：app / lib / *”，“ com.example.MyApplication”]\n")])])]),a("p",[t._v("假设上面"),a("code",[t._v("Dockerfile")]),t._v("是当前目录，则可以使用构建docker映像"),a("code",[t._v("docker build .")]),t._v("，或者可以选择指定应用程序jar的路径，如以下示例所示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker build --build-arg APPJAR = path / to / myapp.jar。\n")])])]),a("h2",{attrs:{id:"_2-部署到云"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-部署到云"}},[t._v("#")]),t._v(" 2.部署到云")]),t._v(" "),a("p",[t._v("Spring Boot的可执行jar已为大多数流行的云PaaS（平台即服务）提供程序准备就绪。这些提供程序往往要求您“自带容器”。他们管理应用程序流程（不是专门用于Java应用程序），因此他们需要一个中间层，以使"),a("em",[t._v("您的")]),t._v("应用程序适应"),a("em",[t._v("云")]),t._v("中正在运行的流程"),a("em",[t._v("的")]),t._v("概念。")]),t._v(" "),a("p",[t._v("两家受欢迎的云提供商，Heroku和Cloud Foundry，采用了“ buildpack”方法。buildpack将部署的代码包装在"),a("em",[t._v("启动")]),t._v("应用程序所需的任何内容中。它可以是JDK，也可以是对"),a("code",[t._v("java")]),t._v("，嵌入式Web服务器或成熟的应用程序服务器的调用。一个buildpack是可插入的，但是理想情况下，您应该能够通过尽可能少的自定义来获得它。这减少了您无法控制的功能的占用空间。它使开发和生产环境之间的差异最小化。")]),t._v(" "),a("p",[t._v("理想情况下，您的应用程序像Spring Boot可执行jar一样，具有打包运行所需的一切。")]),t._v(" "),a("p",[t._v("在本节中，我们研究如何使在“入门”部分中"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/getting-started.html#getting-started-first-application",target:"_blank",rel:"noopener noreferrer"}},[t._v("开发"),a("OutboundLink")],1),t._v("的"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/getting-started.html#getting-started-first-application",target:"_blank",rel:"noopener noreferrer"}},[t._v("简单应用程序"),a("OutboundLink")],1),t._v("启动并在云中运行。")]),t._v(" "),a("h3",{attrs:{id:"_2-1。云铸造"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1。云铸造"}},[t._v("#")]),t._v(" 2.1。云铸造")]),t._v(" "),a("p",[t._v("如果未指定其他构建包，Cloud Foundry将提供默认的构建包。Cloud Foundry "),a("a",{attrs:{href:"https://github.com/cloudfoundry/java-buildpack",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java buildpack"),a("OutboundLink")],1),t._v("对Spring应用程序（包括Spring Boot）提供了出色的支持。您可以部署独立的可执行jar应用程序以及传统的"),a("code",[t._v(".war")]),t._v("打包应用程序。")]),t._v(" "),a("p",[t._v("一旦您构建了应用程序（例如，使用"),a("code",[t._v("mvn clean package")]),t._v("）并"),a("a",{attrs:{href:"https://docs.cloudfoundry.org/cf-cli/install-go-cli.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装了"),a("code",[t._v("cf")]),t._v("命令行工具"),a("OutboundLink")],1),t._v("，就可以通过使用"),a("code",[t._v("cf push")]),t._v("命令来部署您的应用程序，并替换已编译的路径"),a("code",[t._v(".jar")]),t._v("。推送应用程序之前，请确保已"),a("a",{attrs:{href:"https://docs.cloudfoundry.org/cf-cli/getting-started.html#login",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用"),a("code",[t._v("cf")]),t._v("命令行客户端登录"),a("OutboundLink")],1),t._v("。以下行显示使用"),a("code",[t._v("cf push")]),t._v("命令部署应用程序：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ cf push acloudyspringtime -p target / demo-0.0.1-SNAPSHOT.jar\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("在前面的示例中，我们用"),a("code",[t._v("acloudyspringtime")]),t._v("您提供的任何值代替"),a("code",[t._v("cf")]),t._v("应用程序的名称。")])]),t._v(" "),a("p",[t._v("请参阅"),a("a",{attrs:{href:"https://docs.cloudfoundry.org/cf-cli/getting-started.html#push",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("cf push")]),t._v("文档"),a("OutboundLink")],1),t._v("以获取更多选项。如果"),a("a",{attrs:{href:"https://docs.cloudfoundry.org/devguide/deploy-apps/manifest.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("manifest.yml")]),a("OutboundLink")],1),t._v("同一目录中存在Cloud Foundry 文件，则将其考虑。")]),t._v(" "),a("p",[t._v("此时，"),a("code",[t._v("cf")]),t._v("开始上传您的应用程序，产生类似于以下示例的输出：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("正在上传acloudyspringtime ... 确定 \n正在准备启动acloudyspringtime ... 确定 \n-----\x3e下载的应用包（8.9M）\n-----\x3e Java Buildpack版本：v3.12（离线）| https://github.com/cloudfoundry/java-buildpack.git#6f25b7e\n-----\x3e从https://java-buildpack.cloudfoundry.org/openjdk/trusty/x86_64/openjdk-1.8.0_121.tar.gz下载Open Jdk JRE 1.8.0_121（在缓存中找到）\n       将Open Jdk JRE扩展到.java-buildpack / open_jdk_jre（1.6s）\n-----\x3e从https://java-buildpack.cloudfoundry.org/memory-calculator/trusty/x86_64/memory-calculator-2.0.2_RELEASE.tar.gz下载Open JDK，如Memory Calculator 2.0.2_RELEASE。缓存）\n       内存设置：-Xss349K -Xmx681574K -XX：MaxMetaspaceSize = 104857K -Xms681574K -XX：MetaspaceSize = 104857K\n-----\x3e从https://java-buildpack.cloudfoundry.org/container-certificate-trust-store/container-certificate-trust-store-1.0.0_RELEASE.jar下载容器证书信任库1.0.0_RELEASE在缓存中）\n       将证书添加到.java-buildpack / container_certificate_trust_store / truststore.jks（0.6s）\n-----\x3e从https://java-buildpack.cloudfoundry.org/auto-reconfiguration/auto-reconfiguration-1.10.0_RELEASE.jar下载Spring Auto Reconfiguration 1.10.0_RELEASE（在缓存中找到）\n正在检查应用程序“ acloudyspringtime”的状态...\n  正在运行1个实例中的0个（正在启动1个）\n  ...\n  正在运行1个实例中的0个（正在启动1个）\n  ...\n  正在运行1个实例中的0个（正在启动1个）\n  ...\n  1个实例中有1个正在运行（1个正在运行）\n\n应用已启动\n")])])]),a("p",[t._v("恭喜你！该应用程序现已上线！")]),t._v(" "),a("p",[t._v("应用程序上线后，可以使用"),a("code",[t._v("cf apps")]),t._v("命令验证已部署应用程序的状态，如以下示例所示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ cf个应用\n在...中获取应用程序\n好\n\n名称请求状态实例内存磁盘URL\n...\nacloudyspringtime已启动1/1 512M 1G acloudyspringtime.cfapps.io\n...\n")])])]),a("p",[t._v("一旦Cloud Foundry确认已部署了您的应用程序，您就应该能够在给定的URI上找到该应用程序。在前面的示例中，您可以在找到它"),a("code",[t._v("https://acloudyspringtime.cfapps.io/")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"_2-1-1。绑定服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1。绑定服务"}},[t._v("#")]),t._v(" 2.1.1。绑定服务")]),t._v(" "),a("p",[t._v("默认情况下，有关正在运行的应用程序以及服务连接信息的元数据将作为环境变量（例如：）公开给应用程序"),a("code",[t._v("$VCAP_SERVICES")]),t._v("。该架构决定是由于Cloud Foundry的多语言（可以将任何语言和平台支持为buildpack）所决定的。过程范围的环境变量与语言无关。")]),t._v(" "),a("p",[t._v("环境变量并非总是使用最简单的API，因此Spring Boot会自动提取它们并将数据展平为可以通过Spring的"),a("code",[t._v("Environment")]),t._v("抽象访问的属性，如以下示例所示：")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyBean")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnvironmentAware")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" instanceId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEnvironment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Environment")]),t._v(" environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("instanceId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" environment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vcap.application.instance_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("所有Cloud Foundry属性均以开头"),a("code",[t._v("vcap")]),t._v("。您可以使用"),a("code",[t._v("vcap")]),t._v("属性来访问应用程序信息（例如应用程序的公共URL）和服务信息（例如数据库凭据）。有关完整的详细信息，请参见"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/cloud/CloudFoundryVcapEnvironmentPostProcessor.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("“ CloudFoundryVcapEnvironmentPostProcessor”"),a("OutboundLink")],1),t._v(" Javadoc。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("在"),a("a",{attrs:{href:"https://github.com/pivotal-cf/java-cfenv/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java的CFEnv"),a("OutboundLink")],1),t._v("项目是一个更适合的任务，如配置数据源。")])]),t._v(" "),a("h3",{attrs:{id:"_2-2。heroku"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2。heroku"}},[t._v("#")]),t._v(" 2.2。Heroku")]),t._v(" "),a("p",[t._v("Heroku是另一个流行的PaaS平台。要自定义Heroku构建，请提供"),a("code",[t._v("Procfile")]),t._v("，以提供部署应用程序所需的内容。Heroku分配一个"),a("code",[t._v("port")]),t._v("供Java应用程序使用，然后确保路由到外部URI起作用。")]),t._v(" "),a("p",[t._v("您必须配置您的应用程序以侦听正确的端口。以下示例显示了"),a("code",[t._v("Procfile")]),t._v("我们的入门REST应用程序的：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("网路：java -Dserver.port = $ PORT -jar target / demo-0.0.1-SNAPSHOT.jar\n")])])]),a("p",[t._v("Spring Boot使"),a("code",[t._v("-D")]),t._v("参数作为可从Spring "),a("code",[t._v("Environment")]),t._v("实例访问的属性而可用。所述"),a("code",[t._v("server.port")]),t._v("配置属性被馈送到嵌入的Tomcat，码头，或暗流实例，它然后使用端口在启动时。该"),a("code",[t._v("$PORT")]),t._v("环境变量由Heroku的PaaS的分配给我们。")]),t._v(" "),a("p",[t._v("这应该是您需要的一切。Heroku部署最常见的部署工作流程是"),a("code",[t._v("git push")]),t._v("将代码投入生产，如以下示例所示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ git push heroku master\n\n初始化存储库，完成。\n计数对象：95，完成。\n增量压缩最多使用8个线程。\n压缩对象：100％（78/78），已完成。\n书写对象：100％（95/95），8.66 MiB | 606.00 KiB / s，已完成。\n总计95（增量31），已重用0（增量0）\n\n-----\x3e检测到Java应用\n-----\x3e安装OpenJDK 1.8 ...已完成 \n-----\x3e安装Maven 3.3.1 ...已完成 \n-----\x3e安装settings.xml ...已完成\n-----\x3e执行中：mvn -B -DskipTests = true全新安装\n\n       [INFO]正在扫描项目...\n       下载：https：//repo.spring.io / ...\n       下载地址：https://repo.spring.io/...(818 B，速度为1.8 KB /秒）\n        ....\n       下载地址：https：//s3pository.heroku.com/jvm / ...（152 KB，595.3 KB / sec）\n       [INFO]正在安装/ tmp / build_0c35a5d2-a067-4abc-a232-14b1fb7a8229 / target / ...\n       [INFO]正在安装/tmp/build_0c35a5d2-a067-4abc-a232-14b1fb7a8229/pom.xml ...\n       [INFO] ----------------------------------------------- -------------------------\n       [INFO]建立成功\n       [INFO] ----------------------------------------------- -------------------------\n       [INFO]总时间：59.358秒\n       [INFO]完成于：UTC 2014年3月7日星期五7:28:25\n       [INFO]最终内存：20M / 493M\n       [INFO] ----------------------------------------------- -------------------------\n\n-----\x3e发现过程类型\n       Procfile声明类型-> Web\n\n-----\x3e压缩... 完成，70.4MB\n-----\x3e启动... 完成，第6版\n       https://agile-sierra-1405.herokuapp.com/ 部署到Heroku\n\n到git@heroku.com ：agile-sierra-1405.git\n * [新分支]主->主\n")])])]),a("p",[t._v("您的应用程序现在应该已经在Heroku上启动并运行了。有关更多详细信息，请参阅将"),a("a",{attrs:{href:"https://devcenter.heroku.com/articles/deploying-spring-boot-apps-to-heroku",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Boot应用程序部署到Heroku"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_2-3。openshift"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3。openshift"}},[t._v("#")]),t._v(" 2.3。OpenShift")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.openshift.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenShift"),a("OutboundLink")],1),t._v("是Kubernetes容器编排平台的Red Hat公共（和企业）扩展。与Kubernetes相似，OpenShift具有许多用于安装基于Spring Boot的应用程序的选项。")]),t._v(" "),a("p",[t._v("OpenShift提供了许多资源来描述如何部署Spring Boot应用程序，包括：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.openshift.com/using-openshift-enterprise-grade-spring-boot-deployments/",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用S2I构建器"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://access.redhat.com/documentation/en-us/reference_architectures/2017/html-single/spring_boot_microservices_on_red_hat_openshift_container_platform_3/",target:"_blank",rel:"noopener noreferrer"}},[t._v("建筑指南"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blog.openshift.com/using-spring-boot-on-openshift/",target:"_blank",rel:"noopener noreferrer"}},[t._v("在Wildfly上作为传统的Web应用程序运行"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blog.openshift.com/openshift-commons-briefing-96-cloud-native-applications-spring-rhoar/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenShift公共简报"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"_2-4。亚马逊网络服务（aws）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4。亚马逊网络服务（aws）"}},[t._v("#")]),t._v(" 2.4。亚马逊网络服务（AWS）")]),t._v(" "),a("p",[t._v("Amazon Web Services提供了多种安装基于Spring Boot的应用程序的方式，既可以作为传统的Web应用程序（war），也可以作为嵌入式Web服务器的可执行jar文件安装。选项包括：")]),t._v(" "),a("ul",[a("li",[t._v("AWS Elastic Beanstalk")]),t._v(" "),a("li",[t._v("AWS Code Deploy")]),t._v(" "),a("li",[t._v("AWS OPS作品")]),t._v(" "),a("li",[t._v("AWS云形成")]),t._v(" "),a("li",[t._v("AWS容器注册表")])]),t._v(" "),a("p",[t._v("每个都有不同的功能和定价模型。在本文档中，我们仅描述最简单的选项：AWS Elastic Beanstalk。")]),t._v(" "),a("h4",{attrs:{id:"_2-4-1。aws-elastic-beanstalk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1。aws-elastic-beanstalk"}},[t._v("#")]),t._v(" 2.4.1。AWS Elastic Beanstalk")]),t._v(" "),a("p",[t._v("如官方的"),a("a",{attrs:{href:"https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_Java.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Elastic Beanstalk Java指南中所述"),a("OutboundLink")],1),t._v("，部署Java应用程序有两个主要选项。您可以使用“ Tomcat平台”或“ Java SE平台”。")]),t._v(" "),a("h5",{attrs:{id:"使用tomcat平台"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用tomcat平台"}},[t._v("#")]),t._v(" 使用Tomcat平台")]),t._v(" "),a("p",[t._v("该选项适用于产生war文件的Spring Boot项目。无需特殊配置。您只需要遵循官方指南即可。")]),t._v(" "),a("h5",{attrs:{id:"使用java-se平台"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用java-se平台"}},[t._v("#")]),t._v(" 使用Java SE平台")]),t._v(" "),a("p",[t._v("此选项适用于产生jar文件并运行嵌入式Web容器的Spring Boot项目。Elastic Beanstalk环境在端口80上运行nginx实例以代理在端口5000上运行的实际应用程序。要对其进行配置，请在"),a("code",[t._v("application.properties")]),t._v("文件中添加以下行：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server.port = 5000\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("上传二进制文件而不是源文件默认情况下，Elastic Beanstalk上载源并在AWS中进行编译。但是，最好改为上传二进制文件。为此，向您的"),a("code",[t._v(".elasticbeanstalk/config.yml")]),t._v("文件添加类似于以下内容的行："),a("code",[t._v("deploy: artifact: target/demo-0.0.1-SNAPSHOT.jar")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("通过设置环境类型来降低成本默认情况下，Elastic Beanstalk环境是负载平衡的。负载均衡器的成本很高。为避免该费用，请"),a("a",{attrs:{href:"https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/environments-create-wizard.html#environments-create-wizard-capacity",target:"_blank",rel:"noopener noreferrer"}},[t._v("按照Amazon文档"),a("OutboundLink")],1),t._v("中"),a("a",{attrs:{href:"https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/environments-create-wizard.html#environments-create-wizard-capacity",target:"_blank",rel:"noopener noreferrer"}},[t._v("的说明"),a("OutboundLink")],1),t._v("将环境类型设置为“单个实例” 。您还可以使用CLI和以下命令来创建单实例环境："),a("code",[t._v("eb创建-s")])])]),t._v(" "),a("h4",{attrs:{id:"_2-4-2。摘要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2。摘要"}},[t._v("#")]),t._v(" 2.4.2。摘要")]),t._v(" "),a("p",[t._v("这是使用AWS的最简单方法之一，但还有更多内容需要介绍，例如如何将Elastic Beanstalk集成到任何CI / CD工具中，如何使用Elastic Beanstalk Maven插件而不是CLI等等。有一篇"),a("a",{attrs:{href:"https://exampledriven.wordpress.com/2017/01/09/spring-boot-aws-elastic-beanstalk-example/",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客文章"),a("OutboundLink")],1),t._v("详细介绍了这些主题。")]),t._v(" "),a("h3",{attrs:{id:"_2-5。boxfuse和amazon-web-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5。boxfuse和amazon-web-services"}},[t._v("#")]),t._v(" 2.5。Boxfuse和Amazon Web Services")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://boxfuse.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Boxfuse的"),a("OutboundLink")],1),t._v("工作原理是将您的Spring Boot可执行jar或war变成一个最小的VM映像，该映像可以在VirtualBox或AWS上不变地部署。Boxfuse与Spring Boot进行了深度集成，并使用Spring Boot配置文件中的信息自动配置端口和运行状况检查URL。Boxfuse利用此信息生成的图像以及它提供的所有资源（实例，安全组，弹性负载均衡器等）。")]),t._v(" "),a("p",[t._v("创建"),a("a",{attrs:{href:"https://console.boxfuse.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Boxfuse帐户"),a("OutboundLink")],1),t._v("，将其连接到您的AWS帐户，安装最新版本的Boxfuse Client并确保该应用程序已由Maven或Gradle构建（例如使用"),a("code",[t._v("mvn clean package")]),t._v("）后，就可以部署Spring使用与以下类似的命令将应用程序引导到AWS：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ boxfuse运行myapp-1.0.jar -env = prod\n")])])]),a("p",[t._v("请参阅"),a("a",{attrs:{href:"https://boxfuse.com/docs/commandline/run.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("boxfuse run")]),t._v("文档"),a("OutboundLink")],1),t._v("以获取更多选项。如果"),a("a",{attrs:{href:"https://boxfuse.com/docs/commandline/#configuration",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("boxfuse.conf")]),a("OutboundLink")],1),t._v("当前目录中存在文件，则将其考虑。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("默认情况下，Boxfuse会"),a("code",[t._v("boxfuse")]),t._v("在启动时激活一个名为Spring的配置文件。如果您的可执行jar或war包含"),a("a",{attrs:{href:"https://boxfuse.com/docs/payloads/springboot.html#configuration",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("application-boxfuse.properties")]),a("OutboundLink")],1),t._v("文件，Boxfuse的配置将基于其包含的属性。")])]),t._v(" "),a("p",[t._v("此时，"),a("code",[t._v("boxfuse")]),t._v("为您的应用程序创建一个映像，上传该映像，并在AWS上配置并启动必要的资源，其输出类似于以下示例：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("为myapp-1.0.jar融合图像...\n图片融合于00：06.838s（53937 K）-> axelfontaine / myapp：1.0\n创建axelfontaine / myapp ...\n推送axelfontaine / myapp：1.0 ...\n验证axelfontaine / myapp：1.0 ...\n创建弹性IP ...\n将myapp-axelfontaine.boxfuse.io映射到52.28.233.167 ...\n等待AWS在eu-central-1中为axelfontaine / myapp：1.0创建AMI（这可能需要长达50秒的时间）...\n在00：23.557s-> ami-d23f38cf中创建了AMI\n创建安全组boxfuse-sg_axelfontaine / myapp：1.0 ...\n在eu-central-1中启动axelfontaine / myapp：1.0（ami-d23f38cf）的t2.micro实例...\n在00：30.306s-> i-92ef9f53启动实例\n等待AWS引导实例i-92ef9f53和有效负载从https://52.28.235.61/开始...\n有效负载始于00：29.266s-> https://52.28.235.61/\n将Elastic IP 52.28.233.167重新映射到i-92ef9f53 ...\n等待15秒钟以使AWS完成弹性IP零停机时间转换...\n部署成功完成。axelfontaine / myapp：1.0已启动并在https://myapp-axelfontaine.boxfuse.io/运行\n")])])]),a("p",[t._v("您的应用程序现在应该已启动并在AWS上运行。")]),t._v(" "),a("p",[t._v("请参阅有关"),a("a",{attrs:{href:"https://boxfuse.com/blog/spring-boot-ec2.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("在EC2"),a("OutboundLink")],1),t._v("上"),a("a",{attrs:{href:"https://boxfuse.com/blog/spring-boot-ec2.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("部署Spring Boot应用程序"),a("OutboundLink")],1),t._v("的博客文章以及"),a("a",{attrs:{href:"https://boxfuse.com/docs/payloads/springboot.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Boxfuse Spring Boot集成"),a("OutboundLink")],1),t._v("的"),a("a",{attrs:{href:"https://boxfuse.com/docs/payloads/springboot.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档，"),a("OutboundLink")],1),t._v("以开始使用Maven构建来运行该应用程序。")]),t._v(" "),a("h3",{attrs:{id:"_2-6。谷歌云"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6。谷歌云"}},[t._v("#")]),t._v(" 2.6。谷歌云")]),t._v(" "),a("p",[t._v("Google Cloud有多个选项可用于启动Spring Boot应用程序。最容易上手的可能是App Engine，但您也可以找到在Container Engine的容器中或Compute Engine的虚拟机上运行Spring Boot的方法。")]),t._v(" "),a("p",[t._v("要在App Engine中运行，您可以先在用户界面中创建一个项目，该项目将为您设置一个唯一的标识符，并还设置HTTP路由。将Java应用程序添加到项目中，并将其保留为空，然后使用"),a("a",{attrs:{href:"https://cloud.google.com/sdk/install",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Cloud SDK"),a("OutboundLink")],1),t._v("从命令行或CI构建将Spring Boot应用程序推送到该插槽中。")]),t._v(" "),a("p",[t._v("App Engine Standard要求您使用WAR包装。请按照"),a("a",{attrs:{href:"https://github.com/GoogleCloudPlatform/getting-started-java/blob/master/appengine-standard-java8/springboot-appengine-standard/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("以下步骤"),a("OutboundLink")],1),t._v("将App Engine标准应用程序部署到Google Cloud。")]),t._v(" "),a("p",[t._v("另外，App Engine Flex要求您创建一个"),a("code",[t._v("app.yaml")]),t._v("文件来描述您的应用程序所需的资源。通常，您将此文件放在中"),a("code",[t._v("src/main/appengine")]),t._v("，它应类似于以下文件：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runtime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" java\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flex\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runtime_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jdk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" openjdk8\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /.*\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" this field is required"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" but ignored\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("manual_scaling")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instances")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("health_check")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enable_health_check")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("False")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env_variables")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ENCRYPT_KEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" your_encryption_key_here\n")])])]),a("p",[t._v("您可以通过将项目ID添加到构建配置中来部署应用程序（例如，使用Maven插件），如以下示例所示：")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.google.cloud.tools"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("appengine-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("1.3.0"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("project")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("myproject"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("project")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("然后进行部署"),a("code",[t._v("mvn appengine:deploy")]),t._v("（如果您需要首先进行身份验证，则构建将失败）。")]),t._v(" "),a("h2",{attrs:{id:"_3-安装spring-boot应用程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装spring-boot应用程序"}},[t._v("#")]),t._v(" 3.安装Spring Boot应用程序")]),t._v(" "),a("p",[t._v("除了使用来运行Spring Boot应用程序外"),a("code",[t._v("java -jar")]),t._v("，还可以为Unix系统制作完全可执行的应用程序。完全可执行的jar可以像任何其他可执行二进制文件一样执行，也可以"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/deployment.html#deployment-service",target:"_blank",rel:"noopener noreferrer"}},[t._v("向"),a("code",[t._v("init.d")]),t._v("或注册"),a("code",[t._v("systemd")]),a("OutboundLink")],1),t._v("。这使得在普通生产环境中安装和管理Spring Boot应用程序变得非常容易。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("完全可执行的jar通过将额外的脚本嵌入文件的开头来工作。当前，某些工具不接受此格式，因此您可能无法始终使用此技术。例如，"),a("code",[t._v("jar -xf")]),t._v("可能无声地无法提取出可以完全执行的jar或war。建议仅当您打算直接执行jar或war时才使其完全可执行，而不是使用java -jar来运行它或将其部署到servlet容器中。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("不能使zip64格式的jar文件完全可执行。尝试这样做将导致直接或与执行时，jar文件被报告为损坏"),a("code",[t._v("java -jar")]),t._v("。包含一个或多个zip64格式嵌套jar的标准格式jar文件可以完全执行。")])]),t._v(" "),a("p",[t._v("要使用Maven创建一个“完全可执行”的jar，请使用以下插件配置：")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("executable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("true"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("executable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("以下示例显示了等效的Gradle配置：")]),t._v(" "),a("div",{staticClass:"language-groovy extra-class"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[t._v("bootJar "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("launchScript")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后，您可以通过键入"),a("code",[t._v("./my-application.jar")]),t._v("（"),a("code",[t._v("my-application")]),t._v("工件的名称在其中）来运行应用程序。包含jar的目录用作应用程序的工作目录。")]),t._v(" "),a("h3",{attrs:{id:"_3-1。支持的操作系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1。支持的操作系统"}},[t._v("#")]),t._v(" 3.1。支持的操作系统")]),t._v(" "),a("p",[t._v("默认脚本支持大多数Linux发行版，并已在CentOS和Ubuntu上进行了测试。其他平台，例如OS X和FreeBSD，则需要使用custom "),a("code",[t._v("embeddedLaunchScript")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_3-2。unix-linux服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2。unix-linux服务"}},[t._v("#")]),t._v(" 3.2。Unix / Linux服务")]),t._v(" "),a("p",[t._v("通过使用"),a("code",[t._v("init.d")]),t._v("或，可以轻松地将Spring Boot应用程序作为Unix / Linux服务启动"),a("code",[t._v("systemd")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"_3-2-1。安装即init-d服务（系统v）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1。安装即init-d服务（系统v）"}},[t._v("#")]),t._v(" 3.2.1。安装即"),a("code",[t._v("init.d")]),t._v("服务（系统V）")]),t._v(" "),a("p",[t._v("如果您将Spring Boot的Maven或Gradle插件配置为生成"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/deployment.html#deployment-install",target:"_blank",rel:"noopener noreferrer"}},[t._v("完全可执行的jar"),a("OutboundLink")],1),t._v("，而不使用custom "),a("code",[t._v("embeddedLaunchScript")]),t._v("，则您的应用程序可以用作"),a("code",[t._v("init.d")]),t._v("服务。要做到这一点，符号链接罐子"),a("code",[t._v("init.d")]),t._v("，支持标准"),a("code",[t._v("start")]),t._v("，"),a("code",[t._v("stop")]),t._v("，"),a("code",[t._v("restart")]),t._v("，和"),a("code",[t._v("status")]),t._v("命令。")]),t._v(" "),a("p",[t._v("该脚本支持以下功能：")]),t._v(" "),a("ul",[a("li",[t._v("以拥有jar文件的用户身份启动服务")]),t._v(" "),a("li",[t._v("通过使用跟踪应用程序的PID "),a("code",[t._v("/var/run/<appname>/<appname>.pid")])]),t._v(" "),a("li",[t._v("将控制台日志写入 "),a("code",[t._v("/var/log/<appname>.log")])])]),t._v(" "),a("p",[t._v("假设您在"),a("code",[t._v("/var/myapp")]),t._v("中安装了Spring Boot应用程序，以将Spring Boot应用程序作为"),a("code",[t._v("init.d")]),t._v("服务安装，请创建一个符号链接，如下所示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ sudo ln -s /var/myapp/myapp.jar /etc/init.d/myapp\n")])])]),a("p",[t._v("安装后，您可以按照通常的方式启动和停止服务。例如，在基于Debian的系统上，可以使用以下命令启动它：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$服务myapp启动\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("如果您的应用程序无法启动，请检查写入的日志文件中"),a("code",[t._v("/var/log/<appname>.log")]),t._v("是否有错误。")])]),t._v(" "),a("p",[t._v("您还可以使用标准操作系统工具将应用程序标记为自动启动。例如，在Debian上，您可以使用以下命令：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ update-rc.d myapp默认为<priority>\n")])])]),a("h5",{attrs:{id:"保护init-d服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保护init-d服务"}},[t._v("#")]),t._v(" 保护"),a("code",[t._v("init.d")]),t._v("服务")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("以下是一组有关如何保护作为init.d服务运行的Spring Boot应用程序的准则。它并不旨在详尽列出增强应用程序及其运行环境所应进行的所有工作。")])]),t._v(" "),a("p",[t._v("当以root身份执行时（例如使用root来启动init.d服务时），默认的可执行脚本以"),a("code",[t._v("RUN_AS_USER")]),t._v("环境变量中指定的用户身份运行应用程序。如果未设置环境变量，则使用拥有jar文件的用户。您永远不要以身份运行Spring Boot应用程序"),a("code",[t._v("root")]),t._v("，因此"),a("code",[t._v("RUN_AS_USER")]),t._v("绝对不能以root 身份运行，并且应用程序的jar文件也绝对不能由root拥有。而是创建一个特定用户来运行您的应用程序并设置"),a("code",[t._v("RUN_AS_USER")]),t._v("环境变量，或使用"),a("code",[t._v("chown")]),t._v("它来使其成为jar文件的所有者，如以下示例所示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ chown bootapp：bootapp your-app.jar\n")])])]),a("p",[t._v("在这种情况下，默认的可执行脚本以"),a("code",[t._v("bootapp")]),t._v("用户身份运行应用程序。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("为了减少应用程序的用户帐户被盗用的机会，应考虑阻止它使用登录外壳程序。例如，您可以将帐户的外壳设置为"),a("code",[t._v("/usr/sbin/nologin")]),t._v("。")])]),t._v(" "),a("p",[t._v("您还应该采取措施防止修改应用程序的jar文件。首先，配置其权限，使其不能被写入，只能由其所有者读取或执行，如以下示例所示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ chmod 500 your-app.jar\n")])])]),a("p",[t._v("其次，如果您的应用程序或运行该应用程序的帐户受到威胁，您还应采取措施限制损害。如果攻击者确实获得了访问权限，则他们可以使jar文件可写并更改其内容。防止这种情况发生的一种方法是使用使其不可变"),a("code",[t._v("chattr")]),t._v("，如以下示例所示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ sudo chattr + i your-app.jar\n")])])]),a("p",[t._v("这将阻止任何用户（包括root用户）修改jar。")]),t._v(" "),a("p",[t._v("如果使用root来控制应用程序的服务，并且您"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/deployment.html#deployment-script-customization-conf-file",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用"),a("code",[t._v(".conf")]),t._v("文件"),a("OutboundLink")],1),t._v("自定义其启动，"),a("code",[t._v(".conf")]),t._v("则root用户将读取并评估该文件。应该相应地对其进行保护。使用，"),a("code",[t._v("chmod")]),t._v("以便文件只能由所有者读取，并用于"),a("code",[t._v("chown")]),t._v("使root用户成为所有者，如以下示例所示：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ chmod 400 your-app.conf\n$ sudo chown root：root your-app.conf\n")])])]),a("h4",{attrs:{id:"_3-2-2。安装即systemd服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2。安装即systemd服务"}},[t._v("#")]),t._v(" 3.2.2。安装即"),a("code",[t._v("systemd")]),t._v("服务")]),t._v(" "),a("p",[a("code",[t._v("systemd")]),t._v("是System V init系统的后继产品，现在被许多现代Linux发行版使用。尽管您可以继续使用"),a("code",[t._v("init.d")]),t._v("带有脚本"),a("code",[t._v("systemd")]),t._v("，但也可以通过使用"),a("code",[t._v("systemd")]),t._v("“服务”脚本来启动Spring Boot应用程序。")]),t._v(" "),a("p",[t._v("假设您在"),a("code",[t._v("/var/myapp")]),t._v("中安装了Spring Boot应用程序，以将Spring Boot应用程序作为"),a("code",[t._v("systemd")]),t._v("服务安装，请创建一个名为的脚本"),a("code",[t._v("myapp.service")]),t._v("并将其放置在"),a("code",[t._v("/etc/systemd/system")]),t._v("目录中。以下脚本提供了一个示例：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[单元]\n说明= myapp\n之后= syslog.target\n\n[服务]\n用户= myapp\nExecStart = / var / myapp / myapp.jar\nSuccessExitStatus = 143\n\n[安装]\nWantedBy =多用户目标\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("请记住，改变"),a("code",[t._v("Description")]),t._v("，"),a("code",[t._v("User")]),t._v("和"),a("code",[t._v("ExecStart")]),t._v("域为您的应用。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("该"),a("code",[t._v("ExecStart")]),t._v("字段未声明脚本操作命令，这意味着"),a("code",[t._v("run")]),t._v("默认情况下使用该命令。")])]),t._v(" "),a("p",[t._v("请注意，与作为"),a("code",[t._v("init.d")]),t._v("服务运行时不同，运行应用程序的用户，PID文件和控制台日志文件由其"),a("code",[t._v("systemd")]),t._v("自身管理，因此必须使用“服务”脚本中的适当字段进行配置。有关更多详细信息，请查阅"),a("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/systemd.service.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务单元配置手册页"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("要将应用程序标记为在系统启动时自动启动，请使用以下命令：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ systemctl启用myapp.service\n")])])]),a("p",[a("code",[t._v("man systemctl")]),t._v("有关更多详细信息，请参阅。")]),t._v(" "),a("h4",{attrs:{id:"_3-2-3。自定义启动脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3。自定义启动脚本"}},[t._v("#")]),t._v(" 3.2.3。自定义启动脚本")]),t._v(" "),a("p",[t._v("由Maven或Gradle插件编写的默认嵌入式启动脚本可以通过多种方式进行自定义。对于大多数人来说，使用默认脚本以及一些自定义设置通常就足够了。如果发现无法自定义所需的内容，请使用该"),a("code",[t._v("embeddedLaunchScript")]),t._v("选项完全写入自己的文件。")]),t._v(" "),a("h5",{attrs:{id:"编写后自定义启动脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写后自定义启动脚本"}},[t._v("#")]),t._v(" 编写后自定义启动脚本")]),t._v(" "),a("p",[t._v("在将启动脚本写入jar文件时，自定义启动脚本的元素通常很有意义。例如，init.d脚本可以提供“描述”。由于您已经预先了解了描述（并且无需更改），因此在生成jar时也可以提供它。")]),t._v(" "),a("p",[t._v("要自定义书面元素，请使用"),a("code",[t._v("embeddedLaunchScriptProperties")]),t._v("Spring Boot Maven插件的选项或"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/gradle-plugin/reference/html//#packaging-executable-configuring-launch-script",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("properties")]),t._v("Spring Boot Gradle插件的属性"),a("code",[t._v("launchScript")]),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("默认脚本支持以下属性替换：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("名称")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Gradle默认")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Maven默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("mode")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("脚本模式。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("auto")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("auto")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("initInfoProvides")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("在"),a("code",[t._v("Provides")]),t._v("的“INIT INFO”节")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("${task.baseName}")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("${project.artifactId}")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("initInfoRequiredStart")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("Required-Start")]),t._v(" “ INIT INFO”部分。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$remote_fs $syslog $network")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$remote_fs $syslog $network")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("initInfoRequiredStop")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("Required-Stop")]),t._v(" “ INIT INFO”部分。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$remote_fs $syslog $network")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$remote_fs $syslog $network")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("initInfoDefaultStart")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("Default-Start")]),t._v(" “ INIT INFO”部分。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("2 3 4 5")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("2 3 4 5")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("initInfoDefaultStop")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("Default-Stop")]),t._v(" “ INIT INFO”部分。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("0 1 6")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("0 1 6")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("initInfoShortDescription")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("Short-Description")]),t._v(" “ INIT INFO”部分。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("的单行版本"),a("code",[t._v("${project.description}")]),t._v("（回退到"),a("code",[t._v("${task.baseName}")]),t._v("）")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("${project.name}")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("initInfoDescription")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("Description")]),t._v(" “ INIT INFO”部分。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("${project.description}")]),t._v("（回落到"),a("code",[t._v("${task.baseName}")]),t._v("）")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("${project.description}")]),t._v("（回落到"),a("code",[t._v("${project.name}")]),t._v("）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("initInfoChkconfig")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("chkconfig")]),t._v(" “ INIT INFO”部分")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("2345 99 01")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("2345 99 01")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("confFolder")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("的默认值 "),a("code",[t._v("CONF_FOLDER")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("包含罐子的文件夹")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("包含罐子的文件夹")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("inlinedConfScript")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("引用应在默认启动脚本中内联的文件脚本。这可用于设置环境变量，例如"),a("code",[t._v("JAVA_OPTS")]),t._v("在加载任何外部配置文件之前")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("logFolder")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("的默认值"),a("code",[t._v("LOG_FOLDER")]),t._v("。仅对"),a("code",[t._v("init.d")]),t._v("服务有效")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("logFilename")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("的默认值"),a("code",[t._v("LOG_FILENAME")]),t._v("。仅对"),a("code",[t._v("init.d")]),t._v("服务有效")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("pidFolder")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("的默认值"),a("code",[t._v("PID_FOLDER")]),t._v("。仅对"),a("code",[t._v("init.d")]),t._v("服务有效")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("pidFilename")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PID文件名的默认值"),a("code",[t._v("PID_FOLDER")]),t._v("。仅对"),a("code",[t._v("init.d")]),t._v("服务有效")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("useStartStopDaemon")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("该"),a("code",[t._v("start-stop-daemon")]),t._v("命令在可用时是否应用于控制过程")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("true")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("true")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("stopWaitTime")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("缺省值（"),a("code",[t._v("STOP_WAIT_TIME")]),t._v("以秒为单位）。仅对"),a("code",[t._v("init.d")]),t._v("服务有效")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("60")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("60")])])])]),t._v(" "),a("h5",{attrs:{id:"运行时自定义脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行时自定义脚本"}},[t._v("#")]),t._v(" 运行时自定义脚本")]),t._v(" "),a("p",[t._v("对于编写jar "),a("em",[t._v("之后")]),t._v("需要自定义的脚本项目，可以使用环境变量或"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/deployment.html#deployment-script-customization-conf-file",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置文件"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("默认脚本支持以下环境属性：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("变量")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("MODE")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("操作的“模式”。默认值取决于jar的构建方式，但通常"),a("code",[t._v("auto")]),t._v("是这样（这意味着它会通过检查目录中是否为符号链接来尝试猜测它是否为初始化脚本"),a("code",[t._v("init.d")]),t._v("）。您可以将其显式设置为"),a("code",[t._v("service")]),t._v("以便"),a("code",[t._v("stop|start|status|restart")]),t._v("命令"),a("code",[t._v("run")]),t._v("可以运行，也可以将其设置为要在前台运行脚本。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("RUN_AS_USER")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("将用于运行应用程序的用户。未设置时，将使用拥有jar文件的用户。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("USE_START_STOP_DAEMON")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("该"),a("code",[t._v("start-stop-daemon")]),t._v("命令在可用时是否应用于控制过程。默认为"),a("code",[t._v("true")]),t._v("。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("PID_FOLDER")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("pid文件夹的根名称（"),a("code",[t._v("/var/run")]),t._v("默认情况下）。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("LOG_FOLDER")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("放置日志文件的文件夹的名称（"),a("code",[t._v("/var/log")]),t._v("默认情况下）。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("CONF_FOLDER")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("从中读取.conf文件的文件夹的名称（默认情况下与jar文件相同的文件夹）。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("LOG_FILENAME")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("日志文件的名称"),a("code",[t._v("LOG_FOLDER")]),t._v("（"),a("code",[t._v("<appname>.log")]),t._v("默认情况下为）。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("APP_NAME")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("应用程序的名称。如果jar是从符号链接运行的，则脚本会猜测应用程序名称。如果它不是符号链接，或者您要显式设置应用程序名称，则这将很有用。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("RUN_ARGS")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("传递给程序（Spring Boot应用程序）的参数。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("JAVA_HOME")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("java")]),t._v("可执行文件的位置"),a("code",[t._v("PATH")]),t._v("默认情况下使用来发现，但是如果在上有可执行文件，则可以显式设置它"),a("code",[t._v("$JAVA_HOME/bin/java")]),t._v("。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("JAVA_OPTS")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("启动JVM时传递给JVM的选项。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("JARFILE")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("jar文件的显式位置，以防脚本用于启动实际上未嵌入的jar。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("DEBUG")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("如果不为空，则"),a("code",[t._v("-x")]),t._v("在shell进程上设置该标志，从而易于查看脚本中的逻辑。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("STOP_WAIT_TIME")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("停止应用程序之前强制关闭的等待时间（以秒为单位"),a("code",[t._v("60")]),t._v("）（默认情况下）。")])])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("的"),a("code",[t._v("PID_FOLDER")]),t._v("，"),a("code",[t._v("LOG_FOLDER")]),t._v("和"),a("code",[t._v("LOG_FILENAME")]),t._v("变量仅适用于一个"),a("code",[t._v("init.d")]),t._v("服务。对于"),a("code",[t._v("systemd")]),t._v("，等效的自定义是通过使用“服务”脚本进行的。有关更多详细信息，请参见"),a("a",{attrs:{href:"https://www.freedesktop.org/software/systemd/man/systemd.service.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务单元配置手册页"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("p",[t._v("除"),a("code",[t._v("JARFILE")]),t._v("和以外"),a("code",[t._v("APP_NAME")]),t._v("，可以使用"),a("code",[t._v(".conf")]),t._v("文件配置上一节中列出的设置。该文件应位于jar文件的旁边，并且具有相同的名称，但后缀为"),a("code",[t._v(".conf")]),t._v("而不是"),a("code",[t._v(".jar")]),t._v("。例如，一个名为jar的jar "),a("code",[t._v("/var/myapp/myapp.jar")]),t._v("使用名为的配置文件"),a("code",[t._v("/var/myapp/myapp.conf")]),t._v("，如以下示例所示：")]),t._v(" "),a("p",[t._v("myapp.conf")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("JAVA_OPTS = -Xmx1024M\nLOG_FOLDER = / custom / log / folder\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("如果您不喜欢将配置文件放在jar文件旁边，则可以设置"),a("code",[t._v("CONF_FOLDER")]),t._v("环境变量以自定义配置文件的位置。")])]),t._v(" "),a("p",[t._v("要了解有关适当保护此文件的信息，请参阅"),a("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/deployment.html#deployment-initd-service-securing",target:"_blank",rel:"noopener noreferrer"}},[t._v("保护init.d服务的准则"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_3-3。microsoft-windows服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3。microsoft-windows服务"}},[t._v("#")]),t._v(" 3.3。Microsoft Windows服务")]),t._v(" "),a("p",[t._v("可以使用来将Spring Boot应用程序作为Windows服务启动"),a("a",{attrs:{href:"https://github.com/kohsuke/winsw",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("winsw")]),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("（一个"),a("a",{attrs:{href:"https://github.com/snicoll-scratches/spring-boot-daemon",target:"_blank",rel:"noopener noreferrer"}},[t._v("单独维护的示例"),a("OutboundLink")],1),t._v("）逐步说明了如何为Spring Boot应用程序创建Windows服务。")]),t._v(" "),a("h2",{attrs:{id:"_4-接下来阅读什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-接下来阅读什么"}},[t._v("#")]),t._v(" 4.接下来阅读什么")]),t._v(" "),a("p",[t._v("请访问"),a("a",{attrs:{href:"https://www.cloudfoundry.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloud Foundry"),a("OutboundLink")],1),t._v("，"),a("a",{attrs:{href:"https://www.heroku.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Heroku"),a("OutboundLink")],1),t._v("，"),a("a",{attrs:{href:"https://www.openshift.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenShift"),a("OutboundLink")],1),t._v("和"),a("a",{attrs:{href:"https://boxfuse.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Boxfuse"),a("OutboundLink")],1),t._v("网站，以获取有关PaaS可以提供的各种功能的更多信息。这些只是最受欢迎的Java PaaS提供程序中的四个。由于Spring Boot非常适合基于云的部署，因此您也可以自由考虑其他提供商。")]),t._v(" "),a("p",[t._v("下一节将继续介绍"),a("em",[t._v("Spring Boot CLI")]),t._v("，或者您可以直接阅读有关"),a("em",[t._v("构建工具插件的信息")]),t._v("。")])])}),[],!1,null,null,null);e.default=n.exports}}]);