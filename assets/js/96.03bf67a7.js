(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{388:function(t,a,s){"use strict";s.r(a);var n=s(26),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"云原生应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#云原生应用"}},[t._v("#")]),t._v(" 云原生应用")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://pivotal.io/platform-as-a-service/migrating-to-cloud-native-application-architectures-ebook",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cloud Native"),s("OutboundLink")],1),t._v("是一种应用程序开发样式，鼓励在持续交付和价值驱动型开发领域轻松采用最佳实践。一个相关的学科是构建"),s("a",{attrs:{href:"https://12factor.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("12要素应用程序"),s("OutboundLink")],1),t._v("，其中开发实践与交付和运营目标保持一致-例如，通过使用声明性编程，管理和监视。Spring Cloud通过多种特定方式促进了这些开发风格。起点是一组功能，分布式系统中的所有组件都需要轻松访问这些功能。")]),t._v(" "),s("p",[t._v("Spring Cloud构建于其中的Spring "),s("a",{attrs:{href:"https://projects.spring.io/spring-boot",target:"_blank",rel:"noopener noreferrer"}},[t._v("Boot"),s("OutboundLink")],1),t._v("涵盖了许多这些功能。Spring Cloud作为两个库提供了更多功能：Spring Cloud上下文和Spring Cloud Commons。Spring Cloud Context为"),s("code",[t._v("ApplicationContext")]),t._v("Spring Cloud应用程序提供实用程序和特殊服务（引导上下文，加密，刷新作用域和环境端点）。Spring Cloud Commons是在不同Spring Cloud实现中使用的一组抽象和通用类（例如Spring Cloud Netflix和Spring Cloud Consul）。")]),t._v(" "),s("p",[t._v("如果由于“密钥大小非法”而导致异常，并且使用Sun的JDK，则需要安装Java密码学扩展（JCE）无限强度管辖权策略文件。有关更多信息，请参见以下链接：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.oracle.com/technetwork/java/javase/downloads/jce-6-download-429243.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java 6 JCE"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java 7 JCE"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java 8 JCE"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("将文件解压缩到所使用的JRE / JDK x64 / x86版本的JDK / jre / lib / security文件夹中。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("Spring Cloud是根据非限制性Apache 2.0许可发布的。如果您想为文档的这一部分做出贡献或发现错误，可以在{docslink} [github]上找到该项目的源代码和问题跟踪器。")])]),t._v(" "),s("h2",{attrs:{id:"_1-spring-cloud-context：应用程序上下文服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-spring-cloud-context：应用程序上下文服务"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-context-application-context-services",target:"_blank",rel:"noopener noreferrer"}},[t._v("1. Spring Cloud Context：应用程序上下文服务"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Spring Boot对于如何使用Spring构建应用程序有一个坚定的看法。例如，它具有用于公共配置文件的常规位置，并具有用于公共管理和监视任务的端点。Spring Cloud在此基础上构建并添加了一些功能，这些功能可能是系统中所有组件可能会使用或偶尔需要的。")]),t._v(" "),s("h3",{attrs:{id:"_1-1。bootstrap应用程序上下文"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1。bootstrap应用程序上下文"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#the-bootstrap-application-context",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.1。Bootstrap应用程序上下文"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Spring Cloud应用程序通过创建“引导”上下文来运行，该上下文是主应用程序的父上下文。它负责从外部源加载配置属性，并负责解密本地外部配置文件中的属性。这两个上下文共享一个"),s("code",[t._v("Environment")]),t._v("，这是任何Spring应用程序的外部属性的来源。默认情况下，引导程序属性（不是"),s("code",[t._v("bootstrap.properties")]),t._v("引导程序阶段加载的属性）具有较高的优先级，因此它们不能被本地配置覆盖。")]),t._v(" "),s("p",[t._v("引导上下文使用不同于主应用程序上下文的约定来定位外部配置。可以使用代替"),s("code",[t._v("application.yml")]),t._v("（或"),s("code",[t._v(".properties")]),t._v("），"),s("code",[t._v("bootstrap.yml")]),t._v("将引导程序的外部配置和主上下文很好地分开。以下清单显示了一个示例：")]),t._v(" "),s("p",[t._v("bootstrap.yml")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("弹簧：\n  应用：\n    名称：foo\n  云：\n    配置：\n      uri：$ {SPRING_CONFIG_URI：http：// localhost：8888}\n")])])]),s("p",[t._v("如果您的应用程序需要来自服务器的任何特定于应用程序的配置，则最好设置"),s("code",[t._v("spring.application.name")]),t._v("（in "),s("code",[t._v("bootstrap.yml")]),t._v("或"),s("code",[t._v("application.yml")]),t._v("）。为了将该属性"),s("code",[t._v("spring.application.name")]),t._v("用作应用程序的上下文ID，您必须在中设置它"),s("code",[t._v("bootstrap.[properties | yml]")]),t._v("。")]),t._v(" "),s("p",[t._v("您可以通过设置"),s("code",[t._v("spring.cloud.bootstrap.enabled=false")]),t._v("来完全禁用引导过程（例如，在系统属性中）。")]),t._v(" "),s("h3",{attrs:{id:"_1-2。应用程序上下文层次结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2。应用程序上下文层次结构"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#application-context-hierarchies",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.2。应用程序上下文层次结构"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果从"),s("code",[t._v("SpringApplication")]),t._v("或构建应用程序上下文"),s("code",[t._v("SpringApplicationBuilder")]),t._v("，那么Bootstrap上下文将作为父级添加到该上下文。Spring的一个功能是子上下文从其父级继承属性源和配置文件，因此，与没有Spring Cloud Config的相同上下文相比，“主”应用程序上下文包含其他属性源。其他属性来源是：")]),t._v(" "),s("ul",[s("li",[t._v("“ bootstrap”：如果"),s("code",[t._v("PropertySourceLocators")]),t._v("在Bootstrap上下文中找到任何内容，并且它们具有非空属性，"),s("code",[t._v("CompositePropertySource")]),t._v("则会显示具有高优先级的可选内容。一个示例就是Spring Cloud Config Server中的属性。有关如何自定义此属性源内容的说明，请参见“ "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#customizing-bootstrap-property-sources",target:"_blank",rel:"noopener noreferrer"}},[t._v("自定义Bootstrap属性源"),s("OutboundLink")],1),t._v(" ”。")]),t._v(" "),s("li",[t._v("“ applicationConfig：[classpath：bootstrap.yml]”（以及相关文件（如果Spring配置文件处于活动状态））：如果您具有"),s("code",[t._v("bootstrap.yml")]),t._v("（或"),s("code",[t._v(".properties")]),t._v("），则这些属性用于配置Bootstrap上下文。然后，当它们的父级被设置时，它们被添加到子级上下文中。它们的优先级低于"),s("code",[t._v("application.yml")]),t._v("（或"),s("code",[t._v(".properties")]),t._v("）和在创建Spring Boot应用程序过程中通常添加到子级的任何其他属性源的优先级。有关如何自定义这些属性源内容的说明，请参见“ "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#customizing-bootstrap-properties",target:"_blank",rel:"noopener noreferrer"}},[t._v("更改Bootstrap属性的位置"),s("OutboundLink")],1),t._v(" ”。")])]),t._v(" "),s("p",[t._v("由于属性源的排序规则，“引导程序”条目具有优先权。但是，请注意，这些不包含来自的任何数据，这些数据的"),s("code",[t._v("bootstrap.yml")]),t._v("优先级非常低，但可用于设置默认值。")]),t._v(" "),s("p",[t._v("您可以通过设置任何父上下文扩展上下文结构"),s("code",[t._v("ApplicationContext")]),t._v("创建-例如，通过使用自己的接口或与"),s("code",[t._v("SpringApplicationBuilder")]),t._v("方便的方法（"),s("code",[t._v("parent()")]),t._v("，"),s("code",[t._v("child()")]),t._v("和"),s("code",[t._v("sibling()")]),t._v("）。引导上下文是您创建的最高级祖先的父级。层次结构中的每个上下文都有其自己的“引导程序”（可能为空）属性源，以避免无意间将值从父级提升到子级。如果有配置服务器，则层次结构中的每个上下文原则上也可以有不同的"),s("code",[t._v("spring.application.name")]),t._v("因此，另一个远程资源来源。常规的Spring应用程序上下文行为规则适用于属性解析：子上下文中的属性会按名称以及属性源名称覆盖父级属性。（如果子项具有与父项同名的属性源，则子项中不包括父项的值）。")]),t._v(" "),s("p",[t._v("请注意，"),s("code",[t._v("SpringApplicationBuilder")]),t._v("可以让您"),s("code",[t._v("Environment")]),t._v("在整个层次结构中共享一个，但这不是默认设置。因此，同级上下文尤其不需要具有相同的配置文件或属性源，即使它们可能与其父级共享相同的值。")]),t._v(" "),s("h3",{attrs:{id:"_1-3。更改引导程序属性的位置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3。更改引导程序属性的位置"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#customizing-bootstrap-properties",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.3。更改引导程序属性的位置"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("的"),s("code",[t._v("bootstrap.yml")]),t._v("（或"),s("code",[t._v(".properties")]),t._v("）位置可以通过设置来指定"),s("code",[t._v("spring.cloud.bootstrap.name")]),t._v("（默认值："),s("code",[t._v("bootstrap")]),t._v("）或"),s("code",[t._v("spring.cloud.bootstrap.location")]),t._v("（默认值：空） -例如，在系统性能。这些属性的行为类似于"),s("code",[t._v("spring.config.*")]),t._v("具有相同名称的变量。实际上，它们是通过在中设置引导程序"),s("code",[t._v("ApplicationContext")]),t._v("属性来设置引导程序的"),s("code",[t._v("Environment")]),t._v("。如果有一个活动的配置文件（从"),s("code",[t._v("spring.profiles.active")]),t._v("或通过"),s("code",[t._v("Environment")]),t._v("在上下文你正在构建API），在配置文件属性获取加载以及，同样作为普通春天启动的应用程序-例如，从"),s("code",[t._v("bootstrap-development.properties")]),t._v("一个"),s("code",[t._v("development")]),t._v("轮廓。")]),t._v(" "),s("h3",{attrs:{id:"_1-4。覆盖远程属性的值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-4。覆盖远程属性的值"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#overriding-bootstrap-properties",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.4。覆盖远程属性的值"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("通过引导上下文添加到应用程序的属性源通常是“远程”的（例如，来自Spring Cloud Config Server）。默认情况下，不能在本地覆盖它们。如果要让您的应用程序使用其自己的系统属性或配置文件覆盖远程属性，则远程属性源必须通过设置来授予其权限"),s("code",[t._v("spring.cloud.config.allowOverride=true")]),t._v("（在本地设置此属性无效）。设置该标志后，将使用两个更细粒度的设置来控制远程属性相对于系统属性和应用程序本地配置的位置：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("spring.cloud.config.overrideNone=true")]),t._v("：从任何本地属性源覆盖。")]),t._v(" "),s("li",[s("code",[t._v("spring.cloud.config.overrideSystemProperties=false")]),t._v("注意：仅系统属性，命令行参数和环境变量（而不是本地配置文件）应覆盖远程设置。")])]),t._v(" "),s("h3",{attrs:{id:"_1-5。自定义引导程序配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-5。自定义引导程序配置"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#customizing-the-bootstrap-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.5。自定义引导程序配置"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("通过将条目添加到"),s("code",[t._v("/META-INF/spring.factories")]),t._v("名为的键下，可以将引导上下文设置为执行您喜欢的任何操作"),s("code",[t._v("org.springframework.cloud.bootstrap.BootstrapConfiguration")]),t._v("。它包含"),s("code",[t._v("@Configuration")]),t._v("用于创建上下文的Spring 类的逗号分隔列表。您可以在此处创建要用于主应用程序上下文进行自动装配的任何bean。"),s("code",[t._v("@Beans")]),t._v("类型的特殊合同"),s("code",[t._v("ApplicationContextInitializer")]),t._v("。如果要控制启动顺序，则可以用"),s("code",[t._v("@Order")]),t._v("注释标记类（默认顺序为"),s("code",[t._v("last")]),t._v("）。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("添加custom时"),s("code",[t._v("BootstrapConfiguration")]),t._v("，请注意不要将添加的类"),s("code",[t._v("@ComponentScanned")]),t._v("错误地插入到可能不需要它们的“主”应用程序上下文中。为引导配置类使用单独的程序包名称，并确保您的名称"),s("code",[t._v("@ComponentScan")]),t._v("或带"),s("code",[t._v("@SpringBootApplication")]),t._v("注释的配置类尚未覆盖该名称。")])]),t._v(" "),s("p",[t._v("引导过程结束时，将初始化程序注入到主"),s("code",[t._v("SpringApplication")]),t._v("实例中（这是正常的Spring Boot启动序列，无论它是作为独立应用程序运行还是在应用程序服务器中部署）。首先，从中找到的类创建引导上下文"),s("code",[t._v("spring.factories")]),t._v("。然后，在启动之前将所有"),s("code",[t._v("@Beans")]),t._v("类型"),s("code",[t._v("ApplicationContextInitializer")]),t._v("添加到主体"),s("code",[t._v("SpringApplication")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_1-6。自定义bootstrap属性源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-6。自定义bootstrap属性源"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#customizing-bootstrap-property-sources",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.6。自定义Bootstrap属性源"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("引导过程添加的外部配置的默认属性源是Spring Cloud Config Server，但是您可以通过将类型的bean添加"),s("code",[t._v("PropertySourceLocator")]),t._v("到引导上下文（通过"),s("code",[t._v("spring.factories")]),t._v("）来添加其他源。例如，您可以从其他服务器或数据库插入其他属性。")]),t._v(" "),s("p",[t._v("例如，请考虑以下定制定位器：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomPropertySourceLocator")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PropertySourceLocator")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PropertySource")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("locate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Environment")]),t._v(" environment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MapPropertySource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"customProperty"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collections")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("singletonMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"property.from.sample.custom.source"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"worked as intended"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("该"),s("code",[t._v("Environment")]),t._v("传递进来的是一个用于"),s("code",[t._v("ApplicationContext")]),t._v("将要创建的-换句话说，一个为我们提供更多的财产来源。它已经有其正常的Spring Boot提供的属性源，因此您可以使用这些属性源来查找特定于此的属性源"),s("code",[t._v("Environment")]),t._v("（例如，通过将其键入"),s("code",[t._v("spring.application.name")]),t._v("，就像在默认的Spring Cloud Config Server属性源定位器中所做的那样）。")]),t._v(" "),s("p",[t._v("如果您在其中包含此类的jar创建一个jar，然后添加一个"),s("code",[t._v("META-INF/spring.factories")]),t._v("包含以下"),s("code",[t._v("customProperty")]),t._v(" "),s("code",[t._v("PropertySource")]),t._v("内容的jar，则在包含该jar的classpath的任何应用程序中都会出现：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("org.springframework.cloud.bootstrap.BootstrapConfiguration = sample.custom.CustomPropertySourceLocator\n")])])]),s("h3",{attrs:{id:"_1-7。记录配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-7。记录配置"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#logging-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.7。记录配置"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果要使用Spring Boot配置日志设置，则应将此配置放在`bootstrap。[yml | 属性]，如果您希望将其应用于所有事件。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("为了使Spring Cloud正确初始化日志记录配置，您不能使用自定义前缀。例如，"),s("code",[t._v("custom.loggin.logpath")]),t._v("初始化日志记录系统时，Spring Cloud不会识别使用。")])]),t._v(" "),s("h3",{attrs:{id:"_1-8。环境变化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-8。环境变化"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#environment-changes",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.8。环境变化"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("用于该应用程序监听"),s("code",[t._v("EnvironmentChangeEvent")]),t._v("并反应在几个标准方法的变化（附加"),s("code",[t._v("ApplicationListeners")]),t._v("可添加如"),s("code",[t._v("@Beans")]),t._v("通过以正常的方式的用户）。当"),s("code",[t._v("EnvironmentChangeEvent")]),t._v("观察到时，它具有已更改的键值的列表，应用程序使用这些键值来：")]),t._v(" "),s("ul",[s("li",[t._v("重新绑定"),s("code",[t._v("@ConfigurationProperties")]),t._v("上下文中的所有bean")]),t._v(" "),s("li",[t._v("在以下位置设置记录器级别的任何属性 "),s("code",[t._v("logging.level.*")])])]),t._v(" "),s("p",[t._v("请注意，默认情况下，Config Client不会轮询中的更改"),s("code",[t._v("Environment")]),t._v("。通常，我们不建议您使用这种方法来检测更改（尽管您可以使用 "),s("code",[t._v("@Scheduled")]),t._v("批注进行设置）。如果您具有横向扩展的客户端应用程序，最好将其广播"),s("code",[t._v("EnvironmentChangeEvent")]),t._v("给所有实例，而不是让它们轮询更改（例如，通过使用"),s("a",{attrs:{href:"https://github.com/spring-cloud/spring-cloud-bus",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud Bus"),s("OutboundLink")],1),t._v("）。")]),t._v(" "),s("p",[s("code",[t._v("EnvironmentChangeEvent")]),t._v("只要您可以实际更改"),s("code",[t._v("Environment")]),t._v("和发布事件，本章就涵盖了一大类刷新用例。请注意，这些API是公共的，并且是核心Spring的一部分）。您可以"),s("code",[t._v("@ConfigurationProperties")]),t._v("通过访问"),s("code",[t._v("/configprops")]),t._v("端点来验证更改是否已绑定到bean （正常的Spring Boot Actuator功能）。例如，"),s("code",[t._v("DataSource")]),t._v("可以"),s("code",[t._v("maxPoolSize")]),t._v("在运行时更改其名称（"),s("code",[t._v("DataSource")]),t._v("Spring Boot创建的默认值为"),s("code",[t._v("@ConfigurationProperties")]),t._v("Bean）并动态增加容量。重新绑定"),s("code",[t._v("@ConfigurationProperties")]),t._v("不涉及另一类大类用例，在这些用例中，您需要对刷新有更多的控制，并且需要进行更改以使整体成为原子"),s("code",[t._v("ApplicationContext")]),t._v("。为了解决这些问题，我们有"),s("code",[t._v("@RefreshScope")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_1-9。刷新范围"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-9。刷新范围"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#refresh-scope",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.9。刷新范围"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("进行配置更改时，"),s("code",[t._v("@Bean")]),t._v("标记为的Spring "),s("code",[t._v("@RefreshScope")]),t._v("会得到特殊处理。此功能解决了有状态Bean的问题，只有在初始化它们时才注入配置。例如，如果"),s("code",[t._v("DataSource")]),t._v("通过更改数据库URL时a 具有开放的连接"),s("code",[t._v("Environment")]),t._v("，则您可能希望这些连接的持有人能够完成它们的工作。然后，下次某物从池中借用连接时，它将获得具有新URL的连接。")]),t._v(" "),s("p",[t._v("有时，甚至可能必须将"),s("code",[t._v("@RefreshScope")]),t._v(" 注释应用于只能初始化一次的某些bean。如果bean是“不可变的”，则必须使用注释bean "),s("code",[t._v("@RefreshScope")]),t._v(" 或在属性key下指定类名 "),s("code",[t._v("spring.cloud.refresh.extra-refreshable")]),t._v("。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("如果您"),s("code",[t._v("DataSource")]),t._v("自己创建一个bean，并且实现是a "),s("code",[t._v("HikariDataSource")]),t._v("，则返回最特定的类型，在这种情况下为"),s("code",[t._v("HikariDataSource")]),t._v("。否则，您需要设置 "),s("code",[t._v("spring.cloud.refresh.extra-refreshable=javax.sql.DataSource")]),t._v("。")])]),t._v(" "),s("p",[t._v("刷新作用域bean是惰性代理，它们在使用时（即，在调用方法时）进行初始化，并且作用域充当初始化值的缓存。要强制bean在下一个方法调用上重新初始化，必须使它的缓存条目无效。")]),t._v(" "),s("p",[t._v("该"),s("code",[t._v("RefreshScope")]),t._v("是在上下文中的豆和具有公共"),s("code",[t._v("refreshAll()")]),t._v("方法通过清除目标缓存刷新范围内的所有豆。的"),s("code",[t._v("/refresh")]),t._v("端点暴露该功能（通过HTTP或JMX）。要通过名称刷新单个bean，还有一种"),s("code",[t._v("refresh(String)")]),t._v("方法。")]),t._v(" "),s("p",[t._v("要公开"),s("code",[t._v("/refresh")]),t._v("端点，您需要在应用程序中添加以下配置：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("management")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exposure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" refresh\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[s("code",[t._v("@RefreshScope")]),t._v("（在技术上）在一个"),s("code",[t._v("@Configuration")]),t._v("类上工作，但这可能会导致令人惊讶的行为。例如，这并不意味着"),s("code",[t._v("@Beans")]),t._v("该类中的所有定义本身都在中"),s("code",[t._v("@RefreshScope")]),t._v("。具体来说，除非刷新本身位于，否则任何依赖于这些bean的东西都不能依赖于刷新启动时对其进行更新"),s("code",[t._v("@RefreshScope")]),t._v("。在这种情况下，将在刷新时重建它，并重新注入其依赖项。此时，它们将从刷新的"),s("code",[t._v("@Configuration")]),t._v("）中重新初始化。")])]),t._v(" "),s("h3",{attrs:{id:"_1-10。加密与解密"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-10。加密与解密"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#encryption-and-decryption",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.10。加密与解密"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Spring Cloud有一个"),s("code",[t._v("Environment")]),t._v("预处理器，用于在本地解密属性值。它遵循与Config Server相同的规则，并通过进行相同的外部配置"),s("code",[t._v("encrypt.*")]),t._v("。因此，您可以使用"),s("code",[t._v("{cipher}*")]),t._v("和形式的加密值，只要有有效的密钥，就可以在主应用程序上下文获得"),s("code",[t._v("Environment")]),t._v("设置之前对它们进行解密。要在应用程序中使用加密功能，您需要在类路径中包含Spring Security RSA（Maven坐标：“ org.springframework.security:spring-security-rsa”），并且您还需要在其中包含完整的JCE扩展。您的JVM。")]),t._v(" "),s("p",[t._v("如果由于“密钥大小非法”而导致异常，并且使用Sun的JDK，则需要安装Java密码学扩展（JCE）无限强度管辖权策略文件。有关更多信息，请参见以下链接：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.oracle.com/technetwork/java/javase/downloads/jce-6-download-429243.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java 6 JCE"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java 7 JCE"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java 8 JCE"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("将文件解压缩到所使用的JRE / JDK x64 / x86版本的JDK / jre / lib / security文件夹中。")]),t._v(" "),s("h3",{attrs:{id:"_1-11。终点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-11。终点"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#endpoints",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.11。终点"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("对于Spring Boot Actuator应用程序，可以使用一些其他管理端点。您可以使用：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("POST")]),t._v("以"),s("code",[t._v("/actuator/env")]),t._v("更新"),s("code",[t._v("Environment")]),t._v("和重新绑定"),s("code",[t._v("@ConfigurationProperties")]),t._v("以及日志级别。")]),t._v(" "),s("li",[s("code",[t._v("/actuator/refresh")]),t._v("重新加载引导上下文并刷新"),s("code",[t._v("@RefreshScope")]),t._v("Bean。")]),t._v(" "),s("li",[s("code",[t._v("/actuator/restart")]),t._v("关闭"),s("code",[t._v("ApplicationContext")]),t._v("并重新启动它（默认情况下处于禁用状态）。")]),t._v(" "),s("li",[s("code",[t._v("/actuator/pause")]),t._v("和"),s("code",[t._v("/actuator/resume")]),t._v("调用的"),s("code",[t._v("Lifecycle")]),t._v("方法（"),s("code",[t._v("stop()")]),t._v("和"),s("code",[t._v("start()")]),t._v("上"),s("code",[t._v("ApplicationContext")]),t._v("）。")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("如果您禁用"),s("code",[t._v("/actuator/restart")]),t._v("端点，则"),s("code",[t._v("/actuator/pause")]),t._v("和"),s("code",[t._v("/actuator/resume")]),t._v("端点也将被禁用，因为它们只是的特殊情况"),s("code",[t._v("/actuator/restart")]),t._v("。")])]),t._v(" "),s("h2",{attrs:{id:"_2-spring-cloud-commons：通用抽象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-spring-cloud-commons：通用抽象"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-commons-common-abstractions",target:"_blank",rel:"noopener noreferrer"}},[t._v("2. Spring Cloud Commons：通用抽象"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("服务发现，负载平衡和电路断路器等模式将它们带到一个通用的抽象层，可以由所有Spring Cloud客户端使用，而与实现无关（例如，使用Eureka或Consul进行发现）。")]),t._v(" "),s("h3",{attrs:{id:"_2-1。-enablediscoveryclient"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1。-enablediscoveryclient"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#discovery-client",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.1。@EnableDiscoveryClient"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Spring Cloud Commons提供了"),s("code",[t._v("@EnableDiscoveryClient")]),t._v("注释。这看起来对的实现"),s("code",[t._v("DiscoveryClient")]),t._v("和"),s("code",[t._v("ReactiveDiscoveryClient")]),t._v("接口用"),s("code",[t._v("META-INF/spring.factories")]),t._v("。发现客户端的实现添加配置类"),s("code",[t._v("spring.factories")]),t._v("的下"),s("code",[t._v("org.springframework.cloud.client.discovery.EnableDiscoveryClient")]),t._v("键。"),s("code",[t._v("DiscoveryClient")]),t._v("实现示例包括"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-netflix/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud Netflix Eureka"),s("OutboundLink")],1),t._v("，"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-consul/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud Consul Discovery"),s("OutboundLink")],1),t._v("和"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-zookeeper/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud Zookeeper Discovery"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("默认情况下，Spring Cloud将同时提供阻塞和响应式服务发现客户端。您可以通过设置"),s("code",[t._v("spring.cloud.discovery.blocking.enabled=false")]),t._v("或轻松禁用阻止和/或反应式客户端"),s("code",[t._v("spring.cloud.discovery.reactive.enabled=false")]),t._v("。要完全禁用服务发现，您只需设置"),s("code",[t._v("spring.cloud.discovery.enabled=false")]),t._v("。")]),t._v(" "),s("p",[t._v("默认情况下，"),s("code",[t._v("DiscoveryClient")]),t._v("将本地Spring Boot服务器自动注册到远程发现服务器的实现。可以通过"),s("code",[t._v("autoRegister=false")]),t._v("在中设置禁用此行为"),s("code",[t._v("@EnableDiscoveryClient")]),t._v("。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[s("code",[t._v("@EnableDiscoveryClient")]),t._v("不再需要。您可以将"),s("code",[t._v("DiscoveryClient")]),t._v("实现放在类路径上，以使Spring Boot应用程序向服务发现服务器注册。")])]),t._v(" "),s("h4",{attrs:{id:"_2-1-1。健康指标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1。健康指标"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#health-indicator",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.1.1。健康指标"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Commons创建了一个Spring Boot "),s("code",[t._v("HealthIndicator")]),t._v("，"),s("code",[t._v("DiscoveryClient")]),t._v("实现可以通过实现来参与"),s("code",[t._v("DiscoveryHealthIndicator")]),t._v("。要禁用复合"),s("code",[t._v("HealthIndicator")]),t._v("，请设置"),s("code",[t._v("spring.cloud.discovery.client.composite-indicator.enabled=false")]),t._v("。自动配置了通用"),s("code",[t._v("HealthIndicator")]),t._v("依据。要禁用它，请设置。要禁用的描述字段，请设置。否则，它可以冒泡作为的卷起。"),s("code",[t._v("DiscoveryClient``DiscoveryClientHealthIndicator``spring.cloud.discovery.client.health-indicator.enabled=false``DiscoveryClientHealthIndicator``spring.cloud.discovery.client.health-indicator.include-description=false``description``HealthIndicator")])]),t._v(" "),s("h4",{attrs:{id:"_2-1-2。订购discoveryclient实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2。订购discoveryclient实例"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#ordering-discoveryclient-instances",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.1.2。订购"),s("code",[t._v("DiscoveryClient")]),t._v("实例"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("code",[t._v("DiscoveryClient")]),t._v("接口扩展"),s("code",[t._v("Ordered")]),t._v("。当使用多个发现客户端时，这很有用，因为它允许您定义返回的发现客户端的顺序，类似于如何订购Spring应用程序加载的bean。默认情况下，any的顺序"),s("code",[t._v("DiscoveryClient")]),t._v("设置为 "),s("code",[t._v("0")]),t._v("。如果要为自定义"),s("code",[t._v("DiscoveryClient")]),t._v("实现设置不同的顺序，则只需要重写该"),s("code",[t._v("getOrder()")]),t._v("方法，以便它返回适合您的设置的值。除了这个，你可以使用属性来设置的顺序"),s("code",[t._v("DiscoveryClient")]),t._v(" 由Spring提供的云计算等等的实现"),s("code",[t._v("ConsulDiscoveryClient")]),t._v("，"),s("code",[t._v("EurekaDiscoveryClient")]),t._v("和 "),s("code",[t._v("ZookeeperDiscoveryClient")]),t._v("。为此，您只需将 "),s("code",[t._v("spring.cloud.{clientIdentifier}.discovery.order")]),t._v("（或"),s("code",[t._v("eureka.client.order")]),t._v("Eureka）属性设置为所需值。")]),t._v(" "),s("h3",{attrs:{id:"_2-2。服务注册"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2。服务注册"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#serviceregistry",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.2。服务注册"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Commons现在提供一个"),s("code",[t._v("ServiceRegistry")]),t._v("接口，该接口提供诸如"),s("code",[t._v("register(Registration)")]),t._v("和的方法"),s("code",[t._v("deregister(Registration)")]),t._v("，这些方法使您可以提供自定义的注册服务。 "),s("code",[t._v("Registration")]),t._v("是标记界面。")]),t._v(" "),s("p",[t._v("以下示例显示了"),s("code",[t._v("ServiceRegistry")]),t._v("正在使用的：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableDiscoveryClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("autoRegister"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServiceRegistry")]),t._v(" registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServiceRegistry")]),t._v(" registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("registry "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// called through some external process, such as an event or a custom actuator endpoint")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Registration")]),t._v(" registration "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructRegistration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("registry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("registration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("每个"),s("code",[t._v("ServiceRegistry")]),t._v("实现都有自己的"),s("code",[t._v("Registry")]),t._v("实现。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("ZookeeperRegistration")]),t._v(" 用于 "),s("code",[t._v("ZookeeperServiceRegistry")])]),t._v(" "),s("li",[s("code",[t._v("EurekaRegistration")]),t._v(" 用于 "),s("code",[t._v("EurekaServiceRegistry")])]),t._v(" "),s("li",[s("code",[t._v("ConsulRegistration")]),t._v(" 用于 "),s("code",[t._v("ConsulServiceRegistry")])])]),t._v(" "),s("p",[t._v("如果使用的是"),s("code",[t._v("ServiceRegistry")]),t._v("接口，则将需要为使用"),s("code",[t._v("Registry")]),t._v("的"),s("code",[t._v("ServiceRegistry")]),t._v("实现传递正确的实现。")]),t._v(" "),s("h4",{attrs:{id:"_2-2-1。serviceregistry自动注册"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1。serviceregistry自动注册"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#serviceregistry-auto-registration",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.2.1。ServiceRegistry自动注册"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("默认情况下，"),s("code",[t._v("ServiceRegistry")]),t._v("实现会自动注册正在运行的服务。要禁用该行为，您可以设置：* "),s("code",[t._v("@EnableDiscoveryClient(autoRegister=false)")]),t._v("永久禁用自动注册。* "),s("code",[t._v("spring.cloud.service-registry.auto-registration.enabled=false")]),t._v("通过配置禁用行为。")]),t._v(" "),s("h5",{attrs:{id:"serviceregistry自动注册事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#serviceregistry自动注册事件"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#serviceregistry-auto-registration-events",target:"_blank",rel:"noopener noreferrer"}},[t._v("ServiceRegistry自动注册事件"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("服务自动注册时将触发两个事件。在"),s("code",[t._v("InstancePreRegisteredEvent")]),t._v("注册服务之前会触发名为的第一个事件 。"),s("code",[t._v("InstanceRegisteredEvent")]),t._v("注册服务后会触发第二个事件，称为。您可以注册一个 "),s("code",[t._v("ApplicationListener")]),t._v("或多个以收听和响应这些事件。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("如果"),s("code",[t._v("spring.cloud.service-registry.auto-registration.enabled")]),t._v("将设置为，则不会触发这些事件"),s("code",[t._v("false")]),t._v("。")])]),t._v(" "),s("h4",{attrs:{id:"_2-2-2。服务注册表执行器端点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2。服务注册表执行器端点"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#service-registry-actuator-endpoint",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.2.2。服务注册表执行器端点"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Spring Cloud Commons提供了一个"),s("code",[t._v("/service-registry")]),t._v("执行器端点。该端点依赖于"),s("code",[t._v("Registration")]),t._v("Spring Application Context中的bean。"),s("code",[t._v("/service-registry")]),t._v("使用GET 调用会返回的状态"),s("code",[t._v("Registration")]),t._v("。对具有JSON正文的同一端点使用POST会将当前状态更改"),s("code",[t._v("Registration")]),t._v("为新值。JSON正文必须包含"),s("code",[t._v("status")]),t._v("具有首选值的字段。请"),s("code",[t._v("ServiceRegistry")]),t._v("在更新状态时查看用于允许值的实现文档，并为状态返回值。例如，尤里卡支持的状态是"),s("code",[t._v("UP")]),t._v("，"),s("code",[t._v("DOWN")]),t._v("，"),s("code",[t._v("OUT_OF_SERVICE")]),t._v("，和"),s("code",[t._v("UNKNOWN")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_2-3。spring-resttemplate作为负载均衡器客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3。spring-resttemplate作为负载均衡器客户端"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#rest-template-loadbalancer-client",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.3。Spring RestTemplate作为负载均衡器客户端"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("code",[t._v("RestTemplate")]),t._v("可以自动配置为在后台使用负载均衡器客户端。要创建负载均衡的"),s("code",[t._v("RestTemplate")]),t._v("，请创建一个"),s("code",[t._v("RestTemplate")]),t._v(" "),s("code",[t._v("@Bean")]),t._v("并使用"),s("code",[t._v("@LoadBalanced")]),t._v("限定符，如以下示例所示：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("restTemplate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyClass")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" restTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doOtherStuff")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" results "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" restTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getForObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://stores/stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" results"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[s("code",[t._v("RestTemplate")]),t._v("豆不再通过自动配置创建。各个应用程序必须创建它。")])]),t._v(" "),s("p",[t._v("URI需要使用虚拟主机名（即服务名，而不是主机名）。功能区客户端用于创建完整的物理地址。有关如何进行"),s("code",[t._v("RestTemplate")]),t._v("设置好了。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("为了使用负载均衡"),s("code",[t._v("RestTemplate")]),t._v("，您需要在类路径中有一个负载均衡器实现。推荐的实现是"),s("code",[t._v("BlockingLoadBalancerClient")]),t._v(" -将"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-loadbalancer-starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud LoadBalancer启动器"),s("OutboundLink")],1),t._v("添加到您的项目中以使用它。该 "),s("code",[t._v("RibbonLoadBalancerClient")]),t._v("也可以使用，但现在正在维修它，我们不建议将其添加到新的项目。")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("如果同时具有"),s("code",[t._v("RibbonLoadBalancerClient")]),t._v("和"),s("code",[t._v("BlockingLoadBalancerClient")]),t._v("，则为了保持向后兼容性，"),s("code",[t._v("RibbonLoadBalancerClient")]),t._v("将默认使用。为了覆盖它，您可以将属性设置"),s("code",[t._v("spring.cloud.loadbalancer.ribbon.enabled")]),t._v("为"),s("code",[t._v("false")]),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"_2-4。spring-webclient作为负载均衡器客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4。spring-webclient作为负载均衡器客户端"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#webclinet-loadbalancer-client",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.4。Spring WebClient作为负载均衡器客户端"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("code",[t._v("WebClient")]),t._v("可以自动配置为使用负载平衡器客户端。要创建负载均衡的"),s("code",[t._v("WebClient")]),t._v("，请创建一个"),s("code",[t._v("WebClient.Builder")]),t._v(" "),s("code",[t._v("@Bean")]),t._v("并使用"),s("code",[t._v("@LoadBalanced")]),t._v("限定符，如以下示例所示：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadBalancedWebClientBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyClass")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" webClientBuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doOtherStuff")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" webClientBuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://stores/stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("retrieve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyToMono")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("URI需要使用虚拟主机名（即服务名，而不是主机名）。Ribbon客户端或Spring Cloud LoadBalancer用于创建完整的物理地址。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),s("p",[t._v("如果要使用"),s("code",[t._v("@LoadBalanced WebClient.Builder")]),t._v("，则需要在类路径中有一个loadbalancer实现。建议您将"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-loadbalancer-starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud LoadBalancer启动器"),s("OutboundLink")],1),t._v("添加 到项目中。然后，"),s("code",[t._v("ReactiveLoadBalancer")]),t._v("将在下面使用。或者，此功能也可以与一起使用"),s("code",[t._v("spring-cloud-starter-netflix-ribbon")]),t._v("，但是请求将由后台的非反应式处理"),s("code",[t._v("LoadBalancerClient")]),t._v("。此外，spring-cloud-starter-netflix-ribbon已经处于维护模式，因此我们不建议您将其添加到新项目中。如果 在类路径中同时存在"),s("code",[t._v("spring-cloud-starter-loadbalancer")]),t._v("和"),s("code",[t._v("spring-cloud-starter-netflix-ribbon")]),t._v("，则默认情况下将使用功能区。为了切换到Spring Cloud LoadBalancer，将值设置"),s("code",[t._v("spring.cloud.loadbalancer.ribbon.enabled")]),t._v("为false。")])]),t._v(" "),s("h4",{attrs:{id:"_2-4-1。重试失败的请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1。重试失败的请求"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#retrying-failed-requests",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.4.1。重试失败的请求"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("code",[t._v("RestTemplate")]),t._v("可以配置负载平衡以重试失败的请求。默认情况下，禁用此逻辑。您可以通过将"),s("a",{attrs:{href:"https://github.com/spring-projects/spring-retry",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Retry"),s("OutboundLink")],1),t._v("添加到应用程序的类路径来启用它。负载平衡"),s("code",[t._v("RestTemplate")]),t._v("遵循与重试失败请求有关的某些功能区配置值。您可以使用"),s("code",[t._v("client.ribbon.MaxAutoRetries")]),t._v("，"),s("code",[t._v("client.ribbon.MaxAutoRetriesNextServer")]),t._v("和"),s("code",[t._v("client.ribbon.OkToRetryOnAllOperations")]),t._v("性能。如果要在类路径上使用Spring Retry禁用重试逻辑，可以设置"),s("code",[t._v("spring.cloud.loadbalancer.retry.enabled=false")]),t._v("。有关这些属性的说明，请参见"),s("a",{attrs:{href:"https://github.com/Netflix/ribbon/wiki/Getting-Started#the-properties-file-sample-clientproperties",target:"_blank",rel:"noopener noreferrer"}},[t._v("功能区文档"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("如果您想"),s("code",[t._v("BackOffPolicy")]),t._v("在重试中实现a ，则需要创建一个类型为bean的bean "),s("code",[t._v("LoadBalancedRetryFactory")]),t._v("并重写该"),s("code",[t._v("createBackOffPolicy")]),t._v("方法：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoadBalancedRetryFactory")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("retryFactory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoadBalancedRetryFactory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BackOffPolicy")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createBackOffPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExponentialBackOffPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),s("p",[s("code",[t._v("client")]),t._v(" 在上述示例中，应将其替换为Ribbon客户的名称。\n如果要向"),s("code",[t._v("RetryListener")]),t._v("重试功能添加一个或多个实现，则需要创建一个类型的bean "),s("code",[t._v("LoadBalancedRetryListenerFactory")]),t._v("并返回"),s("code",[t._v("RetryListener")]),t._v("要用于给定服务的数组，如以下示例所示：")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoadBalancedRetryListenerFactory")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("retryListenerFactory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoadBalancedRetryListenerFactory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createRetryListeners")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("E")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryCallback")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("E")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//TODO Do you business...")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n                    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n                     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("E")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryCallback")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("E")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" throwable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//TODO Do you business...")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n                    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("E")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onError")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RetryCallback")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("E")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" callback"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" throwable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//TODO Do you business...")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-5。多个resttemplate对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5。多个resttemplate对象"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#multiple-resttemplate-objects",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.5。多个RestTemplate对象"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果您想要一个"),s("code",[t._v("RestTemplate")]),t._v("没有负载平衡的，创建一个"),s("code",[t._v("RestTemplate")]),t._v("bean并注入它。要访问负载均衡的"),s("code",[t._v("RestTemplate")]),t._v("，请"),s("code",[t._v("@LoadBalanced")]),t._v("在创建时使用限定符"),s("code",[t._v("@Bean")]),t._v("，如以下示例所示：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadBalanced")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Primary")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("restTemplate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyClass")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" restTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" loadBalanced"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doOtherStuff")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" loadBalanced"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getForObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://stores/stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doStuff")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" restTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getForObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://example.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),s("p",[t._v("请注意，在前面的示例中，"),s("code",[t._v("@Primary")]),t._v("在普通"),s("code",[t._v("RestTemplate")]),t._v("声明上使用了注释，以消除不合格的"),s("code",[t._v("@Autowired")]),t._v("注入的歧义。")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),s("p",[t._v("如果看到诸如此类的错误"),s("code",[t._v("java.lang.IllegalArgumentException: Can not set org.springframework.web.client.RestTemplate field com.my.app.Foo.restTemplate to com.sun.proxy.$Proxy89")]),t._v("，请尝试注入"),s("code",[t._v("RestOperations")]),t._v("或设置"),s("code",[t._v("spring.aop.proxyTargetClass=true")]),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"_2-6。多个webclient对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-6。多个webclient对象"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#multiple-webclient-objects",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.6。多个WebClient对象"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果您想要一个"),s("code",[t._v("WebClient")]),t._v("没有负载平衡的，创建一个"),s("code",[t._v("WebClient")]),t._v("bean并注入它。要访问负载均衡的"),s("code",[t._v("WebClient")]),t._v("，请"),s("code",[t._v("@LoadBalanced")]),t._v("在创建时使用限定符"),s("code",[t._v("@Bean")]),t._v("，如以下示例所示：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadBalanced")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Primary")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("webClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyClass")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" webClientBuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" loadBalanced"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doOtherStuff")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" loadBalanced"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://stores/stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("retrieve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyToMono")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doStuff")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" webClientBuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://example.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("retrieve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyToMono")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-7。spring-webflux-webclient作为负载均衡器客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-7。spring-webflux-webclient作为负载均衡器客户端"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#loadbalanced-webclient",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.7。Spring WebFlux WebClient作为负载均衡器客户端"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"_2-7-1。具有reactorloadbalancerexchangefilterfunction的spring-webflux-webclient"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-1。具有reactorloadbalancerexchangefilterfunction的spring-webflux-webclient"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#webflux-with-reactive-loadbalancer",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.7.1。具有ReactorLoadBalancerExchangeFilterFunction的Spring WebFlux WebClient"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("code",[t._v("WebClient")]),t._v("可以配置为使用"),s("code",[t._v("ReactiveLoadBalancer")]),t._v("。如果您将"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-loadbalancer-starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Cloud LoadBalancer启动器"),s("OutboundLink")],1),t._v("添加到您的项目中， "),s("code",[t._v("ReactorLoadBalancerExchangeFilterFunction")]),t._v("则"),s("code",[t._v("spring-webflux")]),t._v("在类路径中自动配置。以下示例显示了如何配置以"),s("code",[t._v("WebClient")]),t._v("在后台使用无功负载均衡器：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyClass")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReactorLoadBalancerExchangeFilterFunction")]),t._v(" lbFunction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doOtherStuff")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("baseUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lbFunction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("retrieve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyToMono")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("URI需要使用虚拟主机名（即服务名，而不是主机名）。将"),s("code",[t._v("ReactorLoadBalancer")]),t._v("用于创建一个完整的物理地址。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),s("p",[t._v("如果您"),s("code",[t._v("spring-cloud-netflix-ribbon")]),t._v("在类路径中，"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#load-balancer-exchange-filter-function",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("LoadBalancerExchangeFilterFunction")]),s("OutboundLink")],1),t._v(" 默认情况下将使用它来保持向后兼容性。为了能够使用 "),s("code",[t._v("ReactorLoadBalancerExchangeFilterFunction")]),t._v("，请将"),s("code",[t._v("spring.cloud.loadbalancer.ribbon.enabled")]),t._v("property 的值设置为"),s("code",[t._v("false")]),t._v("。")])]),t._v(" "),s("h4",{attrs:{id:"_2-7-2。带有非反应式负载均衡器客户端的spring-webflux-webclient"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-2。带有非反应式负载均衡器客户端的spring-webflux-webclient"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#load-balancer-exchange-filter-function",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.7.2。带有非反应式负载均衡器客户端的Spring WebFlux WebClient"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果你没有"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-loadbalancer-starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("春天的云负载平衡器启动"),s("OutboundLink")],1),t._v("您的项目，但你确实有弹簧云起动Netflix的丝带，你仍然可以使用"),s("code",[t._v("WebClient")]),t._v("带"),s("code",[t._v("LoadBalancerClient")]),t._v("。"),s("code",[t._v("LoadBalancerExchangeFilterFunction")]),t._v(" 如果"),s("code",[t._v("spring-webflux")]),t._v("在类路径上，则将自动配置。但是请注意，这是在后台使用非反应性客户端。以下示例显示如何配置一个"),s("code",[t._v("WebClient")]),t._v("以使用负载均衡器：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyClass")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoadBalancerExchangeFilterFunction")]),t._v(" lbFunction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doOtherStuff")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("baseUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lbFunction"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("retrieve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyToMono")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("URI需要使用虚拟主机名（即服务名，而不是主机名）。将"),s("code",[t._v("LoadBalancerClient")]),t._v("用于创建一个完整的物理地址。")]),t._v(" "),s("p",[t._v("警告：现在不建议使用此方法。我们建议您将"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#webflux-with-reactive-loadbalancer",target:"_blank",rel:"noopener noreferrer"}},[t._v("WebFlux与电抗性负载平衡器一起"),s("OutboundLink")],1),t._v(" 使用。")]),t._v(" "),s("h3",{attrs:{id:"_2-8。忽略网络接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-8。忽略网络接口"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#ignore-network-interfaces",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.8。忽略网络接口"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("有时，忽略某些命名的网络接口很有用，以便可以将它们从服务发现注册中排除（例如，在Docker容器中运行时）。可以设置正则表达式列表以使所需的网络接口被忽略。以下配置将忽略该"),s("code",[t._v("docker0")]),t._v("接口以及所有以开头的接口"),s("code",[t._v("veth")]),t._v("：")]),t._v(" "),s("p",[t._v("application.yml")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("弹簧：\n  云：\n    inetutils：\n      被忽略的接口：\n        -码头工人0\n        -veth。*\n")])])]),s("p",[t._v("您还可以通过使用正则表达式列表来强制仅使用指定的网络地址，如以下示例所示：")]),t._v(" "),s("p",[t._v("bootstrap.yml")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("弹簧：\n  云：\n    inetutils：\n      preferredNetworks：\n        -192.168\n        -10.0\n")])])]),s("p",[t._v("您也可以只使用站点本地地址，如以下示例所示：.application.yml")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("弹簧：\n  云：\n    inetutils：\n      useOnlySiteLocalInterfaces：正确\n")])])]),s("p",[t._v("有关构成站点本地地址的详细信息，请参见"),s("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/api/java/net/Inet4Address.html#isSiteLocalAddress--",target:"_blank",rel:"noopener noreferrer"}},[t._v("Inet4Address.html.isSiteLocalAddress（）"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_2-9。http客户端工厂"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-9。http客户端工厂"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#http-clients",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.9。HTTP客户端工厂"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Spring Cloud Commons提供了用于创建Apache HTTP客户端（"),s("code",[t._v("ApacheHttpClientFactory")]),t._v("）和OK HTTP客户端（"),s("code",[t._v("OkHttpClientFactory")]),t._v("）的bean 。该"),s("code",[t._v("OkHttpClientFactory")]),t._v("豆创建只有在确定HTTP罐子在classpath。另外，Spring Cloud Commons提供了用于创建两个客户端都使用的连接管理器的bean："),s("code",[t._v("ApacheHttpClientConnectionManagerFactory")]),t._v("Apache HTTP客户端和"),s("code",[t._v("OkHttpClientConnectionPoolFactory")]),t._v("OK HTTP客户端。如果要自定义在下游项目中创建HTTP客户端的方式，则可以提供自己的这些Bean实现。另外，如果您提供类型为"),s("code",[t._v("HttpClientBuilder")]),t._v("或的Bean "),s("code",[t._v("OkHttpClient.Builder")]),t._v("，那么默认工厂将使用这些构建器作为返回到下游项目的构建器的基础。您还可以通过将"),s("code",[t._v("spring.cloud.httpclientfactories.apache.enabled")]),t._v("或设置"),s("code",[t._v("spring.cloud.httpclientfactories.ok.enabled")]),t._v("为来禁用这些Bean的创建"),s("code",[t._v("false")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_2-10。启用的功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-10。启用的功能"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#enabled-features",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.10。启用的功能"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Spring Cloud Commons提供了一个"),s("code",[t._v("/features")]),t._v("执行器端点。该端点返回类路径上可用的功能以及是否已启用它们。返回的信息包括功能类型，名称，版本和供应商。")]),t._v(" "),s("h4",{attrs:{id:"_2-10-1。功能类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-10-1。功能类型"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#feature-types",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.10.1。功能类型"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("“功能”有两种类型：抽象和命名。")]),t._v(" "),s("p",[t._v("抽象特征是其中的接口或抽象类定义的特性和一个实现的创造，例如"),s("code",[t._v("DiscoveryClient")]),t._v("，"),s("code",[t._v("LoadBalancerClient")]),t._v("，或"),s("code",[t._v("LockService")]),t._v("。抽象类或接口用于在上下文中查找该类型的Bean。显示的版本是"),s("code",[t._v("bean.getClass().getPackage().getImplementationVersion()")]),t._v("。")]),t._v(" "),s("p",[t._v("命名功能是没有实现的特定类的功能，例如“ Circuit Breaker”，“ API Gateway”，“ Spring Cloud Bus”等。这些功能需要名称和Bean类型。")]),t._v(" "),s("h4",{attrs:{id:"_2-10-2。声明功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-10-2。声明功能"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#declaring-features",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.10.2。声明功能"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("任何模块都可以声明任意数量的"),s("code",[t._v("HasFeature")]),t._v("bean，如以下示例所示：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HasFeatures")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commonsFeatures")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HasFeatures")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("abstractFeatures")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DiscoveryClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoadBalancerClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HasFeatures")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("consulFeatures")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HasFeatures")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("namedFeatures")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NamedFeature")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Spring Cloud Bus"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsulBusAutoConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NamedFeature")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Circuit Breaker"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HystrixCommandAspect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HasFeatures")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("localFeatures")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HasFeatures")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("abstractFeature")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Foo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("namedFeature")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NamedFeature")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bar Feature"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("abstractFeature")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Baz")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这些豆中的每一个都应该装进适当的保护层"),s("code",[t._v("@Configuration")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_2-11。spring-cloud兼容性验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-11。spring-cloud兼容性验证"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-compatibility-verification",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.11。Spring Cloud兼容性验证"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("由于某些用户在设置Spring Cloud应用程序时遇到问题，我们决定添加兼容性验证机制。如果您当前的设置与Spring Cloud要求不兼容，它会中断，并附上一份报告，显示出确切的问题。")]),t._v(" "),s("p",[t._v("目前，我们验证将哪个版本的Spring Boot添加到您的类路径中。")]),t._v(" "),s("p",[t._v("报告范例")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("****************************\n申请开始失败\n****************************\n\n描述：\n\n由于以下原因，您的项目设置不符合我们的要求：\n\n-Spring Boot [2.1.0.RELEASE]与此Spring Cloud发布系列不兼容\n\n\n行动：\n\n考虑应用以下操作：\n\n-将Spring Boot版本更改为以下版本之一[1.2.x，1.3.x]。\n您可以在[https://spring.io/projects/spring-boot#learn]中找到最新的Spring Boot版本。\n如果您想了解有关Spring Cloud Release火车兼容性的更多信息，可以访问此页面[https://spring.io/projects/spring-cloud#overview]并检查[Release Trains]部分。\n")])])]),s("p",[t._v("为了禁用此功能，请设置"),s("code",[t._v("spring.cloud.compatibility-verifier.enabled")]),t._v("为"),s("code",[t._v("false")]),t._v("。如果要覆盖兼容的Spring Boot版本，只需"),s("code",[t._v("spring.cloud.compatibility-verifier.compatible-boot-versions")]),t._v("用逗号分隔的兼容Spring Boot版本列表设置 属性。")]),t._v(" "),s("h2",{attrs:{id:"_3-spring-cloud-loadbalancer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-spring-cloud-loadbalancer"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-loadbalancer",target:"_blank",rel:"noopener noreferrer"}},[t._v("3. Spring Cloud LoadBalancer"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Spring Cloud提供了自己的客户端负载均衡器抽象和实现。对于负载平衡机制，"),s("code",[t._v("ReactiveLoadBalancer")]),t._v("已添加了接口，并为其提供了基于Round-Robin的实现。为了获得实例以从反应式中进行选择"),s("code",[t._v("ServiceInstanceListSupplier")]),t._v(" 。当前，我们支持基于服务发现的实现，"),s("code",[t._v("ServiceInstanceListSupplier")]),t._v(" 该实现使用类路径中可用的"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#discovery-client",target:"_blank",rel:"noopener noreferrer"}},[t._v("发现客户端"),s("OutboundLink")],1),t._v("从服务发现中检索可用实例。")]),t._v(" "),s("h3",{attrs:{id:"_3-1。spring-cloud-loadbalancer集成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1。spring-cloud-loadbalancer集成"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-loadbalancer-integrations",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.1。Spring Cloud LoadBalancer集成"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("为了使使用Spring Cloud LoadBalancer变得容易，我们提供"),s("code",[t._v("ReactorLoadBalancerExchangeFilterFunction")]),t._v("可以与一起使用并"),s("code",[t._v("WebClient")]),t._v("与"),s("code",[t._v("BlockingLoadBalancerClient")]),t._v("一起使用"),s("code",[t._v("RestTemplate")]),t._v("。您可以在以下各节中查看更多信息和用法示例：")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#rest-template-loadbalancer-client",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring RestTemplate作为负载均衡器客户端"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#webclinet-loadbalancer-client",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring WebClient作为负载均衡器客户端"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#webflux-with-reactive-loadbalancer",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring WebFlux WebClient与 "),s("code",[t._v("ReactorLoadBalancerExchangeFilterFunction")]),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"_3-2。spring-cloud-loadbalancer缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2。spring-cloud-loadbalancer缓存"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-loadbalancer-caching",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.2。Spring Cloud LoadBalancer缓存"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("除了基本的"),s("code",[t._v("ServiceInstanceListSupplier")]),t._v("实现需要"),s("code",[t._v("DiscoveryClient")]),t._v("每次选择一个实例来检索实例之外，我们还提供了两种缓存实现。")]),t._v(" "),s("h4",{attrs:{id:"_3-2-1。咖啡因支持的loadbalancer缓存实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1。咖啡因支持的loadbalancer缓存实现"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#caffeine-backed-loadbalancer-cache-implementation",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.2.1。"),s("OutboundLink")],1),s("a",{attrs:{href:"https://github.com/ben-manes/caffeine",target:"_blank",rel:"noopener noreferrer"}},[t._v("咖啡因"),s("OutboundLink")],1),t._v("支持的LoadBalancer缓存实现")]),t._v(" "),s("p",[t._v("如果您"),s("code",[t._v("com.github.ben-manes.caffeine:caffeine")]),t._v("在类路径中，则将使用基于咖啡因的实现。有关如何配置它的信息，请参见"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#loadbalancer-cache-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("LoadBalancerCacheConfiguration"),s("OutboundLink")],1),t._v("部分。")]),t._v(" "),s("p",[t._v("如果您使用的是Caffeine，还可以通过 在属性中传递自己的"),s("a",{attrs:{href:"https://static.javadoc.io/com.github.ben-manes.caffeine/caffeine/2.2.2/com/github/benmanes/caffeine/cache/CaffeineSpec.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Caffeine规范"),s("OutboundLink")],1),t._v("来覆盖LoadBalancer的默认Caffeine Cache设置"),s("code",[t._v("spring.cloud.loadbalancer.cache.caffeine.spec")]),t._v("。")]),t._v(" "),s("p",[t._v("警告：传递您自己的Caffeine规范将覆盖任何其他LoadBalancerCache设置，包括“ "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#loadbalancer-cache-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("常规LoadBalancer缓存配置”"),s("OutboundLink")],1),t._v("字段，例如"),s("code",[t._v("ttl")]),t._v("和"),s("code",[t._v("capacity")]),t._v("。")]),t._v(" "),s("h4",{attrs:{id:"_3-2-2。默认的loadbalancer缓存实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2。默认的loadbalancer缓存实现"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#default-loadbalancer-cache-implementation",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.2.2。默认的LoadBalancer缓存实现"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果您在类路径中没有咖啡因，则将使用"),s("code",[t._v("DefaultLoadBalancerCache")]),t._v("随附的"),s("code",[t._v("spring-cloud-starter-loadbalancer")]),t._v("。有关如何配置它的信息，请参见"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#loadbalancer-cache-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("LoadBalancerCacheConfiguration"),s("OutboundLink")],1),t._v("部分。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),s("p",[t._v("要使用Caffeine而不是默认缓存，请将"),s("code",[t._v("com.github.ben-manes.caffeine:caffeine")]),t._v("依赖项添加到classpath。")])]),t._v(" "),s("h4",{attrs:{id:"_3-2-3。loadbalancer缓存配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3。loadbalancer缓存配置"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#loadbalancer-cache-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.2.3。LoadBalancer缓存配置"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("您可以通过将与"),s("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config-conversion-duration",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Boot"),s("OutboundLink")],1),t._v("兼容的规范传递"),s("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config-conversion-duration",target:"_blank",rel:"noopener noreferrer"}},[t._v("给"),s("OutboundLink")],1),s("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config-conversion-duration",target:"_blank",rel:"noopener noreferrer"}},[t._v("转换器语法，"),s("OutboundLink")],1),t._v("来设置自己的"),s("code",[t._v("ttl")]),t._v("值（写后的时间，条目应在该时间之后过期）。作为属性的值。您还可以通过设置属性的值来设置自己的LoadBalancer缓存初始容量。"),s("code",[t._v("Duration``String")]),s("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config-conversion-duration",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("String``Duration")]),s("OutboundLink")],1),s("code",[t._v("spring.cloud.loadbalancer.cache.ttl``spring.cloud.loadbalancer.cache.capacity")])]),t._v(" "),s("p",[t._v("默认设置包括"),s("code",[t._v("ttl")]),t._v("30秒，默认"),s("code",[t._v("initialCapacity")]),t._v("值为"),s("code",[t._v("256")]),t._v("。")]),t._v(" "),s("p",[t._v("您还可以通过将的值设置为"),s("code",[t._v("spring.cloud.loadbalancer.cache.enabled")]),t._v(" 来完全禁用loadBalancer缓存"),s("code",[t._v("false")]),t._v("。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),s("p",[t._v("尽管基本的非缓存实现对于原型开发和测试很有用，但其效率远低于缓存版本，因此我们建议始终在生产中使用缓存版本。")])]),t._v(" "),s("h3",{attrs:{id:"_3-3。spring-cloud-loadbalancer入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3。spring-cloud-loadbalancer入门"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-loadbalancer-starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.3。Spring Cloud LoadBalancer入门"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("我们还提供了一个启动程序，使您可以轻松地在Spring Boot应用程序中添加Spring Cloud LoadBalancer。为了使用它，只需"),s("code",[t._v("org.springframework.cloud:spring-cloud-starter-loadbalancer")]),t._v("在构建文件中添加到Spring Cloud依赖项即可。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),s("p",[t._v("Spring Cloud LoadBalancer入门版包括 "),s("a",{attrs:{href:"https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-caching.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Boot Caching"),s("OutboundLink")],1),t._v(" 和"),s("a",{attrs:{href:"https://github.com/stoyanr",target:"_blank",rel:"noopener noreferrer"}},[t._v("Evictor"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("注意事项")]),t._v(" "),s("p",[t._v("如果类路径中同时具有Ribbon和Spring Cloud LoadBalancer，则为了保持向后兼容性，默认情况下将使用基于Ribbon的实现。为了切换到在后台使用Spring Cloud LoadBalancer，请确保将属性设置"),s("code",[t._v("spring.cloud.loadbalancer.ribbon.enabled")]),t._v("为"),s("code",[t._v("false")]),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"_3-4。传递自己的spring-cloud-loadbalancer配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4。传递自己的spring-cloud-loadbalancer配置"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#passing-your-own-spring-cloud-loadbalancer-configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.4。传递自己的Spring Cloud LoadBalancer配置"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("您还可以使用"),s("code",[t._v("@LoadBalancerClient")]),t._v("注释传递您自己的负载平衡器客户端配置，传递负载平衡器客户端的名称和配置类，如下所示：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalancerClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configuration "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StoresLoadBalancerClientConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadBalancedWebClientBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("也可以通过"),s("code",[t._v("@LoadBalancerClients")]),t._v("注释将多个配置（对于一个以上的负载均衡器客户端）一起传递，如下所示：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalancerClients")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalancerClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stores"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configuration "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StoresLoadBalancerClientConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalancerClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"customers"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configuration "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomersLoadBalancerClientConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyConfiguration")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadBalancedWebClientBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("builder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_4-弹簧云断路器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-弹簧云断路器"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#spring-cloud-circuit-breaker",target:"_blank",rel:"noopener noreferrer"}},[t._v("4.弹簧云断路器"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_4-1。介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1。介绍"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#introduction",target:"_blank",rel:"noopener noreferrer"}},[t._v("4.1。介绍"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Spring Cloud断路器提供了不同断路器实现之间的抽象。它提供了可在您的应用程序中使用的一致API，使开发人员可以选择最适合您的应用程序需求的断路器实现。")]),t._v(" "),s("h4",{attrs:{id:"_4-1-1。支持的实施"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1。支持的实施"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#supported-implementations",target:"_blank",rel:"noopener noreferrer"}},[t._v("4.1.1。支持的实施"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/Netflix/Hystrix",target:"_blank",rel:"noopener noreferrer"}},[t._v("Netfix Hystrix"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/resilience4j/resilience4j",target:"_blank",rel:"noopener noreferrer"}},[t._v("弹性4J"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/alibaba/Sentinel",target:"_blank",rel:"noopener noreferrer"}},[t._v("哨兵"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/spring-projects/spring-retry",target:"_blank",rel:"noopener noreferrer"}},[t._v("春季重试"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"_4-2。核心概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2。核心概念"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#core-concepts",target:"_blank",rel:"noopener noreferrer"}},[t._v("4.2。核心概念"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("要在代码中创建断路器，可以使用"),s("code",[t._v("CircuitBreakerFactory")]),t._v("API。当您在类路径中包含Spring Cloud Circuit Breaker入门程序时，将自动为您创建实现此API的bean。下面给出了一个使用此API的非常简单的示例")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DemoControllerService")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" rest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CircuitBreakerFactory")]),t._v(" cbFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DemoControllerService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" rest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CircuitBreakerFactory")]),t._v(" cbFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rest "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbFactory "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cbFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("slow")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cbFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"slow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" rest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getForObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/slow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" throwable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fallback"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("该"),s("code",[t._v("CircuitBreakerFactory.create")]),t._v("API将创建一个名为的类的实例"),s("code",[t._v("CircuitBreaker")]),t._v("。该"),s("code",[t._v("run")]),t._v("方法采用"),s("code",[t._v("Supplier")]),t._v("和"),s("code",[t._v("Function")]),t._v("。这"),s("code",[t._v("Supplier")]),t._v("是要包装在断路器中的代码。的"),s("code",[t._v("Function")]),t._v("是，如果断路器跳闸将要执行回退。该函数将传递"),s("code",[t._v("Throwable")]),t._v("导致回退触发的函数。如果不想提供回退，则可以选择排除回退。")]),t._v(" "),s("h4",{attrs:{id:"_4-2-1。无功代码断路器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1。无功代码断路器"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#circuit-breakers-in-reactive-code",target:"_blank",rel:"noopener noreferrer"}},[t._v("4.2.1。无功代码断路器"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("如果Project Reactor在类路径上，那么您也可以将其"),s("code",[t._v("ReactiveCircuitBreakerFactory")]),t._v("用于反应式代码。")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DemoControllerService")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReactiveCircuitBreakerFactory")]),t._v(" cbFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),t._v(" webClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DemoControllerService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WebClient")]),t._v(" webClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReactiveCircuitBreakerFactory")]),t._v(" cbFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webClient "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" webClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cbFactory "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cbFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("slow")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" webClient"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/slow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("retrieve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyToMono")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("transform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        it "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" cbFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"slow"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("it"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" throwable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("just")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fallback"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("该"),s("code",[t._v("ReactiveCircuitBreakerFactory.create")]),t._v("API将创建一个名为的类的实例"),s("code",[t._v("ReactiveCircuitBreaker")]),t._v("。该"),s("code",[t._v("run")]),t._v("方法使用"),s("code",[t._v("Mono")]),t._v("或"),s("code",[t._v("Flux")]),t._v("并将其包装在断路器中。您可以选择配置一个 故障预置"),s("code",[t._v("Function")]),t._v("，如果断路器跳闸并通过"),s("code",[t._v("Throwable")]),t._v("导致故障的故障，将调用该故障预置。")]),t._v(" "),s("h3",{attrs:{id:"_4-3。组态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3。组态"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("4.3。组态"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("您可以通过创建type的bean来配置断路器"),s("code",[t._v("Customizer")]),t._v("。该"),s("code",[t._v("Customizer")]),t._v("接口具有一个称为的单一方法"),s("code",[t._v("customize")]),t._v("，可以接受"),s("code",[t._v("Object")]),t._v("进行自定义。")]),t._v(" "),s("p",[t._v("有关如何自定义给定实现的详细信息，请参见下面的链接")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/spring-cloud-netflix/reference/html/#_circuit_breaker_spring_cloud_circuit_breaker_with_hystrix",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hystrix"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/spring-cloud-circuitbreaker/reference/html/spring-cloud-circuitbreaker.html#_configuring_resilience4j_circuit_breakers",target:"_blank",rel:"noopener noreferrer"}},[t._v("弹性4J"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/spring-cloud-circuitbreaker/reference/html/spring-cloud-circuitbreaker.html#_configuring_sentinel_circuit_breakers",target:"_blank",rel:"noopener noreferrer"}},[t._v("哨兵"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/spring-cloud-circuitbreaker/reference/html/spring-cloud-circuitbreaker.html#_configuring_spring_retry_circuit_breakers",target:"_blank",rel:"noopener noreferrer"}},[t._v("春季重试"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"_5-配置属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-配置属性"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/#configuration-properties",target:"_blank",rel:"noopener noreferrer"}},[t._v("5.配置属性"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("要查看所有与Spring Cloud Commons相关的配置属性的列表，请检查"),s("a",{attrs:{href:"https://cloud.spring.io/spring-cloud-static/spring-cloud-commons/2.2.0.RELEASE/reference/html/appendix.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("附录页面"),s("OutboundLink")],1),t._v("。")])])}),[],!1,null,null,null);a.default=e.exports}}]);