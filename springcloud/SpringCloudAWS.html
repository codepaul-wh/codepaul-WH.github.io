<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Cloud AWS |  </title>
    <meta name="description" content=" ">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="sodoc/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.6d3e66e0.css" as="style"><link rel="preload" href="/assets/js/app.b6fcbba0.js" as="script"><link rel="preload" href="/assets/js/2.0769d472.js" as="script"><link rel="preload" href="/assets/js/87.bfbb78e2.js" as="script"><link rel="prefetch" href="/assets/js/10.d5b488e5.js"><link rel="prefetch" href="/assets/js/11.ba7209bc.js"><link rel="prefetch" href="/assets/js/12.e31b0e29.js"><link rel="prefetch" href="/assets/js/13.319a2e91.js"><link rel="prefetch" href="/assets/js/14.9538d3bb.js"><link rel="prefetch" href="/assets/js/15.974e2eb6.js"><link rel="prefetch" href="/assets/js/16.4623b410.js"><link rel="prefetch" href="/assets/js/17.1454305d.js"><link rel="prefetch" href="/assets/js/18.0ea0d9aa.js"><link rel="prefetch" href="/assets/js/19.7ec36aa9.js"><link rel="prefetch" href="/assets/js/20.0a0492c5.js"><link rel="prefetch" href="/assets/js/21.92a8470b.js"><link rel="prefetch" href="/assets/js/22.a14b1840.js"><link rel="prefetch" href="/assets/js/23.4afb0e67.js"><link rel="prefetch" href="/assets/js/24.3e389629.js"><link rel="prefetch" href="/assets/js/25.4f11ed3d.js"><link rel="prefetch" href="/assets/js/26.efa31e99.js"><link rel="prefetch" href="/assets/js/27.20ddc719.js"><link rel="prefetch" href="/assets/js/28.eed927de.js"><link rel="prefetch" href="/assets/js/29.079ab1e8.js"><link rel="prefetch" href="/assets/js/3.79868d1c.js"><link rel="prefetch" href="/assets/js/30.1e0924ee.js"><link rel="prefetch" href="/assets/js/31.08adf573.js"><link rel="prefetch" href="/assets/js/32.428d0721.js"><link rel="prefetch" href="/assets/js/33.f0ef16bb.js"><link rel="prefetch" href="/assets/js/34.711c8d67.js"><link rel="prefetch" href="/assets/js/35.85fcf2f6.js"><link rel="prefetch" href="/assets/js/36.5eed3faf.js"><link rel="prefetch" href="/assets/js/37.65bd79fc.js"><link rel="prefetch" href="/assets/js/38.81db9686.js"><link rel="prefetch" href="/assets/js/39.e6b17a18.js"><link rel="prefetch" href="/assets/js/4.4c9f5a13.js"><link rel="prefetch" href="/assets/js/40.0e9f5587.js"><link rel="prefetch" href="/assets/js/41.9b84126f.js"><link rel="prefetch" href="/assets/js/42.ddc9ec9e.js"><link rel="prefetch" href="/assets/js/43.449fd971.js"><link rel="prefetch" href="/assets/js/44.ea48d1be.js"><link rel="prefetch" href="/assets/js/45.b98f0109.js"><link rel="prefetch" href="/assets/js/46.eb43d47f.js"><link rel="prefetch" href="/assets/js/47.ad56abc0.js"><link rel="prefetch" href="/assets/js/48.ad335a45.js"><link rel="prefetch" href="/assets/js/49.a744b401.js"><link rel="prefetch" href="/assets/js/5.229daaa0.js"><link rel="prefetch" href="/assets/js/50.ddfc0b0b.js"><link rel="prefetch" href="/assets/js/51.eec401d9.js"><link rel="prefetch" href="/assets/js/52.da7fa7ff.js"><link rel="prefetch" href="/assets/js/53.e1e2e23b.js"><link rel="prefetch" href="/assets/js/54.74848120.js"><link rel="prefetch" href="/assets/js/55.2f8c0ec8.js"><link rel="prefetch" href="/assets/js/56.d347dd0b.js"><link rel="prefetch" href="/assets/js/57.8a44d824.js"><link rel="prefetch" href="/assets/js/58.10ca6d35.js"><link rel="prefetch" href="/assets/js/59.f8d54318.js"><link rel="prefetch" href="/assets/js/6.cdc6003c.js"><link rel="prefetch" href="/assets/js/60.e6ec0e43.js"><link rel="prefetch" href="/assets/js/61.2fa7526b.js"><link rel="prefetch" href="/assets/js/62.62b59d3e.js"><link rel="prefetch" href="/assets/js/63.87ab7859.js"><link rel="prefetch" href="/assets/js/64.be84d16f.js"><link rel="prefetch" href="/assets/js/65.917244dc.js"><link rel="prefetch" href="/assets/js/66.57f646dd.js"><link rel="prefetch" href="/assets/js/67.f15ba865.js"><link rel="prefetch" href="/assets/js/68.f174a83b.js"><link rel="prefetch" href="/assets/js/69.5043f1f7.js"><link rel="prefetch" href="/assets/js/7.e24d52f3.js"><link rel="prefetch" href="/assets/js/70.84e47d9c.js"><link rel="prefetch" href="/assets/js/71.30c55144.js"><link rel="prefetch" href="/assets/js/72.66c4f565.js"><link rel="prefetch" href="/assets/js/73.73667b18.js"><link rel="prefetch" href="/assets/js/74.84caaa20.js"><link rel="prefetch" href="/assets/js/75.9525ea19.js"><link rel="prefetch" href="/assets/js/76.ec1c236a.js"><link rel="prefetch" href="/assets/js/77.fa787e3b.js"><link rel="prefetch" href="/assets/js/78.9227621f.js"><link rel="prefetch" href="/assets/js/79.dbea9a05.js"><link rel="prefetch" href="/assets/js/8.1f18086b.js"><link rel="prefetch" href="/assets/js/80.fabc8f2d.js"><link rel="prefetch" href="/assets/js/81.12a715f0.js"><link rel="prefetch" href="/assets/js/82.0a160e72.js"><link rel="prefetch" href="/assets/js/83.f6da7255.js"><link rel="prefetch" href="/assets/js/84.a34701a7.js"><link rel="prefetch" href="/assets/js/85.fc0f1ce9.js"><link rel="prefetch" href="/assets/js/86.2d59d78d.js"><link rel="prefetch" href="/assets/js/88.8f033d62.js"><link rel="prefetch" href="/assets/js/89.8d3bb835.js"><link rel="prefetch" href="/assets/js/9.e1c888cc.js"><link rel="prefetch" href="/assets/js/90.dd1fc686.js"><link rel="prefetch" href="/assets/js/91.30ce9023.js"><link rel="prefetch" href="/assets/js/92.7da53901.js"><link rel="prefetch" href="/assets/js/93.fbb2d9d8.js"><link rel="prefetch" href="/assets/js/94.246aadc9.js"><link rel="prefetch" href="/assets/js/95.bd281ef2.js"><link rel="prefetch" href="/assets/js/96.03bf67a7.js"><link rel="prefetch" href="/assets/js/97.d0f3c34f.js"><link rel="prefetch" href="/assets/js/98.bb41cb1c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6d3e66e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name"> </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SpringCloud</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/springcloud/SpringCloud文档.html" class="sidebar-link">Spring Cloud文档</a></li><li><a href="/springcloud/SpringCloud构建.html" class="sidebar-link">Spring Cloud构建</a></li><li><a href="/springcloud/springcloudcommons.html" class="sidebar-link">云原生应用</a></li><li><a href="/springcloud/SpringCloudFunction.html" class="sidebar-link">Spring Cloud Function参考文档</a></li><li><a href="/springcloud/SpringCloudStream.html" class="sidebar-link">Spring Cloud Stream参考文档</a></li><li><a href="/springcloud/SpringCloudAWS.html" class="active sidebar-link">Spring Cloud AWS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_1-使用亚马逊网络服务" class="sidebar-link">1.使用亚马逊网络服务</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_2-基本设置" class="sidebar-link">2.基本设置</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_3-云环境" class="sidebar-link">3.云环境</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_4-管理云环境" class="sidebar-link">4.管理云环境</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_5-消息传递" class="sidebar-link">5.消息传递</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_6-缓存" class="sidebar-link">6.缓存</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_7-使用jdbc进行数据访问" class="sidebar-link">7.使用JDBC进行数据访问</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_8-发送邮件" class="sidebar-link">8.发送邮件</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_9-资源处理" class="sidebar-link">9.资源处理</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudAWS.html#_10-配置属性" class="sidebar-link">10.配置属性</a></li></ul></li><li><a href="/springcloud/SpringCloudBus.html" class="sidebar-link">Spring Cloud Bus</a></li><li><a href="/springcloud/SpringCloudTask.html" class="sidebar-link">Spring Cloud Task参考指南</a></li><li><a href="/springcloud/SpringCloudConfig.html" class="sidebar-link">xxx</a></li><li><a href="/springcloud/SpringCloudNetflix.html" class="sidebar-link">/springcloud/SpringCloudNetflix.html</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-cloud-aws"><a href="#spring-cloud-aws" class="header-anchor">#</a> Spring Cloud AWS</h1> <p>Spring Cloud for Amazon Web Services是Spring Cloud伞项目的一部分，可简化与托管Amazon Web Services的集成。它提供了一种方便的方式，可以使用众所周知的Spring习语和API（例如消息传递或缓存API）与AWS提供的服务进行交互。开发人员可以围绕托管服务构建应用程序，而无需关心基础结构或维护。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>Spring Cloud是根据非限制性Apache 2.0许可发布的。如果您想为文档的这一部分做出贡献或发现错误，请在{docslink} [github]上的项目中找到源代码和问题跟踪程序。</p></div> <h2 id="_1-使用亚马逊网络服务"><a href="#_1-使用亚马逊网络服务" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-amazon-web-services" target="_blank" rel="noopener noreferrer">1.使用亚马逊网络服务<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>亚马逊提供了一个<a href="https://aws.amazon.com/sdk-for-java/" target="_blank" rel="noopener noreferrer">Java SDK，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以发布对<a href="https://aws.amazon.com/" target="_blank" rel="noopener noreferrer">亚马逊网络服务<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>平台提供的所有服务的请求 。使用SDK，应用程序开发人员仍然必须使用大量与基础架构相关的代码将SDK集成到他们的应用程序中。Spring Cloud AWS为应用程序开发人员提供了已经集成的基于Spring的模块，以使用服务并尽可能避免与基础架构相关的代码。Spring Cloud AWS模块提供了一个模块集，以便应用程序开发人员可以根据他们对特定服务的需求来安排依赖项。下图提供了所有Spring Cloud AWS模块的一般概述，以及对相应Spring Cloud AWS服务的服务支持。</p> <p><img src="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/images/overview.png" alt="总览"></p> <ul><li><strong>Spring Cloud AWS Core</strong>是<strong>Spring Cloud AWS</strong>的核心模块，为安全性和配置设置提供基本服务。开发人员不会直接使用此模块，而是会通过其他模块使用。核心模块为基于云的环境配置提供支持，从而可以直接访问基于实例的<a href="https://aws.amazon.com/ec2/" target="_blank" rel="noopener noreferrer">EC2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 元数据和特定于整个应用程序堆栈的<a href="https://aws.amazon.com/cloudformation/" target="_blank" rel="noopener noreferrer">CloudFormation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>元数据。</li> <li><strong>Spring Cloud AWS Context</strong>通过Spring资源加载器抽象提供对<a href="https://aws.amazon.com/s3/" target="_blank" rel="noopener noreferrer">简单存储服务的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>访问。此外，开发人员可以使用<a href="https://aws.amazon.com/ses/" target="_blank" rel="noopener noreferrer">简单电子邮件服务<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和Spring邮件抽象来发送电子邮件。开发人员还可以使用Spring缓存支持和<a href="https://aws.amazon.com/elasticache/" target="_blank" rel="noopener noreferrer">ElastiCache<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>缓存服务来引入声明式缓存。</li> <li><strong>Spring Cloud AWS JDBC</strong>为<a href="https://aws.amazon.com/rds/" target="_blank" rel="noopener noreferrer">关系数据库服务<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了自动的数据源查找和配置，<strong>Spring</strong> 可以将其与JDBC或任何其他支持数据访问技术一起使用。</li> <li><strong>Spring Cloud AWS Messaging</strong>使开发人员可以使用<a href="https://aws.amazon.com/sqs/" target="_blank" rel="noopener noreferrer">简单队列服务<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>接收和发送消息，以进行点对点通信。<a href="https://aws.amazon.com/sns/" target="_blank" rel="noopener noreferrer">Simple Notification Service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的集成支持发布-订阅消息传递。</li> <li><strong>Spring Cloud AWS Parameter Store Configuration</strong>使Spring Cloud应用程序可以将<a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-paramstore.html" target="_blank" rel="noopener noreferrer">AWS Parameter Store<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 用作Bootstrap属性源，这与Spring Cloud Config Server或Consul的键值存储所提供的支持相当。</li> <li><strong>Spring Cloud AWS Secrets Manager配置</strong>使Spring Cloud应用程序可以将<a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html" target="_blank" rel="noopener noreferrer">AWS Secrets Manager<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 用作Bootstrap属性源，这与Spring Cloud Config Server或Consul的键值存储提供的支持相当。</li></ul> <h2 id="_2-基本设置"><a href="#_2-基本设置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#basic-setup" target="_blank" rel="noopener noreferrer">2.基本设置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>在使用Spring Cloud AWS模块之前，开发人员必须选择依赖项并配置Spring Cloud AWS模块。下一章介绍了依赖性管理以及Spring AWS Cloud项目的基本配置。</p> <h3 id="_2-1。spring-cloud-aws-maven依赖管理"><a href="#_2-1。spring-cloud-aws-maven依赖管理" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#spring-cloud-aws-maven-dependency-management" target="_blank" rel="noopener noreferrer">2.1。Spring Cloud AWS Maven依赖管理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>通过特定模块的直接配置，可以在<a href="https://maven.apache.org/" target="_blank" rel="noopener noreferrer">Maven中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>直接使用Spring Cloud AWS模块依赖关系。Spring Cloud AWS模块包括Spring模块的所有传递依赖项以及操作这些模块所需的Amazon SDK。常规依赖项配置如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-aws-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>{spring-cloud-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>可以通过将模块名称替换为相应的模块名称来包含不同的模块（例如<code>spring-cloud-aws-messaging</code> 代替<code>spring-cloud-aws-context</code>）</p> <p>上面的示例适用于Maven Central存储库。要使用Spring Maven存储库（例如，用于里程碑或开发人员快照），您需要在Maven配置中指定存储库位置。完整版本：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>io.spring.repo.maven.release<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repo.spring.io/release/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对于里程碑：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>io.spring.repo.maven.milestone<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repo.spring.io/milestone/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-2。amazon-sdk配置"><a href="#_2-2。amazon-sdk配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#amazon-sdk-configuration" target="_blank" rel="noopener noreferrer">2.2。Amazon SDK配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>目前，Spring Cloud AWS配置是使用Spring Cloud AWS名称空间提供的自定义元素完成的。即将支持JavaConfig。配置设置直接在Spring XML配置文件中完成，因此可以直接使用元素。Spring Cloud AWS的每个模块都提供自定义名称空间，以允许模块的模块化使用。下面概述了使用Spring Cloud AWS的典型XML配置：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aws-context</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/cloud/aws/context
        http://www.springframework.org/schema/cloud/aws/context/spring-cloud-aws-context.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_2-2-1。sdk凭证配置"><a href="#_2-2-1。sdk凭证配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#sdk-credentials-configuration" target="_blank" rel="noopener noreferrer">2.2.1。SDK凭证配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>为了调用Amazon Web Service，必须为Amazon SDK配置凭据。Spring Cloud AWS提供了配置特定于应用程序上下文的凭据的支持，该凭据用于针对Spring Cloud AWS组件完成的请求的<em>每个</em>服务调用，参数存储和Secrets Manager配置除外。因此，对于整个应用程序上下文，必须<strong>完全</strong>是凭据的<strong>一种</strong>配置。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>该<code>com.amazonaws.auth.DefaultAWSCredentialsProviderChain</code>所使用的所有客户端，如果没有定义专用凭证提供商。这实际上将使用以下身份验证信息使用环境变量<code>AWS_ACCESS_KEY_ID</code>和<code>AWS_SECRET_ACCESS_KEY</code>使用系统属性<code>aws.accessKeyId</code>和<code>aws.secretKey</code>使用用户特定的配置文件凭证文件如果<code>AWS_CONTAINER_CREDENTIALS_RELATIVE_URI</code>设置了环境变量，请使用ECS凭据使用实例配置文件凭据（请参见下文）</p></div> <p>根据整体凭据策略，可以使用不同的选项来配置凭据。可能的内容在以下子章节中进行描述。</p> <h5 id="简单的凭证配置"><a href="#简单的凭证配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#simple-credentials-configuration" target="_blank" rel="noopener noreferrer">简单的凭证配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>Amazon SDK的凭证包含一个访问密钥（可以共享）和一个秘密密钥（<strong>不得</strong>共享）。可以使用XML名称空间为Spring Cloud AWS模块创建的每个Amazon SDK服务配置这两个安全属性。整体配置如下所示</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>simple-credentials</span> <span class="token attr-name">access-key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AKIAIO<span class="token punctuation">&quot;</span></span> <span class="token attr-name">secret-key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wJalrXUtnFEMI/K7M<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>访问密钥和秘密密钥应外部化到属性文件中（例如，Spring Boot应用程序配置），而不应检入源管理系统。</p></div> <h5 id="实例配置文件配置"><a href="#实例配置文件配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#instance-profile-configuration" target="_blank" rel="noopener noreferrer">实例配置文件配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>一个<a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/instance-profiles.html" target="_blank" rel="noopener noreferrer">实例配置文件配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>允许指定由一个角色的授权，同时启动EC2实例的轮廓。然后，使用实例配置文件特定的用户角色对从EC2实例发出的所有调用进行身份验证。因此，在配置中不需要专用的访问密钥和秘密密钥。Spring Cloud AWS中实例配置文件的配置如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>instance-profile-credentials</span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="混合两种安全配置"><a href="#混合两种安全配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#mixing-both-security-configurations" target="_blank" rel="noopener noreferrer">混合两种安全配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>在某些情况下，将两种身份验证策略结合使用以允许应用程序将实例配置文件与回退一起用于显式访问键和秘密键配置非常有用。如果在EC2内部（例如，在测试服务器上）对应用程序进行了测试，并在本地进行了测试，则此功能很有用。下一个代码片段显示了这两种安全配置的组合。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>instance-profile-credentials</span><span class="token punctuation">/&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>simple-credentials</span> <span class="token attr-name">access-key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${accessKey:}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">secret-key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${secretKey:}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用占位符表达式以及默认值定义访问密钥和秘密密钥，以避免在根本未配置属性的情况下避免引导错误。</p></div> <h5 id="参数存储和secrets-manager配置凭据和区域配置"><a href="#参数存储和secrets-manager配置凭据和区域配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#parameter-store-and-secrets-manager-configuration-credentials-and-region-configuration" target="_blank" rel="noopener noreferrer">参数存储和Secrets Manager配置凭据和区域配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>参数存储和Secrets Manager配置支持使用引导上下文来配置默认<code>AWSSimpleSystemsManagement</code> 客户端，该默认客户端使用<code>com.amazonaws.auth.DefaultAWSCredentialsProviderChain</code>和<code>com.amazonaws.regions.DefaultAwsRegionProviderChain</code>。如果要覆盖此内容，则需要 使用配置为使用您选择的凭据和/或区域提供程序 的类型的bean <a href="https://cloud.spring.io/spring-cloud-static/Edgware.SR2/multi/multi__spring_cloud_context_application_context_services.html#_customizing_the_bootstrap_configuration" target="_blank" rel="noopener noreferrer">定义自己的Spring Cloud引导程序配置类<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><code>AWSSimpleSystemsManagement</code>。因为此上下文是在创建Spring Cloud Bootstrap上下文时创建的，所以不能简单地在常规<code>@Configuration</code>类中覆盖Bean 。</p> <h4 id="_2-2-2。区域配置"><a href="#_2-2-2。区域配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#region-configuration" target="_blank" rel="noopener noreferrer">2.2.2。区域配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Amazon Web服务可在不同<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html" target="_blank" rel="noopener noreferrer">地区使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。根据自定义要求，用户可以在不同的Amazon地区托管应用程序。该<code>spring-cloud-aws-context</code> 模块提供了一种为整个应用程序上下文定义区域的方法。</p> <h5 id="显式区域配置"><a href="#显式区域配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#explicit-region-configuration" target="_blank" rel="noopener noreferrer">显式区域配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>可以使用XML元素显式配置该区域。如果由于应用程序未托管在EC2实例上（例如本地测试）而无法自动派生区域或必须手动覆盖该区域，则此功能特别有用。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eu-west-1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>提示还允许使用表达式或占位符来使配置外部化，并确保可以使用属性文件或系统属性重新配置区域。</p></div> <h5 id="自动区域配置"><a href="#自动区域配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#automatic-region-configuration" target="_blank" rel="noopener noreferrer">自动区域配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>如果应用程序上下文是在EC2实例内部启动的，则可以从<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html" target="_blank" rel="noopener noreferrer">实例元数据中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>自动获取区域 ，因此不能静态配置。配置将如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">auto-detect</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="服务特定区域配置"><a href="#服务特定区域配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#service-specific-region-configuration" target="_blank" rel="noopener noreferrer">服务特定区域配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>如果一个应用程序上下文使用来自不同区域的服务，则也可以为特定服务覆盖区域。可以像上面描述的那样全局地进行配置，并针对具有区域属性的每个服务进行配置。数据库服务的配置看起来像这样（稍后介绍）</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eu-central-1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jdbc:</span>data-source</span> <span class="token attr-name">...</span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eu-west-1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>提示从理论上讲，每个应用程序可以使用多个区域，但我们强烈建议编写仅在一个区域内托管的应用程序，如果同时托管在不同区域中，则请拆分该应用程序。</p></div> <h4 id="_2-2-3。spring-boot自动配置"><a href="#_2-2-3。spring-boot自动配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#spring-boot-auto-configuration" target="_blank" rel="noopener noreferrer">2.2.3。Spring Boot自动配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>在Spring Cloud伞项目之后，Spring Cloud AWS还提供了专用的Spring Boot支持。可以使用Spring Boot属性配置Spring Cloud AWS，并且还将根据常规设置自动猜测任何合理的配置。</p> <h5 id="maven依赖"><a href="#maven依赖" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#maven-dependencies" target="_blank" rel="noopener noreferrer">Maven依赖<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>Spring Cloud AWS提供了专用模块来启用Spring Boot支持。该模块必须添加到应用程序内部的常规Maven依赖项中。典型配置如下所示</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-aws-autoconfigure<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>{spring-cloud-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>必须添加其他依赖来启用特定功能，例如消息传递和JDBC。Spring Cloud AWS将仅配置Spring Boot应用程序的类路径中可用的类。</p> <h5 id="配置凭证"><a href="#配置凭证" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-credentials" target="_blank" rel="noopener noreferrer">配置凭证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>Spring Boot提供了一种使用属性文件或YAML配置文件定义属性的标准方法。Spring Cloud AWS提供了使用Spring Boot应用程序配置文件配置凭据信息的支持。Spring Cloud AWS提供了以下属性来配置整个应用程序的凭证设置。</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">例</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">cloud.aws.credentials.accessKey</td> <td style="text-align:left;">AKIAIOSFODNN7EXAMPLE</td> <td style="text-align:left;">静态提供程序要使用的访问密钥</td></tr> <tr><td style="text-align:left;">cloud.aws.credentials.secretKey</td> <td style="text-align:left;">wJalrXUtnFEMI / K7MDENG / bPxRfiCYEXAMPLEKEY</td> <td style="text-align:left;">与静态提供程序一起使用的密钥</td></tr> <tr><td style="text-align:left;">cloud.aws.credentials.instanceProfile</td> <td style="text-align:left;">真正</td> <td style="text-align:left;">无需进一步配置即可配置实例配置文件凭据提供程序</td></tr> <tr><td style="text-align:left;">cloud.aws.credentials.useDefaultAwsCredentialsChain</td> <td style="text-align:left;">真正</td> <td style="text-align:left;">使用DefaultAWSCredentials链而不是配置自定义证书链</td></tr></tbody></table> <h5 id="配置区域"><a href="#配置区域" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-region" target="_blank" rel="noopener noreferrer">配置区域<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>像凭证一样，Spring Cloud AWS模块还支持在Spring Boot配置文件中对区域进行配置。可以自动检测或明确配置区域（例如，在针对AWS云进行本地测试的情况下）。</p> <p>配置区域的属性如下所示</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">例</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">cloud.aws.region.auto</td> <td style="text-align:left;">真正</td> <td style="text-align:left;">启用基于EC2元数据服务的自动区域检测</td></tr> <tr><td style="text-align:left;">cloud.aws.region.static</td> <td style="text-align:left;">eu-west-1</td> <td style="text-align:left;">为应用程序配置静态区域。可能的区域是（当前）us-east-1，us-west-1，us-west-2，eu-west-1，eu-central-1，ap-southeast-1，ap-southeast-1，ap- northeast-1，sa-east-1，cn-north-1以及配置有自己的区域元数据的任何自定义区域</td></tr></tbody></table> <h2 id="_3-云环境"><a href="#_3-云环境" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#cloud-environment" target="_blank" rel="noopener noreferrer">3.云环境<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>应用程序通常需要特定于环境的配置信息，尤其是在不断变化的环境中，例如在Amazon云环境中。Spring Cloud AWS提供了一种支持，可使用常见的Spring机制（如属性占位符或Spring表达式语言）在应用程序上下文中检索和使用特定于环境的数据。</p> <h3 id="_3-1。检索实例元数据"><a href="#_3-1。检索实例元数据" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#retrieving-instance-metadata" target="_blank" rel="noopener noreferrer">3.1。检索实例元数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html" target="_blank" rel="noopener noreferrer">实例元数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在EC2环境中可用。可以使用提供实例元数据的特殊HTTP地址查询元数据。Spring Cloud AWS使应用程序可以直接在表达式或属性占位符中访问此元数据，而无需调用外部HTTP服务。</p> <h4 id="_3-1-1。使用xml启用实例元数据支持"><a href="#_3-1-1。使用xml启用实例元数据支持" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#enabling-instance-metadata-support-with-xml" target="_blank" rel="noopener noreferrer">3.1.1。使用XML启用实例元数据支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>通过XML元素（例如Spring中的标准属性占位符）启用了实例元数据检索支持。以下代码示例演示了在应用程序上下文中激活实例元数据支持。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-instance-data</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>无需授权服务调用即可检索实例元数据，因此上述配置不需要任何区域或特定于安全性的配置。</p></div> <h4 id="_3-1-2。使用java启用实例元数据支持"><a href="#_3-1-2。使用java启用实例元数据支持" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#enabling-instance-metadata-support-with-java" target="_blank" rel="noopener noreferrer">3.1.2。使用Java启用实例元数据支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>实例元数据也可以在Java配置类中进行配置，而无需进行XML配置。下一个示例显示了一个典型的Spring <code>@Configuration</code>类，该类使用 <code>org.springframework.cloud.aws.context.config.annotation.EnableInstanceData</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableContextInstanceData</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-1-3。在spring-boot中启用实例元数据支持"><a href="#_3-1-3。在spring-boot中启用实例元数据支持" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#enabling-instance-metadata-support-in-spring-boot" target="_blank" rel="noopener noreferrer">3.1.3。在Spring Boot中启用实例元数据支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>如果实例元数据在EC2实例上运行，则该实例元数据可在Spring Boot应用程序中自动用作属性源。</p> <h4 id="_3-1-4。使用实例元数据"><a href="#_3-1-4。使用实例元数据" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-instance-metadata" target="_blank" rel="noopener noreferrer">3.1.4。使用实例元数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>实例元数据可以在XML，Java占位符和表达式中使用。下面的示例演示了使用占位符的XML文件内部实例元数据的用法以及引用特殊变量的表达式<code>environment</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.cloud.aws....SimpleConfigurationBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>value1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#{environment.ami-id}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>value2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#{environment.hostname}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>value3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${instance-type}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>value4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${instance-id}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>实例元数据也可以通过Spring <code>org.springframework.beans.factory.annotation.Value</code>注释直接注入Java字段中。下一个示例演示在Spring bean中使用实例元数据。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationInfoBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${ami-id:N/A}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> amiId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${hostname:N/A}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> hostname<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${instance-type:N/A}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> instanceType<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${services/domain:N/A}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serviceDomain<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>可以通过<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html" target="_blank" rel="noopener noreferrer">实例元数据服务中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可用的键来访问每个实例元数据，可以通过使用 斜杠（'/'）分隔属性来访问嵌套属性。</p></div> <h4 id="_3-1-5。使用实例用户数据"><a href="#_3-1-5。使用实例用户数据" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-instance-user-data" target="_blank" rel="noopener noreferrer">3.1.5。使用实例用户数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>除了默认实例元数据，还可以在每个实例上配置用户数据。该用户数据由Spring Cloud AWS检索和解析。可以在使用应用程序启动EC2实例时定义用户数据。Spring Cloud AWS需要<code>&lt;key&gt;:&lt;value&gt;;&lt;key&gt;:&lt;value&gt;</code>用户数据内的格式，以便它可以解析字符串并提取键值对。</p> <p>可以使用下面显示的管理控制台或<a href="https://aws.amazon.com/cloudformation/aws-cloudformation-templates/" target="_blank" rel="noopener noreferrer">CloudFormation模板<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来配置用户数据。</p> <p><img src="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/images/cloud-environment-user-data.png" alt="管理控制台中的用户数据"></p> <p>下面概述了用于配置用户数据的CloudFormation模板代码段：</p> <div class="language-json extra-class"><pre class="language-json"><code>...
<span class="token property">&quot;Resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
 <span class="token property">&quot;ApplicationServerInstance&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AWS::EC2::Instance&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;Properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">&quot;ImageId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ami-6a56b81d&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;UserData&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;Fn::Base64&quot;</span><span class="token operator">:</span> <span class="token string">&quot;data1:value1;data2:value2&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">&quot;InstanceType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t1.micro&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
...
</code></pre></div><p>可以通过占位符或表达式在应用程序上下文中直接访问用户数据，例如实例元数据。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecondConfigurationBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${data1}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> firstDataOption<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${data2}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> secondDataOption<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-1-6。使用实例标签"><a href="#_3-1-6。使用实例标签" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-instance-tags" target="_blank" rel="noopener noreferrer">3.1.6。使用实例标签<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>用户配置的属性也可以使用标签而不是用户数据进行配置。标签是Amazon Web services上下文中的全局概念，并在不同的服务中使用。Spring Cloud AWS还支持跨不同服务的实例标签。与用户数据相比，用户标签可以在运行时更新，而无需停止和重启实例。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html" target="_blank" rel="noopener noreferrer">用户数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>还可用于在实例启动时执行脚本。因此，利用实例标记进行用户配置和用户数据在实例启动时执行脚本很有用。</p></div> <p>可以通过下面概述的管理控制台在实例级别配置实例特定的标签，并且像用户数据一样，还可以使用随后显示的CloudFormation模板进行配置。</p> <p><img src="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/images/cloud-environment-instance-tags.png" alt="管理控制台中的实例数据"></p> <p>下面概述了用于配置实例标签的CloudFormation模板代码段：</p> <div class="language-json extra-class"><pre class="language-json"><code>...
<span class="token property">&quot;Resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;UserTagAndUserDataInstance&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AWS::EC2::Instance&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;ImageId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ami-6a56b81d&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;InstanceType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;t1.micro&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;Tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;Key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tag1&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tagv1&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;Key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tag3&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tagv3&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;Key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tag2&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tagv2&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;Key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tag4&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;Value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tagv4&quot;</span>
            <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
...
</code></pre></div><p>要检索实例标签，Spring Cloud AWS必须发出经过身份验证的请求，因此，在实际解析占位符之前，将需要区域和安全性配置。另外，由于实例标记在启动应用程序上下文时不可用，因此只能将它们引用为表达式，而不能使用占位符。该<code>context-instance-data</code> 元素定义的属性<code>user-tags-map</code>，这将在创建的名称的应用程序上下文的地图。然后可以使用表达式查询其他bean定义的映射。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-instance-data</span> <span class="token attr-name">user-tags-map</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>instanceData<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一个Java bean可能会解析带有<code>@Value</code>注释的表达式。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleConfigurationBean</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{instanceData.tag1}&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> value1<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{instanceData.tag2}&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> value2<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{instanceData.tag3}&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> value3<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{instanceData.tag4}&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> value4<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-1-7。配置自定义ec2客户端"><a href="#_3-1-7。配置自定义ec2客户端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-custom-ec2-client" target="_blank" rel="noopener noreferrer">3.1.7。配置自定义EC2客户端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>在某些情况下，必须具有定制的EC2客户端来检索实例信息。该 <code>context-instance-data</code>元素支持与定制的EC2客户<code>amazon-ec2</code>属性。下一个示例说明了使用自定义EC2客户端的情况，该客户端可能已进行了特殊配置。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>....<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">...</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-instance-data</span>  <span class="token attr-name">amazon-ec2</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myCustomClient<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myCustomClient<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.amazonaws.services.ec2.AmazonEC2Client<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_3-1-8。注入默认的ec2客户端"><a href="#_3-1-8。注入默认的ec2客户端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#injecting-the-default-ec2-client" target="_blank" rel="noopener noreferrer">3.1.8。注入默认的EC2客户端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>如果为实例数据配置了用户标签（请参见上文），Spring Cloud AWS将使用指定的区域和安全凭证配置EC2客户端。应用程序开发人员可以使用<code>@Autowired</code>注释将EC2客户端直接注入其代码中。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AmazonEC2</span> amazonEc2<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">ApplicationService</span><span class="token punctuation">(</span><span class="token class-name">AmazonEC2</span> amazonEc2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>amazonEc2 <span class="token operator">=</span> amazonEc2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-2。将spring-cloud应用程序与aws-parameter-store集成"><a href="#_3-2。将spring-cloud应用程序与aws-parameter-store集成" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#integrating-your-spring-cloud-application-with-the-aws-parameter-store" target="_blank" rel="noopener noreferrer">3.2。将Spring Cloud应用程序与AWS Parameter Store集成<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud提供了对集中式配置的支持，<code>PropertySource</code>当启动应用程序时，它可以作为常规Spring读取并提供 。参数存储配置允许您将此机制与<a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-paramstore.html" target="_blank" rel="noopener noreferrer">AWS参数存储一起使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>只需在<code>spring-cloud-starter-aws-parameter-store-config</code>启动模块上添加依赖项即可激活支持。该支持类似于为Spring Cloud Config Server或Consul的键值存储提供的支持：可以将配置参数定义为在所有服务之间共享或为特定服务共享，并且可以是特定于配置文件的。检索到的值将被解密。</p> <p>所有配置参数均从公共路径前缀（默认为）检索<code>/config</code>。从那里，从默认路径检索共享参数，<code>application</code>特定于服务的参数使用默认路径为configure的路径<code>spring.application.name</code>。您可以使用点和正斜杠来指定配置键的名称。激活的配置文件的名称将使用默认为下划线的分隔符添加到路径。</p> <p>这意味着对于<code>my-service</code>默认情况下称为模块的服务，将查找并使用以下参数：</p> <table><thead><tr><th style="text-align:left;">参数键</th> <th style="text-align:left;">春季物业</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>/config/application/cloud.aws.stack.name</code></td> <td style="text-align:left;"><code>cloud.aws.stack.name</code></td> <td style="text-align:left;">由启用了配置支持的所有服务共享。可以用特定于服务或配置文件的属性覆盖。</td></tr> <tr><td style="text-align:left;"><code>/config/application_production/cloud.aws.stack.name</code></td> <td style="text-align:left;"><code>cloud.aws.stack.name</code></td> <td style="text-align:left;">由启用了配置支持并<code>production</code>激活了Spring配置文件的所有服务共享。可以用特定于服务的属性覆盖。</td></tr> <tr><td style="text-align:left;"><code>/config/my-service/cloud/aws/stack/auto</code></td> <td style="text-align:left;"><code>cloud.aws.stack.auto</code></td> <td style="text-align:left;">特定于<code>my-service</code>服务。请注意，密钥路径中的斜杠将替换为点。</td></tr> <tr><td style="text-align:left;"><code>/config/my-service_production/cloud/aws/stack/auto</code></td> <td style="text-align:left;"><code>cloud.aws.stack.auto</code></td> <td style="text-align:left;">激活Spring配置文件<code>my-service</code>时特定于服务<code>production</code>。</td></tr></tbody></table> <p>请注意，该模块不支持像Spring Cloud Consul一样用作参数值的完整配置文件：AWS参数值限制为4096个字符，因此我们仅支持配置单个Spring属性。</p> <p>您可以在Spring Cloud <code>bootstrap.properties</code>或<code>bootstrap.yml</code>文件中配置以下设置（请注意，已应用宽松的属性绑定，因此您不必使用此确切语法）：</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">默认</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>aws.paramstore.prefix</code></td> <td style="text-align:left;"><code>/config</code></td> <td style="text-align:left;">前缀，指示从参数存储加载的每个属性的第一级。值必须以正斜杠开头，后跟一个或多个有效路径段，或者为空。</td></tr> <tr><td style="text-align:left;"><code>aws.paramstore.defaultContext</code></td> <td style="text-align:left;"><code>application</code></td> <td style="text-align:left;">定义所有服务共享的属性的上下文名称</td></tr> <tr><td style="text-align:left;"><code>aws.paramstore.profileSeparator</code></td> <td style="text-align:left;"><code>_</code></td> <td style="text-align:left;">用于将附加的配置文件与上下文名称分开的字符串。请注意，AWS参数密钥只能在字母数字字符旁边包含点，破折号和下划线。</td></tr> <tr><td style="text-align:left;"><code>aws.paramstore.failFast</code></td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">指示在检索参数时出现错误是否应导致启动应用程序失败。</td></tr> <tr><td style="text-align:left;"><code>aws.paramstore.name</code></td> <td style="text-align:left;">的配置值 <code>spring.application.name</code></td> <td style="text-align:left;">在构造用于查找此特定服务的属性的路径时要使用的名称。</td></tr> <tr><td style="text-align:left;"><code>aws.paramstore.enabled</code></td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">即使自动配置位于类路径上，也可用于禁用“参数存储配置”支持。</td></tr></tbody></table> <h3 id="_3-3。将spring-cloud应用程序与aws-secrets-manager集成"><a href="#_3-3。将spring-cloud应用程序与aws-secrets-manager集成" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#integrating-your-spring-cloud-application-with-the-aws-secrets-manager" target="_blank" rel="noopener noreferrer">3.3。将Spring Cloud应用程序与AWS Secrets Manager集成<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud提供了对集中式配置的支持，<code>PropertySource</code>当启动应用程序时，它可以作为常规Spring读取并提供 。通过Secrets Manager配置，您可以将此机制与<a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html" target="_blank" rel="noopener noreferrer">AWS Secrets Manager结合使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>只需在<code>spring-cloud-starter-aws-secrets-manager-config</code>启动模块上添加依赖项即可激活支持。该支持类似于为Spring Cloud Config Server或Consul的键值存储提供的支持：可以将配置参数定义为在所有服务之间共享或为特定服务共享，并且可以是特定于配置文件的。</p> <p>所有配置参数均从公共路径前缀（默认为）检索<code>/secret</code>。从那里，从默认路径检索共享参数，<code>application</code>特定于服务的参数使用默认路径为configure的路径<code>spring.application.name</code>。您可以使用点和正斜杠来指定配置键的名称。激活的配置文件的名称将使用默认为下划线的分隔符添加到路径。</p> <p>这意味着对于<code>my-service</code>默认情况下称为模块的服务，将查找并使用以下参数：</p> <table><thead><tr><th style="text-align:left;">参数键</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>/secret/application</code></td> <td style="text-align:left;">由启用了配置支持的所有服务共享。可以用特定于服务或配置文件的属性覆盖。</td></tr> <tr><td style="text-align:left;"><code>/secret/application_production</code></td> <td style="text-align:left;">由启用了配置支持并<code>production</code>激活了Spring配置文件的所有服务共享。可以用特定于服务的属性覆盖。</td></tr> <tr><td style="text-align:left;"><code>/secret/my-service</code></td> <td style="text-align:left;">特定于<code>my-service</code>服务</td></tr> <tr><td style="text-align:left;"><code>/secret/my-service_production</code></td> <td style="text-align:left;">激活Spring配置文件<code>my-service</code>时特定于服务<code>production</code>。</td></tr></tbody></table> <p>您可以在Spring Cloud <code>bootstrap.properties</code>或<code>bootstrap.yml</code>文件中配置以下设置（请注意，已应用宽松的属性绑定，因此您不必使用此确切语法）：</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">默认</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>aws.secretsmanager.prefix</code></td> <td style="text-align:left;"><code>/secret</code></td> <td style="text-align:left;">前缀，指示从Secrets Manager加载的每个属性的第一级。值必须以正斜杠开头，后跟一个或多个有效路径段，或者为空。</td></tr> <tr><td style="text-align:left;"><code>aws.secretsmanager.defaultContext</code></td> <td style="text-align:left;"><code>application</code></td> <td style="text-align:left;">定义所有服务共享的属性的上下文名称</td></tr> <tr><td style="text-align:left;"><code>aws.secretsmanager.profileSeparator</code></td> <td style="text-align:left;"><code>_</code></td> <td style="text-align:left;">用于将附加的配置文件与上下文名称分开的字符串。</td></tr> <tr><td style="text-align:left;"><code>aws.secretsmanager.failFast</code></td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">指示在检索机密时发生错误是否应该导致启动应用程序失败。</td></tr> <tr><td style="text-align:left;"><code>aws.secretsmanager.name</code></td> <td style="text-align:left;">的配置值 <code>spring.application.name</code></td> <td style="text-align:left;">在构造用于查找此特定服务的属性的路径时要使用的名称。</td></tr> <tr><td style="text-align:left;"><code>aws.secretsmanager.enabled</code></td> <td style="text-align:left;"><code>true</code></td> <td style="text-align:left;">即使自动配置位于类路径上，也可用于禁用Secrets Manager配置支持。</td></tr></tbody></table> <h2 id="_4-管理云环境"><a href="#_4-管理云环境" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#managing-cloud-environments" target="_blank" rel="noopener noreferrer">4.管理云环境<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>使用管理控制台手动管理环境无法扩展，并且随着基础结构复杂性的增加，容易出错。Amazon Web服务提供了<a href="https://aws.amazon.com/cloudformation/" target="_blank" rel="noopener noreferrer">CloudFormation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 服务，该服务允许定义堆栈配置模板并使用服务引导整个基础架构。为了允许并行使用多个堆栈，堆栈中的每个资源都会接收一个唯一的物理名称，该名称包含一些任意生成的名称。为了以统一的方式与堆栈资源交互，AWS允许开发人员使用逻辑名称代替随机的物理名称。</p> <p>下图显示了典型的堆栈配置。</p> <p><img src="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/images/cloudformation-overview.png" alt="CloudFormation概述"></p> <p>该<strong>模板文件</strong>描述了他们所有的堆栈资源<em>的逻辑名称</em>。该<strong>CloudFormation</strong>服务解析堆栈的模板文件，并与他们创造的所有资源<em>的物理名称</em>。应用程序可以将所有堆栈配置的资源与模板中定义的<em>逻辑名称</em>一起使用。Spring Cloud AWS将所有<em>逻辑名称</em>解析为应用程序开发人员的相应 <em>物理名称</em>。</p> <h3 id="_4-1。自动cloudformation配置"><a href="#_4-1。自动cloudformation配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#automatic-cloudformation-configuration" target="_blank" rel="noopener noreferrer">4.1。自动CloudFormation配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>如果应用程序在堆栈中运行（因为基础EC2实例已在堆栈中自举），则Spring Cloud AWS将自动检测堆栈并解析堆栈中的所有资源。应用程序开发人员可以使用堆栈模板中的所有逻辑名与服务进行交互。在以下示例中，使用CloudFormation模板配置数据库资源，该模板为数据库实例定义了逻辑名称。</p> <div class="language-xml extra-class"><pre class="language-xml"><code>&quot;applicationDatabase&quot;: {
  &quot;Type&quot;: &quot;AWS::RDS::DBInstance&quot;,
  &quot;Properties&quot;: {
    &quot;AllocatedStorage&quot;: &quot;5&quot;,
    &quot;DBInstanceClass&quot;: &quot;db.t1.micro&quot;,
    &quot;DBName&quot;: &quot;test&quot;
    ...
  ]
 }
}
</code></pre></div><p>然后创建数据源，并将接收一个物理名称（例如ir142c39k6o5irj）作为数据库服务名称。应用程序开发人员仍然可以使用逻辑名（在本例中为<code>applicationDatabase</code>）与数据库进行交互。下例显示了由元素定义<code>aws-context:stack-configuration</code>并自动解析特定堆栈的堆栈配置。该<code>data-source</code>元素使用逻辑名称<code>db-instance-identifier</code>属性的工作与数据库。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aws-context</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/context
       http://www.springframework.org/schema/cloud/aws/context/spring-cloud-aws-context.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
    ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">..</span> <span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>stack-configuration</span><span class="token punctuation">/&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jdbc:</span>data-source</span> <span class="token attr-name">db-instance-identifier</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>applicationDatabase<span class="token punctuation">&quot;</span></span> <span class="token attr-name">...</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示有关Amazon RDS配置和设置的更多详细信息，可以在本文档的相应章节中找到。 :::</p> <h3 id="_4-2。手动cloudformation配置"><a href="#_4-2。手动cloudformation配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#manual-cloudformation-configuration" target="_blank" rel="noopener noreferrer">4.2。手动CloudFormation配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>如果应用程序未在配置了堆栈的EC2实例中运行，则必须手动配置堆栈配置。该配置包含一个附加的element属性<code>stack-name</code>，该属性将在运行时用于解析所有各自的堆栈配置信息。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">....</span><span class="token punctuation">&gt;</span></span>
    ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>stack-configuration</span> <span class="token attr-name">stack-name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myStackName<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_4-3。具有java配置类的cloudformation配置"><a href="#_4-3。具有java配置类的cloudformation配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#cloudformation-configuration-with-java-config-classes" target="_blank" rel="noopener noreferrer">4.3。具有Java配置类的CloudFormation配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS还支持在Java类中配置CloudFormation支持，从而避免在应用程序配置中使用XML。Spring Cloud AWS提供了<code>og.springframework.cloud.aws.context.config.annotation.EnableStackConfiguration</code>允许自动和手动堆栈配置的注释 。下一个示例显示一个配置类，该类使用显式堆栈名称（此处为<code>manualStackName</code>）配置CloudFormation支持。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableStackConfiguration</span><span class="token punctuation">(</span>stackName <span class="token operator">=</span> <span class="token string">&quot;manualStackName&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ApplicationConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th>::: tip 提示<code>stackName</code>如果应该启用自动堆栈名称，则不要定义属性。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h3 id="_4-4。spring-boot中的cloudformation配置"><a href="#_4-4。spring-boot中的cloudformation配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#cloudformation-configuration-in-spring-boot" target="_blank" rel="noopener noreferrer">4.4。Spring Boot中的CloudFormation配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS在Spring Boot配置中还支持CloudFormation支持的配置。可以使用下表中描述的属性来定义手动和自动堆栈配置。</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">例</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">cloud.aws.stack.name</td> <td style="text-align:left;">myStackName</td> <td style="text-align:left;">手动配置的堆栈名称的名称，该名称将用于检索资源。</td></tr> <tr><td style="text-align:left;">cloud.aws.stack.auto</td> <td style="text-align:left;">真正</td> <td style="text-align:left;">为应用程序启用自动堆栈名称检测。</td></tr></tbody></table> <h3 id="_4-5。手动名称解析"><a href="#_4-5。手动名称解析" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#manual-name-resolution" target="_blank" rel="noopener noreferrer">4.5。手动名称解析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS使用CloudFormation堆栈使用逻辑名称在内部解析所有资源。在某些情况下，可能需要解析应用程序代码中的物理名称。Spring Cloud AWS提供了一个预先配置的服务，用于根据逻辑名称解析物理堆栈名称。该示例显示了手动堆栈资源解析。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationService</span> <span class="token punctuation">{</span>

 <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ResourceIdResolver</span> resourceIdResolver<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token keyword">public</span> <span class="token class-name">ApplicationService</span><span class="token punctuation">(</span><span class="token class-name">ResourceIdResolver</span> resourceIdResolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>resourceIdResolver <span class="token operator">=</span> resourceIdResolver<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleApplicationLogic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> physicalBucketName <span class="token operator">=</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resourceIdResolver<span class="token punctuation">.</span><span class="token function">resolveToPhysicalResourceId</span><span class="token punctuation">(</span><span class="token string">&quot;someLogicalName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-6。堆叠标签"><a href="#_4-6。堆叠标签" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#stack-tags" target="_blank" rel="noopener noreferrer">4.6。堆叠标签<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>与Amazon EC2实例一样，CloudFormation也提供特定于堆栈的标签，可用于配置特定于堆栈的配置信息并在应用程序内部接收它们。例如，这可以是阶段特定的配置属性（例如DEV，INT，PRD）。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">....</span><span class="token punctuation">&gt;</span></span>
    ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>stack-configuration</span> <span class="token attr-name">user-tags-map</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stackTags<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>然后，应用程序可以使用类似的表达式访问堆栈标签<code>#{stackTags.key1}</code>。</p> <h3 id="_4-7。使用自定义cloudformation客户端"><a href="#_4-7。使用自定义cloudformation客户端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-custom-cloudformation-client" target="_blank" rel="noopener noreferrer">4.7。使用自定义CloudFormation客户端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>与EC2配置设置一样，该<code>aws-context:stack-configuration</code>元素支持具有特殊设置的自定义CloudFormation客户端。客户端本身可以使用<code>amazon-cloud-formation</code>示例中所示的属性进行配置：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>stack-configuration</span> <span class="token attr-name">amazon-cloud-formation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.amazonaws.services.cloudformation.AmazonCloudFormationClient<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_5-消息传递"><a href="#_5-消息传递" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#messaging" target="_blank" rel="noopener noreferrer">5.消息传递<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>Spring Cloud AWS提供了<a href="https://aws.amazon.com/sqs/" target="_blank" rel="noopener noreferrer">Amazon SQS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://aws.amazon.com/sqs/" target="_blank" rel="noopener noreferrer">Amazon SNS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>集成，从而简化了SQS或SNS上消息的发布和使用。尽管SQS完全依赖于Spring 4.0引入的消息传递API，但是SNS仅部分实现了它，因为对于推送通知，接收部分必须进行不同的处理。</p> <h3 id="_5-1。配置消息传递"><a href="#_5-1。配置消息传递" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-messaging" target="_blank" rel="noopener noreferrer">5.1。配置消息传递<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>在使用和配置消息传递支持之前，应用程序必须将相应的模块依赖性包括在Maven配置中。Spring Cloud AWS Messaging支持作为单独的模块提供，以允许模块的模块化使用。</p> <h4 id="_5-1-1。maven依赖项配置"><a href="#_5-1-1。maven依赖项配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#maven-dependency-configuration" target="_blank" rel="noopener noreferrer">5.1.1。Maven依赖项配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Spring Cloud AWS消息传递模块作为独立模块提供，可以通过以下依赖项声明导入：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-aws-messaging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>{spring-cloud-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_5-2。sqs支持"><a href="#_5-2。sqs支持" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#sqs-support" target="_blank" rel="noopener noreferrer">5.2。SQS支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Amazon SQS是Amazon Web Service平台上的托管消息传递服务，提供与队列的点对点通信。与JMS或其他消息服务相比，Amazon SQS具有一些应考虑的功能和限制。</p> <ul><li>Amazon SQS仅允许<code>String</code>有效负载，因此任何有效负载都<code>Object</code>必须转换为String表示形式。Spring Cloud AWS专门支持通过将Java对象与Amazon SQS消息转换为JSON来传输它们。</li> <li>Amazon SQS不支持事务，因此消息可能会被检索两次。必须以幂等的方式编写应用程序，这样他们才能收到两次消息。</li> <li>Amazon SQS的最大消息大小为每条消息256kb，因此，较大的消息将无法发送。</li></ul> <h4 id="_5-2-1。传送讯息"><a href="#_5-2-1。传送讯息" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#sending-a-message" target="_blank" rel="noopener noreferrer">5.2.1。传送讯息<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>将<code>QueueMessagingTemplate</code>包含许多方便的方法来发送消息。有一些发送方法使用一个<code>QueueMessageChannel</code>对象指定目标，而那些发送方法使用一个将根据SQS API解析的字符串指定目标。不带目的地参数的send方法使用默认目的地。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>sqs</span><span class="token punctuation">.</span><span class="token class-name">AmazonSQS</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>aws<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">QueueMessagingTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>support</span><span class="token punctuation">.</span><span class="token class-name">MessageBuilder</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqsQueueSender</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">QueueMessagingTemplate</span> queueMessagingTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">SqsQueueSender</span><span class="token punctuation">(</span><span class="token class-name">AmazonSQS</span> amazonSqs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>queueMessagingTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueueMessagingTemplate</span><span class="token punctuation">(</span>amazonSqs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>queueMessagingTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;physicalQueueName&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MessageBuilder</span><span class="token punctuation">.</span><span class="token function">withPayload</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>本示例使用<code>MessageBuilder</code>该类创建带有字符串有效负载的消息。的<code>QueueMessagingTemplate</code>是通过使参考构建<code>AmazonSQS</code>客户端。send方法中的目标是一个字符串值，必须与AWS上定义的队列名称匹配。该值将在运行时由Amazon SQS客户端解析。在CloudFormation堆栈中运行时，<code>ResourceIdResolver</code>可以选择将实现传递给<code>QueueMessagingTemplate</code>构造函数以按逻辑名称解析资源（有关资源名称解析的更多信息，请参阅<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#managing-cloud-environments" target="_blank" rel="noopener noreferrer">管理云环境<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p> <p>使用消息传递名称空间，<code>QueueMessagingTemplate</code>可以在XML配置文件中定义a 。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>aws-context</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/context<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>aws-messaging</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/messaging<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/cloud/aws/context
        http://www.springframework.org/schema/cloud/aws/context/spring-cloud-aws-context.xsd
        http://www.springframework.org/schema/cloud/aws/messaging
        http://www.springframework.org/schema/cloud/aws/messaging/spring-cloud-aws-messaging<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>instance-profile-credentials</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>queue-messaging-template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>queueMessagingTemplate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在此示例中，消息传递名称空间处理程序构造了一个new <code>QueueMessagingTemplate</code>。该<code>AmazonSQS</code>客户端会自动创建并传递给基于所提供的证书模板的构造函数。如果应用程序在已配置的CloudFormation堆栈中运行，<code>ResourceIdResolver</code>则会将a 传递给构造函数（有关资源名称解析的更多信息，请参阅 <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#managing-cloud-environments" target="_blank" rel="noopener noreferrer">管理云环境<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p> <h5 id="使用消息转换器"><a href="#使用消息转换器" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-message-converters" target="_blank" rel="noopener noreferrer">使用消息转换器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>为了促进域模型对象的发送，该<code>QueueMessagingTemplate</code>方法具有各种发送方法，这些方法将Java对象作为消息数据内容的参数。重载方法<code>convertAndSend()</code>和 <code>receiveAndConvert()</code>在<code>QueueMessagingTemplate</code>将转换过程委派到的一个实例<code>MessageConverter</code> 的接口。该接口定义了一个简单的协定，可以在Java对象和SQS消息之间进行转换。<code>SimpleMessageConverter</code>只要消息有效负载与目标类型匹配，默认实现就将其解包。通过使用转换器，您和您的应用程序代码可以专注于通过SQS发送或接收的业务对象，而不必关心如何将其表示为SQS消息的细节。</p> <div class="custom-block tip"><p class="custom-block-title">提示由于SQS仅能够发送`String`有效载荷，因此默认转换器`SimpleMessageConverter`仅应用于发送`String`有效载荷。对于更复杂的对象，应该使用自定义转换器，就像消息传递名称空间处理程序创建的转换器一样。 :::</p> <p>建议使用XML消息传递名称空间来创建<code>QueueMessagingTemplate</code>，因为它将设置一个更复杂的功能<code>MessageConverter</code>，当杰克逊在类路径上时，它将对象转换为JSON。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>queue-messaging-template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>queueMessagingTemplate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
this.queueMessagingTemplate.convertAndSend(&quot;queueName&quot;, new Person(&quot;John, &quot;Doe&quot;));
</code></pre></div><p>在此示例<code>QueueMessagingTemplate</code>中，使用消息传递名称空间创建一个。该<code>convertAndSend</code>方法<code>Person</code>使用配置的转换有效负载<code>MessageConverter</code>并发送消息。</p> <h4 id="_5-2-2。接收讯息"><a href="#_5-2-2。接收讯息" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#receiving-a-message" target="_blank" rel="noopener noreferrer">5.2.2。接收讯息<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>有两种接收SQS消息的<code>receive</code>方法，可以使用的方法<code>QueueMessagingTemplate</code>或使用注释驱动的侦听器端点的方法。到目前为止，后者是接收消息的更方便的方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>queueMessagingTemplate<span class="token punctuation">.</span><span class="token function">receiveAndConvert</span><span class="token punctuation">(</span><span class="token string">&quot;queueName&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在此示例中，<code>QueueMessagingTemplate</code>它将从SQS队列中获得一条消息，并将其转换为作为参数传递的目标类。</p> <h4 id="_5-2-3。注释驱动的侦听器端点"><a href="#_5-2-3。注释驱动的侦听器端点" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#annotation-driven-listener-endpoints" target="_blank" rel="noopener noreferrer">5.2.3。注释驱动的侦听器端点<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>注释驱动的侦听器端点是侦听SQS消息的最简单方法。只需使用<code>MessageMapping</code>和注释方法， <code>QueueMessageHandler</code>便会将消息路由到已注释的方法。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>annotation-driven-queue-listener</span> <span class="token punctuation">/&gt;</span></span>
@SqsListener(&quot;queueName&quot;)
public void queueListener(Person person) {
    // ...
}
</code></pre></div><p>在此示例中，启动了一个队列侦听器容器，该容器轮询<code>queueName</code>传递给<code>MessageMapping</code> 注释的SQS 。传入的消息将转换为目标类型，然后<code>queueListener</code>调用带注释的方法。</p> <p>除了有效载荷外，还可以使用<code>@Header</code>或<code>@Headers</code> 批注将标头注入侦听器方法中。<code>@Header</code>用于注入特定的标头值，而<code>@Headers</code>注入<code>Map&lt;String, String&gt;</code> 包含所有标头的。</p> <p>仅支持与SQS消息一起发送的<a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/APIReference/API_Message.html" target="_blank" rel="noopener noreferrer">标准消息属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。当前不支持自定义属性。</p> <p>除了提供的参数解析器外，还可以<code>aws-messaging:annotation-driven-queue-listener</code>使用<code>aws-messaging:argument-resolvers</code>属性在元素上注册自定义解析器 （请参见下面的示例）。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>annotation-driven-queue-listener</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>argument-resolvers</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.custom.CustomArgumentResolver<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-messaging:</span>argument-resolvers</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-messaging:</span>annotation-driven-queue-listener</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>默认情况下，使用核心和最大池大小的计算值<code>SimpleMessageListenerContainer</code>创建一个<code>ThreadPoolTaskExecutor</code>。核心池大小设置为队列数的两倍，最大池大小通过将队列数乘以该<code>maxNumberOfMessages</code>字段的值获得。如果这些默认值不满足应用程序的需求，则可以使用<code>task-executor</code>属性设置自定义任务执行程序（请参见下面的示例）。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>annotation-driven-queue-listener</span> <span class="token attr-name">task-executor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>simpleTaskExecutor<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h5 id="留言回复"><a href="#留言回复" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#message-reply" target="_blank" rel="noopener noreferrer">留言回复<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>可以对消息侦听器方法进行注释，<code>@SendTo</code>以将其返回值发送到另一个通道。在 <code>SendToHandlerMethodReturnValueHandler</code>上使用已定义的消息模板集 <code>aws-messaging:annotation-driven-queue-listener</code>元送返回值。消息传递模板必须实现<code>DestinationResolvingMessageSendingOperations</code>接口。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>annotation-driven-queue-listener</span> <span class="token attr-name">send-to-message-template</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>queueMessagingTemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
@SqsListener(&quot;treeQueue&quot;)
@SendTo(&quot;leafsQueue&quot;)
public List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Leaf</span><span class="token punctuation">&gt;</span></span> extractLeafs(Tree tree) {
    // ...
}
</code></pre></div><p>在此示例中，该<code>extractLeafs</code>方法将接收来自的消息<code>treeQueue</code>，然后返回的 <code>List</code>，<code>Leaf</code>将发送到<code>leafsQueue</code>。注意，在 <code>aws-messaging:annotation-driven-queue-listener</code>XML元素上有一个属性<code>send-to-message-template</code> ，指定<code>QueueMessagingTemplate</code>为消息模板，用于发送消息侦听器方法的返回值。</p> <h4 id="_5-2-4。simplemessagelistenercontainerfactory"><a href="#_5-2-4。simplemessagelistenercontainerfactory" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#the-simplemessagelistenercontainerfactory" target="_blank" rel="noopener noreferrer">5.2.4。SimpleMessageListenerContainerFactory<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>该<code>SimpleMessageListenerContainer</code>还可以通过创建类型的豆与Java配置<code>SimpleMessageListenerContainerFactory</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SimpleMessageListenerContainerFactory</span> <span class="token function">simpleMessageListenerContainerFactory</span><span class="token punctuation">(</span><span class="token class-name">AmazonSQSAsync</span> amazonSqs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SimpleMessageListenerContainerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleMessageListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setAmazonSqs</span><span class="token punctuation">(</span>amazonSqs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setAutoStartup</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setMaxNumberOfMessages</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>

    <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_5-2-5。通过amazon-sqs消费aws事件消息"><a href="#_5-2-5。通过amazon-sqs消费aws事件消息" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#consuming-aws-event-messages-with-amazon-sqs" target="_blank" rel="noopener noreferrer">5.2.5。通过Amazon SQS消费AWS事件消息<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>还可以通过SQS消息侦听器接收AWS生成的事件消息。因为AWS消息不包含mime-type头，所以必须为Jackson消息转换器配置<code>strictContentTypeMatch</code>属性false，以在没有正确的mime类型的情况下解析消息。</p> <p>以下代码显示了使用<code>QueueMessageHandlerFactory</code> 并重新配置的消息转换器的配置<code>MappingJackson2MessageConverter</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">QueueMessageHandlerFactory</span> <span class="token function">queueMessageHandlerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">QueueMessageHandlerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueueMessageHandlerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MappingJackson2MessageConverter</span> messageConverter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MappingJackson2MessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//set strict content type match to false</span>
    messageConverter<span class="token punctuation">.</span><span class="token function">setStrictContentTypeMatch</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setArgumentResolvers</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HandlerMethodArgumentResolver</span><span class="token punctuation">&gt;</span></span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PayloadArgumentResolver</span><span class="token punctuation">(</span>messageConverter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过上述配置，可以在<code>@SqsListener</code>以下所示的带注释的方法中接收S3存储桶的事件通知（以及其他事件通知，例如弹性代码转换器消息）。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SqsListener</span><span class="token punctuation">(</span><span class="token string">&quot;testQueue&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token class-name">S3EventNotification</span> s3EventNotificationRecord<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">S3EventNotification</span><span class="token punctuation">.</span><span class="token class-name">S3Entity</span> s3Entity <span class="token operator">=</span> s3EventNotificationRecord<span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getS3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-3。sns支持"><a href="#_5-3。sns支持" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#sns-support" target="_blank" rel="noopener noreferrer">5.3。SNS支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Amazon SNS是一个发布-订阅消息传递系统，它允许客户端将通知发布到特定主题。其他感兴趣的客户端可以使用不同的协议（例如HTTP / HTTPS，电子邮件或Amazon SQS队列）进行订阅以接收消息。</p> <p>下图显示了Amazon SNS架构的典型示例。</p> <p><img src="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/images/sns-overview.png" alt="SNS概述"></p> <p>Spring Cloud AWS通过<code>NotificationMessagingTemplate</code>使用基于Spring Web MVC <code>@Controller</code>的编程模型提供使用a发送通知和使用HTTP / HTTPS端点接收通知的支持，从而支持Amazon SNS 。基于Amazon SQS的订阅可以与Spring Cloud AWS消息传递模块提供的注释驱动消息支持一起使用。</p> <h4 id="_5-3-1。传送讯息"><a href="#_5-3-1。传送讯息" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#sending-a-message-2" target="_blank" rel="noopener noreferrer">5.3.1。传送讯息<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>在<code>NotificationMessagingTemplate</code>包含两个方便的方法来发送通知。第一个使用<code>String</code>将根据SNS API解析的来指定目的地。第二个不带目的地参数，并使用默认目的地。实现了所有可用的常规发送方法，<code>MessageSendingOperations</code> 但是发送通知不太方便，因为必须将主题作为标头传递。</p> <div class="custom-block tip"><p class="custom-block-title">提示当前只能`String`使用来发送有效载荷，`NotificationMessagingTemplate`因为这是SNS API的预期类型。 :::</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>amazonaws<span class="token punctuation">.</span>services<span class="token punctuation">.</span>sns</span><span class="token punctuation">.</span><span class="token class-name">AmazonSNS</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>aws<span class="token punctuation">.</span>messaging<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">NotificationMessagingTemplate</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SnsNotificationSender</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">NotificationMessagingTemplate</span> notificationMessagingTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">SnsNotificationSender</span><span class="token punctuation">(</span><span class="token class-name">AmazonSNS</span> amazonSns<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>notificationMessagingTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NotificationMessagingTemplate</span><span class="token punctuation">(</span>amazonSns<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>notificationMessagingTemplate<span class="token punctuation">.</span><span class="token function">sendNotification</span><span class="token punctuation">(</span><span class="token string">&quot;physicalTopicName&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> subject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>本示例<code>NotificationMessagingTemplate</code>通过将<code>AmazonSNS</code>客户端作为参数传递来构造一个新对象。在该<code>send</code> 方法中，便捷<code>sendNotification</code>方法用于将<code>message</code>with 发送<code>subject</code>给SNS主题。方法中的目标<code>sendNotification</code>是一个字符串值，必须与AWS上定义的主题名称匹配。此值在运行时由Amazon SNS客户端解析。在CloudFormation堆栈中运行时，<code>ResourceIdResolver</code>可以选择将实现传递给 <code>NotificationMessagingTemplate</code>构造函数以按逻辑名称解析资源。（有关资源名称解析的更多信息，请参阅<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#managing-cloud-environments" target="_blank" rel="noopener noreferrer">管理云环境<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。）</p> <p>建议使用XML消息传递名称空间进行创建<code>NotificationMessagingTemplate</code>，因为它将自动配置SNS客户端以设置默认转换器。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>notification-messaging-template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>notificationMessagingTemplate<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h4 id="_5-3-2。注释驱动的http通知端点"><a href="#_5-3-2。注释驱动的http通知端点" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#annotation-driven-http-notification-endpoint" target="_blank" rel="noopener noreferrer">5.3.2。注释驱动的HTTP通知端点<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>SNS支持多种端点类型（SQS，电子邮件，HTTP，HTTPS），Spring Cloud AWS提供了对HTTP（S）端点的支持。SNS向HTTP主题侦听器端点发送三种类型的请求，为每种请求提供了注释：</p> <ul><li>订阅请求→ <code>@NotificationSubscriptionMapping</code></li> <li>通知请求→ <code>@NotificationMessageMapping</code></li> <li>退订请求→ <code>@NotificationUnsubscribeMapping</code></li></ul> <p>HTTP端点基于Spring MVC控制器。Spring Cloud AWS添加了一些自定义参数解析器，以提取消息并从通知请求中进行主题处理。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/topicName&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotificationTestController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NotificationSubscriptionMapping</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleSubscriptionMessage</span><span class="token punctuation">(</span><span class="token class-name">NotificationStatus</span> status<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">//We subscribe to start receive the message</span>
        status<span class="token punctuation">.</span><span class="token function">confirmSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NotificationMessageMapping</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleNotificationMessage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NotificationSubject</span> <span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token annotation punctuation">@NotificationMessage</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NotificationUnsubscribeConfirmationMapping</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleUnsubscribeMessage</span><span class="token punctuation">(</span><span class="token class-name">NotificationStatus</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//e.g. the client has been unsubscribed and we want to &quot;re-subscribe&quot;</span>
        status<span class="token punctuation">.</span><span class="token function">confirmSubscription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>|      | 当前无法在方法级别定义映射URL，因此<code>RequestMapping</code>必须在类型级别完成并且必须包含端点的完整路径。 :::</p> <p>本示例使用三种方法创建新的Spring MVC控制器，以处理上面列出的三个请求。为了解析<code>handleNotificationMessage</code>方法的参数，必须注册自定义参数解析器。XML配置在下面列出。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>argument-resolvers</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>notificationResolver<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>argument-resolvers</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>notification-argument-resolver</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>notificationResolver<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>所述<code>aws-messaging:notification-argument-resolver</code>元件寄存器的三个参数解析器： <code>NotificationStatusHandlerMethodArgumentResolver</code>，<code>NotificationMessageHandlerMethodArgumentResolver</code>，和<code>NotificationSubjectHandlerMethodArgumentResolver</code>。</p> <h3 id="_5-4。使用cloudformation"><a href="#_5-4。使用cloudformation" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-cloudformation" target="_blank" rel="noopener noreferrer">5.4。使用CloudFormation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>可以在堆栈中配置Amazon SQS队列和SNS主题，然后供应用程序使用。Spring Cloud AWS还支持通过其逻辑名称以及对物理名称的解析来查找堆栈配置的队列和主题。以下示例显示了CloudFormation模板中的SNS主题和SQS队列配置。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;LogicalQueueName&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AWS::SQS::Queue&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token property">&quot;LogicalTopicName&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AWS::SNS::Topic&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>逻辑名称<code>LogicalQueueName</code>和<code>LogicalTopicName</code>可以在配置和应用程序中使用，如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>queue-messaging-template</span> <span class="token attr-name">default-destination</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>LogicalQueueName<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-messaging:</span>notification-messaging-template</span> <span class="token attr-name">default-destination</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>LogicalTopicName<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
@SqsListener(&quot;LogicalQueueName&quot;)
public void receiveQueueMessages(Person person) {
    // Logical names can also be used with messaging templates
    this.notificationMessagingTemplate.sendNotification(&quot;anotherLogicalTopicName&quot;, &quot;Message&quot;, &quot;Subject&quot;);
}
</code></pre></div><p>当使用上面示例中的逻辑名称时，可以在不同的环境中创建堆栈，而无需在应用程序内部进行任何配置或代码更改。</p> <h2 id="_6-缓存"><a href="#_6-缓存" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#caching" target="_blank" rel="noopener noreferrer">6.缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>在云环境中进行缓存对于减少应用程序的延迟并节省数据库往返时间很有用。减少数据库往返次数可以大大减少对数据库实例的需求。从3.1版开始，Spring框架提供了统一的Cache抽象，以允许在类似于声明式事务的应用程序中进行声明式缓存。</p> <p>Spring Cloud AWS将<a href="https://aws.amazon.com/elasticache/" target="_blank" rel="noopener noreferrer">Amazon ElastiCache<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>服务集成到Spring统一缓存抽象中，从而提供基于memcached和Redis协议的缓存管理器。对Spring Cloud的缓存支持AWS为ElastiCache提供了自己的memcached实现，并将 <a href="https://projects.spring.io/spring-data-redis/" target="_blank" rel="noopener noreferrer">Spring Data Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>用于Redis缓存。</p> <h3 id="_6-1。配置redis缓存的依赖关系"><a href="#_6-1。配置redis缓存的依赖关系" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-dependencies-for-redis-caches" target="_blank" rel="noopener noreferrer">6.1。配置Redis缓存的依赖关系<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS提供了自己的Memcached缓存实现，因此不需要其他依赖项。对于Redis Spring Cloud，AWS依靠Spring Data Redis支持缓存并允许使用多个Redis驱动程序。Spring Cloud AWS支持Spring Data Redis支持的所有Redis驱动程序（当前为Jedis，Jredis，SRP和Lettuce），并且Jedis在内部用于针对ElastiCache进行测试。示例中显示了Redis与Jedis的依赖关系定义</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-data-redis.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Spring Cloud AWS将自动检测Redis驱动程序，并自动使用其中之一。</p> <h3 id="_6-2。使用xml配置缓存"><a href="#_6-2。使用xml配置缓存" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-caching-with-xml" target="_blank" rel="noopener noreferrer">6.2。使用XML配置缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS的缓存支持位于上下文模块中，因此，如果上下文模块已导入到项目中，则可以使用它。缓存集成提供了自己的名称空间，以配置托管在Amazon ElastiCache服务中的缓存集群。下一个示例包含用于缓存集群的配置和用于启用声明式，基于注释的缓存的Spring配置。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>aws-cache</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/cache<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>cache</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cache<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/cache
        http://www.springframework.org/schema/cloud/aws/cache/spring-cloud-aws-cache.xsd
        http://www.springframework.org/schema/cache
        https://www.springframework.org/schema/cache/spring-cache.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
        ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-cache:</span>cache-manager</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-cache:</span>cache-cluster</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CacheCluster<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-cache:</span>cache-manager</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">cache:</span>annotation-driven</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>上面的配置<code>cache-manager</code>使用一个缓存来配置一个名称<code>CacheCluster</code>为 <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/UserGuide/ManagingCacheClusters.html" target="_blank" rel="noopener noreferrer">ElasticCache集群的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>缓存。</p> <h4 id="_6-2-1。混合缓存"><a href="#_6-2-1。混合缓存" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#mixing-caches" target="_blank" rel="noopener noreferrer">6.2.1。混合缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>应用程序可能需要由一个中央缓存群集维护的多个缓存。Spring Cloud AWS缓存支持允许在一个缓存管理器内定义多个缓存，也可以在缓存管理器内使用外部定义的缓存。</p> <p>以下示例演示了一个配置示例，该示例包含带有<code>cache-ref</code>元素的预配置缓存（可能是本地缓存）和<code>cache-cluster</code>ElastiCache缓存群集的配置。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-cache:</span>cache-manager</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cacheManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-cache:</span>cache-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>memcached<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-cache:</span>cache-cluster</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SimpleCache<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-cache:</span>cache-manager</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_6-2-2。定义到期时间"><a href="#_6-2-2。定义到期时间" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#defining-expiration" target="_blank" rel="noopener noreferrer">6.2.2。定义到期时间<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Spring缓存划分不支持到期时间配置，而是将其留给缓存实现来支持到期时间。Spring Cloud AWS缓存配置支持每个缓存的到期时间设置。到期时间将传递给memcached服务。</p> <p>的<code>cache-cluster</code>元件接受定义了以秒的到期时间到期属性。没有配置的值表示存在无限的到期时间。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-cache:</span>cache-manager</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-cache:</span>cache-cluster</span> <span class="token attr-name">expiration</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CacheCluster<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-cache:</span>cache-manager</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_6-3。使用java配置配置缓存"><a href="#_6-3。使用java配置配置缓存" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-caching-using-java-configuration" target="_blank" rel="noopener noreferrer">6.3。使用Java配置配置缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS还通过Java配置类支持缓存配置。在任何<code>Configuration</code>类上，都可以使用<code>org.springframework.cloud.aws.cache.config.annotation.EnableElastiCache</code> Spring Cloud AWS提供的注释来配置缓存。下一个示例显示了两个缓存群集的配置。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableElastiCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token annotation punctuation">@CacheClusterConfig</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;firstCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@CacheClusterConfig</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;secondCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果将<code>value</code>属性保留为空，则将自动配置CloudFormation堆栈（如果有）中的所有缓存。</p></div></div></div></div> <h4 id="_6-3-1。配置缓存的到期时间"><a href="#_6-3-1。配置缓存的到期时间" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-expiry-time-for-caches" target="_blank" rel="noopener noreferrer">6.3.1。配置缓存的到期时间<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Java配置还允许配置缓存的到期时间。可以使用该<code>defaultExpiration</code>属性对所有缓存执行此操作，如下例所示。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableElastiCache</span><span class="token punctuation">(</span>defaultExpiration <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以使用<code>@CacheClusterConfig</code>注释过期属性在缓存级别上定义过期，如下所示（使用秒作为值）。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableElastiCache</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token annotation punctuation">@CacheClusterConfig</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;firstCache&quot;</span><span class="token punctuation">,</span> expiration <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@CacheClusterConfig</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;secondCache&quot;</span><span class="token punctuation">,</span> expiration <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-4。在spring-boot中配置缓存"><a href="#_6-4。在spring-boot中配置缓存" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-caching-in-spring-boot" target="_blank" rel="noopener noreferrer">6.4。在Spring Boot中配置缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>缓存将在Spring Boot中自动配置，没有任何显式的配置属性。</p> <h3 id="_6-5。使用缓存"><a href="#_6-5。使用缓存" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-caching" target="_blank" rel="noopener noreferrer">6.5。使用缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>基于缓存的配置，开发人员可以注释其方法以将缓存用于方法返回值。下一个示例包含服务的缓存声明，应为其缓存返回值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExpensiveService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span><span class="token string">&quot;CacheCluster&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">calculateExpensiveValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-6。memcached客户端实现"><a href="#_6-6。memcached客户端实现" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#memcached-client-implementation" target="_blank" rel="noopener noreferrer">6.6。Memcached客户端实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>有许多可用于Java的内存缓存客户端实现，最著名的是 <a href="https://github.com/couchbase/spymemcached" target="_blank" rel="noopener noreferrer">Spymemcached<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/killme2008/xmemcached" target="_blank" rel="noopener noreferrer">XMemcached<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。Amazon AWS支持动态配置，并提供基于Spymemcached的增强型Memcached客户端，以支持基于中央配置终端节点的新节点的 <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/UserGuide/AutoDiscovery.html" target="_blank" rel="noopener noreferrer">自动发现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>Spring Cloud AWS依赖于Amazon ElastiCache Client实现，因此对此具有依赖性。</p> <h3 id="_6-7。使用cloudformation"><a href="#_6-7。使用cloudformation" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-cloudformation-2" target="_blank" rel="noopener noreferrer">6.7。使用CloudFormation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>还可以在堆栈中配置Amazon ElastiCache集群，然后供应用程序使用。Spring Cloud AWS还支持通过其逻辑名称以及对物理名称的解析来查找堆栈配置的缓存集群。下面的示例显示了CloudFormation模板内部的缓存集群配置。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;CacheCluster&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AWS::ElastiCache::CacheCluster&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;AutoMinorVersionUpgrade&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Engine&quot;</span><span class="token operator">:</span> <span class="token string">&quot;memcached&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;CacheNodeType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cache.t2.micro&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;CacheSubnetGroupName&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;sample&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;NumCacheNodes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;VpcSecurityGroupIds&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;sample1&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后，可以将缓存集群与<code>CacheCluster</code>应用程序配置中的名称一起使用，如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans...</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-cache:</span>cache-manager</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-cache:</span>cache-cluster</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CacheCluster<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expiration</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>15<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-cache:</span>cache-manager</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>通过以上配置，可以在不同环境中在多个堆栈中部署应用程序，而无需在应用程序内部进行任何配置更改。</p> <h2 id="_7-使用jdbc进行数据访问"><a href="#_7-使用jdbc进行数据访问" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#data-access-with-jdbc" target="_blank" rel="noopener noreferrer">7.使用JDBC进行数据访问<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>Spring对基于JDBC之类的<code>JdbcTemplate</code>专用ORM（JPA，Hibernate支持）构建的数据访问技术提供了广泛的支持。Spring Cloud AWS使应用程序开发人员可以重用他们选择的JDBC技术，并通过声明性配置访问 <a href="https://aws.amazon.com/rds/" target="_blank" rel="noopener noreferrer">Amazon Relational Database Service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。Spring Cloud AWS为JDBC数据访问提供的主要支持是：</p> <ul><li>基于Amazon RDS数据库实例的自动数据源配置和设置。</li> <li>Amazon RDS数据库实例的自动只读副本检测和配置。</li> <li>重试支持以处理数据中心内的多可用区故障转移期间的异常。</li></ul> <h3 id="_7-1。配置数据源"><a href="#_7-1。配置数据源" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-data-source" target="_blank" rel="noopener noreferrer">7.1。配置数据源<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>在使用和配置数据库支持之前，应用程序必须将相应的模块依赖性包括在其Maven配置中。Spring Cloud AWS JDBC支持作为一个单独的模块提供，以允许模块的模块化使用。</p> <h4 id="_7-1-1。maven依赖项配置"><a href="#_7-1-1。maven依赖项配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#maven-dependency-configuration-2" target="_blank" rel="noopener noreferrer">7.1.1。Maven依赖项配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Spring Cloud AWS JDBC模块作为独立模块提供，可以通过以下依赖项声明导入。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-aws-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>{spring-cloud-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_7-1-2。基本数据源配置"><a href="#_7-1-2。基本数据源配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#basic-data-source-configuration" target="_blank" rel="noopener noreferrer">7.1.2。基本数据源配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>数据源配置至少需要安全性和区域配置，以允许Spring Cloud AWS使用Amazon RDS服务检索数据库元数据信息。Spring Cloud AWS提供了一个额外的<code>jdbc</code>特定名称空间，以配置具有最少属性的数据源，如示例中所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>jdbc</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/jdbc<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/jdbc
       http://www.springframework.org/schema/cloud/aws/jdbc/spring-cloud-aws-jdbc.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
  ...
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jdbc:</span>data-source</span>
         <span class="token attr-name">db-instance-identifier</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myRdsDatabase<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${rdsPassword}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">jdbc:</span>data-source</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最小配置参数<code>id</code>对于数据源来说是唯一的，它<code>db-instance-identifier</code>是指向有效Amazon RDS数据库实例的有效属性。主用户的主用户密码。如果有另一个用户要使用（推荐），则<code>username</code>可以设置该属性。</p> <p>通过这种配置，Spring Cloud AWS会获取所有必要的元数据，并使用默认属性创建一个 <a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html" target="_blank" rel="noopener noreferrer">Tomcat JDBC池<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。数据源可以稍后注入到任何Spring Bean中，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleDatabaseService</span> <span class="token keyword">implements</span> <span class="token class-name">DatabaseService</span> <span class="token punctuation">{</span>

 <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

 <span class="token annotation punctuation">@Autowired</span>
 <span class="token keyword">public</span> <span class="token class-name">SimpleDatabaseService</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以通过<code>@Qualifier</code>注释限定数据源注入点，以允许在一个应用程序上下文中进行多个数据源配置，并且仍然使用自动装配。</p> <h4 id="_7-1-3。数据源池配置"><a href="#_7-1-3。数据源池配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#data-source-pool-configuration" target="_blank" rel="noopener noreferrer">7.1.3。数据源池配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Spring Cloud AWS使用默认属性创建一个新的Tomcat JDBC池。这些默认属性通常在池大小和其他设置方面不满足应用程序的要求。数据源配置支持使用嵌套XML元素配置所有有效池属性。下面的示例演示使用自定义池属性重新配置数据源。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">..</span><span class="token punctuation">&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
  ...
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>...<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jdbc:</span>data-source</span>
         <span class="token attr-name">db-instance-identifier</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myRdsDatabase<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${rdsPassword}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jdbc:</span>pool-attributes</span> <span class="token attr-name">initialSize</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">&quot;</span> <span class="token attr-name">maxActive</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minIdle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span>
                <span class="token attr-name">testOnBorrow</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">validationQuery</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SELECT 1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">jdbc:</span>data-source</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><a href="https://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html" target="_blank" rel="noopener noreferrer">此处<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了所有配置属性及其值的完整列表。</p> <h3 id="_7-2。使用java配置配置数据源"><a href="#_7-2。使用java配置配置数据源" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-data-source-with-java-config" target="_blank" rel="noopener noreferrer">7.2。使用Java配置配置数据源<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS还支持在类中配置数据源<code>@Configuration</code>。该 <code>org.springframework.cloud.aws.jdbc.config.annotation.EnableRdsInstance</code>注释可被用于配置一个数据源。可以使用多个配置多个数据源。每个注释将只生成一个数据源bean。</p> <p>下面的类显示了配置类内部的数据源配置</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableRdsInstance</span><span class="token punctuation">(</span>dbInstanceIdentifier <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>password <span class="token operator">=</span> <span class="token string">&quot;secret&quot;</span><span class="token punctuation">,</span> readReplicaSupport <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>XML元素中的配置属性相同。XML配置所需的属性也相同（<code>dbInstanceIdentifier</code>and <code>password</code>属性）</p></div> <h4 id="_7-2-1。基于java的数据源池配置"><a href="#_7-2-1。基于java的数据源池配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#java-based-data-source-pool-configuration" target="_blank" rel="noopener noreferrer">7.2.1。基于Java的数据源池配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>也可以使用自定义值覆盖池配置。Spring Cloud AWS提供了一个 <code>org.springframework.cloud.aws.jdbc.config.annotation.RdsInstanceConfigurer</code>创建的 <code>org.springframework.cloud.aws.jdbc.datasource.DataSourceFactory</code>，其中可能包含自定义池属性。下一个示例显示了一个覆盖验证查询和初始大小的配置程序的实现。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableRdsInstance</span><span class="token punctuation">(</span>dbInstanceIdentifier <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>password <span class="token operator">=</span> <span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RdsInstanceConfigurer</span> <span class="token function">instanceConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RdsInstanceConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">DataSourceFactory</span> <span class="token function">getDataSourceFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">TomcatJdbcDataSourceFactory</span> dataSourceFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TomcatJdbcDataSourceFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                dataSourceFactory<span class="token punctuation">.</span><span class="token function">setInitialSize</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                dataSourceFactory<span class="token punctuation">.</span><span class="token function">setValidationQuery</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT 1 FROM DUAL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> dataSourceFactory<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>此类返回类型为的匿名类<code>org.springframework.cloud.aws.jdbc.config.annotation.RdsInstanceConfigurer</code>，它当然也可以是独立类。</p></div> <h3 id="_7-3。在spring-boot中配置数据源"><a href="#_7-3。在spring-boot中配置数据源" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-data-source-in-spring-boot" target="_blank" rel="noopener noreferrer">7.3。在Spring Boot中配置数据源<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>也可以使用Spring Boot配置文件来配置数据源。由于一个应用程序中数据源的数量动态，因此必须为每个数据源配置Spring Boot属性。</p> <p>数据源配置由<code>cloud.aws.rds.&lt;instanceName&gt;</code>数据源标识符的常规属性名称和特定数据源的子属性组成，其中子属性为<code>instanceName</code>具体实例的名称。下表概述了<code>test</code>用作实例标识符的数据源的所有属性。</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">例</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">cloud.aws.rds.test</td> <td style="text-align:left;"></td> <td style="text-align:left;">使用名称测试配置数据源的配置属性</td></tr> <tr><td style="text-align:left;">cloud.aws.rds.test.password</td> <td style="text-align:left;">非常秘密</td> <td style="text-align:left;">数据库实例测试的密码</td></tr> <tr><td style="text-align:left;">cloud.aws.rds.test。用户名</td> <td style="text-align:left;">管理员</td> <td style="text-align:left;">数据库实例测试的用户名（可选）</td></tr> <tr><td style="text-align:left;">cloud.aws.rds.test.readReplicaSupport</td> <td style="text-align:left;">真正</td> <td style="text-align:left;">如果应将只读副本用作数据源（请参见下文）</td></tr> <tr><td style="text-align:left;">cloud.aws.rds.test.databaseName</td> <td style="text-align:left;">fooDb</td> <td style="text-align:left;">自定义数据库名称（如果不应使用来自rds的默认数据库名称）</td></tr></tbody></table> <h3 id="_7-4。只读副本配置"><a href="#_7-4。只读副本配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#read-replica-configuration" target="_blank" rel="noopener noreferrer">7.4。只读副本配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Amazon RDS允许使用<a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_ReadRepl.html" target="_blank" rel="noopener noreferrer">MySQL只读副本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实例，通过将读取数据访问权转移给一个或多个只读副本从属，同时将数据维护在一个主数据库中来提高数据库的整体吞吐量。</p> <p>Spring Cloud AWS支持将只读副本与Spring只读事务结合使用。如果启用了只读副本支持，则在使用master数据库进行写操作时，任何只读事务都将被路由到只读副本实例。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>使用只读副本实例不能保证对数据库访问具有严格的<a href="https://en.wikipedia.org/wiki/ACID" target="_blank" rel="noopener noreferrer">ACID<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>语义，因此应谨慎使用。这是由于以下事实：读副本可能位于后面，而读事务可能无法立即看到写操作。因此，建议仅将只读副本实例用于读取数据的事务，这些事务不会经常更改并且应用程序可以处理过时的数据。</p></div> <p>可以使用<code>read-replica</code>数据源配置中的属性启用只读副本支持。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">..</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jdbc:</span>data-source</span> <span class="token attr-name">db-instance-identifier</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>RdsSingleMicroInstance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${rdsPassword}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-replica-support</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">jdbc:</span>data-source</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Spring Cloud AWS将搜索为主数据库创建的任何只读副本，并将只读事务路由到可用的只读副本之一。可以像示例中所示实现使用只读副本的业务服务。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleDatabaseService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">SimpleDatabaseService</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>readOnly <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">loadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// read data on the read replica</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updatePerson</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// write data into database</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-5。故障转移支持"><a href="#_7-5。故障转移支持" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#failover-support" target="_blank" rel="noopener noreferrer">7.5。故障转移支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>如果由于主实例的故障或故障而导致一个可用区不可用，则Amazon RDS支持<a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.MultiAZ.html" target="_blank" rel="noopener noreferrer">多<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可用区故障转移。复制是同步的（与只读副本相比），并提供连续的服务。Spring Cloud AWS通过重试机制支持多可用区故障转移，以恢复在多可用区故障转移期间失败的事务。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>在大多数情况下，最好是向用户提供直接反馈，而不是尝试在用户交互中进行可能较长且频繁的重试。因此，故障转移支持主要用于批处理应用程序或服务调用的响应性不是至关重要的应用程序。</p></div> <p>Spring Cloud AWS JDBC模块提供了一个重试拦截器，可用于使用拦截器来修饰服务。如果由于多可用区故障转移而导致暂时性错误，拦截器将再次重试数据库操作。多可用区故障转移通常仅持续几秒钟，因此重试业务交易将很可能成功。</p> <p>可以将拦截器配置为常规bean，然后由切入点表达式使用该拦截器来装饰各个方法调用。拦截器必须具有配置的数据库，才能从Amazon RDS服务检索当前状态（如果是临时故障转移或永久错误）。</p> <p>可以使用Spring Cloud AWS jdbc命名空间中的自定义元素来完成拦截器的配置，并将其配置如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">..</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jdbc:</span>retry-interceptor</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myInterceptor<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">db-instance-identifier</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myRdsDatabase<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">max-number-of-retries</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>拦截器本身可以与任何Spring建议配置一起使用，以包装相应的服务。上一章中显示的服务切入点可以定义如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">..</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myInterceptor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bean(simpleDatabaseService)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>重要的是，在事务拦截器外部调用该拦截器，以确保将重新执行整个事务。在事务拦截器中配置拦截器将导致永久性错误，因为断开的连接将永远不会刷新。</p></div> <p>上面的配置与事务配置相结合，将为服务生成以下代理配置。</p> <p><img src="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/images/jdbc-retry-interceptor.png" alt="重试拦截器"></p> <h3 id="_7-6。cloudformation支持"><a href="#_7-6。cloudformation支持" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#cloudformation-support" target="_blank" rel="noopener noreferrer">7.6。CloudFormation支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS支持使用CloudFormation配置的数据库实例。Spring Cloud AWS可以在数据库配置中使用逻辑名，并使用生成的物理资源名查找具体数据库。可以使用以下示例中的模板定义在CloudFormation中轻松配置数据库配置。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;myRdsDatabase&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AWS::RDS::DBInstance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">&quot;AllocatedStorage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;DBInstanceClass&quot;</span><span class="token operator">:</span> <span class="token string">&quot;db.t1.micro&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;DBName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;Engine&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;MasterUsername&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;MasterUserPassword&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;Ref&quot;</span><span class="token operator">:</span><span class="token string">&quot;RdsPassword&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     ...
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token property">&quot;readReplicaDatabase&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AWS::RDS::DBInstance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">&quot;AllocatedStorage&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;SourceDBInstanceIdentifier&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Ref&quot;</span><span class="token operator">:</span> <span class="token string">&quot;myRdsDatabase&quot;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token property">&quot;DBInstanceClass&quot;</span><span class="token operator">:</span> <span class="token string">&quot;db.t1.micro&quot;</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后可以使用模板中设置的名称来配置数据库。此外，可以启用只读副本以在应用程序中使用配置的只读副本数据库。下面概述了使用已配置数据库的配置：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>stack-configuration</span><span class="token punctuation">/&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jdbc:</span>data-source</span> <span class="token attr-name">db-instance-identifier</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myRdsDatabase<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${rdsPassword}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-replica-support</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_7-7。数据库标签"><a href="#_7-7。数据库标签" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#database-tags" target="_blank" rel="noopener noreferrer">7.7。数据库标签<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>还可以使用RDS数据库特定标签配置Amazon RDS实例，从而允许用户使用数据库配置数据库特定的配置元数据。可以使用元素<code>user-tags-map</code>上的属性来配置特定于数据库实例的标签<code>data-source</code>。如下例所示配置标签支持：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jdbc:</span>data-source</span>
    <span class="token attr-name">db-instance-identifier</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myRdsDatabase<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${rdsPassword}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user-tags-map</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dbTags<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>这使开发人员可以使用下面的类中所示的表达式访问代码中的属性：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;#{dbTags['aws:cloudformation:aws:cloudformation:stack-name']}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> stackName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p><code>aws:cloudformation:aws:cloudformation:stack-name</code>如果使用CloudFormation配置数据库，则数据库标记是默认标记。</p></div> <h2 id="_8-发送邮件"><a href="#_8-发送邮件" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#sending-mails" target="_blank" rel="noopener noreferrer">8.发送邮件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>Spring具有内置支持，可以基于<a href="https://www.oracle.com/technetwork/java/javamail/index.html" target="_blank" rel="noopener noreferrer">Java Mail API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>发送电子邮件， 从而避免在使用Java Mail API时进行任何静态方法调用，从而支持应用程序的可测试性。Spring Cloud AWS支持将<a href="https://aws.amazon.com/de/ses/" target="_blank" rel="noopener noreferrer">Amazon SES<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>作为Spring Mail抽象的实现。</p> <p>因此，Spring Cloud AWS用户可以决定使用Amazon SES服务的Spring Cloud AWS实施，或使用基于标准Java Mail API的实施，该实施通过SMTP将电子邮件发送到Amazon SES。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>出于性能原因，首选使用Spring Cloud AWS实施而不是SMTP。Spring Cloud AWS使用一个API调用来发送邮件，而SMTP协议发出多个请求（EHLO，MAIL FROM，RCPT TO，DATA，QUIT），直到发送电子邮件为止。</p></div> <h3 id="_8-1。配置邮件发件人"><a href="#_8-1。配置邮件发件人" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-the-mail-sender" target="_blank" rel="noopener noreferrer">8.1。配置邮件发件人<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS提供了一个XML元素来<code>org.springframework.mail.MailSender</code>为要使用的客户端配置Spring 实现。默认邮件发件人可以在没有Java Mail依赖项的情况下工作，并且能够将不带附件的邮件作为简单邮件发送。具有必要元素的配置如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>aws-mail</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/mail<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/mail
      http://www.springframework.org/schema/cloud/aws/mail/spring-cloud-aws-mail.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
      ..
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eu-west-1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-mail:</span>mail-sender</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>testSender<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_8-2。发送简单邮件"><a href="#_8-2。发送简单邮件" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#sending-simple-mails" target="_blank" rel="noopener noreferrer">8.2。发送简单邮件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>应用程序开发人员可以将注入<code>MailSender</code>到他们的应用程序代码中，并直接发送基于简单文本的电子邮件。下面的示例演示简单邮件的创建。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailSendingService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">MailSender</span> mailSender<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MailSendingService</span><span class="token punctuation">(</span><span class="token class-name">MailSender</span> mailSender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mailSender <span class="token operator">=</span> mailSender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMailMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SimpleMailMessage</span> simpleMailMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleMailMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleMailMessage<span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span><span class="token string">&quot;foo@bar.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleMailMessage<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span><span class="token string">&quot;bar@baz.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleMailMessage<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">&quot;test subject&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        simpleMailMessage<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">&quot;test content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>simpleMailMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-3。发送附件"><a href="#_8-3。发送附件" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#sending-attachments" target="_blank" rel="noopener noreferrer">8.3。发送附件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>使用电子邮件发送附件需要创建和发送MIME消息。为了创建MIME消息，Java Mail依赖关系是必需的，并且必须包含在类路径中。Spring Cloud AWS将检测依赖关系并创建一个<code>org.springframework.mail.javamail.JavaMailSender</code>实现，该实现允许创建和构建MIME消息并将其发送。Java Mail API的依赖项配置是配置中唯一的更改，如下所示。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.mail<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mailapi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- exclusion because we are running on Java 1.7 that includes the activation API by default--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.activation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>即使对Java Mail API有所依赖，仍然在下面使用Amazon SES API发送邮件消息。在Amazon AWS端无需进行<a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/send-email-smtp.html" target="_blank" rel="noopener noreferrer">SMTP设置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>发送邮件要求应用程序开发人员使用<code>JavaMailSender</code>来发送电子邮件，如下例所示。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MailSendingService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">JavaMailSender</span> mailSender<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MailSendingService</span><span class="token punctuation">(</span><span class="token class-name">JavaMailSender</span> mailSender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mailSender <span class="token operator">=</span> mailSender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMailMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mailSender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MimeMessagePreparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token class-name">MimeMessage</span> mimeMessage<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">MimeMessageHelper</span> helper <span class="token operator">=</span>
                    <span class="token keyword">new</span> <span class="token class-name">MimeMessageHelper</span><span class="token punctuation">(</span>mimeMessage<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                helper<span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span><span class="token string">&quot;foo@bar.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                helper<span class="token punctuation">.</span><span class="token function">setFrom</span><span class="token punctuation">(</span><span class="token string">&quot;bar@baz.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                helper<span class="token punctuation">.</span><span class="token function">addAttachment</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                helper<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">&quot;test subject with attachment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                helper<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">&quot;mime body&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-4。配置区域"><a href="#_8-4。配置区域" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-regions" target="_blank" rel="noopener noreferrer">8.4。配置区域<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Amazon SES并非在Amazon Web Services云的所有<a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/regions.html" target="_blank" rel="noopener noreferrer">区域<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中都可用。因此，在不支持邮件服务的区域中托管和运行的应用程序在使用邮件服务时将产生错误。因此，对于邮件发件人配置，必须覆盖该区域。下面的示例显示了不提供SES服务的区域（EU-CENTRAL-1）的典型组合，在该区域中，客户端被覆盖以使用有效区域（EU-WEST-1）。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>

 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-region</span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eu-central-1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-mail:</span>mail-sender</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>testSender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">region</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eu-west-1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_8-5。验证电子邮件"><a href="#_8-5。验证电子邮件" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#authenticating-e-mails" target="_blank" rel="noopener noreferrer">8.5。验证电子邮件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>为了避免对Amazon SES邮件服务进行垃圾邮件攻击，没有生产访问权限的应用程序必须 <a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/verify-email-addresses.html" target="_blank" rel="noopener noreferrer">验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>每个电子邮件接收者，否则邮件发送者将抛出<code>com.amazonaws.services.simpleemail.model.MessageRejectedException</code>。</p> <p>可以请求<a href="https://docs.aws.amazon.com/ses/latest/DeveloperGuide/request-production-access.html" target="_blank" rel="noopener noreferrer">生产访问权限<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这将禁用对邮件地址验证的需要。</p> <h2 id="_9-资源处理"><a href="#_9-资源处理" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#resource-handling" target="_blank" rel="noopener noreferrer">9.资源处理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>Spring框架提供了<code>org.springframework.core.io.ResourceLoader</code>从文件系统，servlet上下文和类路径加载文件的抽象。Spring Cloud AWS增加了对<a href="https://aws.amazon.com/s3/" target="_blank" rel="noopener noreferrer">Amazon S3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>服务的支持，以使用资源加载器和<code>s3</code>协议加载和写入资源。</p> <p>资源加载器是上下文模块的一部分，因此使用资源处理支持不需要其他依赖项。</p> <h3 id="_9-1。配置资源加载器"><a href="#_9-1。配置资源加载器" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuring-the-resource-loader" target="_blank" rel="noopener noreferrer">9.1。配置资源加载器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring Cloud AWS不会修改默认资源加载器，除非它遇到带有XML名称空间元素的显式配置。该配置由整个应用程序上下文中的一个元素组成，如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aws-context</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/context<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/cloud/aws/context
       http://www.springframework.org/schema/cloud/aws/context/spring-cloud-aws-context.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>
            ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aws-context:</span>context-credentials</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-resource-loader</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_9-2。下载文件"><a href="#_9-2。下载文件" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#downloading-files" target="_blank" rel="noopener noreferrer">9.2。下载文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>通过使用<code>s3</code>协议来引用Amazon S3存储桶及其存储桶中的对象，可以完成文件下载。典型模式是：<code>s3://&lt;bucket&gt;/&lt;object&gt;</code>bucket是全局且唯一的存储桶名称，而object是存储桶内的有效对象名称。对象名称可以是存储桶<em>根</em>文件夹中的文件，也可以是存储桶内目录中的嵌套文件。</p> <p>下一个示例演示如何使用资源加载器加载不同的资源。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleResourceLoadingBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resourceLoadingMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Resource</span> resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">&quot;s3://myBucket/rootFile.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Resource</span> secondResource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">&quot;s3://myBucket/rootFolder/subFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//read file</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-3。上载档案"><a href="#_9-3。上载档案" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#uploading-files" target="_blank" rel="noopener noreferrer">9.3。上载档案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>从Spring Framework 3.1开始，资源加载器还可以用于通过<code>org.springframework.core.io.WritableResource</code> 接口上传文件，这是该接口的一种特殊形式<code>org.springframework.core.io.ResourceLoader</code>。客户端可以使用该<code>WritableResource</code>界面上传文件。下一个示例演示了使用资源加载器上传资源。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleResourceLoadingBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Resource</span> resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">&quot;s3://myBucket/rootFile.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WritableResource</span> writableResource <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WritableResource</span><span class="token punctuation">)</span> resource<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> writableResource<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_9-3-1。上载多部分文件"><a href="#_9-3-1。上载多部分文件" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#uploading-multi-part-files" target="_blank" rel="noopener noreferrer">9.3.1。上载多部分文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Amazon S3支持<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/uploadobjusingmpu.html" target="_blank" rel="noopener noreferrer">分段上传，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以提高<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/uploadobjusingmpu.html" target="_blank" rel="noopener noreferrer">上传<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>时的总体吞吐量。默认情况下，Spring Cloud AWS仅使用一个线程上传文件，因此不提供并行上传支持。用户可以<code>org.springframework.core.task.TaskExecutor</code> 为资源加载器配置自定义。资源加载器将同时将多个线程排队，以使用并行的多部分上传。</p> <p>使用10个线程上传的资源加载器的配置如下所示</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aws-context:</span>context-resource-loader</span> <span class="token attr-name">task-executor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>executor<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">task:</span>executor</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>executor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pool-size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">queue-capacity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rejection-policy</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CALLER_RUNS<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>Spring Cloud AWS每个线程最多消耗5 MB（最少）的内存。因此，每个并行线程将在堆中占用5 MB的内存，而线程大小为10的线程将因此消耗多达50 mb的堆空间。Spring Cloud AWS会尽快释放内存。另外，上面的示例显示没有<code>queue-capacity</code>配置，因为排队的请求还会占用内存。</p></div> <h4 id="_9-3-2。使用transfermanager上载"><a href="#_9-3-2。使用transfermanager上载" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#uploading-with-the-transfermanager" target="_blank" rel="noopener noreferrer">9.3.2。使用TransferManager上载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Amazon SDK还提供了一个高级抽象，对于上传文件很有用，也可以使用多部分功能通过多个线程上传文件。<code>com.amazonaws.services.s3.transfer.TransferManager</code>可以在应用程序代码中轻松创建A ，并将其注入<code>com.amazonaws.services.s3.AmazonS3</code>已经使用Spring Cloud AWS资源加载器配置创建的预配置客户端。</p> <p>本示例说明<code>transferManager</code>在应用程序中使用来从硬盘驱动器上载文件。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleResourceLoadingBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AmazonS3</span> amazonS3<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">withTransferManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TransferManager</span> transferManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransferManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>amazonS3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferManager<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token string">&quot;myBucket&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;filename&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;someFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-4。搜索资源"><a href="#_9-4。搜索资源" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#searching-resources" target="_blank" rel="noopener noreferrer">9.4。搜索资源<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Spring资源加载器还支持基于Ant样式的路径规范来收集资源。Spring Cloud AWS提供了相同的支持来解析存储桶中甚至整个存储桶中的资源。实际的资源加载器需要与Spring Cloud AWS 1一起包装才能搜索s3存储桶，在非s3存储桶的情况下，资源加载器将退回到原始资源加载器。下一个示例显示使用不同模式的资源解析。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleResourceLoadingBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ResourcePatternResolver</span> resourcePatternResolver<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setupResolver</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">,</span> <span class="token class-name">AmazonS3</span> amazonS3<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePatternResolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PathMatchingSimpleStorageResourcePatternResolver</span><span class="token punctuation">(</span>amazonS3<span class="token punctuation">,</span> applicationContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resolveAndLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allTxtFilesInFolder <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePatternResolver<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token string">&quot;s3://bucket/name/*.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allTxtFilesInBucket <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePatternResolver<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token string">&quot;s3://bucket/**/*.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allTxtFilesGlobally <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePatternResolver<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token string">&quot;s3://**/*.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">提示根据用户拥有的存储桶数，解析所有存储桶中的资源可能非常耗时。 :::</p> <h3 id="_9-5。使用cloudformation"><a href="#_9-5。使用cloudformation" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#using-cloudformation-3" target="_blank" rel="noopener noreferrer">9.5。使用CloudFormation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>CloudFormation还允许在堆栈创建期间创建存储桶。这些存储桶通常会有一个生成的名称，该名称必须用作存储桶名称。为了允许应用程序开发人员在其配置中定义<em>静态</em>名称，Spring Cloud AWS提供了支持来解析生成的存储桶名称。应用程序开发人员可以使用该<code>org.springframework.cloud.aws.core.env.ResourceIdResolver</code>接口来解析基于逻辑名称生成的物理名称。</p> <p>下一个示例显示了CloudFormation堆栈模板内的存储桶定义。该存储桶将使用诸如<em>integrationteststack-sampleBucket-23qysofs62tc2之</em>类的名称创建</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;Resources&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;sampleBucket&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AWS::S3::Bucket&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>应用程序开发人员可以解析该名称并将其用于加载资源，如下面的下一个示例所示。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleResourceLoadingBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ResourceLoader</span> loader<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ResourceIdResolver</span> idResolver<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">SimpleResourceLoadingBean</span><span class="token punctuation">(</span><span class="token class-name">ResourceLoader</span> loader<span class="token punctuation">,</span> <span class="token class-name">ResourceIdResolver</span> idResolver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loader <span class="token operator">=</span> loader<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>idResolver <span class="token operator">=</span> idResolver<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resolveAndLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> sampleBucketName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>idResolver<span class="token punctuation">.</span>
            <span class="token function">resolveToPhysicalResourceId</span><span class="token punctuation">(</span><span class="token string">&quot;sampleBucket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Resource</span> resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loader<span class="token punctuation">.</span>
            <span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">&quot;s3://&quot;</span> <span class="token operator">+</span> sampleBucketName <span class="token operator">+</span> <span class="token string">&quot;/test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_10-配置属性"><a href="#_10-配置属性" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/#configuration-properties" target="_blank" rel="noopener noreferrer">10.配置属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>要查看所有与Spring Cloud AWS相关的配置属性的列表，请检查<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.2.0.RELEASE/reference/html/appendix.html" target="_blank" rel="noopener noreferrer">附录页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/springcloud/SpringCloudStream.html" class="prev">
        Spring Cloud Stream参考文档
      </a></span> <span class="next"><a href="/springcloud/SpringCloudBus.html">
        Spring Cloud Bus
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b6fcbba0.js" defer></script><script src="/assets/js/2.0769d472.js" defer></script><script src="/assets/js/87.bfbb78e2.js" defer></script>
  </body>
</html>
