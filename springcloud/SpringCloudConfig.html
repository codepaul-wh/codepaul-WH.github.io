<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Cloud Config |  </title>
    <meta name="description" content=" ">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/img/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.6d3e66e0.css" as="style"><link rel="preload" href="/assets/js/app.ab60294b.js" as="script"><link rel="preload" href="/assets/js/2.0769d472.js" as="script"><link rel="preload" href="/assets/js/91.4f784eb3.js" as="script"><link rel="prefetch" href="/assets/js/10.d5b488e5.js"><link rel="prefetch" href="/assets/js/100.b05fe937.js"><link rel="prefetch" href="/assets/js/101.c78118ad.js"><link rel="prefetch" href="/assets/js/11.ba7209bc.js"><link rel="prefetch" href="/assets/js/12.7eb2b639.js"><link rel="prefetch" href="/assets/js/13.319a2e91.js"><link rel="prefetch" href="/assets/js/14.fe83290c.js"><link rel="prefetch" href="/assets/js/15.8a7ec64a.js"><link rel="prefetch" href="/assets/js/16.41f2dd98.js"><link rel="prefetch" href="/assets/js/17.904bc325.js"><link rel="prefetch" href="/assets/js/18.7a6246f7.js"><link rel="prefetch" href="/assets/js/19.84ab8dd3.js"><link rel="prefetch" href="/assets/js/20.04c09d1c.js"><link rel="prefetch" href="/assets/js/21.e75a2f46.js"><link rel="prefetch" href="/assets/js/22.a14b1840.js"><link rel="prefetch" href="/assets/js/23.799a37e9.js"><link rel="prefetch" href="/assets/js/24.c3eada22.js"><link rel="prefetch" href="/assets/js/25.4f11ed3d.js"><link rel="prefetch" href="/assets/js/26.375a9c03.js"><link rel="prefetch" href="/assets/js/27.bc7c4ae2.js"><link rel="prefetch" href="/assets/js/28.2250b95c.js"><link rel="prefetch" href="/assets/js/29.f568d59e.js"><link rel="prefetch" href="/assets/js/3.79868d1c.js"><link rel="prefetch" href="/assets/js/30.f7eb4129.js"><link rel="prefetch" href="/assets/js/31.94b316c6.js"><link rel="prefetch" href="/assets/js/32.428d0721.js"><link rel="prefetch" href="/assets/js/33.6064d0ca.js"><link rel="prefetch" href="/assets/js/34.711c8d67.js"><link rel="prefetch" href="/assets/js/35.2d341b53.js"><link rel="prefetch" href="/assets/js/36.d44bf3ce.js"><link rel="prefetch" href="/assets/js/37.b6844632.js"><link rel="prefetch" href="/assets/js/38.80d006c6.js"><link rel="prefetch" href="/assets/js/39.f7bee99d.js"><link rel="prefetch" href="/assets/js/4.973e9025.js"><link rel="prefetch" href="/assets/js/40.0239e47a.js"><link rel="prefetch" href="/assets/js/41.ae2fbfaa.js"><link rel="prefetch" href="/assets/js/42.dfd29a6a.js"><link rel="prefetch" href="/assets/js/43.683daf3c.js"><link rel="prefetch" href="/assets/js/44.562e4097.js"><link rel="prefetch" href="/assets/js/45.95b98fcb.js"><link rel="prefetch" href="/assets/js/46.d96aa487.js"><link rel="prefetch" href="/assets/js/47.2aca851e.js"><link rel="prefetch" href="/assets/js/48.814b9e24.js"><link rel="prefetch" href="/assets/js/49.fe2be804.js"><link rel="prefetch" href="/assets/js/5.336b97a1.js"><link rel="prefetch" href="/assets/js/50.c5a763c1.js"><link rel="prefetch" href="/assets/js/51.41e24a47.js"><link rel="prefetch" href="/assets/js/52.6c448e60.js"><link rel="prefetch" href="/assets/js/53.8c0b5684.js"><link rel="prefetch" href="/assets/js/54.8f76ab97.js"><link rel="prefetch" href="/assets/js/55.a15238f6.js"><link rel="prefetch" href="/assets/js/56.385a70ef.js"><link rel="prefetch" href="/assets/js/57.fe5f9465.js"><link rel="prefetch" href="/assets/js/58.348704b8.js"><link rel="prefetch" href="/assets/js/59.8074fc81.js"><link rel="prefetch" href="/assets/js/6.cdc6003c.js"><link rel="prefetch" href="/assets/js/60.1886e5a2.js"><link rel="prefetch" href="/assets/js/61.8cdce743.js"><link rel="prefetch" href="/assets/js/62.ccfad9c2.js"><link rel="prefetch" href="/assets/js/63.16b1771b.js"><link rel="prefetch" href="/assets/js/64.ab84024e.js"><link rel="prefetch" href="/assets/js/65.5d7c3b7a.js"><link rel="prefetch" href="/assets/js/66.d8591a18.js"><link rel="prefetch" href="/assets/js/67.73456f7e.js"><link rel="prefetch" href="/assets/js/68.f481f8f3.js"><link rel="prefetch" href="/assets/js/69.96f25530.js"><link rel="prefetch" href="/assets/js/7.46997b0a.js"><link rel="prefetch" href="/assets/js/70.0ab0d1fd.js"><link rel="prefetch" href="/assets/js/71.dd8facc4.js"><link rel="prefetch" href="/assets/js/72.ef52962d.js"><link rel="prefetch" href="/assets/js/73.0e844bfe.js"><link rel="prefetch" href="/assets/js/74.a3f222d9.js"><link rel="prefetch" href="/assets/js/75.cbbf1e57.js"><link rel="prefetch" href="/assets/js/76.79bfac66.js"><link rel="prefetch" href="/assets/js/77.536742b4.js"><link rel="prefetch" href="/assets/js/78.44d6cb00.js"><link rel="prefetch" href="/assets/js/79.2dc3f78e.js"><link rel="prefetch" href="/assets/js/8.2825b7c8.js"><link rel="prefetch" href="/assets/js/80.30f2b7e8.js"><link rel="prefetch" href="/assets/js/81.ce007e74.js"><link rel="prefetch" href="/assets/js/82.7f8e37af.js"><link rel="prefetch" href="/assets/js/83.201b9f31.js"><link rel="prefetch" href="/assets/js/84.8e750285.js"><link rel="prefetch" href="/assets/js/85.b564c207.js"><link rel="prefetch" href="/assets/js/86.85da9ef3.js"><link rel="prefetch" href="/assets/js/87.61865fb9.js"><link rel="prefetch" href="/assets/js/88.2c3e8d72.js"><link rel="prefetch" href="/assets/js/89.2b99140f.js"><link rel="prefetch" href="/assets/js/9.2a76fd8c.js"><link rel="prefetch" href="/assets/js/90.6ede089c.js"><link rel="prefetch" href="/assets/js/92.503a04a8.js"><link rel="prefetch" href="/assets/js/93.668a1616.js"><link rel="prefetch" href="/assets/js/94.78890e02.js"><link rel="prefetch" href="/assets/js/95.4eafa307.js"><link rel="prefetch" href="/assets/js/96.8be342d2.js"><link rel="prefetch" href="/assets/js/97.cff73008.js"><link rel="prefetch" href="/assets/js/98.2d7c9205.js"><link rel="prefetch" href="/assets/js/99.4e9998dc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6d3e66e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.png" alt=" " class="logo"> <span class="site-name can-hide"> </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SpringCloud</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/springcloud/SpringCloud文档.html" class="sidebar-link">Spring Cloud文档</a></li><li><a href="/springcloud/SpringCloud构建.html" class="sidebar-link">Spring Cloud构建</a></li><li><a href="/springcloud/springcloudcommons.html" class="sidebar-link">云原生应用</a></li><li><a href="/springcloud/SpringCloudFunction.html" class="sidebar-link">Spring Cloud Function参考文档</a></li><li><a href="/springcloud/SpringCloudStream.html" class="sidebar-link">Spring Cloud Stream参考文档</a></li><li><a href="/springcloud/SpringCloudAWS.html" class="sidebar-link">Spring Cloud AWS</a></li><li><a href="/springcloud/SpringCloudBus.html" class="sidebar-link">Spring Cloud Bus</a></li><li><a href="/springcloud/SpringCloudTask.html" class="sidebar-link">Spring Cloud Task参考指南</a></li><li><a href="/springcloud/SpringCloudConfig.html" class="active sidebar-link">Spring Cloud Config</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#快速开始" class="sidebar-link">快速开始</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#客户端使用" class="sidebar-link">客户端使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#spring-cloud-config服务器" class="sidebar-link">Spring Cloud Config服务器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#环境资料库" class="sidebar-link">环境资料库</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#健康指标" class="sidebar-link">健康指标</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#安全" class="sidebar-link">安全</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#加密与解密" class="sidebar-link">加密与解密</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#密钥管理" class="sidebar-link">密钥管理</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#创建密钥库进行测试" class="sidebar-link">创建密钥库进行测试</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#使用多个按键和按键旋转" class="sidebar-link">使用多个按键和按键旋转</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#提供加密的属性" class="sidebar-link">提供加密的属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#服务替代格式" class="sidebar-link">服务替代格式</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#提供纯文本" class="sidebar-link">提供纯文本</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#git，svn和本机后端" class="sidebar-link">Git，SVN和本机后端</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#aws-s3" class="sidebar-link">AWS S3</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#解密纯文本" class="sidebar-link">解密纯文本</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#嵌入配置服务器" class="sidebar-link">嵌入配置服务器</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#推送通知和spring-cloud-bus" class="sidebar-link">推送通知和Spring Cloud Bus</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#spring-cloud-config客户端" class="sidebar-link">Spring Cloud Config客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#配置第一个引导程序" class="sidebar-link">配置第一个引导程序</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#发现第一引导" class="sidebar-link">发现第一引导</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#快速配置客户端失败" class="sidebar-link">快速配置客户端失败</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#配置客户端重试" class="sidebar-link">配置客户端重试</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#查找远程配置资源" class="sidebar-link">查找远程配置资源</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#为配置服务器指定多个url" class="sidebar-link">为配置服务器指定多个URL</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#配置超时" class="sidebar-link">配置超时</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#安全-2" class="sidebar-link">安全</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudConfig.html#保险柜中的嵌套键" class="sidebar-link">保险柜中的嵌套键</a></li></ul></li></ul></li><li><a href="/springcloud/SpringCloudNetflix.html" class="sidebar-link">/springcloud/SpringCloudNetflix.html</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-cloud-config"><a href="#spring-cloud-config" class="header-anchor">#</a> Spring Cloud Config</h1> <p><strong>2.2.1。发布</strong></p> <p>Spring Cloud Config为分布式系统中的外部化配置提供服务器端和客户端支持。使用Config Server，您可以在中心位置管理所有环境中应用程序的外部属性。客户端和服务器上的概念与Spring <code>Environment</code>和<code>PropertySource</code>抽象，因此它们非常适合Spring应用程序，但可以与以任何语言运行的任何应用程序一起使用。在应用程序从开发人员到测试人员再到生产人员的整个部署过程中，您可以管理这些环境之间的配置，并确保应用程序具有它们迁移时所需的一切。服务器存储后端的默认实现使用git，因此它轻松支持带标签的配置环境版本，并且可以通过各种工具来访问这些内容来管理内容。添加替代实现并将其插入Spring配置很容易。</p> <h2 id="快速开始"><a href="#快速开始" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_quick_start" target="_blank" rel="noopener noreferrer">快速开始<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>该快速入门介绍了如何同时使用Spring Cloud Config Server的服务器和客户端。</p> <p>首先，启动服务器，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>$ cd spring-cloud-config-server
$ ../mvnw spring-boot：run
</code></pre></div><p>该服务器是Spring Boot应用程序，因此如果愿意，可以从IDE运行它（主类是<code>ConfigServerApplication</code>）。</p> <p>接下来尝试一个客户端，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl localhost:8888/foo/development
{&quot;name&quot;:&quot;foo&quot;,&quot;label&quot;:&quot;master&quot;,&quot;propertySources&quot;:[
  {&quot;name&quot;:&quot;https://github.com/scratches/config-repo/foo-development.properties&quot;,&quot;source&quot;:{&quot;bar&quot;:&quot;spam&quot;}},
  {&quot;name&quot;:&quot;https://github.com/scratches/config-repo/foo.properties&quot;,&quot;source&quot;:{&quot;foo&quot;:&quot;bar&quot;}}
]}
</code></pre></div><p>定位属性源的默认策略是克隆git存储库（位于<code>spring.cloud.config.server.git.uri</code>）并使用它初始化mini <code>SpringApplication</code>。迷你应用程序<code>Environment</code>用于枚举属性源并将其发布在JSON端点上。</p> <p>HTTP服务具有以下形式的资源：</p> <div class="language- extra-class"><pre class="language-text"><code>/ {application} / {profile} [/ {label}]
/{application}-{profile}.yml
/{label}/{application}-{profile}.yml
/{application}-{profile}.properties
/{label}/{application}-{profile}.properties
</code></pre></div><p>其中<code>application</code>注入作为<code>spring.config.name</code>在<code>SpringApplication</code>（什么是通常<code>application</code>以规则的弹簧引导应用程序），<code>profile</code>是一个有效简表（或逗号分隔的属性列表），并且<code>label</code>是一个可选的git标签（默认为<code>master</code>）。</p> <p>Spring Cloud Config Server从各种来源提取远程客户端的配置。以下示例从git存储库（必须提供）中获取配置，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>samples/config<span class="token punctuation">-</span>repo
</code></pre></div><p>其他来源包括任何与JDBC兼容的数据库，Subversion，Hashicorp Vault，Credhub和本地文件系统。</p> <h3 id="客户端使用"><a href="#客户端使用" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_client_side_usage" target="_blank" rel="noopener noreferrer">客户端使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>要在应用程序中使用这些功能，您可以将其构建为依赖于spring-cloud-config-client的Spring Boot应用程序（例如，请参阅config-client或示例应用程序的测试用例）。添加依赖项最方便的方法是使用Spring Boot启动器<code>org.springframework.cloud:spring-cloud-starter-config</code>。<code>spring-cloud-starter-parent</code>对于Maven用户，还有一个父pom和BOM（），对于Gradle和Spring CLI用户，还有一个Spring IO版本管理属性文件。以下示例显示了典型的Maven配置：</p> <p>pom.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>{spring-boot-docs-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span> <span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>{spring-cloud-version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

   <span class="token comment">&lt;!-- repositories also needed for snapshots and milestones --&gt;</span>
</code></pre></div><p>现在，您可以创建一个标准的Spring Boot应用程序，例如以下HTTP服务器：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>当此HTTP服务器运行时，它将从端口8888上的默认本地配置服务器（如果正在运行）中拾取外部配置。要修改启动行为，可以使用以下命令更改配置服务器的位置<code>bootstrap.properties</code>（类似于，<code>application.properties</code>但对于应用程序上下文的引导阶段），如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.config.uri：http：//myconfigserver.com
</code></pre></div><p>默认情况下，如果未设置应用程序名称，<code>application</code>将使用。要修改名称，可以将以下属性添加到<code>bootstrap.properties</code>文件中：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.application.name：myapp
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>设置属性时，<code>${spring.application.name}</code>请勿在您的应用名称前加上保留字，<code>application-</code>以防止解析正确的属性源时出现问题。</p></div> <p>引导程序属性在<code>/env</code>端点中显示为高优先级属性源，如以下示例所示。</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl localhost:8080/env
{
  &quot;profiles&quot;:[],
  &quot;configService:https://github.com/spring-cloud-samples/config-repo/bar.properties&quot;:{&quot;foo&quot;:&quot;bar&quot;},
  &quot;servletContextInitParams&quot;:{},
  &quot;systemProperties&quot;:{...},
  ...
}
</code></pre></div><p>名为的属性源```configService:/<code>包含</code>foo<code>值为</code>bar`且具有最高优先级的属性。</p> <table><thead><tr><th></th> <th>属性源名称中的URL是git存储库，而不是配置服务器URL。</th></tr></thead> <tbody><tr><td></td> <td></td></tr></tbody></table> <h2 id="spring-cloud-config服务器"><a href="#spring-cloud-config服务器" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_spring_cloud_config_server" target="_blank" rel="noopener noreferrer">Spring Cloud Config服务器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>Spring Cloud Config Server为外部配置（名称-值对或等效的YAML内容）提供了一个基于HTTP资源的API。通过使用<code>@EnableConfigServer</code>注释，服务器可嵌入到Spring Boot应用程序中。因此，以下应用程序是配置服务器：</p> <p>ConfigServer.java</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableConfigServer</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigServer</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ConfigServer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>像所有Spring Boot应用程序一样，它默认在端口8080上运行，但是您可以通过各种方式将其切换到更传统的端口8888。最简单的方法是（通过Config Server jar中<code>spring.config.name=configserver</code>有一个）启动它，从而设置默认配置存储库<code>configserver.yml</code>。另一种是使用您自己的<code>application.properties</code>，如以下示例所示：</p> <p>application.properties</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">server.port</span><span class="token punctuation">:</span> <span class="token attr-value">8888</span>
<span class="token attr-name">spring.cloud.config.server.git.uri</span><span class="token punctuation">:</span> <span class="token attr-value">file://${user.home}/config-repo</span>
</code></pre></div><p>哪里<code>${user.home}/config-repo</code>是一个包含YAML和属性文件的git存储库。</p> <table><thead><tr><th>在Windows上，如果文件URL带有驱动器前缀（例如，<code>file:///${user.home}/config-repo</code>）是绝对的，则在文件URL中需要一个额外的“ /” 。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>以下清单显示了在前面的示例中创建git存储库的方法：<code>$ cd $ HOME $ mkdir config-repo $ cd config-repo $ git初始化。 $ echo info.foo：栏&gt; application.properties $ git add -A。 $ git commit -m“添加application.properties”</code></th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>将本地文件系统用于git存储库仅用于测试。您应该使用服务器在生产环境中托管配置存储库。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>如果仅在其中存储文本文件，则配置存储库的初始克隆可以快速有效。如果存储二进制文件（尤其是大文件），则可能会在首次配置请求时遇到延迟，或者在服务器中遇到内存不足错误。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h3 id="环境资料库"><a href="#环境资料库" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_environment_repository" target="_blank" rel="noopener noreferrer">环境资料库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>您应该在哪里存储配置服务器的配置数据？控制此行为的策略是<code>EnvironmentRepository</code>服务<code>Environment</code>对象。这<code>Environment</code>是Spring的域的浅表副本<code>Environment</code>（包括<code>propertySources</code>作为主要功能）。该<code>Environment</code>资源由三个变量参数化：</p> <ul><li><code>{application}</code>，它映射到<code>spring.application.name</code>客户端。</li> <li><code>{profile}</code>，它映射到<code>spring.profiles.active</code>客户端（逗号分隔列表）上。</li> <li><code>{label}</code>，这是服务器端功能，标记了一组“版本化”的配置文件。</li></ul> <p>仓库实现通常表现得像一个Spring Boot应用程序，从<code>spring.config.name</code>等于<code>{application}</code>参数且<code>spring.profiles.active</code>等于参数的位置加载配置文件<code>{profiles}</code>。配置文件的优先级规则也与常规Spring Boot应用程序中的规则相同：活动配置文件优先于默认配置，如果有多个配置文件，则最后一个优先（类似于向中添加条目<code>Map</code>）。</p> <p>以下示例客户端应用程序具有此引导程序配置：</p> <p>bootstrap.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> foo
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev<span class="token punctuation">,</span>mysql
</code></pre></div><p>（与Spring Boot应用程序一样，这些属性也可以由环境变量或命令行参数设置）。</p> <p>如果存储库是基于文件的，服务器的创建 <code>Environment</code>从<code>application.yml</code>（所有客户端之间共享）和 <code>foo.yml</code>（与<code>foo.yml</code>采取优先次序）。如果YAML文件中包含指向Spring概要文件的文档，则会以更高的优先级应用这些文件（按列出的概要文件的顺序）。如果存在特定于配置文件的YAML（或属性）文件，这些文件也将以比默认文件更高的优先级应用。较高的优先级将转换为<code>PropertySource</code>早些时候上市<code>Environment</code>。（这些规则适用于独立的Spring Boot应用程序。）</p> <p>您可以将spring.cloud.config.server.accept-empty设置为false，以便在未找到应用程序的情况下Server返回HTTP 404状态。默认情况下，此标志设置为true。</p> <h4 id="git后端"><a href="#git后端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_git_backend" target="_blank" rel="noopener noreferrer">Git后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>的默认实现<code>EnvironmentRepository</code>使用Git后端，这对于管理升级和物理环境以及审核更改非常方便。要更改存储库的位置，可以<code>spring.cloud.config.server.git.uri</code>在Config Server中设置配置属性（例如，在中<code>application.yml</code>）。如果您使用<code>file:</code>前缀，它应该在本地存储库中运行，以便无需服务器即可快速轻松地开始使用。但是，在那种情况下，服务器直接在本地存储库上运行而无需克隆它（如果它不是裸露的，这并不重要，因为Config Server从不对“远程”存储库进行更改）。要扩展Config Server并使其高度可用，您需要使服务器的所有实例都指向同一存储库，因此仅共享文件系统可以工作。即使在那种情况下，最好对<code>ssh:</code>共享文件系统存储库使用该协议，以便服务器可以克隆该协议并将本地工作副本用作高速缓存。</p> <p>此存储库实现将<code>{label}</code>HTTP资源的参数映射到git标签（提交ID，分支名称或标记）。如果git分支或标记名称包含斜杠（<code>/</code>），则应使用特殊字符串在HTTP URL中指定标签<code>(_)</code>（以避免与其他URL路径产生歧义）。例如，如果标签为<code>foo/bar</code>，则替换斜杠将产生以下标签：<code>foo(_)bar</code>。特殊字符串的包含<code>(_)</code>也可以应用于<code>{application}</code>参数。如果您使用curl之类的命令行客户端，请注意URL中的括号-您应使用单引号（''）将其从外壳中移出。</p> <h5 id="跳过ssl证书验证"><a href="#跳过ssl证书验证" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_skipping_ssl_certificate_validation" target="_blank" rel="noopener noreferrer">跳过SSL证书验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>可以通过将该<code>git.skipSslValidation</code>属性设置为<code>true</code>（默认值为<code>false</code>）来禁用配置服务器对Git服务器的SSL证书的验证。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.com/my/repo
          <span class="token key atrule">skipSslValidation</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h5 id="设置http连接超时"><a href="#设置http连接超时" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_setting_http_connection_timeout" target="_blank" rel="noopener noreferrer">设置HTTP连接超时<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>您可以配置配置服务器将等待获取HTTP连接的时间（以秒为单位）。使用该<code>git.timeout</code>属性。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.com/my/repo
          <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">4</span>
</code></pre></div><h5 id="git-uri中的占位符"><a href="#git-uri中的占位符" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_placeholders_in_git_uri" target="_blank" rel="noopener noreferrer">Git URI中的占位符<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>春天的云配置Server支持的占位符一个Git仓库URL <code>{application}</code>和<code>{profile}</code>（和<code>{label}</code>如果你需要它，但请记住，标签作为一个git标签反正适用）。因此，您可以通过使用类似于以下内容的结构来支持“每个应用程序一个存储库”策略：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/myorg/<span class="token punctuation">{</span>application<span class="token punctuation">}</span>
</code></pre></div><p>您也可以使用类似的模式来支持“每个配置文件一个存储库”策略 <code>{profile}</code>。</p> <p>此外，在<code>{application}</code>参数中使用特殊字符串“（_）” 可以启用对多个组织的支持，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/<span class="token punctuation">{</span>application<span class="token punctuation">}</span>
</code></pre></div><p>其中<code>{application}</code>被设置在请求时以下面的格式：<code>organization(_)application</code>。</p> <h5 id="模式匹配和多个存储库"><a href="#模式匹配和多个存储库" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_pattern_matching_and_multiple_repositories" target="_blank" rel="noopener noreferrer">模式匹配和多个存储库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>Spring Cloud Config还通过在应用程序和配置文件名称上进行模式匹配来支持更复杂的需求。模式格式是用逗号分隔的<code>{application}/{profile}</code>带通配符名称列表（请注意，以通配符开头的模式可能需要加引号），如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>samples/config<span class="token punctuation">-</span>repo
          <span class="token key atrule">repos</span><span class="token punctuation">:</span>
            <span class="token key atrule">simple</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/simple/config<span class="token punctuation">-</span>repo
            <span class="token key atrule">special</span><span class="token punctuation">:</span>
              <span class="token key atrule">pattern</span><span class="token punctuation">:</span> special*/dev*<span class="token punctuation">,</span><span class="token important">*special</span>*/dev*
              <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/special/config<span class="token punctuation">-</span>repo
            <span class="token key atrule">local</span><span class="token punctuation">:</span>
              <span class="token key atrule">pattern</span><span class="token punctuation">:</span> local*
              <span class="token key atrule">uri</span><span class="token punctuation">:</span> file<span class="token punctuation">:</span>/home/configsvc/config<span class="token punctuation">-</span>repo
</code></pre></div><p>如果<code>{application}/{profile}</code>与任何模式都不匹配，则使用在下定义的默认URI <code>spring.cloud.config.server.git.uri</code>。在上面的示例中，对于“简单”存储库，模式为<code>simple/*</code>（它仅匹配<code>simple</code>在所有概要文件中命名的一个应用程序）。“本地”存储库匹配所有<code>local</code>以所有概要文件开头的应用程序名称（<code>/*</code>后缀会自动添加到没有概要文件匹配器的任何模式中）。</p> <table><thead><tr><th></th></tr></thead> <tbody><tr><td>仅当要设置的唯一属性是URI时，才能使用“简单”示例中使用的“单线”快捷方式。如果您需要设置其他任何内容（凭证，模式等），则需要使用完整表格。</td></tr></tbody></table> <p>的<code>pattern</code>在回购属性实际上是一个数组，所以可以使用一个YAML阵列（或<code>[0]</code>，<code>[1]</code>在属性文件等后缀）绑定到多个图案。如果要运行具有多个配置文件的应用程序，则可能需要这样做，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>samples/config<span class="token punctuation">-</span>repo
          <span class="token key atrule">repos</span><span class="token punctuation">:</span>
            <span class="token key atrule">development</span><span class="token punctuation">:</span>
              <span class="token key atrule">pattern</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">'*/development'</span>
                <span class="token punctuation">-</span> <span class="token string">'*/staging'</span>
              <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/development/config<span class="token punctuation">-</span>repo
            <span class="token key atrule">staging</span><span class="token punctuation">:</span>
              <span class="token key atrule">pattern</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> <span class="token string">'*/qa'</span>
                <span class="token punctuation">-</span> <span class="token string">'*/production'</span>
              <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/staging/config<span class="token punctuation">-</span>repo
</code></pre></div><table><thead><tr><th></th></tr></thead> <tbody><tr><td>Spring Cloud猜测包含不以结尾结尾的配置文件的模式<code>*</code>意味着您实际上要匹配以该模式开头的配置文件列表（因此<code>*/staging</code>是的快捷方式<code>[&quot;*/staging&quot;, &quot;*/staging,*&quot;]</code>，依此类推）。例如，这很普遍，例如，您需要在本地的“开发”配置文件中运行应用程序，而又需要在远程的“云”配置文件中运行应用程序。</td></tr></tbody></table> <p>每个存储库还可以选择将配置文件存储在子目录中，用于搜索这些目录的模式可以指定为<code>searchPaths</code>。以下示例在顶层显示了一个配置文件：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>samples/config<span class="token punctuation">-</span>repo
          <span class="token key atrule">searchPaths</span><span class="token punctuation">:</span> foo<span class="token punctuation">,</span>bar*
</code></pre></div><p>在前面的示例中，服务器在顶层，<code>foo/</code>子目录以及名称以开头的任何子目录中搜索配置文件<code>bar</code>。</p> <p>默认情况下，服务器在首次请求配置时克隆远程存储库。可以将服务器配置为在启动时克隆存储库，如以下顶级示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//git/common/config<span class="token punctuation">-</span>repo.git
          <span class="token key atrule">repos</span><span class="token punctuation">:</span>
            <span class="token key atrule">team-a</span><span class="token punctuation">:</span>
                <span class="token key atrule">pattern</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>a<span class="token punctuation">-</span>*
                <span class="token key atrule">cloneOnStart</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
                <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//git/team<span class="token punctuation">-</span>a/config<span class="token punctuation">-</span>repo.git
            <span class="token key atrule">team-b</span><span class="token punctuation">:</span>
                <span class="token key atrule">pattern</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>b<span class="token punctuation">-</span>*
                <span class="token key atrule">cloneOnStart</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
                <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//git/team<span class="token punctuation">-</span>b/config<span class="token punctuation">-</span>repo.git
            <span class="token key atrule">team-c</span><span class="token punctuation">:</span>
                <span class="token key atrule">pattern</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>c<span class="token punctuation">-</span>*
                <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//git/team<span class="token punctuation">-</span>a/config<span class="token punctuation">-</span>repo.git
</code></pre></div><p>在前面的示例中，服务器在接受任何请求之前会在启动时克隆team-a的config-repo。在请求从存储库进行配置之前，不会克隆所有其他存储库。</p> <table><thead><tr><th></th></tr></thead> <tbody><tr><td>设置要在Config Server启动时克隆的存储库可以帮助在Config Server启动时快速识别配置错误的配置源（例如无效的存储库URI）。如果<code>cloneOnStart</code>未启用配置源，则Config Server可能会以配置错误或无效的配置源成功启动，并且直到应用程序从该配置源请求配置时才检测到错误。</td></tr></tbody></table> <h5 id="认证方式"><a href="#认证方式" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_authentication" target="_blank" rel="noopener noreferrer">认证方式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>要在远程存储库上使用HTTP基本认证，请分别添加<code>username</code>和<code>password</code>属性（不在URL中），如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>samples/config<span class="token punctuation">-</span>repo
          <span class="token key atrule">username</span><span class="token punctuation">:</span> trolley
          <span class="token key atrule">password</span><span class="token punctuation">:</span> strongpassword
</code></pre></div><p>如果您不使用HTTPS和用户凭据，则在将密钥存储在默认目录（<code>~/.ssh</code>）中且URI指向SSH位置（例如）时，SSH也应立即可用<code>git@github.com:configuration/cloud-configuration</code>。重要的是，<code>~/.ssh/known_hosts</code>文件中应包含Git服务器的条目，并采用<code>ssh-rsa</code>格式。<code>ecdsa-sha2-nistp256</code>不支持其他格式（例如）。为避免意外，您应该确保<code>known_hosts</code>Git服务器的文件中仅存在一个条目，并且该条目与您提供给配置服务器的URL匹配。如果在URL中使用主机名，则要在<code>known_hosts</code>文件中完全包含该主机名（而不是IP）。使用JGit访问存储库，因此您找到的任何文档都应该适用。可以在以下位置设置HTTPS代理设置<code>~/.git/config</code>或（与其他任何JVM进程相同）具有系统属性（<code>-Dhttps.proxyHost</code>和<code>-Dhttps.proxyPort</code>）。</p> <table><thead><tr><th></th></tr></thead> <tbody><tr><td>如果您不知道<code>~/.git</code>目录在哪里，请使用<code>git config --global</code>来操纵设置（例如<code>git config --global http.sslVerify false</code>）。</td></tr></tbody></table> <h5 id="使用aws-codecommit进行身份验证"><a href="#使用aws-codecommit进行身份验证" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_authentication_with_aws_codecommit" target="_blank" rel="noopener noreferrer">使用AWS CodeCommit进行身份验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>Spring Cloud Config Server还支持<a href="https://docs.aws.amazon.com/codecommit/latest/userguide/welcome.html" target="_blank" rel="noopener noreferrer">AWS CodeCommit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>身份验证。从命令行使用Git时，AWS CodeCommit使用身份验证帮助程序。该帮助程序未与JGit库一起使用，因此，如果Git URI与AWS CodeCommit模式匹配，则会为AWS CodeCommit创建一个JGit CredentialProvider。AWS CodeCommit URI遵循以下模式：//git-codecommit.${AWS_REGION}.amazonaws.com/${repopath}。</p> <p>如果您提供带有AWS CodeCommit URI的用户名和密码，则它们必须是提供对存储库访问权限的<a href="https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html" target="_blank" rel="noopener noreferrer">AWS accessKeyId和secretAccessKey<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果您未指定用户名和密码，则使用<a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html" target="_blank" rel="noopener noreferrer">AWS Default Credential Provider链<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>检索accessKeyId和secretAccessKey 。</p> <p>如果您的Git URI与CodeCommit URI模式（如前所示）匹配，则必须在用户名和密码或默认凭据提供商链支持的位置之一中提供有效的AWS凭据。AWS EC2实例可以将<a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html" target="_blank" rel="noopener noreferrer">IAM角色用于EC2实例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <table><thead><tr><th></th></tr></thead> <tbody><tr><td>该<code>aws-java-sdk-core</code>罐是一个可选的依赖。如果<code>aws-java-sdk-core</code>jar不在您的类路径中，则无论git服务器URI如何，都不会创建AWS Code Commit凭证提供程序。</td></tr></tbody></table> <h5 id="使用google-cloud-source进行身份验证"><a href="#使用google-cloud-source进行身份验证" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_authentication_with_google_cloud_source" target="_blank" rel="noopener noreferrer">使用Google Cloud Source进行身份验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>Spring Cloud Config Server还支持针对<a href="https://cloud.google.com/source-repositories/" target="_blank" rel="noopener noreferrer">Google Cloud Source<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>存储库进行身份验证。</p> <p>如果您的Git URI使用<code>http</code>或<code>https</code>协议，域名是<code>source.developers.google.com</code>，则将使用Google Cloud Source凭据提供程序。Google Cloud Source资源库URI的格式为<code>https://source.developers.google.com/p/${GCP_PROJECT}/r/${REPO}</code>。要获取您存储库的URI，请在Google Cloud Source UI中单击“克隆”，然后选择“手动生成的凭据”。不生成任何凭证，只需复制显示的URI。</p> <p>Google Cloud Source凭据提供商将使用Google Cloud Platform应用程序默认凭据。有关如何为系统创建应用程序默认凭据的信息，请参阅<a href="https://cloud.google.com/sdk/gcloud/reference/auth/application-default/login" target="_blank" rel="noopener noreferrer">Google Cloud SDK文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。这种方法适用于开发环境中的用户帐户和生产环境中的服务帐户。</p> <table><thead><tr><th></th></tr></thead> <tbody><tr><td><code>com.google.auth:google-auth-library-oauth2-http</code>是可选的依赖项。如果<code>google-auth-library-oauth2-http</code>jar不在您的类路径中，则无论git服务器URI如何，都不会创建Google Cloud Source凭据提供程序。</td></tr></tbody></table> <h5 id="使用属性进行git-ssh配置"><a href="#使用属性进行git-ssh配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_git_ssh_configuration_using_properties" target="_blank" rel="noopener noreferrer">使用属性进行Git SSH配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>默认情况下，当使用SSH URI连接到Git存储库时，Spring Cloud Config Server使用的JGit库使用SSH配置文件，例如<code>~/.ssh/known_hosts</code>和<code>/etc/ssh/ssh_config</code>。在Cloud Foundry之类的云环境中，本地文件系统可能是临时的，或者不容易访问。在这种情况下，可以使用Java属性设置SSH配置。为了激活基于属性的SSH配置，<code>spring.cloud.config.server.git.ignoreLocalSshSettings</code>必须将属性设置为<code>true</code>，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>  <span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server</span><span class="token punctuation">:</span>
          <span class="token key atrule">git</span><span class="token punctuation">:</span>
            <span class="token key atrule">uri</span><span class="token punctuation">:</span> git@gitserver.com<span class="token punctuation">:</span>team/repo1.git
            <span class="token key atrule">ignoreLocalSshSettings</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">hostKey</span><span class="token punctuation">:</span> someHostKey
            <span class="token key atrule">hostKeyAlgorithm</span><span class="token punctuation">:</span> ssh<span class="token punctuation">-</span>rsa
            <span class="token key atrule">privateKey</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
                         -----BEGIN RSA PRIVATE KEY-----
                         MIIEpgIBAAKCAQEAx4UbaDzY5xjW6hc9jwN0mX33XpTDVW9WqHp5AKaRbtAC3DqX
                         IXFMPgw3K45jxRb93f8tv9vL3rD9CUG1Gv4FM+o7ds7FRES5RTjv2RT/JVNJCoqF
                         ol8+ngLqRZCyBtQN7zYByWMRirPGoDUqdPYrj2yq+ObBBNhg5N+hOwKjjpzdj2Ud
                         1l7R+wxIqmJo1IYyy16xS8WsjyQuyC0lL456qkd5BDZ0Ag8j2X9H9D5220Ln7s9i
                         oezTipXipS7p7Jekf3Ywx6abJwOmB0rX79dV4qiNcGgzATnG1PkXxqt76VhcGa0W
                         DDVHEEYGbSQ6hIGSh0I7BQun0aLRZojfE3gqHQIDAQABAoIBAQCZmGrk8BK6tXCd
                         fY6yTiKxFzwb38IQP0ojIUWNrq0+9Xt+NsypviLHkXfXXCKKU4zUHeIGVRq5MN9b
                         BO56/RrcQHHOoJdUWuOV2qMqJvPUtC0CpGkD+valhfD75MxoXU7s3FK7yjxy3rsG
                         EmfA6tHV8/4a5umo5TqSd2YTm5B19AhRqiuUVI1wTB41DjULUGiMYrnYrhzQlVvj
                         5MjnKTlYu3V8PoYDfv1GmxPPh6vlpafXEeEYN8VB97e5x3DGHjZ5UrurAmTLTdO8
                         +AahyoKsIY612TkkQthJlt7FJAwnCGMgY6podzzvzICLFmmTXYiZ/28I4BX/mOSe
                         pZVnfRixAoGBAO6Uiwt40/PKs53mCEWngslSCsh9oGAaLTf/XdvMns5VmuyyAyKG
                         ti8Ol5wqBMi4GIUzjbgUvSUt+IowIrG3f5tN85wpjQ1UGVcpTnl5Qo9xaS1PFScQ
                         xrtWZ9eNj2TsIAMp/svJsyGG3OibxfnuAIpSXNQiJPwRlW3irzpGgVx/AoGBANYW
                         dnhshUcEHMJi3aXwR12OTDnaLoanVGLwLnkqLSYUZA7ZegpKq90UAuBdcEfgdpyi
                         PhKpeaeIiAaNnFo8m9aoTKr+7I6/uMTlwrVnfrsVTZv3orxjwQV20YIBCVRKD1uX
                         VhE0ozPZxwwKSPAFocpyWpGHGreGF1AIYBE9UBtjAoGBAI8bfPgJpyFyMiGBjO6z
                         FwlJc/xlFqDusrcHL7abW5qq0L4v3R+FrJw3ZYufzLTVcKfdj6GelwJJO+8wBm+R
                         gTKYJItEhT48duLIfTDyIpHGVm9+I1MGhh5zKuCqIhxIYr9jHloBB7kRm0rPvYY4
                         VAykcNgyDvtAVODP+4m6JvhjAoGBALbtTqErKN47V0+JJpapLnF0KxGrqeGIjIRV
                         cYA6V4WYGr7NeIfesecfOC356PyhgPfpcVyEztwlvwTKb3RzIT1TZN8fH4YBr6Ee
                         KTbTjefRFhVUjQqnucAvfGi29f+9oE3Ei9f7wA+H35ocF6JvTYUsHNMIO/3gZ38N
                         CPjyCMa9AoGBAMhsITNe3QcbsXAbdUR00dDsIFVROzyFJ2m40i4KCRM35bC/BIBs
                         q0TY3we+ERB40U8Z2BvU61QuwaunJ2+uGadHo58VSVdggqAo0BSkH58innKKt96J
                         69pcVH/4rmLbXdcmNYGm6iu+MlPQk4BUZknHSmVHIFdJ0EPupVaQ8RHT
                         -----END RSA PRIVATE KEY-----</span>
</code></pre></div><p>下表描述了SSH配置属性。</p> <table><thead><tr><th style="text-align:left;">物业名称</th> <th style="text-align:left;">备注</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>ignoreLocalSshSettings</strong></td> <td style="text-align:left;">如果为<code>true</code>，请使用基于属性而不是基于文件的SSH配置。必须设置为<code>spring.cloud.config.server.git.ignoreLocalSshSettings</code>，<strong>而不是</strong>在存储库定义中。</td></tr> <tr><td style="text-align:left;"><strong>私钥</strong></td> <td style="text-align:left;">有效的SSH私钥。如果<code>ignoreLocalSshSettings</code>为true并且Git URI为SSH格式，则必须设置。</td></tr> <tr><td style="text-align:left;"><strong>hostKey</strong></td> <td style="text-align:left;">有效的SSH主机密钥。如果<code>hostKeyAlgorithm</code>还设置，则必须设置。</td></tr> <tr><td style="text-align:left;"><strong>hostKeyAlgorithm</strong></td> <td style="text-align:left;">之一<code>ssh-dss, ssh-rsa, ecdsa-sha2-nistp256, ecdsa-sha2-nistp384, or ecdsa-sha2-nistp521</code>。如果<code>hostKey</code>还设置，则必须设置。</td></tr> <tr><td style="text-align:left;"><strong>strictHostKeyChecking</strong></td> <td style="text-align:left;"><code>true</code>或<code>false</code>。如果为false，请忽略主机密钥错误。</td></tr> <tr><td style="text-align:left;"><strong>knownHostsFile</strong></td> <td style="text-align:left;">自定义<code>.known_hosts</code>文件的位置。</td></tr> <tr><td style="text-align:left;"><strong>preferredAuthentications</strong></td> <td style="text-align:left;">覆盖服务器身份验证方法顺序。如果服务器在此<code>publickey</code>方法之前具有键盘交互身份验证，则应该可以避免登录提示。</td></tr></tbody></table> <h5 id="git搜索路径中的占位符"><a href="#git搜索路径中的占位符" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_placeholders_in_git_search_paths" target="_blank" rel="noopener noreferrer">Git搜索路径中的占位符<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>春季云配置服务器也支持占位符的搜索路径<code>{application}</code>和<code>{profile}</code>（和<code>{label}</code>如果需要的话），如下面的例子：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>samples/config<span class="token punctuation">-</span>repo
          <span class="token key atrule">searchPaths</span><span class="token punctuation">:</span> <span class="token string">'{application}'</span>
</code></pre></div><p>上面的清单导致在存储库中搜索与目录（以及顶层）同名的文件。通配符在带有占位符的搜索路径中也有效（搜索中包括任何匹配的目录）。</p> <h5 id="强制拉入git存储库"><a href="#强制拉入git存储库" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_force_pull_in_git_repositories" target="_blank" rel="noopener noreferrer">强制拉入Git存储库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>如前所述，Spring Cloud Config Server会克隆远程git存储库，以防本地副本变脏（例如，操作系统进程更改了文件夹内容），从而使Spring Cloud Config Server无法从远程存储库更新本地副本。</p> <p>为了解决这个问题，有一个<code>force-pull</code>属性可以使Spring Cloud Config Server在本地副本脏的情况下从远程存储库强制拉出，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>samples/config<span class="token punctuation">-</span>repo
          <span class="token key atrule">force-pull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>如果您具有多个存储库配置，则可<code>force-pull</code>以为每个存储库配置属性，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//git/common/config<span class="token punctuation">-</span>repo.git
          <span class="token key atrule">force-pull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">repos</span><span class="token punctuation">:</span>
            <span class="token key atrule">team-a</span><span class="token punctuation">:</span>
                <span class="token key atrule">pattern</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>a<span class="token punctuation">-</span>*
                <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//git/team<span class="token punctuation">-</span>a/config<span class="token punctuation">-</span>repo.git
                <span class="token key atrule">force-pull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">team-b</span><span class="token punctuation">:</span>
                <span class="token key atrule">pattern</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>b<span class="token punctuation">-</span>*
                <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//git/team<span class="token punctuation">-</span>b/config<span class="token punctuation">-</span>repo.git
                <span class="token key atrule">force-pull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">team-c</span><span class="token punctuation">:</span>
                <span class="token key atrule">pattern</span><span class="token punctuation">:</span> team<span class="token punctuation">-</span>c<span class="token punctuation">-</span>*
                <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//git/team<span class="token punctuation">-</span>a/config<span class="token punctuation">-</span>repo.git
</code></pre></div><table><thead><tr><th></th></tr></thead> <tbody><tr><td><code>force-pull</code>属性 的默认值为<code>false</code>。</td></tr></tbody></table> <h5 id="删除git存储库中未跟踪的分支"><a href="#删除git存储库中未跟踪的分支" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_deleting_untracked_branches_in_git_repositories" target="_blank" rel="noopener noreferrer">删除Git存储库中未跟踪的分支<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>由于Spring Cloud Config Server在将分支签出到本地存储库后（例如，通过标签获取属性）之后具有远程git存储库的克隆，因此它将永久保留该分支，直到下一个服务器重启（这将创建新的本地存储库）。因此，可能会删除远程分支，但仍可获取其本地副本。而且，如果Spring Cloud Config Server客户端服务以<code>--spring.cloud.config.label=deletedRemoteBranch,master</code> 该服务开头，它将从<code>deletedRemoteBranch</code>本地分支获取属性，而不是从<code>master</code>。</p> <p>为了使本地存储库分支保持整洁并保持远程状态- <code>deleteUntrackedBranches</code>可以设置属性。它将使Spring Cloud Config Server <strong>强制</strong>从本地存储库中删除未跟踪的分支。例：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>samples/config<span class="token punctuation">-</span>repo
          <span class="token key atrule">deleteUntrackedBranches</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><table><thead><tr><th><code>deleteUntrackedBranches</code>属性 的默认值为<code>false</code>。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h5 id="git刷新率"><a href="#git刷新率" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_git_refresh_rate" target="_blank" rel="noopener noreferrer">Git刷新率<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>您可以使用来控制配置服务器多久从Git后端获取更新的配置数据<code>spring.cloud.config.server.git.refreshRate</code>。以秒为单位指定此属性的值。默认情况下，该值为0，这意味着配置服务器将在每次请求时从Git存储库中获取更新的配置。</p> <h4 id="版本控制后端文件系统使用"><a href="#版本控制后端文件系统使用" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_version_control_backend_filesystem_use" target="_blank" rel="noopener noreferrer">版本控制后端文件系统使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <table><thead><tr><th></th> <th>使用基于VCS的后端（git，svn），文件被检出或克隆到本地文件系统。默认情况下，它们以前缀放置在系统临时目录中<code>config-repo-</code>。例如，在linux上，它可能是<code>/tmp/config-repo-</code>。一些操作系统<a href="https://serverfault.com/questions/377348/when-does-tmp-get-cleared/377349#377349" target="_blank" rel="noopener noreferrer">通常会清除<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>临时目录。这可能导致意外行为，例如缺少属性。为了避免这个问题，更改配置服务器使用设置的目录<code>spring.cloud.config.server.git.basedir</code>或<code>spring.cloud.config.server.svn.basedir</code>到不驻留在系统临时结构的目录。</th></tr></thead> <tbody><tr><td></td> <td></td></tr></tbody></table> <h4 id="文件系统后端"><a href="#文件系统后端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_file_system_backend" target="_blank" rel="noopener noreferrer">文件系统后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Config Server中还有一个“本机”配置文件，该配置文件不使用Git，而是从本地类路径或文件系统（您要使用指向的任何静态URL）加载配置文件<code>spring.cloud.config.server.native.searchLocations</code>。要使用本机配置文件，请使用启动启动配置服务器<code>spring.profiles.active=native</code>。</p> <table><thead><tr><th>切记<code>file:</code>对文件资源使用前缀（默认情况下，没有前缀的通常是类路径）。与任何Spring Boot配置一样，您可以嵌入<code>${}</code>-style环境占位符，但请记住Windows中的绝对路径需要额外的<code>/</code>（例如<code>file:///${user.home}/config-repo</code>）。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>的默认值<code>searchLocations</code>与本地Spring Boot应用程序（即<code>[classpath:/, classpath:/config, file:./, file:./config]</code>）相同。这不会<code>application.properties</code>从服务器向所有客户端公开，因为服务器中存在的所有属性源在发送给客户端之前都会被删除。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>文件系统后端非常适合快速入门和测试。要在生产环境中使用它，您需要确保文件系统可靠并且可以在Config Server的所有实例之间共享。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>搜索位置可以包含占位符<code>{application}</code>，<code>{profile}</code>和<code>{label}</code>。这样，您可以隔离路径中的目录并选择一种对您有意义的策略（例如，每个应用程序的子目录或每个配置文件的子目录）。</p> <p>如果您在搜索位置中不使用占位符，则此存储库还将<code>{label}</code>HTTP资源的参数附加到搜索路径上的后缀，因此将从每个搜索位置<strong>和</strong>与标签同名的子目录（标记的属性在Spring环境中优先）。因此，没有占位符的默认行为与添加以结尾的搜索位置相同<code>/{label}/</code>。例如，<code>file:/tmp/config</code>与相同<code>file:/tmp/config,file:/tmp/config/{label}</code>。可以通过设置禁用此行为<code>spring.cloud.config.server.native.addLabelLocations=false</code>。</p> <h4 id="保管库后端"><a href="#保管库后端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#vault-backend" target="_blank" rel="noopener noreferrer">保管库后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Spring Cloud Config Server还支持将<a href="https://www.vaultproject.io/" target="_blank" rel="noopener noreferrer">Vault<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>作为后端。</p> <p>保险柜是用于安全访问机密的工具。秘密是您要严格控制访问权限的任何内容，例如API密钥，密码，证书和其他敏感信息。保管箱提供了对任何机密的统一界面，同时提供了严格的访问控制并记录了详细的审核日志。</p> <p>有关Vault的更多信息，请参见<a href="https://learn.hashicorp.com/vault/?track=getting-started#getting-started" target="_blank" rel="noopener noreferrer">Vault快速入门指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>要使配置服务器能够使用Vault后端，您可以使用<code>vault</code>配置文件运行配置服务器。例如，在您的配置服务器中<code>application.properties</code>，您可以添加<code>spring.profiles.active=vault</code>。</p> <p>默认情况下，配置服务器假定您的Vault服务器运行在<code>http://127.0.0.1:8200</code>。它还假定backend的名称为<code>secret</code>，密钥为<code>application</code>。所有这些默认值都可以在配置服务器的中配置<code>application.properties</code>。下表描述了可配置的保管库属性：</p> <table><thead><tr><th style="text-align:left;">Name</th> <th style="text-align:left;">Default Value</th></tr></thead> <tbody><tr><td style="text-align:left;">host</td> <td style="text-align:left;">127.0.0.1</td></tr> <tr><td style="text-align:left;">port</td> <td style="text-align:left;">8200</td></tr> <tr><td style="text-align:left;">scheme</td> <td style="text-align:left;">http</td></tr> <tr><td style="text-align:left;">backend</td> <td style="text-align:left;">secret</td></tr> <tr><td style="text-align:left;">defaultKey</td> <td style="text-align:left;">application</td></tr> <tr><td style="text-align:left;">profileSeparator</td> <td style="text-align:left;">,</td></tr> <tr><td style="text-align:left;">kvVersion</td> <td style="text-align:left;">1</td></tr> <tr><td style="text-align:left;">skipSslValidation</td> <td style="text-align:left;">false</td></tr> <tr><td style="text-align:left;">timeout</td> <td style="text-align:left;">5</td></tr> <tr><td style="text-align:left;">namespace</td> <td style="text-align:left;">null</td></tr></tbody></table> <table><thead><tr><th>上表中的所有属性必须<code>spring.cloud.config.server.vault</code>在复合配置的正确Vault部分中添加前缀或放置在其中。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>所有可配置的属性都可以在中找到<code>org.springframework.cloud.config.server.environment.VaultEnvironmentProperties</code>。</p> <p>Vault 0.10.0引入了版本化的键值后端（k / v后端版本2），该后端公开了与早期版本不同的API，它现在需要<code>data/</code>在安装路径和实际上下文路径之间添加一个，并将秘密包装在一个<code>data</code>对象中。设置<code>kvVersion=2</code>将考虑到这一点。</p> <p>（可选）支持Vault Enterprise <code>X-Vault-Namespace</code>标头。要将其发送到保管库，请设置<code>namespace</code>属性。</p> <p>在配置服务器运行的情况下，您可以向服务器发出HTTP请求以从Vault后端检索值。为此，您需要Vault服务器的令牌。</p> <p>首先，将一些数据放入Vault中，如以下示例所示：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ vault kv put secret/application <span class="token assign-left variable">foo</span><span class="token operator">=</span>bar <span class="token assign-left variable">baz</span><span class="token operator">=</span>bam
$ vault kv put secret/myapp <span class="token assign-left variable">foo</span><span class="token operator">=</span>myappsbar
</code></pre></div><p>其次，向配置服务器发出HTTP请求以检索值，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl -X &quot;GET&quot; &quot;http://localhost:8888/myapp/default&quot; -H &quot;X-Config-Token: yourtoken&quot;
</code></pre></div><p>您应该看到类似于以下内容的响应：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;myapp&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;profiles&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token string">&quot;default&quot;</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token property">&quot;label&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span>
   <span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span>
   <span class="token property">&quot;state&quot;</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span>
   <span class="token property">&quot;propertySources&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;vault:myapp&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;source&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token property">&quot;foo&quot;</span><span class="token operator">:</span><span class="token string">&quot;myappsbar&quot;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;vault:application&quot;</span><span class="token punctuation">,</span>
         <span class="token property">&quot;source&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token property">&quot;baz&quot;</span><span class="token operator">:</span><span class="token string">&quot;bam&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;foo&quot;</span><span class="token operator">:</span><span class="token string">&quot;bar&quot;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>客户端提供必要的身份验证以使Config Server与Vault对话的默认方式是设置X-Config-Token标头。但是，您可以通过设置与Spring Cloud Vault相同的配置属性来省略标题并在服务器中配置身份验证。要设置的属性为<code>spring.cloud.config.server.vault.authentication</code>。应该将其设置为支持的身份验证方法之一。您可能还需要设置特定于您使用的身份验证方法的其他属性，方法是使用与记录的属性名称相同的属性名称，<code>spring.cloud.vault</code>但使用<code>spring.cloud.config.server.vault</code>前缀。有关更多详细信息，请参阅《<a href="https://cloud.spring.io/spring-cloud-vault/reference/html/#vault.config.authentication" target="_blank" rel="noopener noreferrer">Spring Cloud Vault参考指南》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <table><thead><tr><th>如果省略X-Config-Token标头并使用服务器属性来设置身份验证，则Config Server应用程序需要对Spring Vault具有附加的依赖关系才能启用附加的身份验证选项。有关如何添加该依赖关系的信息，请参见《<a href="https://docs.spring.io/spring-vault/docs/current/reference/html/#dependencies" target="_blank" rel="noopener noreferrer">Spring Vault参考指南》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h5 id="多个属性来源"><a href="#多个属性来源" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_multiple_properties_sources" target="_blank" rel="noopener noreferrer">多个属性来源<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>使用Vault时，可以为您的应用程序提供多个属性源。例如，假设您已将数据写入Vault中的以下路径：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>secret/myApp,dev
secret/myApp
secret/application,dev
secret/application
</code></pre></div><p><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_vault_server" target="_blank" rel="noopener noreferrer">使用Config Server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>写入的属性<code>secret/application</code>可用于<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_vault_server" target="_blank" rel="noopener noreferrer">所有应用程序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。随着名称的应用程序，<code>myApp</code>，必须写入任何属性<code>secret/myApp</code>，并<code>secret/application</code>提供给它。当<code>myApp</code>有<code>dev</code>启用配置文件，写入到上述所有路径的性能将提供给它，在列表中的优先级比其他的第一路径属性。</p> <h4 id="通过代理访问后端"><a href="#通过代理访问后端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_accessing_backends_through_a_proxy" target="_blank" rel="noopener noreferrer">通过代理访问后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>配置服务器可以通过HTTP或HTTPS代理访问Git或保管库后端。通过<code>proxy.http</code>和下的设置可以控制Git或Vault的此行为<code>proxy.https</code>。这些设置是针对每个存储库的，因此，如果您使用<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#composite-environment-repositories" target="_blank" rel="noopener noreferrer">组合环境存储库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，则必须分别为组合中的每个后端配置代理设置。如果使用的网络需要HTTP和HTTPS URL分别使用代理服务器，则可以为单个后端配置HTTP和HTTPS代理设置。</p> <p>下表描述了HTTP和HTTPS代理的代理配置属性。所有这些属性都必须以<code>proxy.http</code>或作为前缀<code>proxy.https</code>。</p> <table><thead><tr><th style="text-align:left;">物业名称</th> <th style="text-align:left;">备注</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>主办</strong></td> <td style="text-align:left;">代理的主机。</td></tr> <tr><td style="text-align:left;"><strong>港口</strong></td> <td style="text-align:left;">用于访问代理的端口。</td></tr> <tr><td style="text-align:left;"><strong>nonProxyHosts</strong></td> <td style="text-align:left;">配置服务器应在代理外部访问的所有主机。如果同时为<code>proxy.http.nonProxyHosts</code>和提供值，则将使用<code>proxy.https.nonProxyHosts</code>该<code>proxy.http</code>值。</td></tr> <tr><td style="text-align:left;"><strong>用户名</strong></td> <td style="text-align:left;">用来验证代理的用户名。如果同时为<code>proxy.http.username</code>和提供值，则将使用<code>proxy.https.username</code>该<code>proxy.http</code>值。</td></tr> <tr><td style="text-align:left;"><strong>密码</strong></td> <td style="text-align:left;">用来验证代理的密码。如果同时为<code>proxy.http.password</code>和提供值，则将使用<code>proxy.https.password</code>该<code>proxy.http</code>值。</td></tr></tbody></table> <p>以下配置使用HTTPS代理访问Git存储库。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> git
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>samples/config<span class="token punctuation">-</span>repo
          <span class="token key atrule">proxy</span><span class="token punctuation">:</span>
            <span class="token key atrule">https</span><span class="token punctuation">:</span>
              <span class="token key atrule">host</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>proxy.host.io
              <span class="token key atrule">password</span><span class="token punctuation">:</span> myproxypassword
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token string">'3128'</span>
              <span class="token key atrule">username</span><span class="token punctuation">:</span> myproxyusername
              <span class="token key atrule">nonProxyHosts</span><span class="token punctuation">:</span> example.com
</code></pre></div><h4 id="与所有应用程序共享配置"><a href="#与所有应用程序共享配置" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_sharing_configuration_with_all_applications" target="_blank" rel="noopener noreferrer">与所有应用程序共享配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>所有应用程序之间的共享配置根据您采用的方法而异，如以下主题所述：</p> <ul><li><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#spring-cloud-config-server-file-based-repositories" target="_blank" rel="noopener noreferrer">基于文件的存储库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#spring-cloud-config-server-vault-server" target="_blank" rel="noopener noreferrer">保管箱服务器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h5 id="基于文件的存储库"><a href="#基于文件的存储库" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#spring-cloud-config-server-file-based-repositories" target="_blank" rel="noopener noreferrer">基于文件的存储库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>基于文件（GIT，SVN和本地）仓库，并在文件名的资源<code>application*</code>（<code>application.properties</code>，<code>application.yml</code>，<code>application-*.properties</code>，等）的所有客户端应用程序之间共享。您可以使用具有这些文件名的资源来配置全局默认值，并在必要时使它们被应用程序特定的文件覆盖。</p> <p>该<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#property-overrides" target="_blank" rel="noopener noreferrer">属性覆盖<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>功能也可用于设置全局默认值，使用占位符的应用允许在本地覆盖它们。</p> <table><thead><tr><th>使用“本机”配置文件（本地文件系统后端），您应该使用不属于服务器自身配置的显式搜索位置。否则，<code>application*</code>默认搜索位置中的资源将被删除，因为它们是服务器的一部分。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h5 id="保管箱服务器"><a href="#保管箱服务器" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#spring-cloud-config-server-vault-server" target="_blank" rel="noopener noreferrer">保管箱服务器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>使用Vault作为后端时，可以通过将配置放在中来与所有应用程序共享配置<code>secret/application</code>。例如，如果您运行以下Vault命令，则使用配置服务器的所有应用程序都将具有属性<code>foo</code>并<code>baz</code>可供其使用：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>$ vault <span class="token function">write</span> secret/application <span class="token assign-left variable">foo</span><span class="token operator">=</span>bar <span class="token assign-left variable">baz</span><span class="token operator">=</span>bam
</code></pre></div><h4 id="jdbc后端"><a href="#jdbc后端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_jdbc_backend" target="_blank" rel="noopener noreferrer">JDBC后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Spring Cloud Config Server支持JDBC（关系数据库）作为配置属性的后端。您可以通过添加<code>spring-jdbc</code>到类路径并使用<code>jdbc</code>配置文件或通过添加类型的Bean 来启用此功能<code>JdbcEnvironmentRepository</code>。如果您在类路径上包含正确的依赖项（有关更多详细信息，请参见用户指南），Spring Boot会配置数据源。</p> <p>数据库需要有一个表<code>PROPERTIES</code>，该表包含名为<code>APPLICATION</code>，<code>PROFILE</code>和<code>LABEL</code>（具有通常的<code>Environment</code>含义）的列，加上<code>KEY</code>和<code>VALUE</code>表示键和值对的<code>Properties</code>样式。在Java中，所有字段的类型均为String，因此您可以根据<code>VARCHAR</code>需要设置它们的长度。属性值的行为方式与它们来自名为的Spring Boot属性文件的行为相同<code>{application}-{profile}.properties</code>，包括所有加密和解密，这将作为后处理步骤应用（即，不直接在存储库实现中使用）。</p> <h4 id="redis后端"><a href="#redis后端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_redis_backend" target="_blank" rel="noopener noreferrer">Redis后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Spring Cloud Config Server支持Redis作为配置属性的后端。您可以通过向<a href="https://spring.io/projects/spring-data-redis" target="_blank" rel="noopener noreferrer">Spring Data Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>添加依赖项来启用此功能。</p> <p>pom.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以下配置使用Spring Data <code>RedisTemplate</code>访问Redis。我们可以使用<code>spring.redis.*</code>属性来覆盖默认的连接设置。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> redis
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">16379</span>
</code></pre></div><p>这些属性应作为字段存储在哈希中。哈希的名称应该是相同的<code>spring.application.name</code>财产或共同<code>spring.application.name</code>及<code>spring.profiles.active[n]</code>。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>HMSET sample-app server.port <span class="token string">&quot;8100&quot;</span> sample.topic.name <span class="token string">&quot;test&quot;</span> test.property1 <span class="token string">&quot;property1&quot;</span>
</code></pre></div><p>执行上面可见的命令后，哈希应包含带有值的以下键：</p> <div class="language- extra-class"><pre class="language-text"><code>HGETALL示例应用程序
{
  “ server.port”：“ 8100”，
  “ sample.topic.name”：“测试”，
  “ test.property1”：“ property1”
}
</code></pre></div><table><thead><tr><th>未指定配置文件时<code>default</code>将使用。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h4 id="aws-s3后端"><a href="#aws-s3后端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_aws_s3_backend" target="_blank" rel="noopener noreferrer">AWS S3后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Spring Cloud Config Server支持将AWS S3作为配置属性的后端。您可以通过向<a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/examples-s3.html" target="_blank" rel="noopener noreferrer">Amazon S3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/examples-s3.html" target="_blank" rel="noopener noreferrer">AWS Java SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>添加依赖项来启用此功能。</p> <p>pom.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.amazonaws<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aws-java-sdk-s3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以下配置使用AWS S3客户端访问配置文件。我们可以使用<code>spring.awss3.*</code>属性来选择存储您的配置的存储桶。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> awss3
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">awss3</span><span class="token punctuation">:</span>
          <span class="token key atrule">region</span><span class="token punctuation">:</span> us<span class="token punctuation">-</span>east<span class="token punctuation">-</span><span class="token number">1</span>
          <span class="token key atrule">bucket</span><span class="token punctuation">:</span> bucket1
</code></pre></div><p>还可以使用指定一个AWS URL来<a href="https://aws.amazon.com/blogs/developer/using-new-regions-and-endpoints/" target="_blank" rel="noopener noreferrer">覆盖<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> S3服务<a href="https://aws.amazon.com/blogs/developer/using-new-regions-and-endpoints/" target="_blank" rel="noopener noreferrer">的标准端点<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><code>spring.awss3.endpoint</code>。这允许支持S3的beta区域以及其他与S3兼容的存储API。</p> <p>可使用<a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html" target="_blank" rel="noopener noreferrer">默认AWS Credential Provider Chain<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>找到<a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html" target="_blank" rel="noopener noreferrer">证书<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。支持版本化和加密的存储桶，无需进一步配置。</p> <p>配置文件存储在你的水桶为<code>{application}-{profile}.properties</code>，<code>{application}-{profile}.yml</code>或<code>{application}-{profile}.json</code>。可以提供一个可选标签来指定文件的目录路径。</p> <table><thead><tr><th>未指定配置文件时<code>default</code>将使用。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h4 id="credhub后端"><a href="#credhub后端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_credhub_backend" target="_blank" rel="noopener noreferrer">CredHub后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Spring Cloud Config Server支持<a href="https://docs.cloudfoundry.org/credhub" target="_blank" rel="noopener noreferrer">CredHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>作为配置属性的后端。您可以通过向<a href="https://spring.io/projects/spring-credhub" target="_blank" rel="noopener noreferrer">Spring CredHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>添加依赖项来启用此功能。</p> <p>pom.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.credhub<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-credhub-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以下配置使用双向TLS访问CredHub：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> credhub
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">credhub</span><span class="token punctuation">:</span>
          <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//credhub<span class="token punctuation">:</span><span class="token number">8844</span>
</code></pre></div><p>属性应存储为JSON，例如：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>credhub <span class="token builtin class-name">set</span> --name <span class="token string">&quot;/demo-app/default/master/toggles&quot;</span> --type<span class="token operator">=</span>json
value: <span class="token punctuation">{</span><span class="token string">&quot;toggle.button&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;blue&quot;</span>, <span class="token string">&quot;toggle.link&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">}</span>
credhub <span class="token builtin class-name">set</span> --name <span class="token string">&quot;/demo-app/default/master/abs&quot;</span> --type<span class="token operator">=</span>json
value: <span class="token punctuation">{</span><span class="token string">&quot;marketing.enabled&quot;</span><span class="token builtin class-name">:</span> true, <span class="token string">&quot;external.enabled&quot;</span><span class="token builtin class-name">:</span> false<span class="token punctuation">}</span>
</code></pre></div><p>具有该名称的所有客户端应用程序<code>spring.cloud.config.name=demo-app</code>将具有以下属性：</p> <div class="language- extra-class"><pre class="language-text"><code>{
    toggle.button：“蓝色”，
    toggle.link：“红色”，
    marketing.enabled：是的，
    external.enabled：false
}
</code></pre></div><table><thead><tr><th>当未指定配置文件<code>default</code>时，<code>master</code>将使用默认值，当未指定标签时，将使用默认值。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h5 id="oauth-2-0"><a href="#oauth-2-0" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_oauth_2_0" target="_blank" rel="noopener noreferrer">OAuth 2.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>您可以使用<a href="https://docs.cloudfoundry.org/concepts/architecture/uaa.html" target="_blank" rel="noopener noreferrer">UAA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>作为提供程序通过<a href="https://oauth.net/2/" target="_blank" rel="noopener noreferrer">OAuth 2.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行身份验证。</p> <p>pom.xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-oauth2-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以下配置使用OAuth 2.0和UAA访问CredHub：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> credhub
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">credhub</span><span class="token punctuation">:</span>
          <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//credhub<span class="token punctuation">:</span><span class="token number">8844</span>
          <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
            <span class="token key atrule">registration-id</span><span class="token punctuation">:</span> credhub<span class="token punctuation">-</span>client
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">registration</span><span class="token punctuation">:</span>
          <span class="token key atrule">credhub-client</span><span class="token punctuation">:</span>
            <span class="token key atrule">provider</span><span class="token punctuation">:</span> uaa
            <span class="token key atrule">client-id</span><span class="token punctuation">:</span> credhub_config_server
            <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> asecret
            <span class="token key atrule">authorization-grant-type</span><span class="token punctuation">:</span> client_credentials
        <span class="token key atrule">provider</span><span class="token punctuation">:</span>
          <span class="token key atrule">uaa</span><span class="token punctuation">:</span>
            <span class="token key atrule">token-uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//uaa<span class="token punctuation">:</span>8443/oauth/token
</code></pre></div><table><thead><tr><th>使用的UAA客户ID应该具有<code>credhub.read</code>范围。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h4 id="复合环境存储库"><a href="#复合环境存储库" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#composite-environment-repositories" target="_blank" rel="noopener noreferrer">复合环境存储库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>在某些情况下，您可能希望从多个环境存储库中提取配置数据。为此，您可以<code>composite</code>在配置服务器的应用程序属性或YAML文件中启用配置文件。例如，如果要从Subversion存储库以及两个Git存储库中提取配置数据，则可以为配置服务器设置以下属性：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> composite
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">composite</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> svn
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> file<span class="token punctuation">:</span>///path/to/svn/repo
        <span class="token punctuation">-</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> git
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> file<span class="token punctuation">:</span>///path/to/rex/git/repo
        <span class="token punctuation">-</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> git
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> file<span class="token punctuation">:</span>///path/to/walter/git/repo
</code></pre></div><p>使用此配置，优先级由<code>composite</code>密钥下列出存储库的顺序确定。在上面的示例中，首先列出了Subversion存储库，因此在Subversion存储库中找到的值将覆盖在其中一个Git存储库中为相同属性找到的值。在<code>rex</code>Git存储库中找到的值将在Git存储库中为相同属性找到的值之前使用<code>walter</code>。</p> <p>如果只想从每种不同类型的存储库中提取配置数据，则可以<code>composite</code>在配置服务器的应用程序属性或YAML文件中启用相应的配置文件，而不是配置文件。例如，如果要从单个Git存储库和单个HashiCorp Vault服务器提取配置数据，则可以为配置服务器设置以下属性：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> git<span class="token punctuation">,</span> vault
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> file<span class="token punctuation">:</span>///path/to/git/repo
          <span class="token key atrule">order</span><span class="token punctuation">:</span> <span class="token number">2</span>
        <span class="token key atrule">vault</span><span class="token punctuation">:</span>
          <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8200</span>
          <span class="token key atrule">order</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre></div><p>使用此配置，可以通过<code>order</code>属性确定优先级。您可以使用该<code>order</code>属性为所有存储库指定优先级顺序。<code>order</code>属性的数值越低，其优先级越高。存储库的优先级顺序有助于解决包含相同属性值的存储库之间的任何潜在冲突。</p> <table><thead><tr><th>如果您的复合环境包括上一个示例中的Vault服务器，则必须在对配置服务器的每个请求中都包含Vault令牌。请参阅<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#vault-backend" target="_blank" rel="noopener noreferrer">保管库后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>从环境存储库中检索值时，任何类型的故障都会导致整个组合环境的故障。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>使用复合环境时，所有存储库都包含相同的标签很重要。如果您的环境与前面的示例中的环境类似，并且您请求带有<code>master</code>标签的配置数据，但是Subversion存储库不包含名为的分支<code>master</code>，则整个请求将失败。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h5 id="定制复合环境存储库"><a href="#定制复合环境存储库" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_custom_composite_environment_repositories" target="_blank" rel="noopener noreferrer">定制复合环境存储库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h5> <p>除了使用Spring Cloud中的一个环境存储库之外，您还可以提供自己的<code>EnvironmentRepository</code>bean，以将其包含在复合环境中。为此，您的bean必须实现<code>EnvironmentRepository</code>接口。如果要<code>EnvironmentRepository</code>在复合环境中控制自定义的优先级，则还应该实现该<code>Ordered</code>接口并重写该<code>getOrdered</code>方法。如果您不实现该<code>Ordered</code>接口，则您<code>EnvironmentRepository</code>的优先级最低。</p> <h4 id="物业替代"><a href="#物业替代" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#property-overrides" target="_blank" rel="noopener noreferrer">物业替代<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Config Server具有“替代”功能，使操作员可以为所有应用程序提供配置属性。应用程序使用常规的Spring Boot钩子不会意外更改重写的属性。要声明覆盖，请将名称/值对的映射添加到<code>spring.cloud.config.server.overrides</code>，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">overrides</span><span class="token punctuation">:</span>
          <span class="token key atrule">foo</span><span class="token punctuation">:</span> bar
</code></pre></div><p>前面的示例使所有作为配置客户端的应用程序读取<code>foo=bar</code>，而与它们自己的配置无关。</p> <table><thead><tr><th>配置系统不能强制应用程序以任何特定方式使用配置数据。因此，覆盖无法执行。但是，它们确实为Spring Cloud Config客户端提供了有用的默认行为。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>通常，<code>${}</code>可以使用反斜杠（<code>\</code>）对<code>$</code>或进行转义，以将Spring环境的占位符转义（并在客户端上解析）<code>{</code>。例如，<code>\${app.foo:bar}</code>解析为<code>bar</code>，除非应用提供自己的<code>app.foo</code>。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>在YAML中，您不需要转义反斜杠本身。但是，在属性文件中，在服务器上配置替代时，确实需要转义反斜杠。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>您可以通过设置<code>spring.cloud.config.overrideNone=true</code>远程存储库中的标志（默认为false），使客户端中所有替代的优先级更像默认值，让应用程序在环境变量或系统属性中提供自己的值。</p> <h3 id="健康指标"><a href="#健康指标" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_health_indicator" target="_blank" rel="noopener noreferrer">健康指标<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Config Server带有运行状况指示器，用于检查配置的<code>EnvironmentRepository</code>是否正常。默认情况下，它会要求<code>EnvironmentRepository</code>提供一个名为<code>app</code>，<code>default</code>配置文件和<code>EnvironmentRepository</code>实现提供的默认标签的应用程序。</p> <p>您可以配置运行状况指示器以检查更多应用程序以及自定义配置文件和自定义标签，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">health</span><span class="token punctuation">:</span>
          <span class="token key atrule">repositories</span><span class="token punctuation">:</span>
            <span class="token key atrule">myservice</span><span class="token punctuation">:</span>
              <span class="token key atrule">label</span><span class="token punctuation">:</span> mylabel
            <span class="token key atrule">myservice-dev</span><span class="token punctuation">:</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> myservice
              <span class="token key atrule">profiles</span><span class="token punctuation">:</span> development
</code></pre></div><p>您可以通过设置禁用运行状况指示器<code>spring.cloud.config.server.health.enabled=false</code>。</p> <h3 id="安全"><a href="#安全" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_security" target="_blank" rel="noopener noreferrer">安全<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>您可以使用对您有意义的任何方式来保护Config Server（从物理网络安全性到OAuth2承载令牌），因为Spring Security和Spring Boot提供了对许多安全性安排的支持。</p> <p>要使用默认的Spring Boot配置的HTTP Basic安全性，请在类路径中包含Spring Security（例如，通过<code>spring-boot-starter-security</code>）。默认值为用户名<code>user</code>和随机生成的密码。随机密码在实践中没有用，因此我们建议您配置密码（通过设置<code>spring.security.user.password</code>）并对其进行加密（有关如何操作的说明，请参见下文）。</p> <h3 id="加密与解密"><a href="#加密与解密" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_encryption_and_decryption" target="_blank" rel="noopener noreferrer">加密与解密<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <table><thead><tr><th>要使用加密和解密功能，您需要在JVM中安装完整功能的JCE（默认情况下不包括）。您可以从Oracle下载“ Java密码学扩展（JCE）无限强度管辖权策略文件”并按照安装说明进行操作（实际上，您需要用下载的JRE lib / security目录替换这两个策略文件）。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>如果远程属性源包含加密的内容（以开头的值<code>{cipher}</code>），则将其解密，然后再通过HTTP发送给客户端。此设置的主要优点是，当属性值处于“静止”状态时（例如，在git存储库中），不需要使用纯文本格式。如果无法解密某个值，则将其从属性源中删除，并使用相同的键但以前缀<code>invalid</code>和表示“不适用”（通常为``）的值添加其他属性。这很大程度上是为了防止将密文用作密码并意外泄漏。</p> <p>如果为配置客户端应用程序设置远程配置存储库，则它可能包含<code>application.yml</code>与以下内容类似的内容：</p> <p>application.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> dbuser
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">'{cipher}FKSAJDFGYOS8F7GLHAKERGFHLSAJ'</span>
</code></pre></div><p>.properties文件中的加密值不能用引号引起来。否则，该值不会解密。以下示例显示了有效的值：</p> <p>application.properties</p> <div class="language- extra-class"><pre class="language-text"><code>spring.datasource.username：dbuser
spring.datasource.password：{cipher} FKSAJDFGYOS8F7GLHAKERGFHLSAJ
</code></pre></div><p>您可以安全地将此纯文本推送到共享的git存储库，并且秘密密码仍然受到保护。</p> <p>服务器还公开<code>/encrypt</code>和<code>/decrypt</code>终结点（假设它们是安全的，并且只能由授权代理访问）。如果您编辑远程配置文件，则可以使用Config Server通过POST到<code>/encrypt</code>端点来加密值，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl本地主机：8888 / encrypt -d mysecret
682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
</code></pre></div><table><thead><tr><th>如果您加密的值中包含需要URL编码的字符，则应使用该<code>--data-urlencode</code>选项来<code>curl</code>确保其编码正确。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>确保不要在加密值中包含任何curl命令统计信息。将值输出到文件可以帮助避免此问题。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>反向操作也可以通过以下方式获得<code>/decrypt</code>（如果服务器配置有对称密钥或完整密钥对），如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>$ curl本地主机：8888 / decrypt -d 682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
我的秘密
</code></pre></div><table><thead><tr><th>如果您使用curl进行测试，则使用<code>--data-urlencode</code>（而不是<code>-d</code>）或设置显式值<code>Content-Type: text/plain</code>，以确保在有特殊字符时，curl可以正确编码数据（'+'特别棘手）。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>在将加密的值<code>{cipher}</code>放入YAML或属性文件中之前，在提交并将其推送到远程（可能不安全）存储之前，请获取加密的值并添加前缀。</p> <p>该<code>/encrypt</code>和<code>/decrypt</code>终点还兼有接受的形式路径<code>/*/{application}/{profiles}</code>，当客户打电话到主环境资源，这可以用来控制加密的每个应用程序（名称）和每个配置文件的基础。</p> <table><thead><tr><th>要以这种精细的方式控制加密，还必须提供一种<code>@Bean</code>类型<code>TextEncryptorLocator</code>，该类型针对每个名称和配置文件创建不同的加密器。默认情况下不提供（所有加密使用相同的密钥）。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>该<code>spring</code>命令行客户机（安装弹簧云CLI扩展）也可以用于加密和解密，因为显示在下面的例子：</p> <div class="language- extra-class"><pre class="language-text"><code>$ spring加密mysecret --key foo
682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
$ spring解密--key foo 682bc583f4641835fa2db009355293665d2647dade3375c0ee201de2a49f7bda
我的秘密
</code></pre></div><p>要使用文件中的密钥（例如用于加密的RSA公钥），请在密钥值前添加“ @”并提供文件路径，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>$ spring加密mysecret --key @ $ {HOME} /。ssh / id_rsa.pub
AQAjPgt3eFZQXwt8tsHAVv / QHiY5sI2dRcR + ...
</code></pre></div><table><thead><tr><th>该<code>--key</code>参数是强制性的（尽管有<code>--</code>前缀）。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h3 id="密钥管理"><a href="#密钥管理" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_key_management" target="_blank" rel="noopener noreferrer">密钥管理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Config Server可以使用对称（共享）密钥或非对称密钥（RSA密钥对）。非对称选择在安全性方面是优越的，但是使用对称密钥通常更方便，因为它是在中配置的单个属性值<code>bootstrap.properties</code>。</p> <p>要配置对称密钥，您需要将其设置<code>encrypt.key</code>为秘密字符串（或使用<code>ENCRYPT_KEY</code>环境变量将其保留在纯文本配置文件之外）。</p> <table><thead><tr><th>您不能使用来配置非对称密钥<code>encrypt.key</code>。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>要配置非对称密钥，请使用密钥库（例如，由<code>keytool</code>JDK附带的实用程序创建的密钥库）。密钥存储属性是<code>encrypt.keyStore.*</code>与<code>*</code>等于</p> <table><thead><tr><th style="text-align:center;">属性</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;"><code>encrypt.keyStore.location</code></td> <td style="text-align:center;">包含<code>Resource</code>位置</td></tr> <tr><td style="text-align:center;"><code>encrypt.keyStore.password</code></td> <td style="text-align:center;">持有用于解锁密钥库的密码</td></tr> <tr><td style="text-align:center;"><code>encrypt.keyStore.alias</code></td> <td style="text-align:center;">标识商店中要使用的密钥</td></tr> <tr><td style="text-align:center;"><code>encrypt.keyStore.type</code></td> <td style="text-align:center;">要创建的KeyStore的类型。默认为<code>jks</code>。</td></tr></tbody></table> <p>加密是使用公钥完成的，解密需要私钥。因此，原则上，如果您只想加密（并准备使用私钥在本地解密值），则只能在服务器中配置公钥。实际上，您可能不希望在本地进行解密，因为它会将密钥管理过程分布在所有客户端上，而不是将其集中在服务器上。另一方面，如果您的配置服务器相对不安全并且只有少数客户端需要加密的属性，那么它可能是一个有用的选项。</p> <h3 id="创建密钥库进行测试"><a href="#创建密钥库进行测试" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_creating_a_key_store_for_testing" target="_blank" rel="noopener noreferrer">创建密钥库进行测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>要创建用于测试的密钥库，可以使用类似于以下内容的命令：</p> <div class="language- extra-class"><pre class="language-text"><code>$ keytool -genkeypair -alias mytestkey -keyalg RSA \
  -dname“ CN = Web服务器，OU =单位，O =组织，L =城市，S =州，C =美国” \
  -keypass changeme -keystore server.jks -storepass letmein
</code></pre></div><table><thead><tr><th>使用JDK 11或更高版本时，使用上述命令时可能会收到以下警告。在这种情况下，您可能要确保<code>keypass</code>和<code>storepass</code>值匹配。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <div class="language- extra-class"><pre class="language-text"><code>警告：PKCS12 KeyStore不支持不同的存储和密钥密码。忽略用户指定的-keypass值。
</code></pre></div><p>将<code>server.jks</code>文件放入类路径（例如），然后在<code>bootstrap.yml</code>Config Server的中，创建以下设置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">encrypt</span><span class="token punctuation">:</span>
  <span class="token key atrule">keyStore</span><span class="token punctuation">:</span>
    <span class="token key atrule">location</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/server.jks
    <span class="token key atrule">password</span><span class="token punctuation">:</span> letmein
    <span class="token key atrule">alias</span><span class="token punctuation">:</span> mytestkey
    <span class="token key atrule">secret</span><span class="token punctuation">:</span> changeme
</code></pre></div><h3 id="使用多个按键和按键旋转"><a href="#使用多个按键和按键旋转" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_using_multiple_keys_and_key_rotation" target="_blank" rel="noopener noreferrer">使用多个按键和按键旋转<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>除了<code>{cipher}</code>加密属性值中的前缀之外，Config Server <code>{name:value}</code>在（Base64编码的）密文开始之前查找零个或多个前缀。密钥被传递给a <code>TextEncryptorLocator</code>，后者可以执行<code>TextEncryptor</code>为密码找到a 所需的任何逻辑。如果配置了密钥库（<code>encrypt.keystore.location</code>），则默认定位器将查找具有<code>key</code>前缀提供的别名的密钥，该密钥的密码文本类似于以下内容：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">foo</span><span class="token punctuation">:</span>
  <span class="token key atrule">bar</span><span class="token punctuation">:</span> `<span class="token punctuation">{</span>cipher<span class="token punctuation">}</span><span class="token punctuation">{</span>key<span class="token punctuation">:</span>testkey<span class="token punctuation">}</span><span class="token punctuation">...</span>`
</code></pre></div><p>定位器查找名为“ testkey”的键。也可以通过使用<code>{secret:…}</code>前缀中的值来提供机密。但是，如果未提供，则默认为使用密钥库密码（这是在构建密钥库且未指定密钥时得到的密码）。如果确实提供了机密，则还应该使用custom加密机密<code>SecretLocator</code>。</p> <p>当密钥仅用于加密几个字节的配置数据时（也就是说，它们未在其他地方使用），从密码的角度讲，几乎不需要旋转密钥。但是，您有时可能需要更改密钥（例如，在发生安全漏洞时）。在这种情况下，所有客户端都需要更改其源配置文件（例如，在git中），并<code>{key:…}</code>在所有密码中使用新的前缀。请注意，客户端需要首先检查Config Server密钥库中的密钥别名是否可用。</p> <table><thead><tr><th>如果要让Config Server处理所有加密以及解密，<code>{name:value}</code>则还可以将前缀作为纯文本添加到发布到<code>/encrypt</code>端点。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h3 id="提供加密的属性"><a href="#提供加密的属性" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_serving_encrypted_properties" target="_blank" rel="noopener noreferrer">提供加密的属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>有时，您希望客户端在本地解密配置，而不是在服务器中进行解密。在这种情况下，如果提供了<code>encrypt.*</code>用于定位密钥的配置，则仍然可以具有<code>/encrypt</code>和<code>/decrypt</code>端点，但是需要通过放置<code>spring.cloud.config.server.encrypt.enabled=false</code>在中来显式关闭对传出属性的解密<code>bootstrap.[yml|properties]</code>。如果您不关心端点，则在不配置键或启用标志的情况下都可以使用。</p> <h2 id="服务替代格式"><a href="#服务替代格式" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_serving_alternative_formats" target="_blank" rel="noopener noreferrer">服务替代格式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>来自环境端点的默认JSON格式非常适合Spring应用程序使用，因为它直接映射到<code>Environment</code>抽象上。如果愿意，可以通过在资源路径中添加后缀（“ .yml”，“。yaml”或“ .properties”）来使用与YAML或Java属性相同的数据。对于不关心JSON终结点的结构或它们提供的额外元数据的应用程序来说，这可能很有用（例如，不使用Spring的应用程序可能会受益于此方法的简单性）。</p> <p>YAML和属性表示形式还有一个附加标志（提供为称为的布尔查询参数<code>resolvePlaceholders</code>），以信号表示<code>${…}</code>应尽可能在呈现之前在输出中解析源文档（以标准Spring 形式）中的占位符。对于不了解Spring占位符约定的使用者来说，这是一个有用的功能。</p> <table><thead><tr><th>使用YAML或属性格式存在一些限制，主要是与元数据的丢失有关。例如，JSON被构造为属性源的有序列表，其名称与该源相关。即使值的来源有多个来源，YAML和属性表单也会合并到一个映射中，并且原始来源文件的名称也会丢失。同样，YAML表示也不一定是后备存储库中YAML源的忠实表示。它由一系列平面属性来源构成，并且必须对密钥的形式进行假设。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h2 id="提供纯文本"><a href="#提供纯文本" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_serving_plain_text" target="_blank" rel="noopener noreferrer">提供纯文本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p><code>Environment</code>您的应用程序可能需要使用针对其环境量身定制的通用纯文本配置文件，而不是使用抽象（或使用YAML或属性格式的抽象表示之一）。在配置服务器通过额外的端点提供了这些<code>/{application}/{profile}/{label}/{path}</code>，在那里<code>application</code>，<code>profile</code>和<code>label</code>的含义与常规环境终点相同，但是<code>path</code>是一个文件名（如路径<code>log.xml</code>）。该端点的源文件与环境端点的定位方式相同。属性和YAML文件使用相同的搜索路径。但是，不是汇总所有匹配资源，而是仅返回第一个要匹配的资源。</p> <p>找到资源后<code>${…}</code>，使用<code>Environment</code>提供的应用程序名称，配置文件和标签的有效名称来解析常规格式（）的占位符。通过这种方式，资源端点与环境端点紧密集成在一起。</p> <table><thead><tr><th>与用于环境配置的源文件一样，<code>profile</code>用来解析文件名。因此，如果您想要一个特定于配置文件的文件，<code>/*/development/*/logback.xml</code>可以通过一个名为<code>logback-development.xml</code>（优先于<code>logback.xml</code>）的文件来解决。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>如果您不想提供，而是<code>label</code>让服务器使用默认标签，则可以提供一个<code>useDefaultLabel</code>请求参数。因此，<code>default</code>配置文件的前面的示例可以是<code>/sample/default/nginx.conf?useDefaultLabel</code>。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>目前，Spring Cloud Config可以为git，SVN，本机后端和AWS S3提供纯文本。对git，SVN和本机后端的支持是相同的。AWS S3的工作方式略有不同。以下各节说明每个部分的工作方式：</p> <ul><li><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#spring-cloud-config-serving-plain-text-git-svn-native-backends" target="_blank" rel="noopener noreferrer">Git，SVN和本机后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#spring-cloud-config-serving-plain-text-aws-s3" target="_blank" rel="noopener noreferrer">AWS S3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="git，svn和本机后端"><a href="#git，svn和本机后端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#spring-cloud-config-serving-plain-text-git-svn-native-backends" target="_blank" rel="noopener noreferrer">Git，SVN和本机后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>考虑以下用于GIT或SVN存储库或本机后端的示例：</p> <div class="language- extra-class"><pre class="language-text"><code>application.yml
nginx.conf
</code></pre></div><p>将<code>nginx.conf</code>可能类似于下面的清单：</p> <div class="language- extra-class"><pre class="language-text"><code>server {
    listen              80;
    server_name         ${nginx.server.name};
}
</code></pre></div><p><code>application.yml</code> 可能类似于以下清单：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">nginx</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> example.com
<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> development
<span class="token key atrule">nginx</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> develop.com
</code></pre></div><p>该<code>/sample/default/master/nginx.conf</code>资源可能如下：</p> <div class="language- extra-class"><pre class="language-text"><code>server {
    listen              80;
    server_name         example.com;
}
</code></pre></div><p><code>/sample/development/master/nginx.conf</code> 可能如下：</p> <div class="language- extra-class"><pre class="language-text"><code>server {
    listen              80;
    server_name         develop.com;
}
</code></pre></div><h3 id="aws-s3"><a href="#aws-s3" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#spring-cloud-config-serving-plain-text-aws-s3" target="_blank" rel="noopener noreferrer">AWS S3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>要为AWS s3启用纯文本服务，Config Server应用程序需要包括对Spring Cloud AWS的依赖关系。有关如何设置该依赖关系的详细信息，请参阅《 <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.1.3.RELEASE/single/spring-cloud-aws.html#_spring_cloud_aws_maven_dependency_management" target="_blank" rel="noopener noreferrer">Spring Cloud AWS Reference Guide》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。然后，您需要按照《<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-aws/2.1.3.RELEASE/single/spring-cloud-aws.html#_configuring_credentials" target="_blank" rel="noopener noreferrer">Spring Cloud AWS参考指南》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中的说明配置Spring Cloud AWS 。</p> <h3 id="解密纯文本"><a href="#解密纯文本" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_decrypting_plain_text" target="_blank" rel="noopener noreferrer">解密纯文本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>默认情况下，纯文本文件中的加密值不会被解密。为了启用对纯文本文件的解密<code>spring.cloud.config.server.encrypt.enabled=true</code>，请<code>spring.cloud.config.server.encrypt.plainTextEncrypt=true</code>在<code>bootstrap.[yml|properties]</code></p> <table><thead><tr><th>仅YAML，JSON和属性文件扩展名支持解密纯文本文件。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>如果启用了此功能，并且请求了不受支持的文件扩展名，则文件中的任何加密值都不会被解密。</p> <h2 id="嵌入配置服务器"><a href="#嵌入配置服务器" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_embedding_the_config_server" target="_blank" rel="noopener noreferrer">嵌入配置服务器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>Config Server最好作为独立应用程序运行。但是，如果需要，可以将其嵌入另一个应用程序。为此，请使用<code>@EnableConfigServer</code>注释。<code>spring.cloud.config.server.bootstrap</code>在这种情况下，名为的可选属性会很有用。它是一个标志，用于指示服务器是否应从其自己的远程存储库中进行配置。默认情况下，该标志为关闭状态，因为它会延迟启动。但是，当嵌入到另一个应用程序中时，以与其他任何应用程序相同的方式进行初始化是有意义的。设置为时<code>spring.cloud.config.server.bootstrap</code>，<code>true</code>还必须使用<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#composite-environment-repositories" target="_blank" rel="noopener noreferrer">复合环境存储库配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。例如</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> configserver
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> composite
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">composite</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> native
            <span class="token key atrule">search-locations</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>HOME<span class="token punctuation">}</span>/Desktop/config
        <span class="token key atrule">bootstrap</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><table><thead><tr><th>如果使用bootstrap标志，则配置服务器需要在中配置其名称和存储库URI <code>bootstrap.yml</code>。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>要更改服务器端点的位置，您可以（可选）设置<code>spring.cloud.config.server.prefix</code>（例如<code>/config</code>）以在前缀下提供资源。前缀应以开头，但不能以结束<code>/</code>。它应用于<code>@RequestMappings</code>Config Server中的（即，在Spring Boot <code>server.servletPath</code>和<code>server.contextPath</code>前缀之下）。</p> <p>如果要直接从后端存储库（而不是从配置服务器）读取应用程序的配置，则基本上需要没有端点的嵌入式配置服务器。您可以不使用<code>@EnableConfigServer</code>批注（set <code>spring.cloud.config.server.bootstrap=true</code>）来完全关闭端点。</p> <h2 id="推送通知和spring-cloud-bus"><a href="#推送通知和spring-cloud-bus" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_push_notifications_and_spring_cloud_bus" target="_blank" rel="noopener noreferrer">推送通知和Spring Cloud Bus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>许多源代码存储库提供程序（例如Github，Gitlab，Gitea，Gitee，Gogs或Bitbucket）都通过Webhook通知您存储库中的更改。您可以通过提供者的用户界面将Webhook配置为URL和您感兴趣的一组事件。例如，<a href="https://developer.github.com/v3/activity/events/types/#pushevent" target="_blank" rel="noopener noreferrer">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>使用POST到Webhook，其JSON主体包含提交列表和<code>X-Github-Event</code>设置为的标头（）<code>push</code>。如果您在<code>spring-cloud-config-monitor</code>库上添加依赖项并在Config Server中激活Spring Cloud Bus，那么将<code>/monitor</code>启用端点。</p> <p>When the webhook is activated, the Config Server sends a <code>RefreshRemoteApplicationEvent</code> targeted at the applications it thinks might have changed. The change detection can be strategized. However, by default, it looks for changes in files that match the application name (for example, <code>foo.properties</code> is targeted at the <code>foo</code> application, while <code>application.properties</code> is targeted at all applications). The strategy to use when you want to override the behavior is <code>PropertyPathNotificationExtractor</code>, which accepts the request headers and body as parameters and returns a list of file paths that changed.</p> <p>默认配置可与Github，Gitlab，Gitea，Gitee，Gogs或Bitbucket一起使用。除了来自Github，Gitlab，Gitee或Bitbucket的JSON通知之外，您还可以通过POST来触发更改通知，该通知<code>/monitor</code>采用形式的形式编码的主体参数<code>path={application}</code>。这样做会向与该<code>{application}</code>模式匹配的应用程序广播（可以包含通配符）。</p> <table><thead><tr><th>在<code>RefreshRemoteApplicationEvent</code>仅在发送<code>spring-cloud-bus</code>时在两个配置服务器和客户端应用程序激活。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <table><thead><tr><th>默认配置还检测本地git存储库中的文件系统更改。在这种情况下，不使用Webhook。但是，一旦您编辑配置文件，就会广播刷新。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h2 id="spring-cloud-config客户端"><a href="#spring-cloud-config客户端" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_spring_cloud_config_client" target="_blank" rel="noopener noreferrer">Spring Cloud Config客户端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>Spring Boot应用程序可以立即利用Spring Config Server（或应用程序开发人员提供的其他外部属性源）。它还选择了一些与<code>Environment</code>变更事件相关的其他有用功能。</p> <h3 id="配置第一个引导程序"><a href="#配置第一个引导程序" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#config-first-bootstrap" target="_blank" rel="noopener noreferrer">配置第一个引导程序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>在类路径上具有Spring Cloud Config Client的任何应用程序的默认行为如下：当配置客户端启动时，它将绑定到Config Server（通过<code>spring.cloud.config.uri</code>bootstrap配置属性），并<code>Environment</code>使用远程属性源初始化Spring 。</p> <p>此行为的最终结果是，所有要使用Config Server的客户端应用程序都需要一个<code>bootstrap.yml</code>（或环境变量），其服务器地址设置为该地址<code>spring.cloud.config.uri</code>（默认为“ http：// localhost：8888”）。</p> <h3 id="发现第一引导"><a href="#发现第一引导" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#discovery-first-bootstrap" target="_blank" rel="noopener noreferrer">发现第一引导<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>如果您使用<code>DiscoveryClient</code>诸如Spring Cloud Netflix和Eureka Service Discovery或Spring Cloud Consul之类的实现，则可以让Config Server在Discovery Service中注册。但是，在默认的“配置优先”模式下，客户端无法利用注册。</p> <p>如果您更喜欢使用<code>DiscoveryClient</code>来定位Config Server，则可以通过设置来实现<code>spring.cloud.config.discovery.enabled=true</code>（默认值为<code>false</code>）。这样做的最终结果是，所有客户端应用程序都需要<code>bootstrap.yml</code>具有适当发现配置的（或环境变量）。例如，对于Spring Cloud Netflix，您需要定义Eureka服务器地址（例如，在中<code>eureka.client.serviceUrl.defaultZone</code>）。使用此选项的价格是启动时需要进行额外的网络往返，以查找服务注册。好处是，只要发现服务是固定点，配置服务器就可以更改其坐标。默认服务ID是<code>configserver</code>，但是您可以通过设置<code>spring.cloud.config.discovery.serviceId</code>（和在服务器上，以一种通常的服务方式，例如通过设置<code>spring.application.name</code>）在客户端上更改该ID 。</p> <p>发现客户端实现均支持某种元数据映射（例如，<code>eureka.instance.metadataMap</code>对于Eureka ，我们拥有）。Config Server的某些其他属性可能需要在其服务注册元数据中进行配置，以便客户端可以正确连接。如果Config Server受HTTP Basic保护，则可以将凭据配置为<code>user</code>和<code>password</code>。另外，如果Config Server具有上下文路径，则可以设置<code>configPath</code>。例如，以下YAML文件适用于作为Eureka客户端的Config Server：</p> <p>bootstrap.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
    <span class="token key atrule">metadataMap</span><span class="token punctuation">:</span>
      <span class="token key atrule">user</span><span class="token punctuation">:</span> osufhalskjrtl
      <span class="token key atrule">password</span><span class="token punctuation">:</span> lviuhlszvaorhvlo5847
      <span class="token key atrule">configPath</span><span class="token punctuation">:</span> /config
</code></pre></div><h3 id="快速配置客户端失败"><a href="#快速配置客户端失败" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#config-client-fail-fast" target="_blank" rel="noopener noreferrer">快速配置客户端失败<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>在某些情况下，如果服务无法连接到Config Server，您可能希望启动失败。如果这是期望的行为，请设置引导程序配置属性，<code>spring.cloud.config.fail-fast=true</code>以使客户端因Exception而暂停。</p> <h3 id="配置客户端重试"><a href="#配置客户端重试" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#config-client-retry" target="_blank" rel="noopener noreferrer">配置客户端重试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>如果您希望配置服务器在您的应用程序启动时偶尔会不可用，则可以使其在失败后继续尝试。首先，您需要设置<code>spring.cloud.config.fail-fast=true</code>。然后，您需要添加<code>spring-retry</code>和<code>spring-boot-starter-aop</code>到您的类路径。默认行为是重试六次，初始回退间隔为1000ms，随后的回退的指数乘数为1.1。您可以通过设置<code>spring.cloud.config.retry.*</code>配置属性来配置这些属性（和其他属性）。</p> <table><thead><tr><th>要完全控制重试行为，请添加ID为<code>@Bean</code>的type 。Spring Retry有一个支持创建一个。 <code>RetryOperationsInterceptor``configServerRetryInterceptor``RetryInterceptorBuilder</code></th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <h3 id="查找远程配置资源"><a href="#查找远程配置资源" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_locating_remote_configuration_resources" target="_blank" rel="noopener noreferrer">查找远程配置资源<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>Config Service提供来自的属性源<code>/{application}/{profile}/{label}</code>，其中客户端应用程序中的默认绑定如下：</p> <ul><li>&quot;name&quot; = <code>${spring.application.name}</code></li> <li>&quot;profile&quot; = <code>${spring.profiles.active}</code> (actually <code>Environment.getActiveProfiles()</code>)</li> <li>&quot;label&quot; = &quot;master&quot;</li></ul> <table><thead><tr><th>设置属性时，<code>${spring.application.name}</code>请勿在您的应用名称前加上保留字，<code>application-</code>以防止解析正确的属性源时出现问题。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <p>您可以通过设置覆盖所有的人<code>spring.cloud.config.*</code>（这里<code>*</code>是<code>name</code>，<code>profile</code>或<code>label</code>）。该<code>label</code>是回滚到配置的先前版本很有用。使用默认的Config Server实现，它可以是git标签，分支名称或提交ID。标签也可以以逗号分隔的列表形式提供。在这种情况下，列表中的项目将一一尝试直到成功为止。在要素分支上工作时，此行为可能很有用。例如，您可能希望使config标签与分支对齐，但使其成为可选（在这种情况下，请使用<code>spring.cloud.config.label=myfeature,develop</code>）。</p> <h3 id="为配置服务器指定多个url"><a href="#为配置服务器指定多个url" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_specifying_multiple_urls_for_the_config_server" target="_blank" rel="noopener noreferrer">为配置服务器指定多个URL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>为确保在部署了Config Server的多个实例并希望不时有一个或多个实例不可用时的高可用性，可以指定多个URL（作为“<code>spring.cloud.config.uri</code>属性），或让您的所有实例都在服务注册中心（例如Eureka）中注册（如果使用Discovery-First Bootstrap模式）。请注意，只有在未运行Config Server时（即，应用程序退出时）或发生连接超时时，这样做才能确保高可用性。例如，如果Config Server返回500（内部服务器错误）响应，或者Config Client从Config Server收到401（由于凭据错误或其他原因），则Config Client不会尝试从其他URL获取属性。此类错误表示用户问题，而不是可用性问题。</p> <p>如果您在Config Server上使用HTTP基本安全性，则仅当将凭据嵌入在<code>spring.cloud.config.uri</code>属性下指定的每个URL中时，当前才可能支持per-Config Server身份验证凭据。如果使用任何其他类型的安全性机制，则（当前）不能支持每台配置服务器的身份验证和授权。</p> <h3 id="配置超时"><a href="#配置超时" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_configuring_timeouts" target="_blank" rel="noopener noreferrer">配置超时<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>如果要配置超时阈值：</p> <ul><li>可以使用属性配置读取超时<code>spring.cloud.config.request-read-timeout</code>。</li> <li>可以使用属性配置连接超时<code>spring.cloud.config.request-connect-timeout</code>。</li></ul> <h3 id="安全-2"><a href="#安全-2" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_security_2" target="_blank" rel="noopener noreferrer">安全<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>如果在服务器上使用HTTP基本安全性，则客户端需要知道密码（如果不是默认用户名，则需要用户名）。您可以通过配置服务器URI或通过单独的用户名和密码属性来指定用户名和密码，如以下示例所示：</p> <p>bootstrap.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
     <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//user<span class="token punctuation">:</span>secret@myconfig.mycompany.com
</code></pre></div><p>以下示例显示了传递相同信息的另一种方法：</p> <p>bootstrap.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
     <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//myconfig.mycompany.com
     <span class="token key atrule">username</span><span class="token punctuation">:</span> user
     <span class="token key atrule">password</span><span class="token punctuation">:</span> secret
</code></pre></div><p>在<code>spring.cloud.config.password</code>与<code>spring.cloud.config.username</code>那就是在URI提供的值覆盖任何东西。</p> <p>如果您在Cloud Foundry上部署应用程序，则提供密码的最佳方法是通过服务凭据（例如URI中的URI），因为它不需要位于配置文件中。以下示例在本地运行，并且适用于Cloud Foundry上名为的用户提供的服务<code>configserver</code>：</p> <p>bootstrap.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
     <span class="token key atrule">uri</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>vcap.services.configserver.credentials.uri<span class="token punctuation">:</span>http<span class="token punctuation">:</span>//user<span class="token punctuation">:</span>password@localhost<span class="token punctuation">:</span><span class="token number">8888</span><span class="token punctuation">}</span>
</code></pre></div><p>如果您使用安全的另一种形式，你可能需要<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#custom-rest-template" target="_blank" rel="noopener noreferrer">提供<code>RestTemplate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<code>ConfigServicePropertySourceLocator</code>（例如，通过在引导方面抓住它，并注入它）。</p> <h4 id="健康指标-2"><a href="#健康指标-2" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_health_indicator_2" target="_blank" rel="noopener noreferrer">健康指标<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>Config Client提供一个Spring Boot Health Indicator，该指示器尝试从Config Server加载配置。可以通过设置禁用健康指示器<code>health.config.enabled=false</code>。由于性能原因，响应也被缓存。默认的生存时间为5分钟。要更改该值，请设置<code>health.config.time-to-live</code>属性（以毫秒为单位）。</p> <h4 id="提供自定义的resttemplate"><a href="#提供自定义的resttemplate" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#custom-rest-template" target="_blank" rel="noopener noreferrer">提供自定义的RestTemplate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>在某些情况下，您可能需要自定义来自客户端对配置服务器的请求。通常，这样做涉及传递特殊的<code>Authorization</code>标头以验证对服务器的请求。提供一个习惯<code>RestTemplate</code>：</p> <ol><li>创建一个具有的实现的新配置bean <code>PropertySourceLocator</code>，如以下示例所示：</li></ol> <p>CustomConfigServiceBootstrapConfiguration.java</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomConfigServiceBootstrapConfiguration</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConfigServicePropertySourceLocator</span> <span class="token function">configServicePropertySourceLocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ConfigClientProperties</span> clientProperties <span class="token operator">=</span> <span class="token function">configClientProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">ConfigServicePropertySourceLocator</span> configServicePropertySourceLocator <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">ConfigServicePropertySourceLocator</span><span class="token punctuation">(</span>clientProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        configServicePropertySourceLocator<span class="token punctuation">.</span><span class="token function">setRestTemplate</span><span class="token punctuation">(</span><span class="token function">customRestTemplate</span><span class="token punctuation">(</span>clientProperties<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> configServicePropertySourceLocator<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th>为了简化添加<code>Authorization</code>标题的方法，<code>spring.cloud.config.headers.*</code>可以使用属性。</th></tr></thead> <tbody><tr><td></td></tr></tbody></table> <ol><li>在中<code>resources/META-INF</code>，创建一个名为的文件 <code>spring.factories</code>并指定您的自定义配置，如以下示例所示：</li></ol> <p>弹簧工厂</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">org.springframework.cloud.bootstrap.BootstrapConfiguration</span> <span class="token punctuation">=</span> <span class="token attr-value">com.my.config.client.CustomConfigServiceBootstrapConfiguration</span>
</code></pre></div><h4 id="金库"><a href="#金库" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_vault" target="_blank" rel="noopener noreferrer">金库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>将保管库用作配置服务器的后端时，客户端需要为服务器提供令牌以从保管库检索值。该令牌可以在客户端内设置被提供<code>spring.cloud.config.token</code> 在<code>bootstrap.yml</code>，如显示在下面的例子：</p> <p>bootstrap.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">token</span><span class="token punctuation">:</span> YourVaultToken
</code></pre></div><h3 id="保险柜中的嵌套键"><a href="#保险柜中的嵌套键" class="header-anchor">#</a> <a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-config/2.2.1.RELEASE/reference/html/#_nested_keys_in_vault" target="_blank" rel="noopener noreferrer">保险柜中的嵌套键<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>保险柜支持将键嵌套在保险柜中存储的值中的功能，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>echo -n '{&quot;appA&quot;: {&quot;secret&quot;: &quot;appAsecret&quot;}, &quot;bar&quot;: &quot;baz&quot;}' | vault write secret/myapp -
</code></pre></div><p>此命令将JSON对象写入您的保险柜。要在Spring中访问这些值，您将使用传统的dot（<code>.</code>）批注，如以下示例所示</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${appA.secret}&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>前面的代码会将<code>name</code>变量的值设置为<code>appAsecret</code>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/springcloud/SpringCloudTask.html" class="prev">
        Spring Cloud Task参考指南
      </a></span> <span class="next"><a href="/springcloud/SpringCloudNetflix.html">
        /springcloud/SpringCloudNetflix.html
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ab60294b.js" defer></script><script src="/assets/js/2.0769d472.js" defer></script><script src="/assets/js/91.4f784eb3.js" defer></script>
  </body>
</html>
