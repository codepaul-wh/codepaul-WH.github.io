<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Cloud Task参考指南 |  </title>
    <meta name="description" content=" ">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/img/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.6d3e66e0.css" as="style"><link rel="preload" href="/assets/js/app.ab60294b.js" as="script"><link rel="preload" href="/assets/js/2.0769d472.js" as="script"><link rel="preload" href="/assets/js/95.4eafa307.js" as="script"><link rel="prefetch" href="/assets/js/10.d5b488e5.js"><link rel="prefetch" href="/assets/js/100.b05fe937.js"><link rel="prefetch" href="/assets/js/101.c78118ad.js"><link rel="prefetch" href="/assets/js/11.ba7209bc.js"><link rel="prefetch" href="/assets/js/12.7eb2b639.js"><link rel="prefetch" href="/assets/js/13.319a2e91.js"><link rel="prefetch" href="/assets/js/14.fe83290c.js"><link rel="prefetch" href="/assets/js/15.8a7ec64a.js"><link rel="prefetch" href="/assets/js/16.41f2dd98.js"><link rel="prefetch" href="/assets/js/17.904bc325.js"><link rel="prefetch" href="/assets/js/18.7a6246f7.js"><link rel="prefetch" href="/assets/js/19.84ab8dd3.js"><link rel="prefetch" href="/assets/js/20.04c09d1c.js"><link rel="prefetch" href="/assets/js/21.e75a2f46.js"><link rel="prefetch" href="/assets/js/22.a14b1840.js"><link rel="prefetch" href="/assets/js/23.799a37e9.js"><link rel="prefetch" href="/assets/js/24.c3eada22.js"><link rel="prefetch" href="/assets/js/25.4f11ed3d.js"><link rel="prefetch" href="/assets/js/26.375a9c03.js"><link rel="prefetch" href="/assets/js/27.bc7c4ae2.js"><link rel="prefetch" href="/assets/js/28.2250b95c.js"><link rel="prefetch" href="/assets/js/29.f568d59e.js"><link rel="prefetch" href="/assets/js/3.79868d1c.js"><link rel="prefetch" href="/assets/js/30.f7eb4129.js"><link rel="prefetch" href="/assets/js/31.94b316c6.js"><link rel="prefetch" href="/assets/js/32.428d0721.js"><link rel="prefetch" href="/assets/js/33.6064d0ca.js"><link rel="prefetch" href="/assets/js/34.711c8d67.js"><link rel="prefetch" href="/assets/js/35.2d341b53.js"><link rel="prefetch" href="/assets/js/36.d44bf3ce.js"><link rel="prefetch" href="/assets/js/37.b6844632.js"><link rel="prefetch" href="/assets/js/38.80d006c6.js"><link rel="prefetch" href="/assets/js/39.f7bee99d.js"><link rel="prefetch" href="/assets/js/4.973e9025.js"><link rel="prefetch" href="/assets/js/40.0239e47a.js"><link rel="prefetch" href="/assets/js/41.ae2fbfaa.js"><link rel="prefetch" href="/assets/js/42.dfd29a6a.js"><link rel="prefetch" href="/assets/js/43.683daf3c.js"><link rel="prefetch" href="/assets/js/44.562e4097.js"><link rel="prefetch" href="/assets/js/45.95b98fcb.js"><link rel="prefetch" href="/assets/js/46.d96aa487.js"><link rel="prefetch" href="/assets/js/47.2aca851e.js"><link rel="prefetch" href="/assets/js/48.814b9e24.js"><link rel="prefetch" href="/assets/js/49.fe2be804.js"><link rel="prefetch" href="/assets/js/5.336b97a1.js"><link rel="prefetch" href="/assets/js/50.c5a763c1.js"><link rel="prefetch" href="/assets/js/51.41e24a47.js"><link rel="prefetch" href="/assets/js/52.6c448e60.js"><link rel="prefetch" href="/assets/js/53.8c0b5684.js"><link rel="prefetch" href="/assets/js/54.8f76ab97.js"><link rel="prefetch" href="/assets/js/55.a15238f6.js"><link rel="prefetch" href="/assets/js/56.385a70ef.js"><link rel="prefetch" href="/assets/js/57.fe5f9465.js"><link rel="prefetch" href="/assets/js/58.348704b8.js"><link rel="prefetch" href="/assets/js/59.8074fc81.js"><link rel="prefetch" href="/assets/js/6.cdc6003c.js"><link rel="prefetch" href="/assets/js/60.1886e5a2.js"><link rel="prefetch" href="/assets/js/61.8cdce743.js"><link rel="prefetch" href="/assets/js/62.ccfad9c2.js"><link rel="prefetch" href="/assets/js/63.16b1771b.js"><link rel="prefetch" href="/assets/js/64.ab84024e.js"><link rel="prefetch" href="/assets/js/65.5d7c3b7a.js"><link rel="prefetch" href="/assets/js/66.d8591a18.js"><link rel="prefetch" href="/assets/js/67.73456f7e.js"><link rel="prefetch" href="/assets/js/68.f481f8f3.js"><link rel="prefetch" href="/assets/js/69.96f25530.js"><link rel="prefetch" href="/assets/js/7.46997b0a.js"><link rel="prefetch" href="/assets/js/70.0ab0d1fd.js"><link rel="prefetch" href="/assets/js/71.dd8facc4.js"><link rel="prefetch" href="/assets/js/72.ef52962d.js"><link rel="prefetch" href="/assets/js/73.0e844bfe.js"><link rel="prefetch" href="/assets/js/74.a3f222d9.js"><link rel="prefetch" href="/assets/js/75.cbbf1e57.js"><link rel="prefetch" href="/assets/js/76.79bfac66.js"><link rel="prefetch" href="/assets/js/77.536742b4.js"><link rel="prefetch" href="/assets/js/78.44d6cb00.js"><link rel="prefetch" href="/assets/js/79.2dc3f78e.js"><link rel="prefetch" href="/assets/js/8.2825b7c8.js"><link rel="prefetch" href="/assets/js/80.30f2b7e8.js"><link rel="prefetch" href="/assets/js/81.ce007e74.js"><link rel="prefetch" href="/assets/js/82.7f8e37af.js"><link rel="prefetch" href="/assets/js/83.201b9f31.js"><link rel="prefetch" href="/assets/js/84.8e750285.js"><link rel="prefetch" href="/assets/js/85.b564c207.js"><link rel="prefetch" href="/assets/js/86.85da9ef3.js"><link rel="prefetch" href="/assets/js/87.61865fb9.js"><link rel="prefetch" href="/assets/js/88.2c3e8d72.js"><link rel="prefetch" href="/assets/js/89.2b99140f.js"><link rel="prefetch" href="/assets/js/9.2a76fd8c.js"><link rel="prefetch" href="/assets/js/90.6ede089c.js"><link rel="prefetch" href="/assets/js/91.4f784eb3.js"><link rel="prefetch" href="/assets/js/92.503a04a8.js"><link rel="prefetch" href="/assets/js/93.668a1616.js"><link rel="prefetch" href="/assets/js/94.78890e02.js"><link rel="prefetch" href="/assets/js/96.8be342d2.js"><link rel="prefetch" href="/assets/js/97.cff73008.js"><link rel="prefetch" href="/assets/js/98.2d7c9205.js"><link rel="prefetch" href="/assets/js/99.4e9998dc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6d3e66e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.png" alt=" " class="logo"> <span class="site-name can-hide"> </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SpringCloud</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/springcloud/SpringCloud文档.html" class="sidebar-link">Spring Cloud文档</a></li><li><a href="/springcloud/SpringCloud构建.html" class="sidebar-link">Spring Cloud构建</a></li><li><a href="/springcloud/springcloudcommons.html" class="sidebar-link">云原生应用</a></li><li><a href="/springcloud/SpringCloudFunction.html" class="sidebar-link">Spring Cloud Function参考文档</a></li><li><a href="/springcloud/SpringCloudStream.html" class="sidebar-link">Spring Cloud Stream参考文档</a></li><li><a href="/springcloud/SpringCloudAWS.html" class="sidebar-link">Spring Cloud AWS</a></li><li><a href="/springcloud/SpringCloudBus.html" class="sidebar-link">Spring Cloud Bus</a></li><li><a href="/springcloud/SpringCloudTask.html" class="active sidebar-link">Spring Cloud Task参考指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_1-关于文档" class="sidebar-link">1.关于文档</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_2-获得帮助" class="sidebar-link">2.获得帮助</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_3-第一步" class="sidebar-link">3.第一步</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_4-介绍spring-cloud-task" class="sidebar-link">4.介绍Spring Cloud Task</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_5-系统要求" class="sidebar-link">5.系统要求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_5-1。数据库要求" class="sidebar-link">5.1。数据库要求</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_6-开发您的第一个spring-cloud-task应用程序" class="sidebar-link">6.开发您的第一个Spring Cloud Task应用程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_6-1。使用spring-initializr创建spring-task项目" class="sidebar-link">6.1。使用Spring Initializr创建Spring Task项目</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_6-2。编写代码" class="sidebar-link">6.2。编写代码</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_6-3。运行示例" class="sidebar-link">6.3。运行示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_7-spring-cloud-task的生命周期" class="sidebar-link">7. Spring Cloud Task的生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_7-1。任务执行" class="sidebar-link">7.1。任务执行</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_7-2。映射退出代码" class="sidebar-link">7.2。映射退出代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-配置" class="sidebar-link">8.配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-1。数据源" class="sidebar-link">8.1。数据源</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-2。表前缀" class="sidebar-link">8.2。表前缀</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-3。启用-禁用表初始化" class="sidebar-link">8.3。启用/禁用表初始化</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-4。外部生成的任务id" class="sidebar-link">8.4。外部生成的任务ID</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-5。外部任务id" class="sidebar-link">8.5。外部任务ID</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-6。父任务id" class="sidebar-link">8.6。父任务ID</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-7。taskconfigurer" class="sidebar-link">8.7。TaskConfigurer</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-8。任务名称" class="sidebar-link">8.8。任务名称</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-9。任务执行监听器" class="sidebar-link">8.9。任务执行监听器</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-10。限制spring-cloud任务实例" class="sidebar-link">8.10。限制Spring Cloud任务实例</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_8-11。禁用spring-cloud-task自动配置" class="sidebar-link">8.11。禁用Spring Cloud Task自动配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_9-将作业执行与执行该作业的任务相关联" class="sidebar-link">9.将作业执行与执行该作业的任务相关联</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_9-1。覆盖taskbatchexecutionlistener" class="sidebar-link">9.1。覆盖TaskBatchExecutionListener</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_10-远程分区" class="sidebar-link">10.远程分区</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_10-1。关于为kubernetes平台开发批处理分区的应用程序的注意事项" class="sidebar-link">10.1。关于为Kubernetes平台开发批处理分区的应用程序的注意事项</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_10-2。有关为cloud-foundry平台开发批处理分区的应用程序的说明" class="sidebar-link">10.2。有关为Cloud Foundry平台开发批处理分区的应用程序的说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_11-批处理参考消息" class="sidebar-link">11.批处理参考消息</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_12-批处理作业退出代码" class="sidebar-link">12.批处理作业退出代码</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_13-从spring-cloud-stream启动任务" class="sidebar-link">13.从Spring Cloud Stream启动任务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_13-1。spring-cloud数据流" class="sidebar-link">13.1。Spring Cloud数据流</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_14-spring-cloud-task事件" class="sidebar-link">14. Spring Cloud Task事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_14-1。禁用特定任务事件" class="sidebar-link">14.1。禁用特定任务事件</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_15-春季批处理活动" class="sidebar-link">15.春季批处理活动</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_15-1。将批次事件发送到不同的渠道" class="sidebar-link">15.1。将批次事件发送到不同的渠道</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_15-2。禁用批处理事件" class="sidebar-link">15.2。禁用批处理事件</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_15-3。发出批量事件的订单" class="sidebar-link">15.3。发出批量事件的订单</a></li></ul></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_16-任务库模式" class="sidebar-link">16.任务库模式</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_17-构建此文档" class="sidebar-link">17.构建此文档</a></li><li class="sidebar-sub-header"><a href="/springcloud/SpringCloudTask.html#_18-在cloud-foundry上运行task-app" class="sidebar-link">18.在Cloud Foundry上运行Task App</a></li></ul></li><li><a href="/springcloud/SpringCloudConfig.html" class="sidebar-link">Spring Cloud Config</a></li><li><a href="/springcloud/SpringCloudNetflix.html" class="sidebar-link">/springcloud/SpringCloudNetflix.html</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-cloud-task参考指南"><a href="#spring-cloud-task参考指南" class="header-anchor">#</a> Spring Cloud Task参考指南</h1> <h1 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h1> <p>本节简要概述了Spring Cloud Task参考文档。可以将其视为文档其余部分的地图。您可以线性阅读本参考指南，或者如果您不感兴趣，可以跳过本节。</p> <h2 id="_1-关于文档"><a href="#_1-关于文档" class="header-anchor">#</a> 1.关于文档</h2> <p>Spring Cloud Task参考指南提供<a href="https://docs.spring.io/spring-cloud-task/docs/%7Bversion%7D/reference/html" target="_blank" rel="noopener noreferrer">html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>， <a href="https://docs.spring.io/spring-cloud-task/docs/%7Bversion%7D/reference/pdf/spring-cloud-task-reference.pdf" target="_blank" rel="noopener noreferrer">pdf<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和<a href="https://docs.spring.io/spring-cloud-task/docs/%7Bversion%7D/reference/epub/spring-cloud-task-reference.epub" target="_blank" rel="noopener noreferrer">epub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>格式。最新副本位于<a href="https://docs.spring.io/spring-cloud-task/docs/current-SNAPSHOT/reference/html/" target="_blank" rel="noopener noreferrer">docs.spring.io/spring-cloud-task/docs/current-SNAPSHOT/reference/html/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>本文档的副本可以供您自己使用，也可以分发给其他人，但前提是您不对此类副本收取任何费用，并且还应确保每份副本均包含本版权声明，无论是印刷版本还是电子版本。</p> <h2 id="_2-获得帮助"><a href="#_2-获得帮助" class="header-anchor">#</a> 2.获得帮助</h2> <p>Spring Cloud Task遇到问题了吗？我们希望为您提供帮助！</p> <ul><li>问一个问题。我们监视<a href="https://stackoverflow.com/" target="_blank" rel="noopener noreferrer">stackoverflow.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上是否有标记为的问题<a href="https://stackoverflow.com/tags/spring-cloud-task" target="_blank" rel="noopener noreferrer"><code>spring-cloud-task</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li> <li>在<a href="https://github.com/spring-cloud/spring-cloud-task/issues" target="_blank" rel="noopener noreferrer">github.com/spring-cloud/spring-cloud-task/issues上<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>报告Spring Cloud Task的 <a href="https://github.com/spring-cloud/spring-cloud-task/issues" target="_blank" rel="noopener noreferrer">错误<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>所有Spring Cloud Task都是开源的，包括文档。如果您发现文档有问题，或者只想改进文档，请<a href="https://github.com/spring-cloud/spring-cloud-task/tree/master" target="_blank" rel="noopener noreferrer">参与其中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h2 id="_3-第一步"><a href="#_3-第一步" class="header-anchor">#</a> 3.第一步</h2> <p>如果您只是刚开始使用Spring Cloud Task或一般使用“ Spring”，我们建议阅读“ <a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#getting-started" target="_blank" rel="noopener noreferrer">入门”<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>一章。</p> <p>要从头开始，请阅读以下部分：*“ <a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#getting-started-introducing-spring-cloud-task" target="_blank" rel="noopener noreferrer">Spring Cloud Task简介<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ” *“ <a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#getting-started-system-requirements" target="_blank" rel="noopener noreferrer">系统要求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”要遵循该教程，请阅读“ <a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#getting-started-developing-first-task" target="_blank" rel="noopener noreferrer">开发第一个Spring Cloud Task应用程序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”以运行示例，请阅读“ <a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#getting-started-running-the-example" target="_blank" rel="noopener noreferrer">运行示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”</p> <h1 id="入门"><a href="#入门" class="header-anchor">#</a> 入门</h1> <p>如果您刚刚开始使用Spring Cloud Task，则应阅读本节。在这里，我们回答基本的“什么？”，“如何？”和“为什么？”问题。我们从对Spring Cloud Task的简要介绍开始。然后，我们构建一个Spring Cloud Task应用程序，并讨论一些核心原理。</p> <h2 id="_4-介绍spring-cloud-task"><a href="#_4-介绍spring-cloud-task" class="header-anchor">#</a> 4.介绍Spring Cloud Task</h2> <p>Spring Cloud Task使创建短暂的微服务变得容易。它提供的功能可以让短期JVM进程在生产环境中按需执行。</p> <h2 id="_5-系统要求"><a href="#_5-系统要求" class="header-anchor">#</a> 5.系统要求</h2> <p>您需要安装Java（Java 8或更高版本）。要进行构建，您还需要安装Maven。</p> <h3 id="_5-1。数据库要求"><a href="#_5-1。数据库要求" class="header-anchor">#</a> 5.1。数据库要求</h3> <p>Spring Cloud Task使用关系数据库来存储已执行任务的结果。尽管您可以在没有数据库的情况下开始开发任务（任务状态记录为任务存储库更新的一部分），但对于生产环境，您希望使用受支持的数据库。Spring Cloud Task当前支持以下数据库：</p> <ul><li>DB2</li> <li>H2</li> <li>数据库</li> <li>MySQL的</li> <li>甲骨文</li> <li>Postgres</li> <li>SQL服务器</li></ul> <h2 id="_6-开发您的第一个spring-cloud-task应用程序"><a href="#_6-开发您的第一个spring-cloud-task应用程序" class="header-anchor">#</a> 6.开发您的第一个Spring Cloud Task应用程序</h2> <p>一个不错的起点是使用一个简单的“ Hello，World！”应用程序，因此我们创建了等效于突出显示框架功能的Spring Cloud Task。大多数IDE对Apache Maven都有很好的支持，因此我们将其用作该项目的构建工具。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>spring.io网站包含许多使用Spring Boot的<a href="https://spring.io/guides" target="_blank" rel="noopener noreferrer">“ <code>Getting Started</code>”指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果您需要解决特定的问题，请首先检查。您可以转到<a href="https://start.spring.io/" target="_blank" rel="noopener noreferrer">Spring Initializr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>并创建一个新项目，以简化以下步骤 。这样做会自动生成一个新的项目结构，以便您可以立即开始编码。我们建议尝试使用Spring Initializr来熟悉它。</p></div> <h3 id="_6-1。使用spring-initializr创建spring-task项目"><a href="#_6-1。使用spring-initializr创建spring-task项目" class="header-anchor">#</a> 6.1。使用Spring Initializr创建Spring Task项目</h3> <p>现在，我们可以创建和测试可打印<code>Hello, World!</code>到控制台的应用程序。</p> <p>为此：</p> <ol><li>访问<a href="https://start.spring.io/" target="_blank" rel="noopener noreferrer">Spring Initialzr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>网站。
<ol><li>创建一个新的Maven项目，其<strong>组</strong>名称为<code>io.spring.demo</code>，<strong>工件</strong>名称为<code>helloworld</code>。</li> <li>在“依赖关系”文本框中，键入<code>task</code>然后选择<code>Cloud Task</code>依赖关系。</li> <li>在“依赖关系”文本框中，键入<code>jdbc</code>然后选择<code>JDBC</code>依赖关系。</li> <li>在“依赖关系”文本框中，键入<code>h2</code>，然后选择<code>H2</code>。（或您喜欢的数据库）</li> <li>单击<strong>生成项目</strong>按钮</li></ol></li> <li>解压缩helloworld.zip文件并将项目导入到您喜欢的IDE中。</li></ol> <h3 id="_6-2。编写代码"><a href="#_6-2。编写代码" class="header-anchor">#</a> 6.2。编写代码</h3> <p>要完成我们的应用程序，我们需要<code>HelloworldApplication</code>使用以下内容更新生成的内容，以便启动任务。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>helloworld</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot</span><span class="token punctuation">.</span><span class="token class-name">CommandLineRunner</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot</span><span class="token punctuation">.</span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure</span><span class="token punctuation">.</span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Bean</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloworldApplication</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">CommandLineRunner</span> <span class="token function">commandLineRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HelloWorldCommandLineRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">HelloworldApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldCommandLineRunner</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>

		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> strings<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>尽管它看起来很小，但仍在继续。有关Spring Boot的详细信息，请参阅 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/" target="_blank" rel="noopener noreferrer">Spring Boot参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>现在我们可以在中打开<code>application.properties</code>文件<code>src/main/resources</code>。我们需要在中配置两个属性<code>application.properties</code>：</p> <ul><li><code>application.name</code>：设置应用程序名称（转换为任务名称）</li> <li><code>logging.level</code>：将Spring Cloud Task的日志记录设置为以<code>DEBUG</code>了解正在发生的事情。</li></ul> <p>以下示例显示了如何同时执行这两项操作：</p> <div class="language- extra-class"><pre class="language-text"><code>logging.level.org.springframework.cloud.task=DEBUG
spring.application.name=helloWorld
</code></pre></div><h4 id="_6-2-1。任务自动配置"><a href="#_6-2-1。任务自动配置" class="header-anchor">#</a> 6.2.1。任务自动配置</h4> <p>当包含Spring Cloud Task Starter依赖项时，Task会自动配置所有bean以引导其功能。此配置的一部分注册<code>TaskRepository</code>以及用于其使用的基础结构。</p> <p>在我们的演示中，<code>TaskRepository</code>使用嵌入式H2数据库记录任务的结果。这个H2嵌入式数据库不是针对生产环境的实用解决方案，因为一旦任务结束，H2 DB就会消失。但是，为了获得快速入门的经验，我们可以在示例中使用此方法，并在日志中回显该存储库中正在更新的内容。在“ <a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#features-configuration" target="_blank" rel="noopener noreferrer">配置”<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>部分（本文档后面的内容）中，我们介绍了如何自定义Spring Cloud Task提供的组件的配置。</p> <p>当我们的示例应用程序运行时，Spring Boot启动我们的<code>HelloWorldCommandLineRunner</code> 并输出“ Hello，World！”消息到标准输出。该<code>TaskLifecycleListener</code> 记录任务的启动和资源库中的任务结束。</p> <h4 id="_6-2-2。主要方法"><a href="#_6-2-2。主要方法" class="header-anchor">#</a> 6.2.2。主要方法</h4> <p>main方法用作任何Java应用程序的入口点。我们的主要方法委托给Spring Boot的<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-spring-application.html" target="_blank" rel="noopener noreferrer">SpringApplication<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>类。</p> <h4 id="_6-2-3。commandlinerunner"><a href="#_6-2-3。commandlinerunner" class="header-anchor">#</a> 6.2.3。CommandLineRunner</h4> <p>Spring提供了许多引导应用程序逻辑的方法。Spring Boot通过其<code>*Runner</code>接口（<code>CommandLineRunner</code>或<code>ApplicationRunner</code>）以一种有组织的方式提供了一种方便的方法。行为良好的任务可以使用这两个运行程序之一来引导任何逻辑。</p> <p>从<code>*Runner#run</code>执行方法到完成所有方法，都要考虑任务的生命周期。Spring Boot <code>*Runner</code>和Spring Cloud Task一样，允许应用程序使用多种 实现。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>从除<code>CommandLineRunner</code>或 <code>ApplicationRunner</code>（<code>InitializingBean#afterPropertiesSet</code>例如，使用）以外的机制引导的任何处理都不会被Spring Cloud Task记录。</p></div> <h3 id="_6-3。运行示例"><a href="#_6-3。运行示例" class="header-anchor">#</a> 6.3。运行示例</h3> <p>此时，我们的应用程序应该可以工作了。由于此应用程序是基于Spring Boot的，因此我们可以从<code>$ mvn spring-boot:run</code>应用程序的根目录使用命令行来运行它，如以下示例所示（及其输出）：</p> <div class="language- extra-class"><pre class="language-text"><code>$ mvn clean spring-boot:run
....... . . .
....... . . . (Maven log output here)
....... . . .

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.0.3.RELEASE)

2018-07-23 17:44:34.426  INFO 1978 --- [           main] i.s.d.helloworld.HelloworldApplication   : Starting HelloworldApplication on Glenns-MBP-2.attlocal.net with PID 1978 (/Users/glennrenfro/project/helloworld/target/classes started by glennrenfro in /Users/glennrenfro/project/helloworld)
2018-07-23 17:44:34.430  INFO 1978 --- [           main] i.s.d.helloworld.HelloworldApplication   : No active profile set, falling back to default profiles: default
2018-07-23 17:44:34.472  INFO 1978 --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@1d24f32d: startup date [Mon Jul 23 17:44:34 EDT 2018]; root of context hierarchy
2018-07-23 17:44:35.280  INFO 1978 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2018-07-23 17:44:35.410  INFO 1978 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2018-07-23 17:44:35.419 DEBUG 1978 --- [           main] o.s.c.t.c.SimpleTaskConfiguration        : Using org.springframework.cloud.task.configuration.DefaultTaskConfigurer TaskConfigurer
2018-07-23 17:44:35.420 DEBUG 1978 --- [           main] o.s.c.t.c.DefaultTaskConfigurer          : No EntityManager was found, using DataSourceTransactionManager
2018-07-23 17:44:35.522 DEBUG 1978 --- [           main] o.s.c.t.r.s.TaskRepositoryInitializer    : Initializing task schema for h2 database
2018-07-23 17:44:35.525  INFO 1978 --- [           main] o.s.jdbc.datasource.init.ScriptUtils     : Executing SQL script from class path resource [org/springframework/cloud/task/schema-h2.sql]
2018-07-23 17:44:35.558  INFO 1978 --- [           main] o.s.jdbc.datasource.init.ScriptUtils     : Executed SQL script from class path resource [org/springframework/cloud/task/schema-h2.sql] in 33 ms.
2018-07-23 17:44:35.728  INFO 1978 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup
2018-07-23 17:44:35.730  INFO 1978 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Bean with name 'dataSource' has been autodetected for JMX exposure
2018-07-23 17:44:35.733  INFO 1978 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Located MBean 'dataSource': registering with JMX server as MBean [com.zaxxer.hikari:name=dataSource,type=HikariDataSource]
2018-07-23 17:44:35.738  INFO 1978 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0
2018-07-23 17:44:35.762 DEBUG 1978 --- [           main] o.s.c.t.r.support.SimpleTaskRepository   : Creating: TaskExecution{executionId=0, parentExecutionId=null, exitCode=null, taskName='application', startTime=Mon Jul 23 17:44:35 EDT 2018, endTime=null, exitMessage='null', externalExecutionId='null', errorMessage='null', arguments=[]}
2018-07-23 17:44:35.772  INFO 1978 --- [           main] i.s.d.helloworld.HelloworldApplication   : Started HelloworldApplication in 1.625 seconds (JVM running for 4.764)
Hello, World!
2018-07-23 17:44:35.782 DEBUG 1978 --- [           main] o.s.c.t.r.support.SimpleTaskRepository   : Updating: TaskExecution with executionId=1 with the following {exitCode=0, endTime=Mon Jul 23 17:44:35 EDT 2018, exitMessage='null', errorMessage='null'}
</code></pre></div><p>前面的输出包含我们感兴趣的三行：</p> <ul><li><code>SimpleTaskRepository</code>在中记录了条目的创建<code>TaskRepository</code>。</li> <li><code>CommandLineRunner</code>“ Hello，World！”输出演示了我们的执行。</li> <li><code>SimpleTaskRepository</code>将任务的完成记录在中<code>TaskRepository</code>。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在<a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/timestamp" target="_blank" rel="noopener noreferrer">此处<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的Spring Cloud Task Project的示例模块中可以找到一个简单的任务应用程序 。</p></div> <h1 id="特征"><a href="#特征" class="header-anchor">#</a> 特征</h1> <p>本节将详细介绍Spring Cloud Task，包括如何使用它，如何配置它以及适当的扩展点。</p> <h2 id="_7-spring-cloud-task的生命周期"><a href="#_7-spring-cloud-task的生命周期" class="header-anchor">#</a> 7. Spring Cloud Task的生命周期</h2> <p>在大多数情况下，现代云环境是围绕执行不会终止的流程而设计的。如果确实结束，则通常会重新启动它们。尽管大多数平台确实具有某种方式来运行在结束时不会重新启动的进程，但是通常不会以消耗性的方式维护该运行的结果。Spring Cloud Task提供了在环境中执行短暂流程并记录结果的功能。这样做可以通过消息的任务集成，围绕短暂的流程以及运行时间更长的服务建立微服务架构。</p> <p>尽管此功能在云环境中很有用，但在传统部署模型中也会出现相同的问题。当使用调度程序（例如cron）运行Spring Boot应用程序时，能够在应用程序完成后监视其结果很有用。</p> <p>Spring Cloud Task采用了一种方法，即Spring Boot应用程序可以有一个开始和结束，并且仍然可以成功。批处理应用程序是一个预期的过程（通常是短暂的）可能如何有所帮助的示例。</p> <p>Spring Cloud Task记录给定任务的生命周期事件。大多数Web应用程序代表的大多数长时间运行的进程不会保存其生命周期事件。Spring Cloud Task的核心任务可以做到。</p> <p>生命周期由单个任务执行组成。这是配置为任务的Spring Boot应用程序的物理执行（也就是说，它具有Sprint Cloud Task依赖项）。</p> <p>在任务的开始，之前的任何<code>CommandLineRunner</code>或<code>ApplicationRunner</code> 实现已运行，在一个条目<code>TaskRepository</code>被创建，记录开始事件。该事件是<code>SmartLifecycle#start</code>由Spring框架触发的。这向系统指示所有Bean都已准备就绪，并且在运行Spring Boot提供的任何<code>CommandLineRunner</code>或<code>ApplicationRunner</code>实现之前已经存在。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>任务的记录仅在成功引导 <code>ApplicationContext</code>。如果上下文根本无法引导，则不会记录任务的运行。</p></div> <p>在完成<code>*Runner#run</code>Spring Boot 的所有调用或失败后 <code>ApplicationContext</code>（由表示<code>ApplicationFailedEvent</code>），任务执行将在存储库中更新并显示结果。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果应用程序要求<code>ApplicationContext</code>在完成任务时关闭该应用程序（<code>*Runner#run</code>已调用所有方法并且已更新任务存储库），请将属性设置<code>spring.cloud.task.closecontext_enabled</code> 为true。</p></div> <h3 id="_7-1。任务执行"><a href="#_7-1。任务执行" class="header-anchor">#</a> 7.1。任务执行</h3> <p>存储在中的信息在该类中<code>TaskRepository</code>建模，<code>TaskExecution</code>并包含以下信息：</p> <table><thead><tr><th style="text-align:left;">领域</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>executionid</code></td> <td style="text-align:left;">任务运行的唯一ID。</td></tr> <tr><td style="text-align:left;"><code>exitCode</code></td> <td style="text-align:left;">从<code>ExitCodeExceptionMapper</code>实现生成的退出代码。如果没有生成退出代码，但是<code>ApplicationFailedEvent</code>抛出，则设置为1。否则，假定为0。</td></tr> <tr><td style="text-align:left;"><code>taskName</code></td> <td style="text-align:left;">任务的名称，由configure决定<code>TaskNameResolver</code>。</td></tr> <tr><td style="text-align:left;"><code>startTime</code></td> <td style="text-align:left;">如<code>SmartLifecycle#start</code>呼叫所示，任务开始的时间。</td></tr> <tr><td style="text-align:left;"><code>endTime</code></td> <td style="text-align:left;">任务完成的时间，如所示<code>ApplicationReadyEvent</code>。</td></tr> <tr><td style="text-align:left;"><code>exitMessage</code></td> <td style="text-align:left;">退出时可用的任何信息。可以通过编程设置 <code>TaskExecutionListener</code>。</td></tr> <tr><td style="text-align:left;"><code>errorMessage</code></td> <td style="text-align:left;">如果异常是导致任务结束的原因（如所示 <code>ApplicationFailedEvent</code>），则该异常的堆栈跟踪存储在此处。</td></tr> <tr><td style="text-align:left;"><code>arguments</code></td> <td style="text-align:left;"><code>List</code>传递给可执行启动应用程序的字符串命令行参数A。</td></tr></tbody></table> <h3 id="_7-2。映射退出代码"><a href="#_7-2。映射退出代码" class="header-anchor">#</a> 7.2。映射退出代码</h3> <p>任务完成后，它将尝试将退出代码返回到OS。如果我们看一下<a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#getting-started-developing-first-task" target="_blank" rel="noopener noreferrer">原始示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，我们可以看到我们没有控制应用程序的这一方面。因此，如果引发异常，则JVM返回的代码在调试时可能会有用，也可能不会有用。</p> <p>因此，Spring Boot提供了一个接口，<code>ExitCodeExceptionMapper</code>使您可以将未捕获的异常映射到退出代码。这样做可以让您在退出代码级别指示出了什么问题。另外，通过以这种方式映射退出代码，Spring Cloud Task记录返回的退出代码。</p> <p>如果任务以SIG-INT或SIG-TERM终止，则除非代码中另外指定，否则退出代码为零。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>任务运行时，退出代码在存储库中存储为null。任务完成后，将根据本节前面介绍的准则存储适当的退出代码。</p></div> <h2 id="_8-配置"><a href="#_8-配置" class="header-anchor">#</a> 8.配置</h2> <p>Spring Cloud Task提供了<code>DefaultTaskConfigurer</code>和<code>SimpleTaskConfiguration</code>类中定义的即用型配置 。本节详细介绍了默认值以及如何根据需要自定义Spring Cloud Task。</p> <h3 id="_8-1。数据源"><a href="#_8-1。数据源" class="header-anchor">#</a> 8.1。数据源</h3> <p>Spring Cloud Task使用数据源来存储任务执行的结果。默认情况下，我们提供了一个H2的内存实例，以提供一种引导开发的简单方法。但是，在生产环境中，您可能需要配置自己的<code>DataSource</code>。</p> <p>如果您的应用程序仅使用一个，<code>DataSource</code>并且既用作您的业务架构又用作任务存储库，那么您所需要做的就是提供任何内容<code>DataSource</code>（最简单的方法是通过Spring Boot的配置约定）。这 <code>DataSource</code>是自动存储库使用春云任务。</p> <p>如果您的应用程序使用多个应用程序<code>DataSource</code>，则需要使用适当的配置任务存储库<code>DataSource</code>。可以通过实现来实现这种自定义<code>TaskConfigurer</code>。</p> <h3 id="_8-2。表前缀"><a href="#_8-2。表前缀" class="header-anchor">#</a> 8.2。表前缀</h3> <p>的一个可修改属性<code>TaskRepository</code>是任务表的表前缀。默认情况下，它们都以开头<code>TASK_</code>。<code>TASK_EXECUTION</code>和<code>TASK_EXECUTION_PARAMS</code> 是两个例子。但是，存在修改此前缀的潜在原因。如果需要在表名称之前添加模式名称，或者在同一模式中需要多个任务表，则必须更改表前缀。您可以将设置<code>spring.cloud.task.tablePrefix</code>为所需的前缀，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.task.tablePrefix=yourPrefix
</code></pre></div><h3 id="_8-3。启用-禁用表初始化"><a href="#_8-3。启用-禁用表初始化" class="header-anchor">#</a> 8.3。启用/禁用表初始化</h3> <p>如果您正在创建任务表，并且不希望Spring Cloud Task在任务启动时创建它们，请将<code>spring.cloud.task.initialize-enabled</code>属性设置为 <code>false</code>，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.task.initialize-enabled=false
</code></pre></div><p>默认为<code>true</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>该属性<code>spring.cloud.task.initialize.enable</code>已弃用。</p></div> <h3 id="_8-4。外部生成的任务id"><a href="#_8-4。外部生成的任务id" class="header-anchor">#</a> 8.4。外部生成的任务ID</h3> <p>在某些情况下，您可能需要考虑请求任务与基础结构实际启动任务之间的时间差。Spring Cloud Task可让您<code>TaskExecution</code>在请求任务时创建一个。然后将生成的执行ID传递<code>TaskExecution</code>给任务，以便它可以更新<code>TaskExecution</code>任务的整个生命周期。</p> <div class="language- extra-class"><pre class="language-text"><code>TaskExecution`可以通过在引用保存对象的数据存储区`createTaskExecution`的实现上调用方法来创建A。`TaskRepository``TaskExecution
</code></pre></div><p>为了将您的任务配置为使用generate <code>TaskExecutionId</code>，请添加以下属性：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.task.executionid=yourtaskId
</code></pre></div><h3 id="_8-5。外部任务id"><a href="#_8-5。外部任务id" class="header-anchor">#</a> 8.5。外部任务ID</h3> <p>Spring Cloud Task允许您为每个存储一个外部任务ID <code>TaskExecution</code>。一个示例是在平台上启动任务时由Cloud Foundry提供的任务ID。为了将您的任务配置为使用generate <code>TaskExecutionId</code>，请添加以下属性：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.task.external-execution-id=&lt;externalTaskId&gt;
</code></pre></div><h3 id="_8-6。父任务id"><a href="#_8-6。父任务id" class="header-anchor">#</a> 8.6。父任务ID</h3> <p>Spring Cloud Task可让您存储每个任务的父任务ID <code>TaskExecution</code>。一个示例就是执行另一个任务或多个任务的任务，并且您想记录哪个任务启动了每个子任务。为了配置您的任务以设置父 <code>TaskExecutionId</code>项，请在子任务上添加以下属性：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.task.parent-execution-id=&lt;parentExecutionTaskId&gt;
</code></pre></div><h3 id="_8-7。taskconfigurer"><a href="#_8-7。taskconfigurer" class="header-anchor">#</a> 8.7。TaskConfigurer</h3> <p>这<code>TaskConfigurer</code>是一个策略界面，可让您自定义Spring Cloud Task组件的配置方式。默认情况下，我们提供<code>DefaultTaskConfigurer</code>提供逻辑默认值的：<code>Map</code>基于内存的组件（如果未<code>DataSource</code>提供，则对开发有用 ）和基于JDBC的组件（如果有<code>DataSource</code> 可用，则有用）。</p> <p>将<code>TaskConfigurer</code>允许您配置三个主要组成部分：</p> <table><thead><tr><th style="text-align:left;">零件</th> <th style="text-align:left;">描述</th> <th style="text-align:left;">默认值（由提供<code>DefaultTaskConfigurer</code>）</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>TaskRepository</code></td> <td style="text-align:left;">执行<code>TaskRepository</code>要使用的。</td> <td style="text-align:left;"><code>SimpleTaskRepository</code></td></tr> <tr><td style="text-align:left;"><code>TaskExplorer</code></td> <td style="text-align:left;">使用的实现<code>TaskExplorer</code>（用于只读访问任务存储库的组件）。</td> <td style="text-align:left;"><code>SimpleTaskExplorer</code></td></tr> <tr><td style="text-align:left;"><code>PlatformTransactionManager</code></td> <td style="text-align:left;">在运行任务更新时要使用的事务管理器。</td> <td style="text-align:left;"><code>DataSourceTransactionManager</code>如果使用a <code>DataSource</code>。 <code>ResourcelessTransactionManager</code>如果不是这样。</td></tr></tbody></table> <p>您可以通过创建<code>TaskConfigurer</code>接口的自定义实现来自定义上表中描述的任何组件。通常，扩展 <code>DefaultTaskConfigurer</code>（如果<code>TaskConfigurer</code>未找到a时提供）并覆盖所需的吸气剂就足够了。但是，可能需要从头开始实现。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>用户不应直接使用直接的getter方法，<code>TaskConfigurer</code>除非他们使用它来提供要作为Spring Beans公开的实现。</p></div> <h3 id="_8-8。任务名称"><a href="#_8-8。任务名称" class="header-anchor">#</a> 8.8。任务名称</h3> <p>在大多数情况下，任务的名称是Spring Boot中配置的应用程序名称。但是，在某些情况下，您可能希望将任务的运行映射到其他名称。Spring Cloud Data Flow就是这样的一个示例（因为您可能希望使用任务定义的名称来运行任务）。因此，我们提供了通过<code>TaskNameResolver</code>界面自定义任务命名方式的功能。</p> <p>默认情况下，Spring Cloud Task提供<code>SimpleTaskNameResolver</code>，使用以下选项（按优先顺序）：</p> <ol><li>一个Spring Boot属性（以Spring Boot允许的任何方式配置）称为 <code>spring.cloud.task.name</code>。</li> <li>使用Spring Boot的规则解析的应用程序名称（通过获得 <code>ApplicationContext#getId</code>）。</li></ol> <h3 id="_8-9。任务执行监听器"><a href="#_8-9。任务执行监听器" class="header-anchor">#</a> 8.9。任务执行监听器</h3> <p><code>TaskExecutionListener</code>使您可以注册侦听器，以了解在任务生命周期中发生的特定事件。为此，创建一个实现该<code>TaskExecutionListener</code>接口的类 。<code>TaskExecutionListener</code> 通知以下事件通知实现该接口的类：</p> <ul><li><code>onTaskStartup</code>：将储存<code>TaskExecution</code>到之前<code>TaskRepository</code>。</li> <li><code>onTaskEnd</code>：在更新中的<code>TaskExecution</code>条目<code>TaskRepository</code>并标记任务的最终状态之前。</li> <li><code>onTaskFailed</code>：在<code>onTaskEnd</code>任务引发未处理的异常时，在调用方法之前。</li></ul> <p>Spring Cloud Task还允许您<code>TaskExecution</code>通过使用以下方法注释将侦听器添加到Bean中的方法：</p> <ul><li><code>@BeforeTask</code>：将储存<code>TaskExecution</code>到之前<code>TaskRepository</code></li> <li><code>@AfterTask</code>：在 标记<code>TaskExecution</code>条目<code>TaskRepository</code>的最终状态之前，在更新条目之前。</li> <li><code>@FailedTask</code>：在<code>@AfterTask</code>任务引发未处理的异常时，在调用方法之前。</li></ul> <p>以下示例显示了正在使用的三个注释：</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@BeforeTask</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodA</span><span class="token punctuation">(</span><span class="token class-name">TaskExecution</span> taskExecution<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@AfterTask</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodB</span><span class="token punctuation">(</span><span class="token class-name">TaskExecution</span> taskExecution<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@FailedTask</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">methodC</span><span class="token punctuation">(</span><span class="token class-name">TaskExecution</span> taskExecution<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>ApplicationListener</code>在链中 插入比<code>TaskLifecycleListener</code>存在的链更早的链可能会导致意外的后果。</p></div> <h4 id="_8-9-1。任务执行侦听器引发的异常"><a href="#_8-9-1。任务执行侦听器引发的异常" class="header-anchor">#</a> 8.9.1。任务执行侦听器引发的异常</h4> <p>如果<code>TaskExecutionListener</code>事件处理程序引发了异常，则该事件处理程序的所有侦听器处理都将停止。例如，如果<code>onTaskStartup</code>启动了三个侦听器，并且第一个<code>onTaskStartup</code>事件处理程序引发异常，<code>onTaskStartup</code>则不会调用其他两个方法。但是，会调用的其他事件处理程序（<code>onTaskEnd</code> 和<code>onTaskFailed</code>）<code>TaskExecutionListeners</code>。</p> <p><code>TaskExecutionListener</code> 事件处理程序引发异常时返回的退出代码是<a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/ExitCodeEvent.html" target="_blank" rel="noopener noreferrer">ExitCodeEvent<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>报告的退出代码 。如果未<code>ExitCodeEvent</code>发出，则对抛出的Exception进行评估，以查看其是否为<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-application-exit" target="_blank" rel="noopener noreferrer">ExitCodeGenerator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>类型 。如果是这样，它将返回的退出代码<code>ExitCodeGenerator</code>。否则，<code>1</code> 返回。</p> <p>如果<code>onTaskStartup</code>方法中抛出异常，则应用程序的退出代码将为<code>1</code>。如果在<code>onTaskEnd</code>或<code>onTaskFailed</code> 方法中引发了异常，则应用程序的退出代码将是使用上面列举的规则建立的退出代码。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在例外的情况下，在被抛出<code>onTaskStartup</code>，<code>onTaskEnd</code>或<code>onTaskFailed</code> 不能覆盖使用应用程序的退出代码<code>ExitCodeExceptionMapper</code>。</p></div> <h4 id="_8-9-2。退出讯息"><a href="#_8-9-2。退出讯息" class="header-anchor">#</a> 8.9.2。退出讯息</h4> <p>您可以使用来以编程方式为任务设置退出消息 <code>TaskExecutionListener</code>。这是通过设置来完成的<code>TaskExecution’s</code> <code>exitMessage</code>，然后将其传递到中<code>TaskExecutionListener</code>。以下示例显示了一个带有注释的方法<code>@AfterTask</code> <code>ExecutionListener</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@AfterTask</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterMe</span><span class="token punctuation">(</span><span class="token class-name">TaskExecution</span> taskExecution<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    taskExecution<span class="token punctuation">.</span><span class="token function">setExitMessage</span><span class="token punctuation">(</span><span class="token string">&quot;AFTER EXIT MESSAGE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一个<code>ExitMessage</code>可以在任何监听事件的设定（<code>onTaskStartup</code>， <code>onTaskFailed</code>，和<code>onTaskEnd</code>）。三个侦听器的优先顺序如下：</p> <ol><li><code>onTaskEnd</code></li> <li><code>onTaskFailed</code></li> <li><code>onTaskStartup</code></li></ol> <p>例如，如果您<code>exitMessage</code>为<code>onTaskStartup</code>和<code>onTaskFailed</code> 侦听器设置，并且任务没有失败而结束，则<code>exitMessage</code>from中的from将<code>onTaskStartup</code> 存储在资源库中。否则，如果发生故障，将存储<code>exitMessage</code>from中的<code>onTaskFailed</code>。此外，如果你设置的<code>exitMessage</code>与 <code>onTaskEnd</code>听众的<code>exitMessage</code>距离<code>onTaskEnd</code>从两取代了退出消息<code>onTaskStartup</code>和<code>onTaskFailed</code>。</p> <h3 id="_8-10。限制spring-cloud任务实例"><a href="#_8-10。限制spring-cloud任务实例" class="header-anchor">#</a> 8.10。限制Spring Cloud任务实例</h3> <p>Spring Cloud Task使您可以确定一次只能运行一个具有给定任务名称的任务。为此，您需要建立<a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#features-task-name" target="_blank" rel="noopener noreferrer">任务名称<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>并<code>spring.cloud.task.single-instance-enabled=true</code>为每个任务执行进行设置 。当第一个任务执行正在运行时，任何其他时间您尝试运行具有相同 <a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#features-task-name" target="_blank" rel="noopener noreferrer">任务名称和<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <code>spring.cloud.task.single-instance-enabled = true</code>的任务时，任务将失败，并显示以下错误消息：<code>Task with name &quot;application&quot; is already running.</code>默认为值<code>spring.cloud.task.single-instance-enabled</code>IS <code>false</code>。以下示例显示了如何设置<code>spring.cloud.task.single-instance-enabled</code>为<code>true</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.task.single-instance-enabled=true or false
</code></pre></div><p>要使用此功能，必须将以下Spring Integration依赖项添加到您的应用程序：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.integration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-integration-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.integration<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-integration-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果任务由于启用了此功能而失败，并且另一个任务正在使用相同的任务名称运行，则该应用程序的退出代码将为1。</p></div> <h3 id="_8-11。禁用spring-cloud-task自动配置"><a href="#_8-11。禁用spring-cloud-task自动配置" class="header-anchor">#</a> 8.11。禁用Spring Cloud Task自动配置</h3> <p>如果不应为实现自动配置Spring Cloud Task，则可以禁用Task的自动配置。这可以通过在Task应用程序中添加以下注释来完成：</p> <div class="language- extra-class"><pre class="language-text"><code>@EnableAutoConfiguration(exclude={SimpleTaskAutoConfiguration.class})
</code></pre></div><p>您还可以通过将<code>spring.cloud.task.autoconfiguration.enabled</code>属性设置为来禁用任务自动配置<code>false</code>。</p> <h1 id="批量"><a href="#批量" class="header-anchor">#</a> 批量</h1> <p>本节将详细介绍Spring Cloud Task与Spring Batch的集成。本节介绍了跟踪作业执行与执行任务之间的关联以及通过Spring Cloud Deployer进行的远程分区。</p> <h2 id="_9-将作业执行与执行该作业的任务相关联"><a href="#_9-将作业执行与执行该作业的任务相关联" class="header-anchor">#</a> 9.将作业执行与执行该作业的任务相关联</h2> <p>Spring Boot提供了用于在über-jar中执行批处理作业的工具。Spring Boot对此功能的支持使开发人员可以在该执行中执行多个批处理作业。Spring Cloud Task提供了将作业的执行（作业执行）与任务的执行相关联的功能，以便可以追溯到另一个。</p> <p>Spring Cloud Task通过使用来实现此功能<code>TaskBatchExecutionListener</code>。默认情况下，此侦听器在配置了Spring Batch Job（通过<code>Job</code>在上下文中定义类型的bean ）和 <code>spring-cloud-task-batch</code>classpath上的jar的任何上下文中自动配置。侦听器被注入满足这些条件的所有作业中。</p> <h3 id="_9-1。覆盖taskbatchexecutionlistener"><a href="#_9-1。覆盖taskbatchexecutionlistener" class="header-anchor">#</a> 9.1。覆盖TaskBatchExecutionListener</h3> <p>为了防止将侦听器注入当前上下文中的任何批处理作业中，可以使用标准的Spring Boot机制禁用自动配置。</p> <p>要仅将侦听器注入到上下文中的特定作业中，请覆盖 <code>batchTaskExecutionListenerBeanPostProcessor</code>并提供作业Bean ID的列表，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">TaskBatchExecutionListenerBeanPostProcessor</span> <span class="token function">batchTaskExecutionListenerBeanPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">TaskBatchExecutionListenerBeanPostProcessor</span> postProcessor <span class="token operator">=</span>
		<span class="token keyword">new</span> <span class="token class-name">TaskBatchExecutionListenerBeanPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	postProcessor<span class="token punctuation">.</span><span class="token function">setJobNames</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token string">&quot;job1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> postProcessor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>你可以找到春云任务项目的采样模块中的样品批处理应用程序， <a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/batch-job" target="_blank" rel="noopener noreferrer">在这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h2 id="_10-远程分区"><a href="#_10-远程分区" class="header-anchor">#</a> 10.远程分区</h2> <p>Spring Cloud Deployer提供了用于在大多数云基础架构上启动基于Spring Boot的应用程序的工具。在<code>DeployerPartitionHandler</code>与 <code>DeployerStepExecutionHandler</code>委托工人步执行的春云部署的开展。</p> <p>要配置<code>DeployerStepExecutionHandler</code>，您必须提供一个<code>Resource</code> 代表要执行的Spring Bootüber-jar，一个<code>TaskLauncher</code>和一个 <code>JobExplorer</code>。您可以配置任何环境属性以及一次执行的最大工作程序数，轮询结果的时间间隔（默认为10秒）和超时（默认为-1或无超时）。以下示例显示了配置<code>PartitionHandler</code>外观：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">PartitionHandler</span> <span class="token function">partitionHandler</span><span class="token punctuation">(</span><span class="token class-name">TaskLauncher</span> taskLauncher<span class="token punctuation">,</span>
		<span class="token class-name">JobExplorer</span> jobExplorer<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

	<span class="token class-name">MavenProperties</span> mavenProperties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MavenProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mavenProperties<span class="token punctuation">.</span><span class="token function">setRemoteRepositories</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">&quot;springRepo&quot;</span><span class="token punctuation">,</span>
		<span class="token keyword">new</span> <span class="token class-name">MavenProperties</span><span class="token punctuation">.</span><span class="token class-name">RemoteRepository</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 	<span class="token class-name">Resource</span> resource <span class="token operator">=</span>
		<span class="token class-name">MavenResource</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%s:%s:%s&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;io.spring.cloud&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;partitioned-batch-job&quot;</span><span class="token punctuation">,</span>
				<span class="token string">&quot;1.1.0.RELEASE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mavenProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">DeployerPartitionHandler</span> partitionHandler <span class="token operator">=</span>
		<span class="token keyword">new</span> <span class="token class-name">DeployerPartitionHandler</span><span class="token punctuation">(</span>taskLauncher<span class="token punctuation">,</span> jobExplorer<span class="token punctuation">,</span> resource<span class="token punctuation">,</span> <span class="token string">&quot;workerStep&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> commandLineArgs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	commandLineArgs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;--spring.profiles.active=worker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	commandLineArgs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;--spring.cloud.task.initialize.enable=false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	commandLineArgs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;--spring.batch.initializer.enabled=false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	partitionHandler<span class="token punctuation">.</span><span class="token function">setCommandLineArgsProvider</span><span class="token punctuation">(</span>
		<span class="token keyword">new</span> <span class="token class-name">PassThroughCommandLineArgsProvider</span><span class="token punctuation">(</span>commandLineArgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	partitionHandler<span class="token punctuation">.</span><span class="token function">setEnvironmentVariablesProvider</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NoOpEnvironmentVariablesProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	partitionHandler<span class="token punctuation">.</span><span class="token function">setMaxWorkers</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	partitionHandler<span class="token punctuation">.</span><span class="token function">setApplicationName</span><span class="token punctuation">(</span><span class="token string">&quot;PartitionedBatchJobTask&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> partitionHandler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>将环境变量传递到分区时，每个分区可能位于具有不同环境设置的不同计算机上。因此，您应该仅传递所需的那些环境变量。</p></div> <p>请注意，在上面的示例中，我们将最大工作程序数设置为2。设置最大工作程序数将建立一次应运行的最大分区数。</p> <p>在<code>Resource</code>将要执行预计是弹簧引导尤伯杯罐具有 <code>DeployerStepExecutionHandler</code>配置为<code>CommandLineRunner</code>在当前上下文中。前面示例中列举的存储库应该是über-jar所在的远程存储库。经理和工作人员都应该对用作作业存储库和任务存储库的同一数据存储具有可见性。一旦基础架构启动了Spring Boot jar并启动了Spring Boot <code>DeployerStepExecutionHandler</code>，步骤处理程序将执行请求的 <code>Step</code>。以下示例显示了如何配置<code>DefaultStepExecutionHandler</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DeployerStepExecutionHandler</span> <span class="token function">stepExecutionHandler</span><span class="token punctuation">(</span><span class="token class-name">JobExplorer</span> jobExplorer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">DeployerStepExecutionHandler</span> handler <span class="token operator">=</span>
		<span class="token keyword">new</span> <span class="token class-name">DeployerStepExecutionHandler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">,</span> jobExplorer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>jobRepository<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> handler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>你可以找到春云任务项目的采样模块中的样本远程分区的应用程序， <a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/partitioned-batch-job" target="_blank" rel="noopener noreferrer">在这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_10-1。关于为kubernetes平台开发批处理分区的应用程序的注意事项"><a href="#_10-1。关于为kubernetes平台开发批处理分区的应用程序的注意事项" class="header-anchor">#</a> 10.1。关于为Kubernetes平台开发批处理分区的应用程序的注意事项</h3> <ul><li><p>在Kubernetes平台上部署分区应用程序时，必须对Spring Cloud Kubernetes Deployer使用以下依赖项：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-deployer-kubernetes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>任务应用程序及其分区的应用程序名称需要遵循以下正则表达式模式：<code>[a-z0-9]([-a-z0-9]*[a-z0-9])</code>。否则，将引发异常。</p></li></ul> <h3 id="_10-2。有关为cloud-foundry平台开发批处理分区的应用程序的说明"><a href="#_10-2。有关为cloud-foundry平台开发批处理分区的应用程序的说明" class="header-anchor">#</a> 10.2。有关为Cloud Foundry平台开发批处理分区的应用程序的说明</h3> <ul><li><p>在Cloud Foundry平台上部署分区应用程序时，必须对Spring Cloud Foundry Deployer使用以下依赖项：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-deployer-cloudfoundry<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.projectreactor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>reactor-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.5.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.projectreactor.ipc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>reactor-netty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.7.5.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>配置分区处理程序时，需要建立Cloud Foundry Deployment环境变量，以便分区处理程序可以启动分区。以下列表显示了必需的环境变量：</p> <ul><li><code>spring_cloud_deployer_cloudfoundry_url</code></li> <li><code>spring_cloud_deployer_cloudfoundry_org</code></li> <li><code>spring_cloud_deployer_cloudfoundry_space</code></li> <li><code>spring_cloud_deployer_cloudfoundry_domain</code></li> <li><code>spring_cloud_deployer_cloudfoundry_username</code></li> <li><code>spring_cloud_deployer_cloudfoundry_password</code></li> <li><code>spring_cloud_deployer_cloudfoundry_services</code></li> <li><code>spring_cloud_deployer_cloudfoundry_taskTimeout</code></li></ul></li></ul> <p>使用<code>mysql</code>数据库服务的分区任务的一组部署环境变量示例可能类似于以下内容：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">spring_cloud_deployer_cloudfoundry_url</span><span class="token operator">=</span>https://api.local.pcfdev.io
<span class="token assign-left variable">spring_cloud_deployer_cloudfoundry_org</span><span class="token operator">=</span>pcfdev-org
<span class="token assign-left variable">spring_cloud_deployer_cloudfoundry_space</span><span class="token operator">=</span>pcfdev-space
<span class="token assign-left variable">spring_cloud_deployer_cloudfoundry_domain</span><span class="token operator">=</span>local.pcfdev.io
<span class="token assign-left variable">spring_cloud_deployer_cloudfoundry_username</span><span class="token operator">=</span>admin
<span class="token assign-left variable">spring_cloud_deployer_cloudfoundry_password</span><span class="token operator">=</span>admin
<span class="token assign-left variable">spring_cloud_deployer_cloudfoundry_services</span><span class="token operator">=</span>mysql
<span class="token assign-left variable">spring_cloud_deployer_cloudfoundry_taskTimeout</span><span class="token operator">=</span><span class="token number">300</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>使用PCF-Dev时，还需要以下环境变量： <code>spring_cloud_deployer_cloudfoundry_skipSslValidation=true</code></p></div> <h2 id="_11-批处理参考消息"><a href="#_11-批处理参考消息" class="header-anchor">#</a> 11.批处理参考消息</h2> <p>Spring Cloud Task提供了批处理作业发出信息性消息的功能。“ <a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#stream-integration-batch-events" target="_blank" rel="noopener noreferrer">春季批处理事件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”部分详细介绍了此功能。</p> <h2 id="_12-批处理作业退出代码"><a href="#_12-批处理作业退出代码" class="header-anchor">#</a> 12.批处理作业退出代码</h2> <p>正如所讨论的<a href="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/#features-lifecycle-exit-codes" target="_blank" rel="noopener noreferrer">前面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，春云任务应用程序支持录制任务执行的退出代码的能力。但是，如果您在任务中运行Spring Batch Job，则无论Batch Job执行如何完成，使用默认的Batch / Boot行为时，任务的结果始终为零。请记住，任务是启动应用程序，并且从任务返回的退出代码与启动应用程序相同。要覆盖此行为，并允许任务时批处理作业返回返回其他的退出代码大于零 <a href="https://docs.spring.io/spring-batch/4.0.x/reference/html/step.html#batchStatusVsExitStatus" target="_blank" rel="noopener noreferrer">BatchStatus<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的<code>FAILED</code>，集<code>spring.cloud.task.batch.fail-on-job-failure</code>到<code>true</code>。然后，退出代码可以为1（默认值），也可以基于 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-spring-application.html#boot-features-application-exit" target="_blank" rel="noopener noreferrer">指定的 <code>ExitCodeGenerator</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p> <p>此功能使用的新功能<code>CommandLineRunner</code>替代了Spring Boot提供的功能。默认情况下，其配置顺序相同。但是，如果要自定义<code>CommandLineRunner</code>运行顺序，则可以通过设置<code>spring.cloud.task.batch.commandLineRunnerOrder</code>属性来设置其顺序 。要使您的任务根据批处理作业的执行结果返回退出代码，您需要编写自己的代码 <code>CommandLineRunner</code>。</p> <h1 id="spring-cloud-stream集成"><a href="#spring-cloud-stream集成" class="header-anchor">#</a> Spring Cloud Stream集成</h1> <p>任务本身可能是有用的，但是将任务集成到更大的生态系统中可以使它对于更复杂的处理和编排很有用。本节介绍Spring Cloud Task与Spring Cloud Stream的集成选项。</p> <h2 id="_13-从spring-cloud-stream启动任务"><a href="#_13-从spring-cloud-stream启动任务" class="header-anchor">#</a> 13.从Spring Cloud Stream启动任务</h2> <p>您可以从流中启动任务。为此，创建一个接收器，以监听包含<code>TaskLaunchRequest</code>有效载荷的消息。该<code>TaskLaunchRequest</code>包含：</p> <ul><li><code>uri</code>：针对要执行的任务工件。</li> <li><code>applicationName</code>：与任务关联的名称。如果未设置applicationName，则<code>TaskLaunchRequest</code>生成一个包含以下内容的任务名称：<code>Task-&lt;UUID&gt;</code>。</li> <li><code>commandLineArguments</code>：包含任务命令行参数的列表。</li> <li><code>environmentProperties</code>：包含任务要使用的环境变量的映射。</li> <li><code>deploymentProperties</code>：包含部署者用来部署任务的属性的映射。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果有效载荷是其他类型，则接收器将引发异常。</p></div> <p>例如，可以创建一个具有处理器的流，该处理器从HTTP源中获取数据，并创建一个<code>GenericMessage</code>包含<code>TaskLaunchRequest</code>的消息，并将消息发送到其输出通道。然后，任务接收器将从其输入通道接收消息，然后启动任务。</p> <p>要创建taskSink，只需创建一个包含<code>EnableTaskLauncher</code>注解的Spring Boot应用程序 ，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableTaskLauncher</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskSinkApplication</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">TaskSinkApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Spring Cloud Task项目的<a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples" target="_blank" rel="noopener noreferrer">示例模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>包含一个示例接收器和处理器。要将这些样本安装到本地maven存储库中，请从属性设置为的<code>spring-cloud-task-samples</code>目录运行maven构建 ，如以下示例所示：<code>skipInstall``false</code></p> <div class="language- extra-class"><pre class="language-text"><code>mvn clean install
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>该<code>maven.remoteRepositories.springRepo.url</code>属性必须设置为über-jar所在的远程存储库的位置。如果未设置，则没有远程存储库，因此它仅依赖于本地存储库。</p></div> <h3 id="_13-1。spring-cloud数据流"><a href="#_13-1。spring-cloud数据流" class="header-anchor">#</a> 13.1。Spring Cloud数据流</h3> <p>要在Spring Cloud Data Flow中创建流，必须首先注册我们创建的Task Sink应用程序。在以下示例中，我们将使用Spring Cloud Data Flow Shell注册Processor和Sink示例应用程序：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>app register --name taskSink --type sink --uri maven://io.spring.cloud:tasksink:<span class="token operator">&lt;</span>version<span class="token operator">&gt;</span>
app register --name taskProcessor --type processor --uri maven:io.spring.cloud:taskprocessor:<span class="token operator">&lt;</span>version<span class="token operator">&gt;</span>
</code></pre></div><p>以下示例显示了如何从Spring Cloud Data Flow Shell创建流：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>stream create foo --definition <span class="token string">&quot;http --server.port=9000|taskProcessor|taskSink&quot;</span> --deploy
</code></pre></div><h2 id="_14-spring-cloud-task事件"><a href="#_14-spring-cloud-task事件" class="header-anchor">#</a> 14. Spring Cloud Task事件</h2> <p>当通过Spring Cloud Stream通道运行任务时，Spring Cloud Task提供了通过Spring Cloud Stream通道发出事件的功能。任务侦听器用于<code>TaskExecution</code>在名为的消息通道上发布<code>task-events</code>。此功能自动连接到具有任何任务<code>spring-cloud-stream</code>，<code>spring-cloud-stream-&lt;binder&gt;</code>以及在它的类路径中定义的任务。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>要禁用发出事件的侦听器，请将<code>spring.cloud.task.events.enabled</code> 属性设置为<code>false</code>。</p></div> <p>定义了适当的类路径后，以下任务<code>TaskExecution</code>在<code>task-events</code>通道上（在任务的开始和结束处）将事件作为事件发出：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskEventsApplication</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">TaskEventsApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Configuration</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TaskConfiguration</span> <span class="token punctuation">{</span>

		<span class="token annotation punctuation">@Bean</span>
		<span class="token keyword">public</span> <span class="token class-name">CommandLineRunner</span> <span class="token function">commandLineRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommandLineRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token annotation punctuation">@Override</span>
				<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
					<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;The CommandLineRunner was executed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>绑定程序实现也必须位于类路径上。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>可以在Spring Cloud Task Project的示例模块中找到一个示例任务事件应用程序， <a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/task-events" target="_blank" rel="noopener noreferrer">在此处<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_14-1。禁用特定任务事件"><a href="#_14-1。禁用特定任务事件" class="header-anchor">#</a> 14.1。禁用特定任务事件</h3> <p>要禁用任务事件，可以将<code>spring.cloud.task.events.enabled</code>属性设置为 <code>false</code>。</p> <h2 id="_15-春季批处理活动"><a href="#_15-春季批处理活动" class="header-anchor">#</a> 15.春季批处理活动</h2> <p>通过任务执行Spring Batch作业时，可以将Spring Cloud Task配置为基于Spring Batch中可用的Spring Batch侦听器发出参考消息。具体来说，以下Spring Batch侦听器将自动配置到每个批处理作业中，并在通过Spring Cloud Task运行时在关联的Spring Cloud Stream通道上发出消息：</p> <ul><li><code>JobExecutionListener</code> 听 <code>job-execution-events</code></li> <li><code>StepExecutionListener</code> 听 <code>step-execution-events</code></li> <li><code>ChunkListener</code> 听 <code>chunk-events</code></li> <li><code>ItemReadListener</code> 听 <code>item-read-events</code></li> <li><code>ItemProcessListener</code> 听 <code>item-process-events</code></li> <li><code>ItemWriteListener</code> 听 <code>item-write-events</code></li> <li><code>SkipListener</code> 听 <code>skip-events</code></li></ul> <p><code>AbstractJob</code>当上下文中存在适当的bean（a <code>Job</code>和a <code>TaskLifecycleListener</code>）时，这些侦听器将自动配置为任意侦听器。侦听这些事件的配置以与绑定到任何其他Spring Cloud Stream通道相同的方式进行处理。我们的任务（运行批处理任务的任务）充当a <code>Source</code>，监听应用程序充当a <code>Processor</code>或a <code>Sink</code>。</p> <p>一个示例可能是让应用程序监听<code>job-execution-events</code>频道以开始和停止作业。要配置监听应用程序，您将输入配置<code>job-execution-events</code>如下：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.stream.bindings.input.destination=job-execution-events
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>绑定程序实现也必须位于类路径上。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>可以在Spring Cloud Task Project的示例模块中找到示例批处理事件应用程序， <a href="https://github.com/spring-cloud/spring-cloud-task/tree/master/spring-cloud-task-samples/batch-events" target="_blank" rel="noopener noreferrer">在此处<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_15-1。将批次事件发送到不同的渠道"><a href="#_15-1。将批次事件发送到不同的渠道" class="header-anchor">#</a> 15.1。将批次事件发送到不同的渠道</h3> <p>Spring Cloud Task为批处理事件提供的选项之一是能够更改特定侦听器可以向其发出消息的通道。要做到这一点，使用以下配置： <code>spring.cloud.stream.bindings.&lt;the channel&gt;.destination=&lt;new destination&gt;</code>。例如，如果<code>StepExecutionListener</code>需要将其消息发送到另一个通道 <code>my-step-execution-events</code>而不是default <code>step-execution-events</code>，则可以添加以下配置：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.stream.bindings.step-execution-events.destination=my-step-execution-events
</code></pre></div><h3 id="_15-2。禁用批处理事件"><a href="#_15-2。禁用批处理事件" class="header-anchor">#</a> 15.2。禁用批处理事件</h3> <p>要为所有批处理事件禁用侦听器功能，请使用以下配置：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.cloud.task.batch.events.enabled=false
</code></pre></div><p>要禁用特定的批处理事件，请使用以下配置：</p> <p><code>spring.cloud.task.batch.events.&lt;batch event listener&gt;.enabled=false</code>：</p> <p>以下清单显示了可以禁用的单个侦听器：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>spring.cloud.task.batch.events.job-execution.enabled<span class="token operator">=</span>false
spring.cloud.task.batch.events.step-execution.enabled<span class="token operator">=</span>false
spring.cloud.task.batch.events.chunk.enabled<span class="token operator">=</span>false
spring.cloud.task.batch.events.item-read.enabled<span class="token operator">=</span>false
spring.cloud.task.batch.events.item-process.enabled<span class="token operator">=</span>false
spring.cloud.task.batch.events.item-write.enabled<span class="token operator">=</span>false
spring.cloud.task.batch.events.skip.enabled<span class="token operator">=</span>false
</code></pre></div><h3 id="_15-3。发出批量事件的订单"><a href="#_15-3。发出批量事件的订单" class="header-anchor">#</a> 15.3。发出批量事件的订单</h3> <p>默认情况下，批处理事件具有<code>Ordered.LOWEST_PRECEDENCE</code>。要更改此值（例如，更改为5），请使用以下配置：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>spring.cloud.task.batch.events.job-execution-order<span class="token operator">=</span><span class="token number">5</span>
spring.cloud.task.batch.events.step-execution-order<span class="token operator">=</span><span class="token number">5</span>
spring.cloud.task.batch.events.chunk-order<span class="token operator">=</span><span class="token number">5</span>
spring.cloud.task.batch.events.item-read-order<span class="token operator">=</span><span class="token number">5</span>
spring.cloud.task.batch.events.item-process-order<span class="token operator">=</span><span class="token number">5</span>
spring.cloud.task.batch.events.item-write-order<span class="token operator">=</span><span class="token number">5</span>
spring.cloud.task.batch.events.skip-order<span class="token operator">=</span><span class="token number">5</span>
</code></pre></div><h1 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h1> <h2 id="_16-任务库模式"><a href="#_16-任务库模式" class="header-anchor">#</a> 16.任务库模式</h2> <p>本附录为任务存储库中使用的数据库模式提供了ERD。</p> <p><img src="https://docs.spring.io/spring-cloud-task/docs/2.2.1.RELEASE/reference/images/task_schema.png" alt="任务模式"></p> <h2 id="_17-构建此文档"><a href="#_17-构建此文档" class="header-anchor">#</a> 17.构建此文档</h2> <p>该项目使用Maven生成此文档。要自己生成它，请运行以下命令：<code>$ ./mvnw clean package -P full</code>。</p> <h2 id="_18-在cloud-foundry上运行task-app"><a href="#_18-在cloud-foundry上运行task-app" class="header-anchor">#</a> 18.在Cloud Foundry上运行Task App</h2> <p>将Spring Cloud Task应用程序作为Cloud Foundry上的任务启动的最简单方法是使用Spring Cloud Data Flow。通过Spring Cloud Data Flow，您可以注册任务应用程序，为其创建定义，然后启动它。然后，您可以通过RESTful API，Spring Cloud Data Flow Shell或UI跟踪任务执行。要了解如何开始安装Data Flow，请遵循 参考文档的“ <a href="https://docs.spring.io/spring-cloud-dataflow/docs/current/reference/htmlsingle/#getting-started" target="_blank" rel="noopener noreferrer">入门”<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>部分中的说明。有关如何注册和启动任务的信息，请参阅<a href="https://docs.spring.io/spring-cloud-dataflow/docs/current/reference/htmlsingle/#_the_lifecycle_of_a_task" target="_blank" rel="noopener noreferrer">任务<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>文档的<a href="https://docs.spring.io/spring-cloud-dataflow/docs/current/reference/htmlsingle/#_the_lifecycle_of_a_task" target="_blank" rel="noopener noreferrer">生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/springcloud/SpringCloudBus.html" class="prev">
        Spring Cloud Bus
      </a></span> <span class="next"><a href="/springcloud/SpringCloudConfig.html">
        Spring Cloud Config
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ab60294b.js" defer></script><script src="/assets/js/2.0769d472.js" defer></script><script src="/assets/js/95.4eafa307.js" defer></script>
  </body>
</html>
