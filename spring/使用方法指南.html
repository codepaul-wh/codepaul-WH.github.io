<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>“使用方法”指南 |  </title>
    <meta name="description" content=" ">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/img/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.6d3e66e0.css" as="style"><link rel="preload" href="/assets/js/app.ab60294b.js" as="script"><link rel="preload" href="/assets/js/2.0769d472.js" as="script"><link rel="preload" href="/assets/js/82.7f8e37af.js" as="script"><link rel="prefetch" href="/assets/js/10.d5b488e5.js"><link rel="prefetch" href="/assets/js/100.b05fe937.js"><link rel="prefetch" href="/assets/js/101.c78118ad.js"><link rel="prefetch" href="/assets/js/11.ba7209bc.js"><link rel="prefetch" href="/assets/js/12.7eb2b639.js"><link rel="prefetch" href="/assets/js/13.319a2e91.js"><link rel="prefetch" href="/assets/js/14.fe83290c.js"><link rel="prefetch" href="/assets/js/15.8a7ec64a.js"><link rel="prefetch" href="/assets/js/16.41f2dd98.js"><link rel="prefetch" href="/assets/js/17.904bc325.js"><link rel="prefetch" href="/assets/js/18.7a6246f7.js"><link rel="prefetch" href="/assets/js/19.84ab8dd3.js"><link rel="prefetch" href="/assets/js/20.04c09d1c.js"><link rel="prefetch" href="/assets/js/21.e75a2f46.js"><link rel="prefetch" href="/assets/js/22.a14b1840.js"><link rel="prefetch" href="/assets/js/23.799a37e9.js"><link rel="prefetch" href="/assets/js/24.c3eada22.js"><link rel="prefetch" href="/assets/js/25.4f11ed3d.js"><link rel="prefetch" href="/assets/js/26.375a9c03.js"><link rel="prefetch" href="/assets/js/27.bc7c4ae2.js"><link rel="prefetch" href="/assets/js/28.2250b95c.js"><link rel="prefetch" href="/assets/js/29.f568d59e.js"><link rel="prefetch" href="/assets/js/3.79868d1c.js"><link rel="prefetch" href="/assets/js/30.f7eb4129.js"><link rel="prefetch" href="/assets/js/31.94b316c6.js"><link rel="prefetch" href="/assets/js/32.428d0721.js"><link rel="prefetch" href="/assets/js/33.6064d0ca.js"><link rel="prefetch" href="/assets/js/34.711c8d67.js"><link rel="prefetch" href="/assets/js/35.2d341b53.js"><link rel="prefetch" href="/assets/js/36.d44bf3ce.js"><link rel="prefetch" href="/assets/js/37.b6844632.js"><link rel="prefetch" href="/assets/js/38.80d006c6.js"><link rel="prefetch" href="/assets/js/39.f7bee99d.js"><link rel="prefetch" href="/assets/js/4.973e9025.js"><link rel="prefetch" href="/assets/js/40.0239e47a.js"><link rel="prefetch" href="/assets/js/41.ae2fbfaa.js"><link rel="prefetch" href="/assets/js/42.dfd29a6a.js"><link rel="prefetch" href="/assets/js/43.683daf3c.js"><link rel="prefetch" href="/assets/js/44.562e4097.js"><link rel="prefetch" href="/assets/js/45.95b98fcb.js"><link rel="prefetch" href="/assets/js/46.d96aa487.js"><link rel="prefetch" href="/assets/js/47.2aca851e.js"><link rel="prefetch" href="/assets/js/48.814b9e24.js"><link rel="prefetch" href="/assets/js/49.fe2be804.js"><link rel="prefetch" href="/assets/js/5.336b97a1.js"><link rel="prefetch" href="/assets/js/50.c5a763c1.js"><link rel="prefetch" href="/assets/js/51.41e24a47.js"><link rel="prefetch" href="/assets/js/52.6c448e60.js"><link rel="prefetch" href="/assets/js/53.8c0b5684.js"><link rel="prefetch" href="/assets/js/54.8f76ab97.js"><link rel="prefetch" href="/assets/js/55.a15238f6.js"><link rel="prefetch" href="/assets/js/56.385a70ef.js"><link rel="prefetch" href="/assets/js/57.fe5f9465.js"><link rel="prefetch" href="/assets/js/58.348704b8.js"><link rel="prefetch" href="/assets/js/59.8074fc81.js"><link rel="prefetch" href="/assets/js/6.cdc6003c.js"><link rel="prefetch" href="/assets/js/60.1886e5a2.js"><link rel="prefetch" href="/assets/js/61.8cdce743.js"><link rel="prefetch" href="/assets/js/62.ccfad9c2.js"><link rel="prefetch" href="/assets/js/63.16b1771b.js"><link rel="prefetch" href="/assets/js/64.ab84024e.js"><link rel="prefetch" href="/assets/js/65.5d7c3b7a.js"><link rel="prefetch" href="/assets/js/66.d8591a18.js"><link rel="prefetch" href="/assets/js/67.73456f7e.js"><link rel="prefetch" href="/assets/js/68.f481f8f3.js"><link rel="prefetch" href="/assets/js/69.96f25530.js"><link rel="prefetch" href="/assets/js/7.46997b0a.js"><link rel="prefetch" href="/assets/js/70.0ab0d1fd.js"><link rel="prefetch" href="/assets/js/71.dd8facc4.js"><link rel="prefetch" href="/assets/js/72.ef52962d.js"><link rel="prefetch" href="/assets/js/73.0e844bfe.js"><link rel="prefetch" href="/assets/js/74.a3f222d9.js"><link rel="prefetch" href="/assets/js/75.cbbf1e57.js"><link rel="prefetch" href="/assets/js/76.79bfac66.js"><link rel="prefetch" href="/assets/js/77.536742b4.js"><link rel="prefetch" href="/assets/js/78.44d6cb00.js"><link rel="prefetch" href="/assets/js/79.2dc3f78e.js"><link rel="prefetch" href="/assets/js/8.2825b7c8.js"><link rel="prefetch" href="/assets/js/80.30f2b7e8.js"><link rel="prefetch" href="/assets/js/81.ce007e74.js"><link rel="prefetch" href="/assets/js/83.201b9f31.js"><link rel="prefetch" href="/assets/js/84.8e750285.js"><link rel="prefetch" href="/assets/js/85.b564c207.js"><link rel="prefetch" href="/assets/js/86.85da9ef3.js"><link rel="prefetch" href="/assets/js/87.61865fb9.js"><link rel="prefetch" href="/assets/js/88.2c3e8d72.js"><link rel="prefetch" href="/assets/js/89.2b99140f.js"><link rel="prefetch" href="/assets/js/9.2a76fd8c.js"><link rel="prefetch" href="/assets/js/90.6ede089c.js"><link rel="prefetch" href="/assets/js/91.4f784eb3.js"><link rel="prefetch" href="/assets/js/92.503a04a8.js"><link rel="prefetch" href="/assets/js/93.668a1616.js"><link rel="prefetch" href="/assets/js/94.78890e02.js"><link rel="prefetch" href="/assets/js/95.4eafa307.js"><link rel="prefetch" href="/assets/js/96.8be342d2.js"><link rel="prefetch" href="/assets/js/97.cff73008.js"><link rel="prefetch" href="/assets/js/98.2d7c9205.js"><link rel="prefetch" href="/assets/js/99.4e9998dc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6d3e66e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.png" alt=" " class="logo"> <span class="site-name can-hide"> </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SpringBoot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/spring/" class="sidebar-link">Spring Boot参考文档</a></li><li><a href="/spring/法律.html" class="sidebar-link">法律</a></li><li><a href="/spring/文档概述.html" class="sidebar-link">文档概述</a></li><li><a href="/spring/入门.html" class="sidebar-link">入门</a></li><li><a href="/spring/使用SpringBoot.html" class="sidebar-link">使用Spring Boot</a></li><li><a href="/spring/SpringBoot功能.html" class="sidebar-link">Spring Boot功能</a></li><li><a href="/spring/SpringBoot启动执行器.html" class="sidebar-link">Spring Boot启动执行器：生产就绪功能</a></li><li><a href="/spring/部署SpringBoot应用程序.html" class="sidebar-link">部署Spring Boot应用程序</a></li><li><a href="/spring/SpringBootCLI.html" class="sidebar-link">Spring Boot CLI</a></li><li><a href="/spring/生成工具插件.html" class="sidebar-link">生成工具插件</a></li><li><a href="/spring/使用方法指南.html" class="active sidebar-link">“使用方法”指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_1-spring-boot应用程序" class="sidebar-link">1. Spring Boot应用程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_1-1。创建自己的failureanalyzer" class="sidebar-link">1.1。创建自己的FailureAnalyzer</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_1-2。自动配置故障排除" class="sidebar-link">1.2。自动配置故障排除</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_1-3。启动之前自定义环境或applicationcontext" class="sidebar-link">1.3。启动之前自定义环境或ApplicationContext</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_1-4。建立applicationcontext层次结构（添加父上下文或根上下文）" class="sidebar-link">1.4。建立ApplicationContext层次结构（添加父上下文或根上下文）</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_1-5。创建一个非web应用程序" class="sidebar-link">1.5。创建一个非Web应用程序</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_2-属性和配置" class="sidebar-link">2.属性和配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_2-1。在构建时自动扩展属性" class="sidebar-link">2.1。在构建时自动扩展属性</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_2-2。外化配置springapplication" class="sidebar-link">2.2。外化配置SpringApplication</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_2-3。更改应用程序外部属性的位置" class="sidebar-link">2.3。更改应用程序外部属性的位置</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_2-4。使用-简短-命令行参数" class="sidebar-link">2.4。使用“简短”命令行参数</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_2-5。对外部属性使用yaml" class="sidebar-link">2.5。对外部属性使用YAML</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_2-6。设置活动弹簧轮廓" class="sidebar-link">2.6。设置活动弹簧轮廓</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_2-7。根据环境更改配置" class="sidebar-link">2.7。根据环境更改配置</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_2-8。发现外部属性的内置选项" class="sidebar-link">2.8。发现外部属性的内置选项</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-嵌入式web服务器" class="sidebar-link">3.嵌入式Web服务器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-1。使用其他web服务器" class="sidebar-link">3.1。使用其他Web服务器</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-2。禁用web服务器" class="sidebar-link">3.2。禁用Web服务器</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-3。更改http端口" class="sidebar-link">3.3。更改HTTP端口</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-4。使用随机未分配的http端口" class="sidebar-link">3.4。使用随机未分配的HTTP端口</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-5。在运行时发现http端口" class="sidebar-link">3.5。在运行时发现HTTP端口</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-6。启用http响应压缩" class="sidebar-link">3.6。启用HTTP响应压缩</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-7。配置ssl" class="sidebar-link">3.7。配置SSL</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-8。配置http-2" class="sidebar-link">3.8。配置HTTP / 2</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-9。配置web服务器" class="sidebar-link">3.9。配置Web服务器</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-10。将servlet，过滤器或侦听器添加到应用程序" class="sidebar-link">3.10。将Servlet，过滤器或侦听器添加到应用程序</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-11。配置访问日志" class="sidebar-link">3.11。配置访问日志</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-12。在前端代理服务器后面运行" class="sidebar-link">3.12。在前端代理服务器后面运行</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-13。使用tomcat启用多个连接器" class="sidebar-link">3.13。使用Tomcat启用多个连接器</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-14。使用tomcat的legacycookieprocessor" class="sidebar-link">3.14。使用Tomcat的LegacyCookieProcessor</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-15。启用tomcat的mbean注册表" class="sidebar-link">3.15。启用Tomcat的MBean注册表</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-16。使用undertow启用多个侦听器" class="sidebar-link">3.16。使用Undertow启用多个侦听器</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_3-17。使用-serverendpoint创建websocket端点" class="sidebar-link">3.17。使用@ServerEndpoint创建WebSocket端点</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_4-spring-mvc" class="sidebar-link">4. Spring MVC</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_4-1。编写json-rest服务" class="sidebar-link">4.1。编写JSON REST服务</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_4-2。编写xml-rest服务" class="sidebar-link">4.2。编写XML REST服务</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_4-3。自定义jackson-objectmapper" class="sidebar-link">4.3。自定义Jackson ObjectMapper</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_4-4。自定义-responsebody渲染" class="sidebar-link">4.4。自定义@ResponseBody渲染</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_4-5。处理分段文件上传" class="sidebar-link">4.5。处理分段文件上传</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_4-6。关闭spring-mvc-dispatcherservlet" class="sidebar-link">4.6。关闭Spring MVC DispatcherServlet</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_4-7。关闭默认的mvc配置" class="sidebar-link">4.7。关闭默认的MVC配置</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_4-8。自定义viewresolvers" class="sidebar-link">4.8。自定义ViewResolvers</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_5-使用spring-security进行测试" class="sidebar-link">5.使用Spring Security进行测试</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_6-球衣" class="sidebar-link">6.球衣</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_6-1。使用spring-security保护jersey端点" class="sidebar-link">6.1。使用Spring Security保护Jersey端点</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_6-2。与另一个web框架一起使用jersey" class="sidebar-link">6.2。与另一个Web框架一起使用Jersey</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_7-http客户端" class="sidebar-link">7. HTTP客户端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_7-1。配置resttemplate使用代理" class="sidebar-link">7.1。配置RestTemplate使用代理</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_7-2。配置基于reactor-netty的webclient使用的tcpclient" class="sidebar-link">7.2。配置基于Reactor Netty的WebClient使用的TcpClient</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_8-记录" class="sidebar-link">8.记录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_8-1。配置登录以进行日志记录" class="sidebar-link">8.1。配置登录以进行日志记录</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_8-2。配置log4j进行日志记录" class="sidebar-link">8.2。配置Log4j进行日志记录</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-资料存取" class="sidebar-link">9.资料存取</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-1。配置自定义数据源" class="sidebar-link">9.1。配置自定义数据源</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-2。配置两个数据源" class="sidebar-link">9.2。配置两个数据源</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-3。使用spring数据仓库" class="sidebar-link">9.3。使用Spring数据仓库</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-4。将-entity定义与spring配置分开" class="sidebar-link">9.4。将@Entity定义与Spring配置分开</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-5。配置jpa属性" class="sidebar-link">9.5。配置JPA属性</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-6。配置休眠命名策略" class="sidebar-link">9.6。配置休眠命名策略</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-7。配置hibernate二级缓存" class="sidebar-link">9.7。配置Hibernate二级缓存</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-8。在休眠组件中使用依赖注入" class="sidebar-link">9.8。在休眠组件中使用依赖注入</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-9。使用自定义entitymanagerfactory" class="sidebar-link">9.9。使用自定义EntityManagerFactory</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-10。使用两个entitymanager" class="sidebar-link">9.10。使用两个EntityManager</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-11。使用传统persistence-xml文件" class="sidebar-link">9.11。使用传统persistence.xml文件</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-12。使用spring-data-jpa和mongo存储库" class="sidebar-link">9.12。使用Spring Data JPA和Mongo存储库</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-13。定制spring-data的web支持" class="sidebar-link">9.13。定制Spring Data的Web支持</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-14。将spring数据存储库公开为rest端点" class="sidebar-link">9.14。将Spring数据存储库公开为REST端点</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-15。配置jpa使用的组件" class="sidebar-link">9.15。配置JPA使用的组件</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_9-16。使用两个数据源配置jooq" class="sidebar-link">9.16。使用两个数据源配置jOOQ</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_10-数据库初始化" class="sidebar-link">10.数据库初始化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_10-1。使用jpa初始化数据库" class="sidebar-link">10.1。使用JPA初始化数据库</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_10-2。使用休眠初始化数据库" class="sidebar-link">10.2。使用休眠初始化数据库</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_10-3。初始化数据库" class="sidebar-link">10.3。初始化数据库</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_10-4。初始化一个spring-batch数据库" class="sidebar-link">10.4。初始化一个Spring Batch数据库</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_10-5。使用高级数据库迁移工具" class="sidebar-link">10.5。使用高级数据库迁移工具</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_11-消息传递" class="sidebar-link">11.消息传递</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_11-1。禁用事务jms会话" class="sidebar-link">11.1。禁用事务JMS会话</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_12-批处理应用" class="sidebar-link">12.批处理应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_12-1。在启动时执行spring-batch作业" class="sidebar-link">12.1。在启动时执行Spring Batch作业</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_13-执行器" class="sidebar-link">13.执行器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_13-1。更改执行器端点的http端口或地址" class="sidebar-link">13.1。更改执行器端点的HTTP端口或地址</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_13-2。自定义-whitelabel-错误页面" class="sidebar-link">13.2。自定义“ whitelabel”错误页面</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_13-3。清理明智的价值观" class="sidebar-link">13.3。清理明智的价值观</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_14-安全性" class="sidebar-link">14.安全性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_14-1。关闭spring-boot安全性配置" class="sidebar-link">14.1。关闭Spring Boot安全性配置</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_14-2。更改userdetailsservice并添加用户帐户" class="sidebar-link">14.2。更改UserDetailsService并添加用户帐户</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_14-3。在代理服务器后运行时启用https" class="sidebar-link">14.3。在代理服务器后运行时启用HTTPS</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_15-热插拔" class="sidebar-link">15.热插拔</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_15-1。重新加载静态内容" class="sidebar-link">15.1。重新加载静态内容</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_15-2。重新加载模板，而无需重新启动容器" class="sidebar-link">15.2。重新加载模板，而无需重新启动容器</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_15-3。快速应用重启" class="sidebar-link">15.3。快速应用重启</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_15-4。重新加载java类而无需重新启动容器" class="sidebar-link">15.4。重新加载Java类而无需重新启动容器</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-建立" class="sidebar-link">16.建立</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-1。生成构建信息" class="sidebar-link">16.1。生成构建信息</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-2。生成git信息" class="sidebar-link">16.2。生成Git信息</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-3。自定义依赖版本" class="sidebar-link">16.3。自定义依赖版本</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-4。使用maven创建可执行jar" class="sidebar-link">16.4。使用Maven创建可执行JAR</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-5。使用spring-boot应用程序作为依赖项" class="sidebar-link">16.5。使用Spring Boot应用程序作为依赖项</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-6。运行可执行jar时提取特定的库" class="sidebar-link">16.6。运行可执行jar时提取特定的库</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-7。创建带有排除项的不可执行的jar" class="sidebar-link">16.7。创建带有排除项的不可执行的JAR</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-8。远程调试以maven开头的spring-boot应用程序" class="sidebar-link">16.8。远程调试以Maven开头的Spring Boot应用程序</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_16-9。在不使用ant的情况下从ant构建可执行存档spring-boot-antlib" class="sidebar-link">16.9。在不使用Ant的情况下从Ant构建可执行存档spring-boot-antlib</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_17-传统部署" class="sidebar-link">17.传统部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_17-1。创建可部署的战争文件" class="sidebar-link">17.1。创建可部署的战争文件</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_17-2。将现有应用程序转换为spring-boot" class="sidebar-link">17.2。将现有应用程序转换为Spring Boot</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_17-3。将war部署到weblogic" class="sidebar-link">17.3。将WAR部署到WebLogic</a></li><li class="sidebar-sub-header"><a href="/spring/使用方法指南.html#_17-4。使用jedis代替生菜" class="sidebar-link">17.4。使用Jedis代替生菜</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用方法-指南"><a href="#使用方法-指南" class="header-anchor">#</a> “使用方法”指南</h1> <p>本节提供了一些在使用Spring Boot时经常出现的常见``我该怎么做...''问题的答案。它的覆盖范围不是很详尽，但是确实覆盖了很多。</p> <p>如果您有一个我们不在此讨论的特定问题，则可能需要查看<a href="https://stackoverflow.com/tags/spring-boot" target="_blank" rel="noopener noreferrer">stackoverflow.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以查看是否有人已经提供了答案。这也是询问新问题的好地方（请使用<code>spring-boot</code>标签）。</p> <p>我们也很乐意扩展此部分。如果您想添加“操作方法”，请向我们发送<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE" target="_blank" rel="noopener noreferrer">请求请求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="_1-spring-boot应用程序"><a href="#_1-spring-boot应用程序" class="header-anchor">#</a> 1. Spring Boot应用程序</h2> <p>本部分包括与Spring Boot应用程序直接相关的主题。</p> <h3 id="_1-1。创建自己的failureanalyzer"><a href="#_1-1。创建自己的failureanalyzer" class="header-anchor">#</a> 1.1。创建自己的FailureAnalyzer</h3> <p><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/diagnostics/FailureAnalyzer.html" target="_blank" rel="noopener noreferrer"><code>FailureAnalyzer</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这是拦截启动时将异常转化为人类可读消息（包装在）的一种好方法<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/diagnostics/FailureAnalysis.html" target="_blank" rel="noopener noreferrer"><code>FailureAnalysis</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。Spring Boot为与应用程序上下文相关的异常，JSR-303验证等提供了此类分析器。您也可以创建自己的。</p> <p><code>AbstractFailureAnalyzer</code>是一个方便的扩展，<code>FailureAnalyzer</code>它检查要处理的异常中是否存在指定的异常类型。您可以对此进行扩展，以便您的实现只有在异常出现时才有机会处理该异常。如果由于某种原因无法处理该异常，请返回<code>null</code>以使另一个实现有机会处理该异常。</p> <p><code>FailureAnalyzer</code>实现必须在中注册<code>META-INF/spring.factories</code>。以下示例注册<code>ProjectConstraintViolationFailureAnalyzer</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">org.springframework.boot.diagnostics.FailureAnalyzer</span><span class="token punctuation">=</span><span class="token attr-value">\
com.example.ProjectConstraintViolationFailureAnalyzer</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您需要访问<code>BeanFactory</code>或<code>Environment</code>，则<code>FailureAnalyzer</code>可以分别实现<code>BeanFactoryAware</code>或<code>EnvironmentAware</code>。</p></div> <h3 id="_1-2。自动配置故障排除"><a href="#_1-2。自动配置故障排除" class="header-anchor">#</a> 1.2。自动配置故障排除</h3> <p>Spring Boot自动配置会尽力“做正确的事”，但有时会失败，并且很难说出原因。</p> <p><code>ConditionEvaluationReport</code>任何Spring Boot 都有一个非常有用的功能<code>ApplicationContext</code>。如果启用<code>DEBUG</code>日志记录输出，则可以看到它。如果使用<code>spring-boot-actuator</code>（请参阅<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/production-ready-features.html#production-ready" target="_blank" rel="noopener noreferrer">“执行器”一章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），那么还有一个<code>conditions</code>终结点，该终结点以JSON形式呈现报告。使用该端点来调试应用程序，并在运行时查看Spring Boot添加了哪些功能（尚未添加）。</p> <p>通过查看源代码和Javadoc，可以回答更多问题。阅读代码时，请记住以下经验法则：</p> <ul><li>查找被调用的类<code>*AutoConfiguration</code>并阅读其源代码。特别注意<code>@Conditional*</code>注释，以了解它们启用了哪些功能以及何时启用。添加<code>--debug</code>到命令行或系统属性<code>-Ddebug</code>以在控制台上获取在您的应用中做出的所有自动配置决策的日志。在启用了执行器的运行应用程序中，查看<code>conditions</code>端点（<code>/actuator/conditions</code>或等效的JMX）以获取相同信息。</li> <li>查找属于<code>@ConfigurationProperties</code>（例如<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java" target="_blank" rel="noopener noreferrer"><code>ServerProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）的类，然后从中读取可用的外部配置选项。该<code>@ConfigurationProperties</code>注释具有一个<code>name</code>充当前缀外部性能属性。因此，<code>ServerProperties</code>拥有<code>prefix=&quot;server&quot;</code>和它的配置性能<code>server.port</code>，<code>server.address</code>以及其他。在启用了执行器的运行应用程序中，查看<code>configprops</code>端点。</li> <li>寻找对<code>bind</code>方法的使用，以一种轻松的方式<code>Binder</code>将配置值明确地拉出<code>Environment</code>。它通常与前缀一起使用。</li> <li>查找<code>@Value</code>直接绑定到的注释<code>Environment</code>。</li> <li>寻找<code>@ConditionalOnExpression</code>注释以响应SpEL表达式来打开或关闭功能，这些注释通常使用从中解析的占位符进行评估<code>Environment</code>。</li></ul> <h3 id="_1-3。启动之前自定义环境或applicationcontext"><a href="#_1-3。启动之前自定义环境或applicationcontext" class="header-anchor">#</a> 1.3。启动之前自定义环境或ApplicationContext</h3> <p>一个<code>SpringApplication</code>具有<code>ApplicationListeners</code>与<code>ApplicationContextInitializers</code>被用于应用自定义的背景或环境。Spring Boot加载了许多此类自定义项，以供内部使用<code>META-INF/spring.factories</code>。注册其他自定义项的方法有多种：</p> <ul><li>在运行之前，通过对每个应用程序进行编程，方法是调用<code>addListeners</code>和<code>addInitializers</code>方法<code>SpringApplication</code>。</li> <li>通过设置<code>context.initializer.classes</code>或<code>context.listener.classes</code>属性，以声明方式针对每个应用程序。</li> <li>声明性地，对于所有应用程序，通过添加<code>META-INF/spring.factories</code>和打包一个jar文件，这些文件都被应用程序用作库。</li></ul> <p>该<code>SpringApplication</code>发送一些特殊<code>ApplicationEvents</code>的听众（背景下创造了一些甚至更早），然后注册了在公布的事件监听器<code>ApplicationContext</code>为好。有关完整列表，请参见“ Spring Boot功能”部分中的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-application-events-and-listeners" target="_blank" rel="noopener noreferrer">应用程序事件和侦听器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。</p> <p>还可以使用来自定义<code>Environment</code>刷新应用程序上下文之前的<code>EnvironmentPostProcessor</code>。每个实现都应在中注册<code>META-INF/spring.factories</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">org.springframework.boot.env.EnvironmentPostProcessor</span><span class="token punctuation">=</span><span class="token attr-value">com.example.YourEnvironmentPostProcessor</span>
</code></pre></div><p>该实现可以加载任意文件并将其添加到中<code>Environment</code>。例如，以下示例从类路径加载YAML配置文件：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnvironmentPostProcessorExample</span> <span class="token keyword">implements</span> <span class="token class-name">EnvironmentPostProcessor</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">YamlPropertySourceLoader</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YamlPropertySourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postProcessEnvironment</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">,</span> <span class="token class-name">SpringApplication</span> application<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Resource</span> path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;com/example/myapp/config.yml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> propertySource <span class="token operator">=</span> <span class="token function">loadYaml</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        environment<span class="token punctuation">.</span><span class="token function">getPropertySources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addLast</span><span class="token punctuation">(</span>propertySource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">PropertySource</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadYaml</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Resource &quot;</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">&quot; does not exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;custom-resource&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to load yaml configuration from &quot;</span> <span class="token operator">+</span> path<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在<code>Environment</code>已经准备与所有常见的财产来源春天引导加载默认。因此可以从环境中获取文件的位置。前面的示例将<code>custom-resource</code>属性源添加到列表的末尾，以便在其他任何常见位置定义的键具有优先权。定制实现可以定义另一个顺序。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在使用<code>@PropertySource</code>你的<code>@SpringBootApplication</code>似乎是加载在一个自定义资源的便利方式<code>Environment</code>，我们不建议这样做。<code>Environment</code>在刷新应用程序上下文之前，不会将此类属性源添加到中。现在配置某些属性（如<code>logging.*</code>和<code>spring.main.*</code>在刷新开始之前先读取）为时已晚。</p></div> <h3 id="_1-4。建立applicationcontext层次结构（添加父上下文或根上下文）"><a href="#_1-4。建立applicationcontext层次结构（添加父上下文或根上下文）" class="header-anchor">#</a> 1.4。建立ApplicationContext层次结构（添加父上下文或根上下文）</h3> <p>您可以使用<code>ApplicationBuilder</code>该类创建父/子<code>ApplicationContext</code>层次结构。有关更多信息，请参见“ Spring Boot功能”部分中的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-fluent-builder-api" target="_blank" rel="noopener noreferrer">spring-boot-features.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。</p> <h3 id="_1-5。创建一个非web应用程序"><a href="#_1-5。创建一个非web应用程序" class="header-anchor">#</a> 1.5。创建一个非Web应用程序</h3> <p>并非所有的Spring应用程序都必须是Web应用程序（或Web服务）。如果要在<code>main</code>方法中执行一些代码，又要引导Spring应用程序以设置要使用的基础结构，则可以使用<code>SpringApplication</code>Spring Boot 的功能。A 根据是否认为需要Web应用程序来<code>SpringApplication</code>更改其<code>ApplicationContext</code>类。您可以做的第一件事是让服务器相关的依赖项（例如Servlet API）脱离类路径。如果你不能做到这一点（例如，您从相同的代码库的两个应用程序），那么你可以显式调用<code>setWebApplicationType(WebApplicationType.NONE)</code>您的<code>SpringApplication</code>实例或设置<code>applicationContextClass</code>属性（通过Java API或与外部属性）。您可以将要作为业务逻辑运行的应用程序代码实现为<code>CommandLineRunner</code>并作为<code>@Bean</code>定义放到上下文中。</p> <h2 id="_2-属性和配置"><a href="#_2-属性和配置" class="header-anchor">#</a> 2.属性和配置</h2> <p>本部分包括有关设置和读取属性，配置设置以及它们与Spring Boot应用程序的交互的主题。</p> <h3 id="_2-1。在构建时自动扩展属性"><a href="#_2-1。在构建时自动扩展属性" class="header-anchor">#</a> 2.1。在构建时自动扩展属性</h3> <p>您可以使用现有的构建配置自动扩展它们，而不是对项目的构建配置中也指定的某些属性进行硬编码。在Maven和Gradle中都是可能的。</p> <h4 id="_2-1-1。使用maven自动扩展属性"><a href="#_2-1-1。使用maven自动扩展属性" class="header-anchor">#</a> 2.1.1。使用Maven自动扩展属性</h4> <p>您可以使用资源过滤从Maven项目自动扩展属性。如果使用<code>spring-boot-starter-parent</code>，则可以使用<code>@..@</code>占位符引用Maven的“项目属性” ，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">app.encoding</span><span class="token punctuation">=</span><span class="token attr-value">@project.build.sourceEncoding@</span>
<span class="token attr-name">app.java.version</span><span class="token punctuation">=</span><span class="token attr-value">@java.version@</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这样只会过滤生产配置（也就是说，不会对进行过滤<code>src/test/resources</code>）。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果启用该<code>addResources</code>标志，则<code>spring-boot:run</code>目标可以<code>src/main/resources</code>直接添加到类路径中（用于热重载）。这样做避免了资源过滤和此功能。相反，您可以使用<code>exec:java</code>目标或自定义插件的配置。有关更多详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/maven-plugin//usage.html" target="_blank" rel="noopener noreferrer">插件使用情况页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>如果您不使用入门级父级，则需要在<code>&lt;build/&gt;</code>元素中包括以下元素<code>pom.xml</code>：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>您还需要在其中包含以下元素<code>&lt;plugins/&gt;</code>：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-resources-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delimiters</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delimiter</span><span class="token punctuation">&gt;</span></span>@<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delimiter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delimiters</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>useDefaultDelimiters</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>useDefaultDelimiters</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>useDefaultDelimiters</code>如果<code>${placeholder}</code>在配置中使用标准的Spring占位符（例如），则 该属性很重要。如果该属性未设置为<code>false</code>，则可以通过构建扩展它们。</p></div> <h4 id="_2-1-2。使用gradle自动扩展属性"><a href="#_2-1-2。使用gradle自动扩展属性" class="header-anchor">#</a> 2.1.2。使用Gradle自动扩展属性</h4> <p>您可以通过配置Java插件的<code>processResources</code>任务来自动扩展Gradle项目中的属性，如以下示例所示：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>processResources <span class="token punctuation">{</span>
    <span class="token function">expand</span><span class="token punctuation">(</span>project<span class="token punctuation">.</span>properties<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后，您可以使用占位符来引用Gradle项目的属性，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">app.name</span><span class="token punctuation">=</span><span class="token attr-value">${name}</span>
<span class="token attr-name">app.description</span><span class="token punctuation">=</span><span class="token attr-value">${description}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Gradle的<code>expand</code>方法使用Groovy 的方法<code>SimpleTemplateEngine</code>来转换<code>${..}</code>令牌。该<code>${..}</code>风格的冲突与Spring自己的财产占位符机制。要将Spring属性占位符与自动扩展一起使用，请按以下步骤对Spring属性占位符进行转义：<code>\${..}</code>。</p></div> <h3 id="_2-2。外化配置springapplication"><a href="#_2-2。外化配置springapplication" class="header-anchor">#</a> 2.2。外化配置<code>SpringApplication</code></h3> <p>A <code>SpringApplication</code>具有bean属性（主要是setter），因此在创建应用程序时可以使用其Java API修改其行为。或者，您可以通过在中设置属性来外部化配置<code>spring.main.*</code>。例如，在中<code>application.properties</code>，您可能具有以下设置：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.main.web-application-type</span><span class="token punctuation">=</span><span class="token attr-value">none</span>
<span class="token attr-name">spring.main.banner-mode</span><span class="token punctuation">=</span><span class="token attr-value">off</span>
</code></pre></div><p>然后，启动时不会打印Spring Boot标语，并且应用程序也没有启动嵌入式Web服务器。</p> <p>外部配置中定义的属性会覆盖用Java API指定的值，但用于创建的源的显着例外除外<code>ApplicationContext</code>。考虑以下应用程序：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">SpringApplicationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">bannerMode</span><span class="token punctuation">(</span><span class="token class-name">Banner</span><span class="token punctuation">.</span><span class="token class-name">Mode</span><span class="token punctuation">.</span>OFF<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sources</span><span class="token punctuation">(</span>demo<span class="token punctuation">.</span><span class="token class-name">MyApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>现在考虑以下配置：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.main.sources</span><span class="token punctuation">=</span><span class="token attr-value">com.acme.Config,com.acme.ExtraConfig</span>
<span class="token attr-name">spring.main.banner-mode</span><span class="token punctuation">=</span><span class="token attr-value">console</span>
</code></pre></div><p>实际应用中*，现在*示出的旗帜（如通过配置覆盖），并使用了三个源<code>ApplicationContext</code>（按以下顺序）： ，<code>demo.MyApp</code>，<code>com.acme.Config</code>和<code>com.acme.ExtraConfig</code>。</p> <h3 id="_2-3。更改应用程序外部属性的位置"><a href="#_2-3。更改应用程序外部属性的位置" class="header-anchor">#</a> 2.3。更改应用程序外部属性的位置</h3> <p>默认情况下，来自不同来源的属性<code>Environment</code>将以定义的顺序添加到Spring 中（有关确切顺序，请参见“ Spring Boot功能”部分中的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config" target="_blank" rel="noopener noreferrer">spring-boot-features.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”）。</p> <p>您还可以提供以下系统属性（或环境变量）来更改行为：</p> <ul><li><code>spring.config.name</code>（<code>SPRING_CONFIG_NAME</code>）：默认为<code>application</code>作为文件名的根。</li> <li><code>spring.config.location</code>（<code>SPRING_CONFIG_LOCATION</code>）：要加载的文件（例如类路径资源或URL）。<code>Environment</code>为此文档设置了单独的属性源，可以通过系统属性，环境变量或命令行来覆盖它。</li></ul> <p>无论您在环境中进行什么设置，Spring Boot都将始终<code>application.properties</code>如上所述进行加载。默认情况下，如果使用YAML，则扩展名为'.yml'的文件也将添加到列表中。</p> <p>Spring Boot记录在该<code>DEBUG</code>级别加载的配置文件以及在该级别找不到的候选文件<code>TRACE</code>。</p> <p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/context/config/ConfigFileApplicationListener.java" target="_blank" rel="noopener noreferrer"><code>ConfigFileApplicationListener</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多详细信息。</p> <h3 id="_2-4。使用-简短-命令行参数"><a href="#_2-4。使用-简短-命令行参数" class="header-anchor">#</a> 2.4。使用“简短”命令行参数</h3> <p>有些人喜欢使用（例如）<code>--port=9000</code>而不是<code>--server.port=9000</code>在命令行上设置配置属性。您可以通过在中使用占位符来启用此行为<code>application.properties</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">${port:8080}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您从<code>spring-boot-starter-parent</code>POM 继承，则将的默认过滤器令牌<code>maven-resources-plugins</code>从更改<code>${*}</code>为<code>@</code>（即，<code>@maven.token@</code>而不是<code>${maven.token}</code>），以防止与Spring样式的占位符冲突。如果<code>application.properties</code>直接启用了Maven过滤，则可能还需要更改默认过滤器令牌以使用<a href="https://maven.apache.org/plugins/maven-resources-plugin/resources-mojo.html#delimiters" target="_blank" rel="noopener noreferrer">其他定界符<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在这种特定情况下，端口绑定可在PaaS环境（例如Heroku或Cloud Foundry）中工作。在这两个平台中，<code>PORT</code>环境变量是自动设置的，Spring可以绑定到大写的<code>Environment</code>属性同义词。</p></div> <h3 id="_2-5。对外部属性使用yaml"><a href="#_2-5。对外部属性使用yaml" class="header-anchor">#</a> 2.5。对外部属性使用YAML</h3> <p>YAML是JSON的超集，因此是一种方便的语法，用于以分层格式存储外部属性，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">application</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cruncher
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost/test
<span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span>
</code></pre></div><p>创建一个名为的文件<code>application.yml</code>，并将其放在类路径的根目录中。然后添加<code>snakeyaml</code>到您的依赖项（Maven坐标<code>org.yaml:snakeyaml</code>，如果使用，则已经包含在内<code>spring-boot-starter</code>）。将YAML文件解析为Java <code>Map&lt;String,Object&gt;</code>（如JSON对象），然后Spring Boot展宽地图，使其深一层，并具有句点分隔的键，这是许多人习惯使用<code>Properties</code>Java中的文件的原因。</p> <p>前面的示例YAML对应于以下<code>application.properties</code>文件：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">cruncher</span>
<span class="token attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
<span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost/test</span>
<span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">9000</span>
</code></pre></div><p>有关YAML的更多信息，请参见“ Spring Boot功能”部分中的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-yaml" target="_blank" rel="noopener noreferrer">spring-boot-features.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。</p> <h3 id="_2-6。设置活动弹簧轮廓"><a href="#_2-6。设置活动弹簧轮廓" class="header-anchor">#</a> 2.6。设置活动弹簧轮廓</h3> <p>Spring <code>Environment</code>为此提供了一个API，但是您通常会设置一个System属性（<code>spring.profiles.active</code>）或OS环境变量（<code>SPRING_PROFILES_ACTIVE</code>）。另外，您可以使用<code>-D</code>参数启动应用程序（请记住将其放在主类或jar存档之前），如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar -Dspring.profiles.active =生产演示-0.0.1-SNAPSHOT.jar
</code></pre></div><p>在Spring Boot中，您还可以在中设置活动配置文件<code>application.properties</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">production</span>
</code></pre></div><p>以这种方式设置的值将由“系统”属性或环境变量设置代替，而不由<code>SpringApplicationBuilder.profiles()</code>方法替代。因此，后一种Java API可用于扩充配置文件，而无需更改默认值。</p> <p>有关更多信息，请参见“ Spring Boot功能”部分中的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-profiles" target="_blank" rel="noopener noreferrer">spring-boot-features.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。</p> <h3 id="_2-7。根据环境更改配置"><a href="#_2-7。根据环境更改配置" class="header-anchor">#</a> 2.7。根据环境更改配置</h3> <p>YAML文件实际上是由<code>---</code>行分隔的文档序列，每个文档都分别解析为展平图。</p> <p>如果YAML文档包含<code>spring.profiles</code>密钥，则将配置文件值（以逗号分隔的配置文件列表）输入到Spring <code>Environment.acceptsProfiles()</code>方法中。如果这些配置文件中的任何一个处于活动状态，那么该文档将包含在最终合并中（否则，它不会包含在此文档中），如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9000</span>
<span class="token punctuation">---</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">profiles</span><span class="token punctuation">:</span> development
<span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9001</span>

<span class="token punctuation">---</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">profiles</span><span class="token punctuation">:</span> production
<span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">0</span>
</code></pre></div><p>在前面的示例中，默认端口为9000。但是，如果名为“ development”的Spring概要文件处于活动状态，则该端口为9001。如果“ production”为活动状态，则该端口为0。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>YAML文档按照它们遇到的顺序进行合并。以后的值将覆盖以前的值。</p></div> <p>要对属性文件执行相同的操作，可以使用<code>application-${profile}.properties</code>指定特定于配置文件的值。</p> <h3 id="_2-8。发现外部属性的内置选项"><a href="#_2-8。发现外部属性的内置选项" class="header-anchor">#</a> 2.8。发现外部属性的内置选项</h3> <p>Spring Boot 在运行时将外部属性<code>application.properties</code>（或<code>.yml</code>文件和其他位置）绑定到应用程序中。在一个位置上没有（而且从技术上来说不是）所有受支持属性的详尽列表，因为贡献可能来自类路径上的其他jar文件。</p> <p>具有Actuator功能的正在运行的应用程序具有一个<code>configprops</code>终结点，该终结点显示了可通过访问的所有绑定和可绑定属性<code>@ConfigurationProperties</code>。</p> <p>附录中包含一个<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-application-properties.html#common-application-properties" target="_blank" rel="noopener noreferrer"><code>application.properties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>示例，其中列出了Spring Boot支持的最常见属性。最终列表来自搜索源代码中的<code>@ConfigurationProperties</code>和<code>@Value</code>注释，以及偶尔使用<code>Binder</code>。有关加载属性的确切顺序的更多信息，请参见“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config" target="_blank" rel="noopener noreferrer">spring-boot-features.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。</p> <h2 id="_3-嵌入式web服务器"><a href="#_3-嵌入式web服务器" class="header-anchor">#</a> 3.嵌入式Web服务器</h2> <p>每个Spring Boot Web应用程序都包含一个嵌入式Web服务器。此功能导致许多方法问题，包括如何更改嵌入式服务器以及如何配置嵌入式服务器。本节回答这些问题。</p> <h3 id="_3-1。使用其他web服务器"><a href="#_3-1。使用其他web服务器" class="header-anchor">#</a> 3.1。使用其他Web服务器</h3> <p>许多Spring Boot启动器都包含默认的嵌入式容器。</p> <ul><li>对于servlet堆栈应用程序，通过<code>spring-boot-starter-web</code>包括来包括Tomcat <code>spring-boot-starter-tomcat</code>，但是您可以使用<code>spring-boot-starter-jetty</code>或<code>spring-boot-starter-undertow</code>代替。</li> <li>对于反应栈的应用，<code>spring-boot-starter-webflux</code>包括反应堆的Netty通过包括<code>spring-boot-starter-reactor-netty</code>，但你可以使用<code>spring-boot-starter-tomcat</code>，<code>spring-boot-starter-jetty</code>或<code>spring-boot-starter-undertow</code>代替。</li></ul> <p>切换到其他HTTP服务器时，除了包括所需的依赖关系之外，还需要排除默认的依赖关系。Spring Boot为HTTP服务器提供了单独的启动器，以帮助简化此过程。</p> <p>以下Maven示例显示了如何排除Tomcat并包括Spring MVC的Jetty：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-api.version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-api.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- Exclude the Tomcat dependency --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- Use Jetty instead --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jetty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Servlet API的版本已被覆盖，因为与Tomcat 9和Undertow 2.0不同，Jetty 9.4不支持Servlet 4.0。</p></div> <p>以下Gradle示例显示了如何排除Netty并包括Spring WebFlux的Undertow：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>configurations <span class="token punctuation">{</span>
    <span class="token comment">// exclude Reactor Netty</span>
    compile<span class="token punctuation">.</span>exclude module<span class="token punctuation">:</span> <span class="token string">'spring-boot-starter-reactor-netty'</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    compile <span class="token string">'org.springframework.boot:spring-boot-starter-webflux'</span>
    <span class="token comment">// Use Undertow instead</span>
    compile <span class="token string">'org.springframework.boot:spring-boot-starter-undertow'</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>spring-boot-starter-reactor-netty</code>使用<code>WebClient</code>该类是必需的，因此即使您需要包括其他HTTP服务器，也可能需要保持对Netty的依赖。</p></div> <h3 id="_3-2。禁用web服务器"><a href="#_3-2。禁用web服务器" class="header-anchor">#</a> 3.2。禁用Web服务器</h3> <p>如果您的类路径包含启动Web服务器所需的位，则Spring Boot将自动启动它。要禁用此行为，请<code>WebApplicationType</code>在中配置<code>application.properties</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.main.web-application-type</span><span class="token punctuation">=</span><span class="token attr-value">none</span>
</code></pre></div><h3 id="_3-3。更改http端口"><a href="#_3-3。更改http端口" class="header-anchor">#</a> 3.3。更改HTTP端口</h3> <p>在独立应用程序中，主HTTP端口默认为，<code>8080</code>但可以使用<code>server.port</code>（例如，在<code>application.properties</code>System属性中或作为System属性）进行设置。由于轻松地绑定了<code>Environment</code>值，因此还可以使用<code>SERVER_PORT</code>（例如，作为OS环境变量）。</p> <p>要完全关闭HTTP端点，但仍创建一个<code>WebApplicationContext</code>，请使用<code>server.port=-1</code>（这样做有时对测试很有用）。</p> <p>有关更多详细信息，请参阅“ Spring Boot功能”部分中的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-customizing-embedded-containers" target="_blank" rel="noopener noreferrer">spring-boot-features.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”或<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java" target="_blank" rel="noopener noreferrer"><code>ServerProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>源代码。</p> <h3 id="_3-4。使用随机未分配的http端口"><a href="#_3-4。使用随机未分配的http端口" class="header-anchor">#</a> 3.4。使用随机未分配的HTTP端口</h3> <p>要扫描可用端口（使用OS本机来防止冲突），请使用<code>server.port=0</code>。</p> <h3 id="_3-5。在运行时发现http端口"><a href="#_3-5。在运行时发现http端口" class="header-anchor">#</a> 3.5。在运行时发现HTTP端口</h3> <p>您可以从日志输出或<code>ServletWebServerApplicationContext</code>通过其端口访问服务器正在运行的端口<code>WebServer</code>。最好的方法是确保它已初始化，是添加一个<code>@Bean</code>类型<code>ApplicationListener&lt;ServletWebServerInitializedEvent&gt;</code>，然后在发布事件时将其从事件中拉出。</p> <p>使用的测试<code>@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code>还可以通过使用<code>@LocalServerPort</code>批注将实际端口注入字段中，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment<span class="token operator">=</span><span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyWebIntegrationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">ServletWebServerApplicationContext</span> server<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@LocalServerPort</span>
    <span class="token keyword">int</span> port<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>@LocalServerPort</code>是的元注释<code>@Value(&quot;${local.server.port}&quot;)</code>。不要尝试在常规应用程序中注入端口。如我们所见，仅在初始化容器之后才设置该值。与测试相反，应早处理应用程序代码回调（在值实际可用之前）。</p></div> <h3 id="_3-6。启用http响应压缩"><a href="#_3-6。启用http响应压缩" class="header-anchor">#</a> 3.6。启用HTTP响应压缩</h3> <p>Jetty，Tomcat和Undertow支持HTTP响应压缩。可以在中启用它<code>application.properties</code>，如下所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">server.compression.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><p>默认情况下，响应的长度必须至少为2048个字节才能执行压缩。您可以通过设置<code>server.compression.min-response-size</code>属性来配置此行为。</p> <p>默认情况下，仅当响应的内容类型为以下之一时，它们才被压缩：</p> <ul><li><code>text/html</code></li> <li><code>text/xml</code></li> <li><code>text/plain</code></li> <li><code>text/css</code></li> <li><code>text/javascript</code></li> <li><code>application/javascript</code></li> <li><code>application/json</code></li> <li><code>application/xml</code></li></ul> <p>您可以通过设置<code>server.compression.mime-types</code>属性来配置此行为。</p> <h3 id="_3-7。配置ssl"><a href="#_3-7。配置ssl" class="header-anchor">#</a> 3.7。配置SSL</h3> <p>可以通过设置各种<code>server.ssl.*</code>属性来声明性地配置SSL ，通常在<code>application.properties</code>或中<code>application.yml</code>。以下示例显示了在中设置SSL属性<code>application.properties</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">8443</span>
<span class="token attr-name">server.ssl.key-store</span><span class="token punctuation">=</span><span class="token attr-value">classpath:keystore.jks</span>
<span class="token attr-name">server.ssl.key-store-password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
<span class="token attr-name">server.ssl.key-password</span><span class="token punctuation">=</span><span class="token attr-value">another-secret</span>
</code></pre></div><p>有关<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/web/server/Ssl.java" target="_blank" rel="noopener noreferrer"><code>Ssl</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>所有受支持属性的详细信息，请参见。</p> <p>使用上述示例的配置意味着应用程序不再在端口8080上支持纯HTTP连接器。SpringBoot不支持通过进行HTTP连接器和HTTPS连接器的配置<code>application.properties</code>。如果要同时拥有两者，则需要以编程方式配置其中之一。我们建议您使用<code>application.properties</code>HTTPS进行配置，因为HTTP连接器是两者中以编程方式进行配置的较容易方式。</p> <h3 id="_3-8。配置http-2"><a href="#_3-8。配置http-2" class="header-anchor">#</a> 3.8。配置HTTP / 2</h3> <p>您可以使用<code>server.http2.enabled</code>配置属性在Spring Boot应用程序中启用HTTP / 2支持。该支持取决于所选的Web服务器和应用程序环境，因为JDK8不立即支持该协议。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot不支持<code>h2c</code>HTTP / 2协议的明文版本。因此，您必须先<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-configure-ssl" target="_blank" rel="noopener noreferrer">配置SSL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_3-8-1。带有undertow的http-2"><a href="#_3-8-1。带有undertow的http-2" class="header-anchor">#</a> 3.8.1。带有Undertow的HTTP / 2</h4> <p>从Undertow 1.4.0+开始，在JDK8上没有任何其他要求就支持HTTP / 2。</p> <h4 id="_3-8-2。http-2与码头"><a href="#_3-8-2。http-2与码头" class="header-anchor">#</a> 3.8.2。HTTP / 2与码头</h4> <p>从Jetty 9.4.8开始，<a href="https://www.conscrypt.org/" target="_blank" rel="noopener noreferrer">Conscrypt库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>还支持HTTP / 2 。要启用该支持，您的应用程序需要具有两个附加依赖项：<code>org.eclipse.jetty:jetty-alpn-conscrypt-server</code>和<code>org.eclipse.jetty.http2:http2-server</code>。</p> <h4 id="_3-8-3。tomcat的http-2"><a href="#_3-8-3。tomcat的http-2" class="header-anchor">#</a> 3.8.3。Tomcat的HTTP / 2</h4> <p>默认情况下，Spring Boot随Tomcat 9.0.x一起提供，当使用JDK 9或更高版本时，Tomcat 9.0.x支持HTTP / 2。另外，如果<code>libtcnative</code>库及其依赖项已安装在主机操作系统上，则可以在JDK 8上使用HTTP / 2 。</p> <p>如果没有，则必须使库文件夹可用于JVM库路径。您可以使用JVM参数（例如）来执行此操作<code>-Djava.library.path=/usr/local/opt/tomcat-native/lib</code>。有关更多信息，请参见<a href="https://tomcat.apache.org/tomcat-9.0-doc/apr.html" target="_blank" rel="noopener noreferrer">Tomcat官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>在没有该本机支持的情况下，在JDK 8上启动Tomcat 9.0.x会记录以下错误：</p> <div class="language- extra-class"><pre class="language-text"><code>错误8787-[[main] oacoyote.http11.Http11NioProtocol：[h2]的升级处理程序[org.apache.coyote.http2.Http2Protocol]仅支持通过ALPN进行升级，但已为[“ https-jsse-nio”配置-8443“]连接器不支持ALPN。
</code></pre></div><p>此错误不是致命错误，并且该应用程序仍以HTTP / 1.1 SSL支持开头。</p> <h4 id="_3-8-4。http-2和reactor-netty"><a href="#_3-8-4。http-2和reactor-netty" class="header-anchor">#</a> 3.8.4。HTTP / 2和Reactor Netty</h4> <p>在<code>spring-boot-webflux-starter</code>默认情况下，反应堆的Netty作为服务器使用。使用JDK 9或更高版本的JDK支持，可以将Reactor Netty配置为HTTP / 2。对于JDK 8环境或最佳运行时性能，此服务器还支持带有本机库的HTTP / 2。为此，您的应用程序需要具有其他依赖关系。</p> <p>Spring Boot管理<code>io.netty:netty-tcnative-boringssl-static</code>“超级罐” 的版本，其中包含所有平台的本机库。开发人员可以选择使用分类器仅导入所需的依赖项（请参阅<a href="https://netty.io/wiki/forked-tomcat-native.html" target="_blank" rel="noopener noreferrer">Netty官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p> <h3 id="_3-9。配置web服务器"><a href="#_3-9。配置web服务器" class="header-anchor">#</a> 3.9。配置Web服务器</h3> <p>通常，您首先应该考虑使用许多可用的配置键之一，并通过在您的<code>application.properties</code>（或<code>application.yml</code>，或环境等）中添加新条目来自定义Web服务器。请参阅“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-discover-build-in-options-for-external-properties" target="_blank" rel="noopener noreferrer">发现外部属性的内置选项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。该<code>server.*</code>命名空间是非常有用的在这里，它包括命名空间一样<code>server.tomcat.*</code>，<code>server.jetty.*</code>和其他人，对服务器的特定功能。请参阅<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-application-properties.html#common-application-properties" target="_blank" rel="noopener noreferrer">appendix-application-properties.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的列表。</p> <p>前面的部分已经介绍了许多常见的用例，例如压缩，SSL或HTTP / 2。但是，如果您的用例不存在配置密钥，则应查看<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/web/server/WebServerFactoryCustomizer.html" target="_blank" rel="noopener noreferrer"><code>WebServerFactoryCustomizer</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。您可以声明一个这样的组件，并访问与您选择的服务器相关的工厂：您应该为所选服务器（Tomcat，Jetty，Reactor Netty，Undertow）和所选Web堆栈（Servlet或Reactive）选择变体。</p> <p>以下示例适用于带有<code>spring-boot-starter-web</code>（Servlet堆栈）的Tomcat ：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTomcatWebServerCustomizer</span>
        <span class="token keyword">implements</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">TomcatServletWebServerFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// customize the factory here</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此外，Spring Boot还提供：</p> <table><thead><tr><th style="text-align:left;">服务器</th> <th style="text-align:left;">Servlet堆栈</th> <th style="text-align:left;">反应堆</th></tr></thead> <tbody><tr><td style="text-align:left;">雄猫</td> <td style="text-align:left;"><code>TomcatServletWebServerFactory</code></td> <td style="text-align:left;"><code>TomcatReactiveWebServerFactory</code></td></tr> <tr><td style="text-align:left;">码头</td> <td style="text-align:left;"><code>JettyServletWebServerFactory</code></td> <td style="text-align:left;"><code>JettyReactiveWebServerFactory</code></td></tr> <tr><td style="text-align:left;">底拖</td> <td style="text-align:left;"><code>UndertowServletWebServerFactory</code></td> <td style="text-align:left;"><code>UndertowReactiveWebServerFactory</code></td></tr> <tr><td style="text-align:left;">反应堆</td> <td style="text-align:left;">不适用</td> <td style="text-align:left;"><code>NettyReactiveWebServerFactory</code></td></tr></tbody></table> <p>一旦访问了<code>WebServerFactory</code>，就可以经常向其添加定制程序，以配置特定的部分，例如连接器，服务器资源或服务器本身-全部使用服务器特定的API。</p> <p>最后，您还可以声明自己的<code>WebServerFactory</code>组件，该组件将覆盖Spring Boot提供的组件。在这种情况下，您不能再依赖<code>server</code>命名空间中的配置属性。</p> <h3 id="_3-10。将servlet，过滤器或侦听器添加到应用程序"><a href="#_3-10。将servlet，过滤器或侦听器添加到应用程序" class="header-anchor">#</a> 3.10。将Servlet，过滤器或侦听器添加到应用程序</h3> <p>在一个servlet栈的应用，即用<code>spring-boot-starter-web</code>，有两种方法可以添加<code>Servlet</code>，<code>Filter</code>，<code>ServletContextListener</code>，和由Servlet API到您的应用程序支持的其他听众：</p> <ul><li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-add-a-servlet-filter-or-listener-as-spring-bean" target="_blank" rel="noopener noreferrer">使用Spring Bean添加Servlet，过滤器或侦听器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-add-a-servlet-filter-or-listener-using-scanning" target="_blank" rel="noopener noreferrer">使用类路径扫描添加Servlet，过滤器和侦听器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="_3-10-1。使用spring-bean添加servlet，过滤器或侦听器"><a href="#_3-10-1。使用spring-bean添加servlet，过滤器或侦听器" class="header-anchor">#</a> 3.10.1。使用Spring Bean添加Servlet，过滤器或侦听器</h4> <p>要添加<code>Servlet</code>，<code>Filter</code>或servlet <code>*Listener</code>使用的Spring bean，你必须提供一个<code>@Bean</code>它的定义。当您要注入配置或依赖项时，这样做非常有用。但是，您必须非常小心，以免引起过多其他bean的急切初始化，因为必须在应用程序生命周期的早期就将它们安装在容器中。（例如，让它们依赖于您的<code>DataSource</code>或JPA配置不是一个好主意。）您可以通过在首次使用bean时而不是在初始化时进行延迟初始化来解决这些限制。</p> <p>在的情况下<code>Filters</code>和<code>Servlets</code>，还可以通过添加添加映射和初始化参数<code>FilterRegistrationBean</code>或<code>ServletRegistrationBean</code>代替或除了下面的部件。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果<code>dispatcherType</code>在过滤器注册上未指定no ，<code>REQUEST</code>则使用。这符合Servlet规范的默认调度程序类型。</p></div> <p>像其他任何Spring bean一样，您可以定义Servlet过滤器bean的顺序。请确保检查“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-embedded-container-servlets-filters-listeners-beans" target="_blank" rel="noopener noreferrer">spring-boot-features.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”部分。</p> <h5 id="禁用servlet或过滤器的注册"><a href="#禁用servlet或过滤器的注册" class="header-anchor">#</a> 禁用Servlet或过滤器的注册</h5> <p>正如<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-add-a-servlet-filter-or-listener-as-spring-bean" target="_blank" rel="noopener noreferrer">前面所述<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，任何<code>Servlet</code>或<code>Filter</code>豆与servlet容器自动注册。要禁用特定<code>Filter</code>或<code>Servlet</code>bean的注册，请为其创建注册bean并将其标记为已禁用，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">registration</span><span class="token punctuation">(</span><span class="token class-name">MyFilter</span> filter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">FilterRegistrationBean</span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    registration<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> registration<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-10-2。使用类路径扫描添加servlet，过滤器和侦听器"><a href="#_3-10-2。使用类路径扫描添加servlet，过滤器和侦听器" class="header-anchor">#</a> 3.10.2。使用类路径扫描添加Servlet，过滤器和侦听器</h4> <p><code>@WebServlet</code>，，<code>@WebFilter</code>和带<code>@WebListener</code>注释的类可以通过向注释一个<code>@Configuration</code>类<code>@ServletComponentScan</code>并指定包含要注册的组件的包来自动向嵌入式servlet容器注册。默认情况下，<code>@ServletComponentScan</code>从带注释的类的包进行扫描。</p> <h3 id="_3-11。配置访问日志"><a href="#_3-11。配置访问日志" class="header-anchor">#</a> 3.11。配置访问日志</h3> <p>可以通过它们各自的名称空间为Tomcat，Undertow和Jetty配置访问日志。</p> <p>例如，以下设置使用<a href="https://tomcat.apache.org/tomcat-9.0-doc/config/valve.html#Access_Logging" target="_blank" rel="noopener noreferrer">自定义模式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>记录对Tomcat的访问。</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">server.tomcat.basedir</span><span class="token punctuation">=</span><span class="token attr-value">my-tomcat</span>
<span class="token attr-name">server.tomcat.accesslog.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">server.tomcat.accesslog.pattern</span><span class="token punctuation">=</span><span class="token attr-value">%t %a &quot;%r&quot; %s (%D ms)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>日志的默认位置是<code>logs</code>相对于Tomcat基本目录的目录。默认情况下，该<code>logs</code>目录是一个临时目录，因此您可能需要修复Tomcat的基本目录或对日志使用绝对路径。在前面的示例中，日志<code>my-tomcat/logs</code>相对于应用程序的工作目录可用。</p></div> <p>可以用类似的方式配置Undertow的访问日志，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">server.undertow.accesslog.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">server.undertow.accesslog.pattern</span><span class="token punctuation">=</span><span class="token attr-value">%t %a &quot;%r&quot; %s (%D ms)</span>
</code></pre></div><p>日志存储在<code>logs</code>相对于应用程序工作目录的目录中。您可以通过设置<code>server.undertow.accesslog.dir</code>属性来自定义此位置。</p> <p>最后，Jetty的访问日志也可以配置如下：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">server.jetty.accesslog.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">server.jetty.accesslog.filename</span><span class="token punctuation">=</span><span class="token attr-value">/var/log/jetty-access.log</span>
</code></pre></div><p>默认情况下，日志重定向到<code>System.err</code>。有关更多详细信息，请参见<a href="https://www.eclipse.org/jetty/documentation/9.4.24.v20191120/configuring-jetty-request-logs.html" target="_blank" rel="noopener noreferrer">Jetty文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_3-12。在前端代理服务器后面运行"><a href="#_3-12。在前端代理服务器后面运行" class="header-anchor">#</a> 3.12。在前端代理服务器后面运行</h3> <p>您的应用程序可能需要发送<code>302</code>重定向或使用绝对链接将内容呈现回自身。当在代理后面运行时，调用者需要链接到代理，而不要链接到托管您的应用程序的计算机的物理地址。通常，此类情况是通过与代理之间的合同来处理的，该代理添加了标头，以告诉后端如何构造与自身的链接。</p> <p>如果代理添加常规<code>X-Forwarded-For</code>和<code>X-Forwarded-Proto</code>标头（大多数代理服务器都这样做），则绝对链接应正确呈现，只要<code>server.forward-headers-strategy</code>将设置为<code>NATIVE</code>或<code>FRAMEWORK</code>中<code>application.properties</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您的应用程序在Cloud Foundry或Heroku中运行，则该<code>server.forward-headers-strategy</code>属性默认为<code>NATIVE</code>。在所有其他情况下，默认为<code>NONE</code>。</p></div> <h4 id="_3-12-1。自定义tomcat的代理配置"><a href="#_3-12-1。自定义tomcat的代理配置" class="header-anchor">#</a> 3.12.1。自定义Tomcat的代理配置</h4> <p>如果使用Tomcat，则可以另外配置用于携带“转发的”信息的标头名称，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>server.tomcat.remote-ip-header = x-您的远程IP-header
server.tomcat.protocol-header = x-您的协议头
</code></pre></div><p>Tomcat还配置有一个默认正则表达式，该正则表达式与要信任的内部代理匹配。默认情况下，IP地址<code>10/8</code>，<code>192.168/16</code>，<code>169.254/16</code>并且<code>127/8</code>是值得信赖的。您可以通过在上添加一个条目来自定义阀门的配置<code>application.properties</code>，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>server.tomcat.internal-proxies = 192 \\。168 \\。\\ d {1,3} \\。\\ d {1,3}
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>仅当使用属性文件进行配置时，才需要双反斜杠。如果使用YAML，则单个反斜杠就足够了，并且与上一个示例中所示的值相等<code>192\.168\.\d{1,3}\.\d{1,3}</code>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以通过将设置<code>internal-proxies</code>为空来信任所有代理（但在生产环境中不要这样做）。</p></div> <p>您可以<code>RemoteIpValve</code>通过关闭自动开关（设置为set <code>server.forward-headers-strategy=NONE</code>）并在<code>TomcatServletWebServerFactory</code>bean中添加新的Valve实例来完全控制Tomcat的配置。</p> <h3 id="_3-13。使用tomcat启用多个连接器"><a href="#_3-13。使用tomcat启用多个连接器" class="header-anchor">#</a> 3.13。使用Tomcat启用多个连接器</h3> <p>您可以在中添加，<code>org.apache.catalina.connector.Connector</code>以<code>TomcatServletWebServerFactory</code>允许多个连接器，包括HTTP和HTTPS连接器，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ServletWebServerFactory</span> <span class="token function">servletContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">TomcatServletWebServerFactory</span> tomcat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tomcat<span class="token punctuation">.</span><span class="token function">addAdditionalTomcatConnectors</span><span class="token punctuation">(</span><span class="token function">createSslConnector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> tomcat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">Connector</span> <span class="token function">createSslConnector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Connector</span> connector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Connector</span><span class="token punctuation">(</span><span class="token string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Http11NioProtocol</span> protocol <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Http11NioProtocol</span><span class="token punctuation">)</span> connector<span class="token punctuation">.</span><span class="token function">getProtocolHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> keystore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> truststore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;keystore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connector<span class="token punctuation">.</span><span class="token function">setScheme</span><span class="token punctuation">(</span><span class="token string">&quot;https&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connector<span class="token punctuation">.</span><span class="token function">setSecure</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connector<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">8443</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        protocol<span class="token punctuation">.</span><span class="token function">setSSLEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        protocol<span class="token punctuation">.</span><span class="token function">setKeystoreFile</span><span class="token punctuation">(</span>keystore<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        protocol<span class="token punctuation">.</span><span class="token function">setKeystorePass</span><span class="token punctuation">(</span><span class="token string">&quot;changeit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        protocol<span class="token punctuation">.</span><span class="token function">setTruststoreFile</span><span class="token punctuation">(</span>truststore<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        protocol<span class="token punctuation">.</span><span class="token function">setTruststorePass</span><span class="token punctuation">(</span><span class="token string">&quot;changeit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        protocol<span class="token punctuation">.</span><span class="token function">setKeyAlias</span><span class="token punctuation">(</span><span class="token string">&quot;apitester&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> connector<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;can't access keystore: [&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;keystore&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;] or truststore: [&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;keystore&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-14。使用tomcat的legacycookieprocessor"><a href="#_3-14。使用tomcat的legacycookieprocessor" class="header-anchor">#</a> 3.14。使用Tomcat的LegacyCookieProcessor</h3> <p>默认情况下，Spring Boot使用的嵌入式Tomcat不支持Cookie格式的“版本0”，因此您可能会看到以下错误：</p> <div class="language- extra-class"><pre class="language-text"><code>java.lang.IllegalArgumentException：Cookie值中存在无效字符[32]
</code></pre></div><p>如果有可能，您应该考虑将代码更新为仅存储符合以后Cookie规范的值。但是，如果无法更改cookie的编写方式，则可以将Tomcat配置为使用<code>LegacyCookieProcessor</code>。要切换到<code>LegacyCookieProcessor</code>，请使用<code>WebServerFactoryCustomizer</code>添加了的Bean <code>TomcatContextCustomizer</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token function">cookieProcessorCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>factory<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> factory
            <span class="token punctuation">.</span><span class="token function">addContextCustomizers</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> context<span class="token punctuation">.</span><span class="token function">setCookieProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LegacyCookieProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-15。启用tomcat的mbean注册表"><a href="#_3-15。启用tomcat的mbean注册表" class="header-anchor">#</a> 3.15。启用Tomcat的MBean注册表</h3> <p>默认情况下，嵌入式Tomcat的MBean注册表是禁用的。这样可以最大程度地减少Tomcat的内存占用。例如，如果要使用Tomcat的MBean，以便可以通过Micrometer公开它们，则必须使用<code>server.tomcat.mbeanregistry.enabled</code>属性，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">server.tomcat.mbeanregistry.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><h3 id="_3-16。使用undertow启用多个侦听器"><a href="#_3-16。使用undertow启用多个侦听器" class="header-anchor">#</a> 3.16。使用Undertow启用多个侦听器</h3> <p>在中添加一个<code>UndertowBuilderCustomizer</code>，<code>UndertowServletWebServerFactory</code>并在中添加一个侦听器<code>Builder</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">UndertowServletWebServerFactory</span> <span class="token function">servletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">UndertowServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UndertowServletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">addBuilderCustomizers</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UndertowBuilderCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            builder<span class="token punctuation">.</span><span class="token function">addHttpListener</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-17。使用-serverendpoint创建websocket端点"><a href="#_3-17。使用-serverendpoint创建websocket端点" class="header-anchor">#</a> 3.17。使用@ServerEndpoint创建WebSocket端点</h3> <p>如果要在使用<code>@ServerEndpoint</code>嵌入式容器的Spring Boot应用程序中使用，必须声明一个single <code>ServerEndpointExporter</code> <code>@Bean</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ServerEndpointExporter</span> <span class="token function">serverEndpointExporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServerEndpointExporter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>前面示例中显示的bean将所有带<code>@ServerEndpoint</code>注释的bean 注册到基础WebSocket容器中。当部署到独立servlet容器时，此角色由servlet容器初始化程序执行，并且<code>ServerEndpointExporter</code>不需要bean。</p> <h2 id="_4-spring-mvc"><a href="#_4-spring-mvc" class="header-anchor">#</a> 4. Spring MVC</h2> <p>Spring Boot有许多启动器，其中包括Spring MVC。请注意，一些入门者包括对Spring MVC的依赖，而不是直接包含它。本部分回答有关Spring MVC和Spring Boot的常见问题。</p> <h3 id="_4-1。编写json-rest服务"><a href="#_4-1。编写json-rest服务" class="header-anchor">#</a> 4.1。编写JSON REST服务</h3> <p><code>@RestController</code>只要Jackson2在类路径上，Spring Boot应用程序中的任何Spring 默认情况下都应呈现JSON响应，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/thing&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">MyThing</span> <span class="token function">thing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>只要<code>MyThing</code>可以由Jackson2序列化（对于普通的POJO或Groovy对象为true），则<code>localhost:8080/thing</code>默认情况下会为其提供JSON表示。请注意，在浏览器中，有时可能会看到XML响应，因为浏览器倾向于发送更喜欢XML的接受标头。</p> <h3 id="_4-2。编写xml-rest服务"><a href="#_4-2。编写xml-rest服务" class="header-anchor">#</a> 4.2。编写XML REST服务</h3> <p>如果<code>jackson-dataformat-xml</code>类路径上具有Jackson XML扩展名（），则可以使用它来呈现XML响应。我们用于JSON的先前示例可以正常工作。要使用Jackson XML渲染器，请将以下依赖项添加到您的项目中：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.dataformat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-dataformat-xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果无法使用Jackson的XML扩展名而可以使用JAXB，则可以将XML <code>MyThing</code>注释为<code>@XmlRootElement</code>，并具有附加要求，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@XmlRootElement</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThing</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token comment">// .. getters and setters</span>
<span class="token punctuation">}</span>
</code></pre></div><p>JAXB仅在Java 8中是开箱即用的。如果您使用的是较新的Java版本，请在项目中添加以下依赖项：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.glassfish.jaxb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jaxb-runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>要使服务器呈现XML而不是JSON，您可能必须发送<code>Accept: text/xml</code>标头（或使用浏览器）。</p></div> <h3 id="_4-3。自定义jackson-objectmapper"><a href="#_4-3。自定义jackson-objectmapper" class="header-anchor">#</a> 4.3。自定义Jackson ObjectMapper</h3> <p>Spring MVC（客户端和服务器端）用于<code>HttpMessageConverters</code>协商HTTP交换中的内容转换。如果Jackson在类路径中，则您已经获得所提供的默认转换器，该转换器<code>Jackson2ObjectMapperBuilder</code>的实例已为您自动配置。</p> <p>该<code>ObjectMapper</code>（或<code>XmlMapper</code>为杰克逊XML转换器）实例（默认创建）具有以下定义的属性：</p> <ul><li><code>MapperFeature.DEFAULT_VIEW_INCLUSION</code> 被禁用</li> <li><code>DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES</code> 被禁用</li> <li><code>SerializationFeature.WRITE_DATES_AS_TIMESTAMPS</code> 被禁用</li></ul> <p>Spring Boot还具有一些功能，可以更轻松地自定义此行为。</p> <p>您可以使用环境配置<code>ObjectMapper</code>和<code>XmlMapper</code>实例。杰克逊提供了一套广泛的简单的开/关功能，可用于配置其处理的各个方面。在六个枚举（在Jackson中）中描述了这些功能，这些枚举映射到环境中的属性：</p> <table><thead><tr><th style="text-align:left;">枚举</th> <th style="text-align:left;">属性</th> <th style="text-align:left;">价值观</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>com.fasterxml.jackson.databind.DeserializationFeature</code></td> <td style="text-align:left;"><code>spring.jackson.deserialization.&lt;feature_name&gt;</code></td> <td style="text-align:left;"><code>true</code>， <code>false</code></td></tr> <tr><td style="text-align:left;"><code>com.fasterxml.jackson.core.JsonGenerator.Feature</code></td> <td style="text-align:left;"><code>spring.jackson.generator.&lt;feature_name&gt;</code></td> <td style="text-align:left;"><code>true</code>， <code>false</code></td></tr> <tr><td style="text-align:left;"><code>com.fasterxml.jackson.databind.MapperFeature</code></td> <td style="text-align:left;"><code>spring.jackson.mapper.&lt;feature_name&gt;</code></td> <td style="text-align:left;"><code>true</code>， <code>false</code></td></tr> <tr><td style="text-align:left;"><code>com.fasterxml.jackson.core.JsonParser.Feature</code></td> <td style="text-align:left;"><code>spring.jackson.parser.&lt;feature_name&gt;</code></td> <td style="text-align:left;"><code>true</code>， <code>false</code></td></tr> <tr><td style="text-align:left;"><code>com.fasterxml.jackson.databind.SerializationFeature</code></td> <td style="text-align:left;"><code>spring.jackson.serialization.&lt;feature_name&gt;</code></td> <td style="text-align:left;"><code>true</code>， <code>false</code></td></tr> <tr><td style="text-align:left;"><code>com.fasterxml.jackson.annotation.JsonInclude.Include</code></td> <td style="text-align:left;"><code>spring.jackson.default-property-inclusion</code></td> <td style="text-align:left;"><code>always</code>，<code>non_null</code>，<code>non_absent</code>，<code>non_default</code>，<code>non_empty</code></td></tr></tbody></table> <p>例如，要启用漂亮打印，请设置<code>spring.jackson.serialization.indent_output=true</code>。请注意，由于使用了<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-relaxed-binding" target="_blank" rel="noopener noreferrer">宽松的绑定<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，的大小写<code>indent_output</code>不必与相应的枚举常量的大小写匹配<code>INDENT_OUTPUT</code>。</p> <p>这种基于环境的配置适用于自动配置的<code>Jackson2ObjectMapperBuilder</code>Bean，并且适用于使用构建器创建的任何映射器，包括自动配置的<code>ObjectMapper</code>Bean。</p> <p>上下文<code>Jackson2ObjectMapperBuilder</code>可以由一个或多个<code>Jackson2ObjectMapperBuilderCustomizer</code>bean 自定义。可以对此类定制器bean进行排序（Boot自己的定制器的顺序为0），从而可以在Boot定制之前和之后应用其他定制。</p> <p>任何类型的bean都会<code>com.fasterxml.jackson.databind.Module</code>自动向自动配置中注册，<code>Jackson2ObjectMapperBuilder</code>并应用于<code>ObjectMapper</code>它创建的任何实例。当您向应用程序中添加新功能时，这提供了一种用于贡献自定义模块的全局机制。</p> <p>如果要<code>ObjectMapper</code>完全替换默认值，请定义<code>@Bean</code>该类型的a并将其标记为，<code>@Primary</code>或者，如果您更喜欢基于构建器的方法，请定义一个<code>Jackson2ObjectMapperBuilder</code> <code>@Bean</code>。请注意，无论哪种情况，这样做都会禁用的所有自动配置<code>ObjectMapper</code>。</p> <p>如果提供任何<code>@Beans</code>type <code>MappingJackson2HttpMessageConverter</code>，它们将替换MVC配置中的默认值。另外，<code>HttpMessageConverters</code>还提供了一种类型的便捷bean （如果使用默认的MVC配置，该bean 始终可用）。它提供了一些有用的方法来访问默认的和用户增强的消息转换器。</p> <p>有关更多详细信息，请参见“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-customize-the-responsebody-rendering" target="_blank" rel="noopener noreferrer">自定义@ResponseBody渲染<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”部分和<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>WebMvcAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>源代码。</p> <h3 id="_4-4。自定义-responsebody渲染"><a href="#_4-4。自定义-responsebody渲染" class="header-anchor">#</a> 4.4。自定义@ResponseBody渲染</h3> <p>Spring用于<code>HttpMessageConverters</code>呈现<code>@ResponseBody</code>（或的响应<code>@RestController</code>）。您可以通过在Spring Boot上下文中添加适当类型的bean来贡献额外的转换器。如果您添加的bean的类型无论如何都是默认包含的（例如<code>MappingJackson2HttpMessageConverter</code>JSON转换），它将替换默认值。<code>HttpMessageConverters</code>提供了类型的便捷bean，如果您使用默认的MVC配置，它将始终可用。它提供了一些有用的方法来访问默认的和用户增强的消息转换器（例如，如果您想将它们手动注入到custom中，可能会很有用<code>RestTemplate</code>）。</p> <p>与正常的MVC用法一样，<code>WebMvcConfigurer</code>您提供的任何bean也可以通过重写<code>configureMessageConverters</code>方法来贡献转换器。但是，与普通的MVC不同，您只能提供所需的其他转换器（因为Spring Boot使用相同的机制来提供其默认值）。最后，如果您通过提供自己的<code>@EnableWebMvc</code>配置来退出Spring Boot默认MVC 配置，则可以完全控制并使用<code>getMessageConverters</code>from 手动完成所有操作<code>WebMvcConfigurationSupport</code>。</p> <p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>WebMvcAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>源代码以获取更多详细信息。</p> <h3 id="_4-5。处理分段文件上传"><a href="#_4-5。处理分段文件上传" class="header-anchor">#</a> 4.5。处理分段文件上传</h3> <p>Spring Boot包含Servlet 3 <code>javax.servlet.http.Part</code>API以支持上传文件。默认情况下，Spring Boot用单个请求将Spring MVC配置为每个文件最大大小为1MB，最大文件数据为10MB。您可以覆盖这些值，使用中间类<code>/tmp</code>公开的属性覆盖中间数据的存储位置（例如，存储到目录）以及将数据刷新到磁盘的阈值<code>MultipartProperties</code>。例如，如果您要指定文件不受限制，请将<code>spring.servlet.multipart.max-file-size</code>属性设置为<code>-1</code>。</p> <p>当您想在Spring MVC控制器处理程序方法中将多部分编码的文件数据作为带<code>@RequestParam</code>注释的类型的参数来接收时，多部分支持会很有帮助<code>MultipartFile</code>。</p> <p>有关<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/MultipartAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>MultipartAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更多详细信息，请参见源。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>建议使用容器的内置支持进行分段上传，而不要引入其他依赖项，例如Apache Commons File Upload。</p></div> <h3 id="_4-6。关闭spring-mvc-dispatcherservlet"><a href="#_4-6。关闭spring-mvc-dispatcherservlet" class="header-anchor">#</a> 4.6。关闭Spring MVC DispatcherServlet</h3> <p>默认情况下，所有内容均从应用程序的根目录（<code>/</code>）提供。如果您希望映射到其他路径，则可以如下配置：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mvc.servlet.path</span><span class="token punctuation">=</span><span class="token attr-value">/acme</span>
</code></pre></div><p>如果您有其他servlet，则可以声明一个或<code>@Bean</code>类型，然后Spring Boot会将它们透明地注册到容器。由于Servlet是通过这种方式注册的，因此可以将它们映射到的子上下文而无需调用它。<code>Servlet``ServletRegistrationBean``DispatcherServlet</code></p> <p>配置<code>DispatcherServlet</code>您自己是不寻常的，但是如果您确实需要这样做，则还必须提供一个<code>@Bean</code>type <code>DispatcherServletPath</code>来提供自定义的路径<code>DispatcherServlet</code>。</p> <h3 id="_4-7。关闭默认的mvc配置"><a href="#_4-7。关闭默认的mvc配置" class="header-anchor">#</a> 4.7。关闭默认的MVC配置</h3> <p>完全控制MVC配置的最简单方法是为您自己<code>@Configuration</code>提供<code>@EnableWebMvc</code>注释。这样做会使您掌握所有MVC配置。</p> <h3 id="_4-8。自定义viewresolvers"><a href="#_4-8。自定义viewresolvers" class="header-anchor">#</a> 4.8。自定义ViewResolvers</h3> <p>A <code>ViewResolver</code>是Spring MVC的核心组件，将视图名称转换<code>@Controller</code>为实际的<code>View</code>实现。请注意，<code>ViewResolvers</code>它主要用于UI应用程序，而不是REST风格的服务（a <code>View</code>不用于呈现a <code>@ResponseBody</code>）。有很多实现<code>ViewResolver</code>可供选择，Spring本身对是否应使用哪个没有意见。另一方面，Spring Boot根据在类路径和应用程序上下文中找到的内容为您安装一个或两个。会<code>DispatcherServlet</code>使用它在应用程序上下文中找到的所有解析器，依次尝试每个解析器，直到获得结果为止。如果添加自己的解析器，则必须知道其顺序以及解析器的添加位置。</p> <p><code>WebMvcAutoConfiguration</code>将以下内容添加<code>ViewResolvers</code>到您的上下文中：</p> <ul><li>一个<code>InternalResourceViewResolver</code>名为“defaultViewResolver”。此代码查找可以通过使用渲染的物理资源<code>DefaultServlet</code>（包括静态资源和JSP页面，如果使用的话）。它将一个前缀和一个后缀应用于视图名称，然后在Servlet上下文中查找具有该路径的物理资源（默认值均为空，但可以通过<code>spring.mvc.view.prefix</code>和进行外部配置访问<code>spring.mvc.view.suffix</code>）。您可以通过提供相同类型的bean覆盖它。</li> <li>一个<code>BeanNameViewResolver</code>名为“beanNameViewResolver”。这是视图解析器链的有用成员，可以拾取与<code>View</code>被解析名称相同的所有bean 。不必重写或替换它。</li> <li><code>ContentNegotiatingViewResolver</code>仅当实际存在类型<strong>为</strong> bean的情况下，才添加一个名为“ viewResolver”的视图<code>View</code>。这是一个“主”解析器，委派给所有其他解析器，并尝试查找与客户端发送的“ Accept” HTTP标头匹配的内容。有一个有用的<a href="https://spring.io/blog/2013/06/03/content-negotiation-using-views" target="_blank" rel="noopener noreferrer">博客<code>ContentNegotiatingViewResolver</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，您可能想学习以了解更多信息，并且您也可以查看源代码以获取详细信息。您可以<code>ContentNegotiatingViewResolver</code>通过定义一个名为“ viewResolver”的bean 来关闭自动配置。</li> <li>如果您使用Thymeleaf，则还有一个<code>ThymeleafViewResolver</code>名为“ thymeleafViewResolver”的文件。它通过在视图名称前后加上前缀和后缀来查找资源。前缀为<code>spring.thymeleaf.prefix</code>，后缀为<code>spring.thymeleaf.suffix</code>。前缀和后缀的值分别默认为“ classpath：/ templates /”和“ .html”。您可以<code>ThymeleafViewResolver</code>通过提供相同名称的bean 来覆盖。</li> <li>如果您使用FreeMarker，则还有一个<code>FreeMarkerViewResolver</code>名为“ freeMarkerViewResolver”的文件。它<code>spring.freemarker.templateLoaderPath</code>通过在视图名称前加上前缀和后缀来在加载程序路径（已外部化并具有默认值'classpath：/ templates /'）中查找资源。前缀被外部<code>spring.freemarker.prefix</code>化为，后缀被外部化为<code>spring.freemarker.suffix</code>。前缀和后缀的默认值分别为空和'.ftlh'。您可以<code>FreeMarkerViewResolver</code>通过提供相同名称的bean 来覆盖。</li> <li>如果您使用Groovy模板（实际上，如果<code>groovy-templates</code>在类路径中），则还具有一个<code>GroovyMarkupViewResolver</code>名为“ groovyMarkupViewResolver”的文件。它通过在视图名称周围加上前缀和后缀（<code>spring.groovy.template.prefix</code>并扩展为和<code>spring.groovy.template.suffix</code>）来在加载器路径中查找资源。前缀和后缀分别具有默认值'classpath：/ templates /'和'.tpl'。您可以<code>GroovyMarkupViewResolver</code>通过提供相同名称的bean 来覆盖。</li> <li>如果您使用Moustache，则还有一个<code>MustacheViewResolver</code>名为“ mustacheViewResolver”的文件。它通过在视图名称前后加上前缀和后缀来查找资源。前缀为<code>spring.mustache.prefix</code>，后缀为<code>spring.mustache.suffix</code>。前缀和后缀的值分别默认为“ classpath：/ templates /”和“ .mustache”。您可以<code>MustacheViewResolver</code>通过提供相同名称的bean 来覆盖。</li></ul> <p>有关更多详细信息，请参见以下部分：</p> <ul><li><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/WebMvcAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>WebMvcAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/thymeleaf/ThymeleafAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>ThymeleafAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/freemarker/FreeMarkerAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>FreeMarkerAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/groovy/template/GroovyTemplateAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>GroovyTemplateAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="_5-使用spring-security进行测试"><a href="#_5-使用spring-security进行测试" class="header-anchor">#</a> 5.使用Spring Security进行测试</h2> <p>Spring Security提供了对以特定用户身份运行测试的支持。例如，下面的代码段中的测试将与具有该<code>ADMIN</code>角色的经过身份验证的用户一起运行。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token annotation punctuation">@WithMockUser</span><span class="token punctuation">(</span>roles<span class="token operator">=</span><span class="token string">&quot;ADMIN&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">requestProtectedUrlWithUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    mvc
        <span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Spring Security提供了与Spring MVC Test的全面集成，并且在使用<code>@WebMvcTest</code>slice和进行测试控制器时也可以使用它<code>MockMvc</code>。</p> <p>有关Spring Security的测试支持的更多详细信息，请参阅Spring Security的<a href="https://docs.spring.io/spring-security/site/docs/5.2.1.RELEASE/reference/htmlsingle/#test" target="_blank" rel="noopener noreferrer">参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="_6-球衣"><a href="#_6-球衣" class="header-anchor">#</a> 6.球衣</h2> <h3 id="_6-1。使用spring-security保护jersey端点"><a href="#_6-1。使用spring-security保护jersey端点" class="header-anchor">#</a> 6.1。使用Spring Security保护Jersey端点</h3> <p>可以使用Spring Security来保护基于Jersey的Web应用程序，其方式与用来保护基于Spring MVC的Web应用程序的方式几乎相同。但是，如果您想在Jersey上使用Spring Security的方法级安全性，则必须将Jersey配置为使用<code>setStatus(int)</code>pretty <code>sendError(int)</code>。这可以防止Jersey在Spring Security有机会向客户端报告身份验证或授权失败之前提交响应。</p> <p>该<code>jersey.config.server.response.setStatusOverSendError</code>属性必须<code>true</code>在应用程序的<code>ResourceConfig</code>Bean 上设置为，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JerseyConfig</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">JerseyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Endpoint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setProperties</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">&quot;jersey.config.server.response.setStatusOverSendError&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-2。与另一个web框架一起使用jersey"><a href="#_6-2。与另一个web框架一起使用jersey" class="header-anchor">#</a> 6.2。与另一个Web框架一起使用Jersey</h3> <p>要将Jersey与其他Web框架（例如Spring MVC）一起使用，应对其进行配置，以便它将允许其他框架处理无法处理的请求。首先，通过将<code>spring.jersey.type</code>应用程序属性配置为值，将Jersey配置为使用过滤器而不是Servlet <code>filter</code>。其次，配置您的<code>ResourceConfig</code>请求以转发可能导致404的请求，如以下示例所示。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JerseyConfig</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">JerseyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Endpoint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">property</span><span class="token punctuation">(</span><span class="token class-name">ServletProperties</span><span class="token punctuation">.</span>FILTER_FORWARD_ON_404<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-http客户端"><a href="#_7-http客户端" class="header-anchor">#</a> 7. HTTP客户端</h2> <p>Spring Boot提供了许多可与HTTP客户端一起使用的启动器。本节回答与使用它们有关的问题。</p> <h3 id="_7-1。配置resttemplate使用代理"><a href="#_7-1。配置resttemplate使用代理" class="header-anchor">#</a> 7.1。配置RestTemplate使用代理</h3> <p>如<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-resttemplate-customization" target="_blank" rel="noopener noreferrer">spring-boot-features.html中所述<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，您可以使用<code>RestTemplateCustomizer</code>with <code>RestTemplateBuilder</code>来构建自定义的<code>RestTemplate</code>。这是创建<code>RestTemplate</code>配置为使用代理的推荐方法。</p> <p>代理配置的确切详细信息取决于所使用的基础客户端请求工厂。以下示例使用进行配置<code>HttpComponentsClientRequestFactory</code>，该<code>HttpClient</code>代理使用除<code>192.168.0.5</code>以下主机之外的所有主机的代理：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ProxyCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">RestTemplateCustomizer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpHost</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;proxy.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpClient</span> httpClient <span class="token operator">=</span> <span class="token class-name">HttpClientBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRoutePlanner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultProxyRoutePlanner</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">HttpHost</span> <span class="token function">determineProxy</span><span class="token punctuation">(</span><span class="token class-name">HttpHost</span> target<span class="token punctuation">,</span> <span class="token class-name">HttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpContext</span> context<span class="token punctuation">)</span>
                    <span class="token keyword">throws</span> <span class="token class-name">HttpException</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.0.5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">determineProxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> request<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        restTemplate<span class="token punctuation">.</span><span class="token function">setRequestFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpComponentsClientHttpRequestFactory</span><span class="token punctuation">(</span>httpClient<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-2。配置基于reactor-netty的webclient使用的tcpclient"><a href="#_7-2。配置基于reactor-netty的webclient使用的tcpclient" class="header-anchor">#</a> 7.2。配置基于Reactor Netty的WebClient使用的TcpClient</h3> <p>当Reactor Netty在类路径上时，将<code>WebClient</code>自动配置基于Reactor Netty的文件。要自定义客户端对网络连接的处理，请提供一个<code>ClientHttpConnector</code>bean。以下示例配置60秒的连接超时并添加<code>ReadTimeoutHandler</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token class-name">ClientHttpConnector</span> <span class="token function">clientHttpConnector</span><span class="token punctuation">(</span><span class="token class-name">ReactorResourceFactory</span> resourceFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">TcpClient</span> tcpClient <span class="token operator">=</span> <span class="token class-name">TcpClient</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>resourceFactory<span class="token punctuation">.</span><span class="token function">getConnectionProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">runOn</span><span class="token punctuation">(</span>resourceFactory<span class="token punctuation">.</span><span class="token function">getLoopResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span>CONNECT_TIMEOUT_MILLIS<span class="token punctuation">,</span> <span class="token number">60000</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">doOnConnected</span><span class="token punctuation">(</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> connection<span class="token punctuation">.</span><span class="token function">addHandlerLast</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReadTimeoutHandler</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ReactorClientHttpConnector</span><span class="token punctuation">(</span><span class="token class-name">HttpClient</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>tcpClient<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>请注意对<code>ReactorResourceFactory</code>连接提供程序和事件循环资源的使用。这确保了用于服务器接收请求和客户端发出请求的资源的有效共享。</p></div> <h2 id="_8-记录"><a href="#_8-记录" class="header-anchor">#</a> 8.记录</h2> <p>除了通常由Spring Framework的<code>spring-jcl</code>模块提供的Commons Logging API之外，Spring Boot没有强制性的日志记录依赖项。要使用<a href="https://logback.qos.ch/" target="_blank" rel="noopener noreferrer">Logback<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，您需要将其包括<code>spring-jcl</code>在类路径中。最简单的方法是通过启动器，这都取决于<code>spring-boot-starter-logging</code>。对于Web应用程序，您仅需要<code>spring-boot-starter-web</code>，因为它暂时依赖于日志记录启动器。如果使用Maven，则以下依赖项会为您添加日志记录：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Spring Boot有一个<code>LoggingSystem</code>抽象，它试图根据类路径的内容来配置日志记录。如果可以使用Logback，则它是首选。</p> <p>如果您需要对日志记录进行的唯一更改是设置各种记录器的级别，则可以<code>application.properties</code>使用“ logging.level”前缀来进行设置，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">logging.level.org.springframework.web</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span>
<span class="token attr-name">logging.level.org.hibernate</span><span class="token punctuation">=</span><span class="token attr-value">ERROR</span>
</code></pre></div><p>您还可以使用“ logging.file.name”来设置要写入日志的文件的位置（除了控制台）。</p> <p>要配置日志记录系统的更细粒度的设置，您需要使用所支持的本机配置格式<code>LoggingSystem</code>。默认情况下，Spring Boot从系统的默认位置（例如<code>classpath:logback.xml</code>Logback）拾取本地配置，但是您可以使用<code>logging.config</code>属性设置配置文件的位置。</p> <h3 id="_8-1。配置登录以进行日志记录"><a href="#_8-1。配置登录以进行日志记录" class="header-anchor">#</a> 8.1。配置登录以进行日志记录</h3> <p>如果您需要将自定义设置应用于Logback之外，可以使用来实现<code>application.properties</code>，则需要添加标准的Logback配置文件。您可以将<code>logback.xml</code>文件添加到类路径的根目录中，以供登录后查找。<code>logback-spring.xml</code>如果您想使用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-logback-extensions" target="_blank" rel="noopener noreferrer">Spring Boot Logback扩展，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>也可以使用。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Logback文档有一个<a href="https://logback.qos.ch/manual/configuration.html" target="_blank" rel="noopener noreferrer">专用部分，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>其中详细<a href="https://logback.qos.ch/manual/configuration.html" target="_blank" rel="noopener noreferrer">介绍了配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>Spring Boot提供了许多<code>included</code>来自您自己的配置的logback 配置。这些包括旨在允许重新应用某些常见的Spring Boot约定。</p> <p>以下文件提供了<code>org/springframework/boot/logging/logback/</code>：</p> <ul><li><code>defaults.xml</code> -提供转换规则，模式属性和通用记录器配置。</li> <li><code>console-appender.xml</code>- <code>ConsoleAppender</code>使用添加<code>CONSOLE_LOG_PATTERN</code>。</li> <li><code>file-appender.xml</code>- <code>RollingFileAppender</code>使用<code>FILE_LOG_PATTERN</code>和并<code>ROLLING_FILE_NAME_PATTERN</code>通过适当的设置添加。</li></ul> <p>此外，<code>base.xml</code>还提供了一个旧文件以与早期版本的Spring Boot兼容。</p> <p>一个典型的自定义<code>logback.xml</code>文件如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org/springframework/boot/logging/logback/defaults.xml<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org/springframework/boot/logging/logback/console-appender.xml<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>CONSOLE<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.web<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>您的登录配置文件也可以利用<code>LoggingSystem</code>为您创建的System属性：</p> <ul><li><code>${PID}</code>：当前进程ID。</li> <li><code>${LOG_FILE}</code>：是否<code>logging.file.name</code>在Boot的外部配置中设置。</li> <li><code>${LOG_PATH}</code>：是否<code>logging.file.path</code>在Boot的外部配置中设置了（表示用于存放日志文件的目录）。</li> <li><code>${LOG_EXCEPTION_CONVERSION_WORD}</code>：是否<code>logging.exception-conversion-word</code>在Boot的外部配置中设置。</li> <li><code>${ROLLING_FILE_NAME_PATTERN}</code>：是否<code>logging.pattern.rolling-file-name</code>在Boot的外部配置中设置。</li></ul> <p>通过使用自定义的Logback转换器，Spring Boot还可以在控制台上提供一些不错的ANSI颜色终端输出（但不在日志文件中）。看到<code>CONSOLE_LOG_PATTERN</code>在<code>defaults.xml</code>一个示例配置。</p> <p>如果Groovy在类路径上，那么您也应该能够配置Logback <code>logback.groovy</code>。如果存在，则优先考虑此设置。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Groovy配置不支持Spring扩展。<code>logback-spring.groovy</code>将不会检测到任何文件。</p></div> <h4 id="_8-1-1。配置仅文件输出的logback"><a href="#_8-1-1。配置仅文件输出的logback" class="header-anchor">#</a> 8.1.1。配置仅文件输出的Logback</h4> <p>如果要禁用控制台日志记录并且仅将输出写入文件，则需要一个<code>logback-spring.xml</code>导入<code>file-appender.xml</code>但不导入的自定义<code>console-appender.xml</code>，如以下示例所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org/springframework/boot/logging/logback/defaults.xml<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>LOG_FILE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${LOG_FILE:-${LOG_PATH:-${LOG_TEMP:-${java.io.tmpdir:-/tmp}}/}spring.log}<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org/springframework/boot/logging/logback/file-appender.xml<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>INFO<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>FILE<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>您还需要将添加<code>logging.file.name</code>到中<code>application.properties</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">logging.file.name</span><span class="token punctuation">=</span><span class="token attr-value">myapplication.log</span>
</code></pre></div><h3 id="_8-2。配置log4j进行日志记录"><a href="#_8-2。配置log4j进行日志记录" class="header-anchor">#</a> 8.2。配置Log4j进行日志记录</h3> <p>如果Spring Boot 在类路径上，则它支持<a href="https://logging.apache.org/log4j/2.x/" target="_blank" rel="noopener noreferrer">Log4j 2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行日志记录配置。如果使用启动器来组装依赖项，则必须排除Logback，然后改为包括log4j 2。如果您不使用启动器，则<code>spring-jcl</code>除了Log4j 2之外，还需要提供（至少）。</p> <p>最简单的方法可能是通过启动程序，即使它需要对排除对象进行微调。以下示例显示了如何在Maven中设置启动器：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-logging<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-log4j2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以下示例显示了在Gradle中设置启动器的一种方法：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    compile <span class="token string">'org.springframework.boot:spring-boot-starter-web'</span>
    compile <span class="token string">'org.springframework.boot:spring-boot-starter-log4j2'</span>
<span class="token punctuation">}</span>

configurations <span class="token punctuation">{</span>
    all <span class="token punctuation">{</span>
        exclude group<span class="token punctuation">:</span> <span class="token string">'org.springframework.boot'</span><span class="token punctuation">,</span> module<span class="token punctuation">:</span> <span class="token string">'spring-boot-starter-logging'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Log4j入门人员将依赖关系集中在一起，以满足常见的日志记录要求（例如使用Tomcat，<code>java.util.logging</code>但使用Log4j 2配置输出）。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>为确保将使用进行的调试日志记录<code>java.util.logging</code>路由到Log4j 2中，请将系统属性设置为，以配置其<a href="https://logging.apache.org/log4j/2.0/log4j-jul/index.html" target="_blank" rel="noopener noreferrer">JDK日志记录适配器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 <code>java.util.logging.manager``org.apache.logging.log4j.jul.LogManager</code></p></div> <h4 id="_8-2-1。使用yaml或json配置log4j-2"><a href="#_8-2-1。使用yaml或json配置log4j-2" class="header-anchor">#</a> 8.2.1。使用YAML或JSON配置Log4j 2</h4> <p>除了默认的XML配置格式外，Log4j 2还支持YAML和JSON配置文件。要将Log4j 2配置为使用备用配置文件格式，请将适当的依赖项添加到类路径中，并命名您的配置文件以匹配您选择的文件格式，如以下示例所示：</p> <table><thead><tr><th style="text-align:left;">格式</th> <th style="text-align:left;">依存关系</th> <th style="text-align:left;">档案名称</th></tr></thead> <tbody><tr><td style="text-align:left;">YAML</td> <td style="text-align:left;"><code>com.fasterxml.jackson.core:jackson-databind</code> + <code>com.fasterxml.jackson.dataformat:jackson-dataformat-yaml</code></td> <td style="text-align:left;"><code>log4j2.yaml</code> + <code>log4j2.yml</code></td></tr> <tr><td style="text-align:left;">JSON格式</td> <td style="text-align:left;"><code>com.fasterxml.jackson.core:jackson-databind</code></td> <td style="text-align:left;"><code>log4j2.json</code> + <code>log4j2.jsn</code></td></tr></tbody></table> <h2 id="_9-资料存取"><a href="#_9-资料存取" class="header-anchor">#</a> 9.资料存取</h2> <p>Spring Boot包含许多用于处理数据源的启动器。本节回答与这样做有关的问题。</p> <h3 id="_9-1。配置自定义数据源"><a href="#_9-1。配置自定义数据源" class="header-anchor">#</a> 9.1。配置自定义数据源</h3> <p>要配置自己的<code>DataSource</code>，请在配置中定义<code>@Bean</code>该类型的。Spring Boot可以<code>DataSource</code>在任何需要重用的地方重复使用，包括数据库初始化。如果需要外部化某些设置，则可以将其绑定<code>DataSource</code>到环境（请参阅“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-3rd-party-configuration" target="_blank" rel="noopener noreferrer">spring-boot-features.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”）。</p> <p>以下示例显示了如何在Bean中定义数据源：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;app.datasource&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FancyDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以下示例显示如何通过设置属性来定义数据源：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">app.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:h2:mem:mydb</span>
<span class="token attr-name">app.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">sa</span>
<span class="token attr-name">app.datasource.pool-size</span><span class="token punctuation">=</span><span class="token attr-value">30</span>
</code></pre></div><p>假设您<code>FancyDataSource</code>具有URL，用户名和池大小的常规JavaBean属性，则在将设置<code>DataSource</code>用于其他组件之前，将自动绑定这些设置。常规的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-initialize-a-database-using-spring-jdbc" target="_blank" rel="noopener noreferrer">数据库初始化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>也会发生（因此的相关子集<code>spring.datasource.*</code>仍可以与您的自定义配置一起使用）。</p> <p>Spring Boot还提供了一个名为的实用程序生成器类，<code>DataSourceBuilder</code>可用于创建标准数据源之一（如果它位于类路径上）。构建器可以根据类路径中可用的内容来检测要使用的一个。它还基于JDBC URL自动检测驱动程序。</p> <p>以下示例显示如何使用来创建数据源<code>DataSourceBuilder</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">DataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>要使用that运行应用程序<code>DataSource</code>，您需要的只是连接信息。还可以提供特定于池的设置。有关更多详细信息，请检查将在运行时使用的实现。</p> <p>以下示例显示如何通过设置属性来定义JDBC数据源：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">app.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost/test</span>
<span class="token attr-name">app.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">dbuser</span>
<span class="token attr-name">app.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">dbpass</span>
<span class="token attr-name">app.datasource.pool-size</span><span class="token punctuation">=</span><span class="token attr-value">30</span>
</code></pre></div><p>但是，有一个陷阱。由于未公开连接池的实际类型，因此在自定义元数据中不会生成任何键，<code>DataSource</code>并且在IDE中也无法完成操作（因为该<code>DataSource</code>接口未公开任何属性）。另外，如果您碰巧在类路径上有Hikari，则此基本设置将不起作用，因为Hikari没有<code>url</code>属性（但确实具有<code>jdbcUrl</code>属性）。在这种情况下，您必须按照以下方式重写配置：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">app.datasource.jdbc-url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost/test</span>
<span class="token attr-name">app.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">dbuser</span>
<span class="token attr-name">app.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">dbpass</span>
<span class="token attr-name">app.datasource.maximum-pool-size</span><span class="token punctuation">=</span><span class="token attr-value">30</span>
</code></pre></div><p>您可以通过强制连接池使用并返回专用的实现而不是来解决此问题<code>DataSource</code>。您无法在运行时更改实现，但是选项列表将是明确的。</p> <p>下面的示例演示如何创建一个<code>HikariDataSource</code>具有<code>DataSourceBuilder</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">HikariDataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">DataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token class-name">HikariDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>您甚至可以利用<code>DataSourceProperties</code>为您提供服务的功能（即，如果没有提供URL，则通过提供一个默认的嵌入式数据库以及一个明智的用户名和密码）来进一步发展。您可以轻松地<code>DataSourceBuilder</code>从任何<code>DataSourceProperties</code>对象的状态初始化a ，因此您还可以注入Spring Boot自动创建的DataSource。然而，这将配置分为两个命名空间：<code>url</code>，<code>username</code>，<code>password</code>，<code>type</code>，和<code>driver</code>上<code>spring.datasource</code>和您的自定义命名空间中的其余部分（<code>app.datasource</code>）。为避免这种情况，可以<code>DataSourceProperties</code>在自定义名称空间上重新定义一个自定义，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">DataSourceProperties</span> <span class="token function">dataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource.configuration&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">HikariDataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token class-name">DataSourceProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> properties<span class="token punctuation">.</span><span class="token function">initializeDataSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token class-name">HikariDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，该设置使您与Spring Boot为您所做的<em>同步</em>，不同的是，已选择（以代码形式）专用的连接池，并且其设置在<code>app.datasource.configuration</code>子名称空间中公开。因为<code>DataSourceProperties</code>正在为您处理<code>url</code>/ <code>jdbcUrl</code>转换，所以可以按以下方式配置它：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">app.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost/test</span>
<span class="token attr-name">app.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">dbuser</span>
<span class="token attr-name">app.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">dbpass</span>
<span class="token attr-name">app.datasource.configuration.maximum-pool-size</span><span class="token punctuation">=</span><span class="token attr-value">30</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot会将Hikari特定的设置公开给<code>spring.datasource.hikari</code>。本示例使用更通用的<code>configuration</code>子名称空间，因为该示例不支持多个数据源实现。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于您的自定义配置选择与Hikari一起使用，<code>app.datasource.type</code>因此无效。实际上，构建器会使用您可以在其中设置的任何值进行初始化，然后被调用覆盖<code>.type()</code>。</p></div> <p>有关更多详细信息，请参见“ Spring Boot功能”部分中的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-configure-datasource" target="_blank" rel="noopener noreferrer">spring-boot-features.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”和<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>DataSourceAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>该类。</p> <h3 id="_9-2。配置两个数据源"><a href="#_9-2。配置两个数据源" class="header-anchor">#</a> 9.2。配置两个数据源</h3> <p>如果需要配置多个数据源，则可以应用上一节中介绍的相同技巧。但是，您必须将其中一个<code>DataSource</code>实例标记为<code>@Primary</code>，因为将来各种自动配置都希望能够按类型获得一个。</p> <p>如果您创建自己的<code>DataSource</code>，则自动配置将退出。在以下示例中，我们提供与自动配置在主数据源上提供的功能<em>完全相同的</em>功能集：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource.first&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">DataSourceProperties</span> <span class="token function">firstDataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource.first.configuration&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">HikariDataSource</span> <span class="token function">firstDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">firstDataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initializeDataSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token class-name">HikariDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource.second&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BasicDataSource</span> <span class="token function">secondDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">DataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token class-name">BasicDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>firstDataSourceProperties</code>必须标记为，<code>@Primary</code>以便数据库初始化程序功能使用您的副本（如果使用初始化程序）。</p></div> <p>这两个数据源也都必须进行高级定制。例如，您可以按以下方式配置它们：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">app.datasource.first.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost/first</span>
<span class="token attr-name">app.datasource.first.username</span><span class="token punctuation">=</span><span class="token attr-value">dbuser</span>
<span class="token attr-name">app.datasource.first.password</span><span class="token punctuation">=</span><span class="token attr-value">dbpass</span>
<span class="token attr-name">app.datasource.first.configuration.maximum-pool-size</span><span class="token punctuation">=</span><span class="token attr-value">30</span>

<span class="token attr-name">app.datasource.second.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost/second</span>
<span class="token attr-name">app.datasource.second.username</span><span class="token punctuation">=</span><span class="token attr-value">dbuser</span>
<span class="token attr-name">app.datasource.second.password</span><span class="token punctuation">=</span><span class="token attr-value">dbpass</span>
<span class="token attr-name">app.datasource.second.max-total</span><span class="token punctuation">=</span><span class="token attr-value">30</span>
</code></pre></div><p>您也可以将相同的概念应用于辅助服务器<code>DataSource</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource.first&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">DataSourceProperties</span> <span class="token function">firstDataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource.first.configuration&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">HikariDataSource</span> <span class="token function">firstDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">firstDataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initializeDataSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token class-name">HikariDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource.second&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">DataSourceProperties</span> <span class="token function">secondDataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.datasource.second.configuration&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BasicDataSource</span> <span class="token function">secondDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">secondDataSourceProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initializeDataSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token class-name">BasicDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面的示例在自定义名称空间上配置两个数据源，其逻辑与Spring Boot在自动配置中使用的逻辑相同。请注意，每个<code>configuration</code>子名称空间都基于所选实现提供高级设置。</p> <h3 id="_9-3。使用spring数据仓库"><a href="#_9-3。使用spring数据仓库" class="header-anchor">#</a> 9.3。使用Spring数据仓库</h3> <p>Spring Data可以创建<code>@Repository</code>各种类型的接口的实现。只要Spring Boot <code>@Repositories</code>包含在类的同一包（或子包）中，Spring Boot就会为您处理所有这些操作<code>@EnableAutoConfiguration</code>。</p> <p>对于许多应用程序，您所需要做的就是在类路径上放置正确的Spring Data依赖项。<code>spring-boot-starter-data-jpa</code>JPA 有一个，Mongodb 有一个spring-boot-starter-data-mongodb<code>等。要开始使用，请创建一些存储库接口来处理您的</code>@Entity`对象。</p> <p>Spring Boot会<code>@Repository</code>根据<code>@EnableAutoConfiguration</code>发现的内容尝试猜测您定义的位置。要获得更多控制权，请使用<code>@EnableJpaRepositories</code>注释（来自Spring Data JPA）。</p> <p>有关Spring Data的更多信息，请参见<a href="https://spring.io/projects/spring-data" target="_blank" rel="noopener noreferrer">Spring Data项目页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_9-4。将-entity定义与spring配置分开"><a href="#_9-4。将-entity定义与spring配置分开" class="header-anchor">#</a> 9.4。将@Entity定义与Spring配置分开</h3> <p>Spring Boot会<code>@Entity</code>根据<code>@EnableAutoConfiguration</code>发现的内容尝试猜测您定义的位置。要获得更多控制，可以使用<code>@EntityScan</code>注释，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableAutoConfiguration</span>
<span class="token annotation punctuation">@EntityScan</span><span class="token punctuation">(</span>basePackageClasses<span class="token operator">=</span><span class="token class-name">City</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token comment">//...</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-5。配置jpa属性"><a href="#_9-5。配置jpa属性" class="header-anchor">#</a> 9.5。配置JPA属性</h3> <p>Spring Data JPA已经提供了一些独立于供应商的配置选项（例如用于SQL日志记录的那些），并且Spring Boot公开了这些选项，还为Hibernate提供了更多选项作为外部配置属性。其中的一些会根据上下文自动检测到，因此您不必进行设置。</p> <p>这<code>spring.jpa.hibernate.ddl-auto</code>是一种特殊情况，因为根据运行时条件，它具有不同的默认值。如果使用嵌入式数据库并且没有模式管理器（例如Liquibase或Flyway）正在处理<code>DataSource</code>，则默认为<code>create-drop</code>。在所有其他情况下，默认为<code>none</code>。</p> <p>JPA提供程序检测到要使用的方言。如果您希望自己设置方言，请设置<code>spring.jpa.database-platform</code>属性。</p> <p>下例显示了最常用的设置选项：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.jpa.hibernate.naming.physical-strategy = com.example.MyPhysicalNamingStrategy
spring.jpa.show-sql = true
</code></pre></div><p>此外，创建<code>spring.jpa.properties.*</code>本地时，所有属性均作为常规JPA属性（前缀被去除）传递<code>EntityManagerFactory</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您需要确保在下面定义的名称<code>spring.jpa.properties.*</code>与您的JPA提供程序期望的名称完全匹配。Spring Boot不会尝试对这些条目进行任何形式的宽松绑定。例如，如果要配置Hibernate的批处理大小，则必须使用<code>spring.jpa.properties.hibernate.jdbc.batch_size</code>。如果您使用其他形式，例如<code>batchSize</code>或<code>batch-size</code>，则Hibernate将不会应用该设置。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您需要对Hibernate属性应用高级自定义，请考虑<code>HibernatePropertiesCustomizer</code>在创建之前注册将被调用的bean <code>EntityManagerFactory</code>。这优先于自动配置应用的任何内容。</p></div> <h3 id="_9-6。配置休眠命名策略"><a href="#_9-6。配置休眠命名策略" class="header-anchor">#</a> 9.6。配置休眠命名策略</h3> <p>Hibernate使用<a href="https://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#naming" target="_blank" rel="noopener noreferrer">两种不同的命名策略<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>将名称从对象模型映射到相应的数据库名称。可以分别通过设置<code>spring.jpa.hibernate.naming.physical-strategy</code>和<code>spring.jpa.hibernate.naming.implicit-strategy</code>属性来配置物理和隐式策略实现的标准类名。替代地，如果<code>ImplicitNamingStrategy</code>或<code>PhysicalNamingStrategy</code>豆在应用程序上下文是可用的，Hibernate会被自动配置为使用它们。</p> <p>默认情况下，Spring Boot用配置物理命名策略<code>SpringPhysicalNamingStrategy</code>。此实现提供了与Hibernate 4相同的表结构：所有点都由下划线替换，而骆驼套也由下划线替换。默认情况下，所有表名均以小写形式生成，但是如果您的架构需要它，则可以覆盖该标志。</p> <p>例如，一个<code>TelephoneNumber</code>实体被映射到<code>telephone_number</code>表。</p> <p>如果您更喜欢使用Hibernate 5的默认设置，请设置以下属性：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.jpa.hibernate.naming.physical-strategy = org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
</code></pre></div><p>另外，您可以配置以下bean：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">PhysicalNamingStrategy</span> <span class="token function">physicalNamingStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PhysicalNamingStrategyStandardImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>HibernateJpaAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/JpaBaseConfiguration.java" target="_blank" rel="noopener noreferrer"><code>JpaBaseConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>了解更多详细信息。</p> <h3 id="_9-7。配置hibernate二级缓存"><a href="#_9-7。配置hibernate二级缓存" class="header-anchor">#</a> 9.7。配置Hibernate二级缓存</h3> <p>可以为一系列缓存提供程序配置Hibernate <a href="https://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#caching" target="_blank" rel="noopener noreferrer">二级<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>缓存。与其将Hibernate配置为再次查找缓存提供程序，不如提供尽可能在上下文中可用的缓存提供程序。</p> <p>如果您使用的是JCache，这非常简单。首先，确保<code>org.hibernate:hibernate-jcache</code>在类路径上可用。然后，添加一个<code>HibernatePropertiesCustomizer</code>bean，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HibernateSecondLevelCacheExample</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">HibernatePropertiesCustomizer</span> <span class="token function">hibernateSecondLevelCacheCustomizer</span><span class="token punctuation">(</span><span class="token class-name">JCacheCacheManager</span> cacheManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>properties<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConfigSettings</span><span class="token punctuation">.</span>CACHE_MANAGER<span class="token punctuation">,</span> cacheManager<span class="token punctuation">.</span><span class="token function">getCacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>该定制器将配置Hibernate以<code>CacheManager</code>使其与应用程序使用的Hibernate相同。也可以使用单独的<code>CacheManager</code>实例。有关详细信息，请参阅<a href="https://docs.jboss.org/hibernate/orm/5.4/userguide/html_single/Hibernate_User_Guide.html#caching-provider-jcache" target="_blank" rel="noopener noreferrer">《 Hibernate用户指南》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_9-8。在休眠组件中使用依赖注入"><a href="#_9-8。在休眠组件中使用依赖注入" class="header-anchor">#</a> 9.8。在休眠组件中使用依赖注入</h3> <p>默认情况下，Spring Boot注册使用的<code>BeanContainer</code>实现，<code>BeanFactory</code>以便转换器和实体侦听器可以使用常规依赖项注入。</p> <p>您可以通过注册<code>HibernatePropertiesCustomizer</code>删除或更改<code>hibernate.resource.beans.container</code>属性的来禁用或调整此行为。</p> <h3 id="_9-9。使用自定义entitymanagerfactory"><a href="#_9-9。使用自定义entitymanagerfactory" class="header-anchor">#</a> 9.9。使用自定义EntityManagerFactory</h3> <p>要完全控制的配置<code>EntityManagerFactory</code>，您需要添加一个<code>@Bean</code>名为“ entityManagerFactory”的文件。如果存在这种类型的Bean，Spring Boot自动配置将关闭其实体管理器。</p> <h3 id="_9-10。使用两个entitymanager"><a href="#_9-10。使用两个entitymanager" class="header-anchor">#</a> 9.10。使用两个EntityManager</h3> <p>即使默认设置<code>EntityManagerFactory</code>工作正常，您也需要定义一个新的。否则，该类型的第二个bean的存在将关闭默认值。为了使操作变得容易，您可以使用<code>EntityManagerBuilder</code>Spring Boot提供的便利。另外，您也可以<code>LocalContainerEntityManagerFactoryBean</code>直接从Spring ORM进行操作，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// add two data sources configured as above</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span> <span class="token function">customerEntityManagerFactory</span><span class="token punctuation">(</span>
        <span class="token class-name">EntityManagerFactoryBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> builder
            <span class="token punctuation">.</span><span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token function">customerDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">packages</span><span class="token punctuation">(</span><span class="token class-name">Customer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">persistenceUnit</span><span class="token punctuation">(</span><span class="token string">&quot;customers&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span> <span class="token function">orderEntityManagerFactory</span><span class="token punctuation">(</span>
        <span class="token class-name">EntityManagerFactoryBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> builder
            <span class="token punctuation">.</span><span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token function">orderDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">packages</span><span class="token punctuation">(</span><span class="token class-name">Order</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">persistenceUnit</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当您为<code>LocalContainerEntityManagerFactoryBean</code>自己创建一个bean时，在自动配置的创建过程中应用的所有定制都将<code>LocalContainerEntityManagerFactoryBean</code>丢失。例如，在Hibernate的情况下，<code>spring.jpa.hibernate</code>前缀下的任何属性都不会自动应用于<code>LocalContainerEntityManagerFactoryBean</code>。如果您依靠这些属性来配置诸如命名策略或DDL模式之类的东西，那么在创建<code>LocalContainerEntityManagerFactoryBean</code>Bean 时将需要显式配置。另一方面，如果您使用自动配置来构建Bean ，则将自动应用<code>EntityManagerFactoryBuilder</code>通过所指定的应用于自动配置的属性。 <code>spring.jpa.properties``EntityManagerFactoryBuilder``LocalContainerEntityManagerFactoryBean</code></p></div> <p>上面的配置几乎可以独立工作。为了完成图片，您还需要<code>TransactionManagers</code>为两者进行配置<code>EntityManagers</code>。如果将其中一个标记为<code>@Primary</code>，则默认情况下可以<code>JpaTransactionManager</code>在Spring Boot 中将其选中。另一个必须显式地注入到新实例中。另外，您也许可以使用跨两个JTA事务管理器。</p> <p>如果使用Spring Data，则需要进行相应的配置<code>@EnableJpaRepositories</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableJpaRepositories</span><span class="token punctuation">(</span>basePackageClasses <span class="token operator">=</span> <span class="token class-name">Customer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        entityManagerFactoryRef <span class="token operator">=</span> <span class="token string">&quot;customerEntityManagerFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerConfiguration</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableJpaRepositories</span><span class="token punctuation">(</span>basePackageClasses <span class="token operator">=</span> <span class="token class-name">Order</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
        entityManagerFactoryRef <span class="token operator">=</span> <span class="token string">&quot;orderEntityManagerFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderConfiguration</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-11。使用传统persistence-xml文件"><a href="#_9-11。使用传统persistence-xml文件" class="header-anchor">#</a> 9.11。使用传统<code>persistence.xml</code>文件</h3> <p><code>META-INF/persistence.xml</code>默认情况下，Spring Boot不会搜索或使用。如果您喜欢使用传统的<code>persistence.xml</code>，则需要定义自己<code>@Bean</code>的类型<code>LocalEntityManagerFactoryBean</code>（ID为'entityManagerFactory'）并在其中设置持久性单元名称。</p> <p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/orm/jpa/JpaBaseConfiguration.java" target="_blank" rel="noopener noreferrer"><code>JpaBaseConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取默认设置。</p> <h3 id="_9-12。使用spring-data-jpa和mongo存储库"><a href="#_9-12。使用spring-data-jpa和mongo存储库" class="header-anchor">#</a> 9.12。使用Spring Data JPA和Mongo存储库</h3> <p>Spring Data JPA和Spring Data Mongo都可以自动<code>Repository</code>为您创建实现。如果它们都存在于类路径中，则可能必须做一些额外的配置以告诉Spring Boot要创建哪个存储库。最明确的方法是使用标准的Spring数据<code>@EnableJpaRepositories</code>和<code>@EnableMongoRepositories</code>注释并提供<code>Repository</code>接口的位置。</p> <p>您还可以使用标志（<code>spring.data.*.repositories.enabled</code>和<code>spring.data.*.repositories.type</code>）在外部配置中打开和关闭自动配置的存储库。这样做很有用，例如，如果您想关闭Mongo存储库并仍然使用自动配置的<code>MongoTemplate</code>。</p> <p>对于其他自动配置的Spring Data存储库类型（Elasticsearch，Solr等），存在相同的障碍和相同的功能。要使用它们，请相应地更改注释和标志的名称。</p> <h3 id="_9-13。定制spring-data的web支持"><a href="#_9-13。定制spring-data的web支持" class="header-anchor">#</a> 9.13。定制Spring Data的Web支持</h3> <p>Spring Data提供了Web支持，简化了Web应用程序中Spring Data存储库的使用。Spring Boot在<code>spring.data.web</code>名称空间中提供了用于自定义其配置的属性。请注意，如果您使用的是Spring Data REST，则必须<code>spring.data.rest</code>改为使用名称空间中的属性。</p> <h3 id="_9-14。将spring数据存储库公开为rest端点"><a href="#_9-14。将spring数据存储库公开为rest端点" class="header-anchor">#</a> 9.14。将Spring数据存储库公开为REST端点</h3> <p><code>Repository</code>如果已为应用程序启用了Spring MVC，则Spring Data REST可以为您将实现公开为REST端点。</p> <p>Spring Boot公开了一组有用的属性（来自<code>spring.data.rest</code>名称空间），这些属性来自定义<a href="https://docs.spring.io/spring-data/rest/docs/3.2.3.RELEASE/api/org/springframework/data/rest/core/config/RepositoryRestConfiguration.html" target="_blank" rel="noopener noreferrer"><code>RepositoryRestConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果需要提供其他定制，则应使用<a href="https://docs.spring.io/spring-data/rest/docs/3.2.3.RELEASE/api/org/springframework/data/rest/webmvc/config/RepositoryRestConfigurer.html" target="_blank" rel="noopener noreferrer"><code>RepositoryRestConfigurer</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>Bean。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您没有在custom上指定任何顺序<code>RepositoryRestConfigurer</code>，它将在一个Spring Boot内部使用之后运行。如果您需要指定订单，请确保该订单大于0。</p></div> <h3 id="_9-15。配置jpa使用的组件"><a href="#_9-15。配置jpa使用的组件" class="header-anchor">#</a> 9.15。配置JPA使用的组件</h3> <p>如果要配置JPA使用的组件，则需要确保在JPA之前初始化该组件。当组件被自动配置后，Spring Boot会为您处理。例如，当自动配置Flyway时，会将Hibernate配置为依赖Flyway，以便Flyway有机会在Hibernate尝试使用数据库之前对其进行初始化。</p> <p>如果您自己配置组件，则可以使用<code>EntityManagerFactoryDependsOnPostProcessor</code>子类作为设置必要依赖项的便捷方法。例如，如果将Hibernate Search与Elasticsearch一起用作其索引管理器，则<code>EntityManagerFactory</code>必须将任何bean配置为依赖于该<code>elasticsearchClient</code>bean，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * {@link EntityManagerFactoryDependsOnPostProcessor} that ensures that
 * {@link EntityManagerFactory} beans depend on the {@code elasticsearchClient} bean.
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ElasticsearchEntityManagerFactoryDependsOnPostProcessor</span>
        <span class="token keyword">extends</span> <span class="token class-name">EntityManagerFactoryDependsOnPostProcessor</span> <span class="token punctuation">{</span>

    <span class="token class-name">ElasticsearchEntityManagerFactoryDependsOnPostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">&quot;elasticsearchClient&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-16。使用两个数据源配置jooq"><a href="#_9-16。使用两个数据源配置jooq" class="header-anchor">#</a> 9.16。使用两个数据源配置jOOQ</h3> <p>如果需要将jOOQ与多个数据源一起使用，则应该<code>DSLContext</code>为每个数据源创建自己的数据源。有关更多详细信息，请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jooq/JooqAutoConfiguration.java" target="_blank" rel="noopener noreferrer">JooqAutoConfiguration<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>特别是，<code>JooqExceptionTranslator</code>并且<code>SpringTransactionProvider</code>可以重复使用以提供与单个自动配置相似的功能<code>DataSource</code>。</p></div> <h2 id="_10-数据库初始化"><a href="#_10-数据库初始化" class="header-anchor">#</a> 10.数据库初始化</h2> <p>可以使用不同的方式初始化SQL数据库，具体取决于堆栈是什么。当然，如果数据库是一个单独的过程，您也可以手动执行。建议使用单一机制进行模式生成。</p> <h3 id="_10-1。使用jpa初始化数据库"><a href="#_10-1。使用jpa初始化数据库" class="header-anchor">#</a> 10.1。使用JPA初始化数据库</h3> <p>JPA具有用于DDL生成的功能，可以将其设置为在启动时针对数据库运行。这是通过两个外部属性控制的：</p> <ul><li><code>spring.jpa.generate-ddl</code> （布尔值）打开和关闭该功能，并且与供应商无关。</li> <li><code>spring.jpa.hibernate.ddl-auto</code>（枚举）是一种Hibernate功能，可以更精细地控制行为。此功能将在本指南的后面部分详细介绍。</li></ul> <h3 id="_10-2。使用休眠初始化数据库"><a href="#_10-2。使用休眠初始化数据库" class="header-anchor">#</a> 10.2。使用休眠初始化数据库</h3> <p>您可以设置<code>spring.jpa.hibernate.ddl-auto</code>明确和标准的Hibernate属性值<code>none</code>，<code>validate</code>，<code>update</code>，<code>create</code>，和<code>create-drop</code>。Spring Boot根据是否认为您的数据库已嵌入为您选择默认值。默认为<code>create-drop</code>是否未检测到任何模式管理器或<code>none</code>在所有其他情况下。通过查看<code>Connection</code>类型可以检测到嵌入式数据库。 <code>hsqldb</code>，<code>h2</code>和<code>derby</code>是嵌入式的，其他不是。从内存数据库转换为“真实”数据库时，请不要对新平台中表和数据的存在做出假设。您必须<code>ddl-auto</code>显式设置或使用其他机制之一来初始化数据库。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以通过启用<code>org.hibernate.SQL</code>记录器来输出架构创建。如果启用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-logging-console-output" target="_blank" rel="noopener noreferrer">调试模式，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>此操作将自动为您完成。</p></div> <p>另外，<code>import.sql</code>如果Hibernate从头开始创建模式（即，如果<code>ddl-auto</code>属性设置为<code>create</code>或<code>create-drop</code>），则在启动时将执行在类路径的根目录中命名的文件。如果您小心的话，这对于演示和测试很有用，但可能不希望出现在生产环境的类路径中。这是一个Hibernate功能（与Spring无关）。</p> <h3 id="_10-3。初始化数据库"><a href="#_10-3。初始化数据库" class="header-anchor">#</a> 10.3。初始化数据库</h3> <p>Spring Boot可以自动创建您的架构（DDL脚本）<code>DataSource</code>并对其进行初始化（DML脚本）。它分别从标准根类路径位置<code>schema.sql</code>和加载SQL <code>data.sql</code>。另外，Spring Boot处理<code>schema-${platform}.sql</code>和<code>data-${platform}.sql</code>文件（如果存在），其中<code>platform</code>的值为<code>spring.datasource.platform</code>。这使您可以在必要时切换到特定于数据库的脚本。例如，您可以选择将其设置为数据库中的供应商名称（<code>hsqldb</code>，<code>h2</code>，<code>oracle</code>，<code>mysql</code>，<code>postgresql</code>，等）。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot自动创建一个嵌入式模式<code>DataSource</code>。可以使用该<code>spring.datasource.initialization-mode</code>属性来自定义此行为。例如，如果您希望始终初始化，则<code>DataSource</code>无论其类型如何：<code>spring.datasource.initialization-mode =总是</code></p></div> <p>默认情况下，Spring Boot启用Spring JDBC初始化程序的快速失败功能。这意味着，如果脚本导致异常，则应用程序将无法启动。您可以通过设置来调整该行为<code>spring.datasource.continue-on-error</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在基于JPA的应用程序中，您可以选择让Hibernate创建架构或使用<code>schema.sql</code>，但您不能两者都做。<code>spring.jpa.hibernate.ddl-auto</code>如果使用，请确保禁用<code>schema.sql</code>。</p></div> <h3 id="_10-4。初始化一个spring-batch数据库"><a href="#_10-4。初始化一个spring-batch数据库" class="header-anchor">#</a> 10.4。初始化一个Spring Batch数据库</h3> <p>如果您使用Spring Batch，则它随大多数流行的数据库平台一起预包装了SQL初始化脚本。Spring Boot可以检测您的数据库类型并在启动时执行这些脚本。如果您使用嵌入式数据库，则默认情况下会发生这种情况。您还可以为任何数据库类型启用它，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.batch.initialize-schema =总是
</code></pre></div><p>您还可以通过设置明确关闭初始化<code>spring.batch.initialize-schema=never</code>。</p> <h3 id="_10-5。使用高级数据库迁移工具"><a href="#_10-5。使用高级数据库迁移工具" class="header-anchor">#</a> 10.5。使用高级数据库迁移工具</h3> <p>春天引导支持两种更高级别的迁移工具：<a href="https://flywaydb.org/" target="_blank" rel="noopener noreferrer">迁飞<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://www.liquibase.org/" target="_blank" rel="noopener noreferrer">Liquibase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="_10-5-1。在启动时执行flyway数据库迁移"><a href="#_10-5-1。在启动时执行flyway数据库迁移" class="header-anchor">#</a> 10.5.1。在启动时执行Flyway数据库迁移</h4> <p>要在启动时自动运行Flyway数据库迁移，请将添加<code>org.flywaydb:flyway-core</code>到您的类路径中。</p> <p>通常，迁移是采用以下形式的脚本<code>V&lt;VERSION&gt;__&lt;NAME&gt;.sql</code>（带有<code>&lt;VERSION&gt;</code>下划线分隔的版本，例如“ 1”或“ 2_1”）。默认情况下，它们位于名为的文件夹中<code>classpath:db/migration</code>，但是您可以通过设置修改该位置<code>spring.flyway.locations</code>。这是一个或多个<code>classpath:</code>或多个<code>filesystem:</code>位置的逗号分隔列表。例如，以下配置将在默认类路径位置和<code>/opt/migration</code>目录中搜索脚本：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.flyway.locations</span><span class="token punctuation">=</span><span class="token attr-value">classpath:db/migration,filesystem:/opt/migration</span>
</code></pre></div><p>您还可以添加特殊的<code>{vendor}</code>占位符以使用特定于供应商的脚本。假设以下内容：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.flyway.locations</span><span class="token punctuation">=</span><span class="token attr-value">classpath:db/migration/{vendor}</span>
</code></pre></div><p><code>db/migration</code>前面的配置不是使用，而是根据数据库的类型（例如，<code>db/migration/mysql</code>对于MySQL）来设置要使用的文件夹。支持的数据库列表在中提供<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jdbc/DatabaseDriver.java" target="_blank" rel="noopener noreferrer"><code>DatabaseDriver</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>迁移也可以用Java编写。Flyway将使用任何实现的bean自动配置<code>JavaMigration</code>。</p> <p><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/flyway/FlywayProperties.java" target="_blank" rel="noopener noreferrer"><code>FlywayProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供Flyway的大多数设置以及少量的其他属性，这些属性可用于禁用迁移或关闭位置检查。如果需要对配置进行更多控制，请考虑注册<code>FlywayConfigurationCustomizer</code>Bean。</p> <p>Spring Boot调用<code>Flyway.migrate()</code>以执行数据库迁移。如果您想要更多控制，请提供<code>@Bean</code>实现<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/flyway/FlywayMigrationStrategy.java" target="_blank" rel="noopener noreferrer"><code>FlywayMigrationStrategy</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>Flyway支持SQL和Java <a href="https://flywaydb.org/documentation/callbacks.html" target="_blank" rel="noopener noreferrer">回调<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。要使用基于SQL的回调，请将回调脚本放在<code>classpath:db/migration</code>文件夹中。要使用基于Java的回调，请创建一个或多个实现的bean <code>Callback</code>。任何此类bean都会自动向进行注册<code>Flyway</code>。可以通过使用<code>@Order</code>或实现来订购它们<code>Ordered</code>。<code>FlywayCallback</code>也可以检测到实现了不推荐使用的接口的Bean ，但是不能与<code>Callback</code>Bean 一起使用。</p> <p>默认情况下，Flyway自动在您的上下文中自动连接（<code>@Primary</code>）<code>DataSource</code>并将其用于迁移。如果您想使用其他名称<code>DataSource</code>，则可以创建一个并将其标记<code>@Bean</code>为<code>@FlywayDataSource</code>。如果这样做并想要两个数据源，请记住创建另一个数据源并将其标记为<code>@Primary</code>。另外，您可以<code>DataSource</code>通过设置<code>spring.flyway.[url,user,password]</code>外部属性来使用Flyway的本机。设置<code>spring.flyway.url</code>或<code>spring.flyway.user</code>足以使Flyway使用自己的<code>DataSource</code>。如果未设置这三个属性中的任何一个，<code>spring.datasource</code>则将使用其等效属性的值。</p> <p>您还可以使用Flyway为特定情况提供数据。例如，您可以放入特定于测试的迁移，<code>src/test/resources</code>并且仅在您的应用程序开始进行测试时才运行它们。另外，您可以使用特定于配置文件的配置进行自定义，<code>spring.flyway.locations</code>以便仅在特定配置文件处于活动状态时才运行某些迁移。例如，在中<code>application-dev.properties</code>，您可以指定以下设置：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.flyway.locations</span><span class="token punctuation">=</span><span class="token attr-value">classpath:/db/migration,classpath:/dev/db/migration</span>
</code></pre></div><p>使用该设置，<code>dev/db/migration</code>仅在<code>dev</code>配置文件处于活动状态时才运行迁移。</p> <h4 id="_10-5-2。在启动时执行liquibase数据库迁移"><a href="#_10-5-2。在启动时执行liquibase数据库迁移" class="header-anchor">#</a> 10.5.2。在启动时执行Liquibase数据库迁移</h4> <p>要在启动时自动运行Liquibase数据库迁移，请将添加<code>org.liquibase:liquibase-core</code>到您的类路径中。</p> <p>默认情况下，从中读取主更改日志<code>db/changelog/db.changelog-master.yaml</code>，但是您可以通过设置来更改位置<code>spring.liquibase.change-log</code>。除了YAML，Liquibase还支持JSON，XML和SQL更改日志格式。</p> <p>默认情况下，Liquibase 在您的上下文中自动装配（<code>@Primary</code>）<code>DataSource</code>并将其用于迁移。如果需要使用其他名称<code>DataSource</code>，则可以创建一个并将其标记<code>@Bean</code>为<code>@LiquibaseDataSource</code>。如果这样做，并且想要两个数据源，请记住创建另一个数据源并将其标记为<code>@Primary</code>。另外，您可以<code>DataSource</code>通过设置<code>spring.liquibase.[url,user,password]</code>外部属性来使用Liquibase的本机。设置<code>spring.liquibase.url</code>或<code>spring.liquibase.user</code>足以使Liquibase使用其自己的<code>DataSource</code>。如果未设置这三个属性中的任何一个，<code>spring.datasource</code>则将使用其等效属性的值。</p> <p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/liquibase/LiquibaseProperties.java" target="_blank" rel="noopener noreferrer"><code>LiquibaseProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取有关可用设置的详细信息，例如上下文，默认架构和其他。</p> <h2 id="_11-消息传递"><a href="#_11-消息传递" class="header-anchor">#</a> 11.消息传递</h2> <p>Spring Boot提供了许多包含消息传递的启动器。本部分回答了将消息与Spring Boot一起使用所引起的问题。</p> <h3 id="_11-1。禁用事务jms会话"><a href="#_11-1。禁用事务jms会话" class="header-anchor">#</a> 11.1。禁用事务JMS会话</h3> <p>如果您的JMS代理不支持事务处理会话，则必须完全禁用对事务的支持。如果您创建自己的<code>JmsListenerContainerFactory</code>，则无需做任何事情，因为默认情况下无法进行交易。如果要使用<code>DefaultJmsListenerContainerFactoryConfigurer</code>来重用Spring Boot的默认值，则可以禁用事务处理的会话，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">DefaultJmsListenerContainerFactory</span> <span class="token function">jmsListenerContainerFactory</span><span class="token punctuation">(</span>
        <span class="token class-name">ConnectionFactory</span> connectionFactory<span class="token punctuation">,</span>
        <span class="token class-name">DefaultJmsListenerContainerFactoryConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DefaultJmsListenerContainerFactory</span> listenerFactory <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">DefaultJmsListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    configurer<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span>listenerFactory<span class="token punctuation">,</span> connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    listenerFactory<span class="token punctuation">.</span><span class="token function">setTransactionManager</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    listenerFactory<span class="token punctuation">.</span><span class="token function">setSessionTransacted</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> listenerFactory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>前面的示例将覆盖默认工厂，并且应将其应用于应用程序定义的任何其他工厂（如果有）。</p> <h2 id="_12-批处理应用"><a href="#_12-批处理应用" class="header-anchor">#</a> 12.批处理应用</h2> <p>本部分回答了将Spring Batch与Spring Boot结合使用所引起的问题。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>默认情况下，批处理应用程序需要一个<code>DataSource</code>来存储作业详细信息。批处理<code>DataSource</code>在您的上下文中自动装配单个电线，并将其用于处理。要让Batch使用<code>DataSource</code>应用程序的main之外的其他代码<code>DataSource</code>，请声明一个<code>DataSource</code>bean，并用注释其<code>@Bean</code>方法<code>@BatchDataSource</code>。如果这样做并想要两个数据源，请记住创建另一个数据源并将其标记为<code>@Primary</code>。要获得更大的控制权，请实施<code>BatchConfigurer</code>。有关更多详细信息，请参见<a href="https://docs.spring.io/spring-batch/apidocs/org/springframework/batch/core/configuration/annotation/EnableBatchProcessing.html" target="_blank" rel="noopener noreferrer">Javadoc<code>@EnableBatchProcessing</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>有关Spring Batch的更多信息，请参见<a href="https://spring.io/projects/spring-batch" target="_blank" rel="noopener noreferrer">Spring Batch项目页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_12-1。在启动时执行spring-batch作业"><a href="#_12-1。在启动时执行spring-batch作业" class="header-anchor">#</a> 12.1。在启动时执行Spring Batch作业</h3> <p>通过<code>@EnableBatchProcessing</code>在上下文中的某个位置添加（从Spring Batch），可以启用Spring Batch自动配置。</p> <p>默认情况下，它在启动时在应用程序上下文中执行<strong>所有操作</strong> <code>Jobs</code>（有关详细信息，请参见<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/batch/JobLauncherCommandLineRunner.java" target="_blank" rel="noopener noreferrer">JobLauncherCommandLineRunner<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。您可以通过指定<code>spring.batch.job.names</code>（使用逗号分隔的作业名称模式列表）缩小到一个或多个特定作业。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在命令行上指定作业参数与<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-command-line-args" target="_blank" rel="noopener noreferrer">在<code>Environment</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-command-line-args" target="_blank" rel="noopener noreferrer">设置属性的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>命令行选项参数不同（即，以开头<code>--</code>，例如<code>--my-property=value</code>），作业参数必须在命令行中指定，而不用破折号（例如<code>jobParam=value</code>）。</p></div> <p>如果应用程序上下文包含<code>JobRegistry</code>，则将<code>spring.batch.job.names</code>在注册表中查找其中的作业，而不是从上下文中自动装配作业。这是更复杂的系统的常见模式，其中多个作业在子上下文中定义并集中注册。</p> <p>有关更多详细信息，请参见<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/batch/BatchAutoConfiguration.java" target="_blank" rel="noopener noreferrer">BatchAutoConfiguration<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/spring-projects/spring-batch/blob/master/spring-batch-core/src/main/java/org/springframework/batch/core/configuration/annotation/EnableBatchProcessing.java" target="_blank" rel="noopener noreferrer">@EnableBatchProcessing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="_13-执行器"><a href="#_13-执行器" class="header-anchor">#</a> 13.执行器</h2> <p>Spring Boot包括Spring Boot执行器。本节回答了经常因使用而引起的问题。</p> <h3 id="_13-1。更改执行器端点的http端口或地址"><a href="#_13-1。更改执行器端点的http端口或地址" class="header-anchor">#</a> 13.1。更改执行器端点的HTTP端口或地址</h3> <p>在独立应用程序中，Actuator HTTP端口默认与主HTTP端口相同。要使应用程序在其他端口上侦听，请设置外部属性：<code>management.server.port</code>。要侦听完全不同的网络地址（例如，当您有一个用于管理的内部网络而有一个用于用户应用程序的外部网络）时，还可以设置<code>management.server.address</code>一个服务器可以绑定到的有效IP地址。</p> <p>有关更多详细信息，请参见<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/web/server/ManagementServerProperties.java" target="_blank" rel="noopener noreferrer"><code>ManagementServerProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>源代码和“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/production-ready-features.html#production-ready-customizing-management-server-port" target="_blank" rel="noopener noreferrer">生产<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>就绪功能”部分中的“ production-ready-features.html”。</p> <h3 id="_13-2。自定义-whitelabel-错误页面"><a href="#_13-2。自定义-whitelabel-错误页面" class="header-anchor">#</a> 13.2。自定义“ whitelabel”错误页面</h3> <p>如果遇到服务器错误，Spring Boot会安装一个“ whitelabel”错误页面，您会在浏览器客户端中看到该错误页面（使用JSON和其他媒体类型的机器客户端应该看到带有正确错误代码的明智响应）。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>设置<code>server.error.whitelabel.enabled=false</code>以关闭默认错误页面。这样做将还原您正在使用的servlet容器的默认值。请注意，Spring Boot仍然尝试解决错误视图，因此您应该添加自己的错误页面，而不是完全禁用它。</p></div> <p>用自己的方法覆盖错误页面取决于您使用的模板技术。例如，如果您使用Thymeleaf，则可以添加<code>error.html</code>模板。如果使用FreeMarker，则可以添加<code>error.ftlh</code>模板。通常，您需要<code>View</code>使用名称解析的<code>error</code>或<code>@Controller</code>处理<code>/error</code>路径的。除非你更换了一些默认配置，你应该找一个<code>BeanNameViewResolver</code>你<code>ApplicationContext</code>，所以<code>@Bean</code>命名<code>error</code>是这样做的一个简单的方法。请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/servlet/error/ErrorMvcAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>ErrorMvcAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多选项。</p> <p>有关如何在servlet容器中注册处理程序的详细信息，另请参见“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-error-handling" target="_blank" rel="noopener noreferrer">错误处理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ” 部分。</p> <h3 id="_13-3。清理明智的价值观"><a href="#_13-3。清理明智的价值观" class="header-anchor">#</a> 13.3。清理明智的价值观</h3> <p><code>env</code>和<code>configprops</code>端点返回的信息可能有些敏感，因此默认情况下会清理与某个模式匹配的键（即，它们的值将替换为<code>******</code>）。</p> <p>Spring Boot对此类密钥使用明智的默认设置：例如，对任何以单词“ password”，“ secret”，“ key”或“ token”结尾的密钥进行清理。也可以改用正则表达式，例如<code>*credentials.*</code>清除将单词保留<code>credentials</code>为键一部分的任何键。</p> <p>可以分别使用<code>management.endpoint.env.keys-to-sanitize</code>和来定制要使用的模式<code>management.endpoint.configprops.keys-to-sanitize</code>。</p> <h2 id="_14-安全性"><a href="#_14-安全性" class="header-anchor">#</a> 14.安全性</h2> <p>本部分解决有关使用Spring Boot时的安全性的问题，包括因将Spring Security与Spring Boot一起使用而引起的问题。</p> <p>有关Spring Security的更多信息，请参见<a href="https://spring.io/projects/spring-security" target="_blank" rel="noopener noreferrer">Spring Security项目页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_14-1。关闭spring-boot安全性配置"><a href="#_14-1。关闭spring-boot安全性配置" class="header-anchor">#</a> 14.1。关闭Spring Boot安全性配置</h3> <p>如果在应用程序<code>@Configuration</code>中用定义A <code>WebSecurityConfigurerAdapter</code>，它将关闭Spring Boot中的默认Webapp安全设置。</p> <h3 id="_14-2。更改userdetailsservice并添加用户帐户"><a href="#_14-2。更改userdetailsservice并添加用户帐户" class="header-anchor">#</a> 14.2。更改UserDetailsService并添加用户帐户</h3> <p>如果你提供了一个<code>@Bean</code>类型的<code>AuthenticationManager</code>，<code>AuthenticationProvider</code>或者<code>UserDetailsService</code>，默认<code>@Bean</code>为<code>InMemoryUserDetailsManager</code>不创建。这意味着您拥有完整的Spring Security功能集（例如<a href="https://docs.spring.io/spring-security/site/docs/5.2.1.RELEASE/reference/htmlsingle/#jc-authentication" target="_blank" rel="noopener noreferrer">各种身份验证选项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p> <p>添加用户帐户的最简单方法是提供您自己的<code>UserDetailsService</code>bean。</p> <h3 id="_14-3。在代理服务器后运行时启用https"><a href="#_14-3。在代理服务器后运行时启用https" class="header-anchor">#</a> 14.3。在代理服务器后运行时启用HTTPS</h3> <p>对于所有应用程序而言，确保所有主要端点仅可通过HTTPS进行访问都是一项重要的工作。如果您将Tomcat用作servlet容器，则Spring Boot <code>RemoteIpValve</code>如果检测到某些环境设置，则会自动添加Tomcat自己的Tomcat ，并且您应该能够依靠Tomcat <code>HttpServletRequest</code>报告其是否安全（甚至在处理代理服务器的下游）。真正的SSL终止）。标准行为由某些请求标头（<code>x-forwarded-for</code>和<code>x-forwarded-proto</code>）的存在或不存在决定，它们的名称是常规名称，因此它应适用于大多数前端代理。您可以通过向中添加一些条目来打开阀门<code>application.properties</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">server.tomcat.remote-ip-header</span><span class="token punctuation">=</span><span class="token attr-value">x-forwarded-for</span>
<span class="token attr-name">server.tomcat.protocol-header</span><span class="token punctuation">=</span><span class="token attr-value">x-forwarded-proto</span>
</code></pre></div><p>（这些属性中的任何一个都会在阀上切换。或者，可以<code>RemoteIpValve</code>通过添加一个<code>TomcatServletWebServerFactory</code>bean 来添加。）</p> <p>要将Spring Security配置为要求所有（或某些）请求使用安全通道，请考虑添加自己的<code>WebSecurityConfigurerAdapter</code>添加以下<code>HttpSecurity</code>配置：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SslWebSecurityConfigurerAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// Customize the application security</span>
        http<span class="token punctuation">.</span><span class="token function">requiresChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requiresSecure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_15-热插拔"><a href="#_15-热插拔" class="header-anchor">#</a> 15.热插拔</h2> <p>Spring Boot支持热插拔。本部分回答有关其工作方式的问题。</p> <h3 id="_15-1。重新加载静态内容"><a href="#_15-1。重新加载静态内容" class="header-anchor">#</a> 15.1。重新加载静态内容</h3> <p>有几种热装选项。推荐的方法是使用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools" target="_blank" rel="noopener noreferrer"><code>spring-boot-devtools</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，因为它提供了其他开发时功能，例如对快速应用程序重新启动和LiveReload的支持，以及合理的开发时配置（例如模板缓存）。Devtools通过监视类路径的更改来工作。这意味着必须“构建”静态资源更改才能使更改生效。默认情况下，当您保存更改时，这在Eclipse中自动发生。在IntelliJ IDEA中，“生成项目”命令将触发必要的构建。由于<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools-restart-exclude" target="_blank" rel="noopener noreferrer">默认的重新启动排除项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，对静态资源的更改不会触发应用程序的重新启动。但是，它们确实会触发实时重新加载。</p> <p>另外，在IDE中运行（特别是在调试时打开）是进行开发的好方法（所有现代IDE都允许重新加载静态资源，并且通常还允许热交换Java类更改）。</p> <p>最后，可以配置<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/build-tool-plugins.html#build-tool-plugins" target="_blank" rel="noopener noreferrer">Maven和Gradle插件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（请参阅<code>addResources</code>属性）以支持从命令行运行，并直接从源中重新加载静态文件。如果要使用高级工具编写该代码，则可以将其与外部css / js编译器进程一起使用。</p> <h3 id="_15-2。重新加载模板，而无需重新启动容器"><a href="#_15-2。重新加载模板，而无需重新启动容器" class="header-anchor">#</a> 15.2。重新加载模板，而无需重新启动容器</h3> <p>Spring Boot支持的大多数模板技术都包含用于禁用缓存的配置选项（在本文档的后面介绍）。如果使用<code>spring-boot-devtools</code>模块，则在开发时会<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools-property-defaults" target="_blank" rel="noopener noreferrer">自动<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>为您<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools-property-defaults" target="_blank" rel="noopener noreferrer">配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这些属性。</p> <h4 id="_15-2-1。胸腺模板"><a href="#_15-2-1。胸腺模板" class="header-anchor">#</a> 15.2.1。胸腺模板</h4> <p>如果您使用Thymeleaf，请将设置<code>spring.thymeleaf.cache</code>为<code>false</code>。有关<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/thymeleaf/ThymeleafAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>ThymeleafAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>其他Thymeleaf定制选项，请参见。</p> <h4 id="_15-2-2。freemarker模板"><a href="#_15-2-2。freemarker模板" class="header-anchor">#</a> 15.2.2。FreeMarker模板</h4> <p>如果使用FreeMarker，请设置<code>spring.freemarker.cache</code>为<code>false</code>。有关<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/freemarker/FreeMarkerAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>FreeMarkerAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>其他FreeMarker定制选项，请参见。</p> <h4 id="_15-2-3。groovy模板"><a href="#_15-2-3。groovy模板" class="header-anchor">#</a> 15.2.3。Groovy模板</h4> <p>如果使用Groovy模板，请设置<code>spring.groovy.template.cache</code>为<code>false</code>。请参阅参考资料，<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/groovy/template/GroovyTemplateAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>GroovyTemplateAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取其他Groovy定制选项。</p> <h3 id="_15-3。快速应用重启"><a href="#_15-3。快速应用重启" class="header-anchor">#</a> 15.3。快速应用重启</h3> <p>该<code>spring-boot-devtools</code>模块包括对应用程序自动重启的支持。尽管不如<a href="https://jrebel.com/software/jrebel/" target="_blank" rel="noopener noreferrer">JRebel<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这样的技术快，但通常比“冷启动”要快得多。在研究本文档后面讨论的一些更复杂的重载选项之前，您可能应该先尝试一下。</p> <p>有关更多详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools" target="_blank" rel="noopener noreferrer">using-spring-boot.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>部分。</p> <h3 id="_15-4。重新加载java类而无需重新启动容器"><a href="#_15-4。重新加载java类而无需重新启动容器" class="header-anchor">#</a> 15.4。重新加载Java类而无需重新启动容器</h3> <p>许多现代的IDE（Eclipse，IDEA等）都支持字节码的热交换。因此，如果所做的更改不影响类或方法的签名，则应干净地重新加载而没有副作用。</p> <h2 id="_16-建立"><a href="#_16-建立" class="header-anchor">#</a> 16.建立</h2> <p>Spring Boot包括Maven和Gradle的构建插件。本部分回答有关这些插件的常见问题。</p> <h3 id="_16-1。生成构建信息"><a href="#_16-1。生成构建信息" class="header-anchor">#</a> 16.1。生成构建信息</h3> <p>Maven插件和Gradle插件都允许生成包含项目的坐标，名称和版本的构建信息。还可以将插件配置为通过配置添加其他属性。当存在这样的文件时，Spring Boot会自动配置一个<code>BuildProperties</code>bean。</p> <p>要使用Maven生成构建信息，请为<code>build-info</code>目标添加执行，如以下示例所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>build-info<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关更多详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/maven-plugin/" target="_blank" rel="noopener noreferrer">Spring Boot Maven插件文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>下面的示例对Gradle执行相同的操作：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>springBoot <span class="token punctuation">{</span>
    <span class="token function">buildInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关更多详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/gradle-plugin/reference/html//#integrating-with-actuator-build-info" target="_blank" rel="noopener noreferrer">Spring Boot Gradle插件文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_16-2。生成git信息"><a href="#_16-2。生成git信息" class="header-anchor">#</a> 16.2。生成Git信息</h3> <p>Maven和Gradle都允许生成一个<code>git.properties</code>文件，其中包含有关<code>git</code>构建项目时源代码存储库状态的信息。</p> <p>对于Maven用户，<code>spring-boot-starter-parent</code>POM包含一个预配置的插件来生成<code>git.properties</code>文件。要使用它，请将以下声明添加到您的POM中：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>pl.project13.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>git-commit-id-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Gradle用户可以通过使用<a href="https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties" target="_blank" rel="noopener noreferrer"><code>gradle-git-properties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>插件获得相同的结果，如以下示例所示：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span>
    id <span class="token string gstring">&quot;com.gorylenko.gradle-git-properties&quot;</span> version <span class="token string gstring">&quot;1.5.1&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>提交时间<code>git.properties</code>应与以下格式匹配：<code>yyyy-MM-dd’T’HH:mm:ssZ</code>。这是上面列出的两个插件的默认格式。使用此格式，可以将时间解析为，<code>Date</code>并将其序列化为JSON时的格式由Jackson的日期序列化配置设置控制。</p></div> <h3 id="_16-3。自定义依赖版本"><a href="#_16-3。自定义依赖版本" class="header-anchor">#</a> 16.3。自定义依赖版本</h3> <p>如果您使用直接或间接继承自<code>spring-boot-dependencies</code>（例如<code>spring-boot-starter-parent</code>）的Maven构建，但要覆盖特定的第三方依赖关系，则可以添加适当的<code>&lt;properties&gt;</code>元素。浏览<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-dependencies/pom.xml" target="_blank" rel="noopener noreferrer"><code>spring-boot-dependencies</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>POM以获取属性的完整列表。例如，要选择其他<code>slf4j</code>版本，可以添加以下属性：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>1.7.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>仅当您的Maven项目从（直接或间接）继承时，此方法才有效<code>spring-boot-dependencies</code>。如果您使用添加<code>spring-boot-dependencies</code>了自己的<code>dependencyManagement</code>部分<code>&lt;scope&gt;import&lt;/scope&gt;</code>，则必须自己重新定义工件，而不是覆盖属性。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>每个Spring Boot版本都是针对这组特定的第三方依赖关系进行设计和测试的。覆盖版本可能会导致兼容性问题。</p></div> <p>要覆盖Gradle中的依赖版本，请参阅Gradle插件文档的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/gradle-plugin/reference/html//#managing-dependencies-customizing" target="_blank" rel="noopener noreferrer">这一部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_16-4。使用maven创建可执行jar"><a href="#_16-4。使用maven创建可执行jar" class="header-anchor">#</a> 16.4。使用Maven创建可执行JAR</h3> <p>该<code>spring-boot-maven-plugin</code>可用于创建可执行的“肥肉” JAR。如果使用<code>spring-boot-starter-parent</code>POM，则可以声明插件，然后将jar重新包装如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果您不使用父POM，则仍然可以使用该插件。但是，您必须另外添加一个<code>&lt;executions&gt;</code>部分，如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>repackage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>有关完整用法的详细信息，请参阅<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/maven-plugin//usage.html" target="_blank" rel="noopener noreferrer">插件文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_16-5。使用spring-boot应用程序作为依赖项"><a href="#_16-5。使用spring-boot应用程序作为依赖项" class="header-anchor">#</a> 16.5。使用Spring Boot应用程序作为依赖项</h3> <p>像war文件一样，Spring Boot应用程序也不打算用作依赖项。如果您的应用程序包含要与其他项目共享的类，则建议的方法是将该代码移到单独的模块中。然后，您的应用程序和其他项目可以依赖单独的模块。</p> <p>如果您不能按照上面的建议重新排列代码，则必须配置Spring Boot的Maven和Gradle插件以生成一个单独的工件，该工件适合用作依赖项。可执行档案不能用作依赖项，因为<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-executable-jar-format.html#executable-jar-jar-file-structure" target="_blank" rel="noopener noreferrer">可执行jar格式将<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>打包应用程序类<code>BOOT-INF/classes</code>。这意味着当将可执行jar用作依赖项时，找不到它们。</p> <p>为了产生两个工件，一个可以用作依赖项，另一个可以执行，必须指定分类器。该分类器应用于可执行归档文件的名称，保留默认归档文件以用作依赖项。</p> <p>要<code>exec</code>在Maven中配置分类器，可以使用以下配置：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classifier</span><span class="token punctuation">&gt;</span></span>exec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classifier</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_16-6。运行可执行jar时提取特定的库"><a href="#_16-6。运行可执行jar时提取特定的库" class="header-anchor">#</a> 16.6。运行可执行jar时提取特定的库</h3> <p>可执行jar中的大多数嵌套库不需要解压即可运行。但是，某些库可能会有问题。例如，JRuby包含自己的嵌套jar支持，它假定<code>jruby-complete.jar</code>总是可以直接以文件的形式直接使用。</p> <p>为了处理任何有问题的库，您可以标记在可执行jar首次运行时应自动解压缩特定的嵌套jar。这些嵌套的jar会写在<code>java.io.tmpdir</code>system属性标识的临时目录下。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>应注意确保已配置您的操作系统，以便在应用程序仍在运行时，它不会删除已解压缩到临时目录中的jar。</p></div> <p>例如，为了指示应该使用Maven插件将JRuby标记为要解包，您可以添加以下配置：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>requiresUnpack</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jruby<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jruby-complete<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>requiresUnpack</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_16-7。创建带有排除项的不可执行的jar"><a href="#_16-7。创建带有排除项的不可执行的jar" class="header-anchor">#</a> 16.7。创建带有排除项的不可执行的JAR</h3> <p>通常，如果您具有一个可执行文件和一个不可执行的jar作为两个单独的构建产品，则可执行版本具有库jar中不需要的其他配置文件。例如，<code>application.yml</code>配置文件可能被排除在不可执行的JAR中。</p> <p>在Maven中，可执行jar必须是主要工件，您可以为库添加一个分类的jar，如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-jar-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>lib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classifier</span><span class="token punctuation">&gt;</span></span>lib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>classifier</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>application.yml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_16-8。远程调试以maven开头的spring-boot应用程序"><a href="#_16-8。远程调试以maven开头的spring-boot应用程序" class="header-anchor">#</a> 16.8。远程调试以Maven开头的Spring Boot应用程序</h3> <p>要将远程调试器附加到使用Maven启动的Spring Boot应用程序，可以使用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/maven-plugin/" target="_blank" rel="noopener noreferrer">maven plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<code>jvmArguments</code>属性。</p> <p>有关更多详细信息，请参<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/maven-plugin//examples/run-debug.html" target="_blank" rel="noopener noreferrer">见此示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_16-9。在不使用ant的情况下从ant构建可执行存档spring-boot-antlib"><a href="#_16-9。在不使用ant的情况下从ant构建可执行存档spring-boot-antlib" class="header-anchor">#</a> 16.9。在不使用Ant的情况下从Ant构建可执行存档<code>spring-boot-antlib</code></h3> <p>要使用Ant进行构建，您需要获取依赖项，进行编译，然后创建一个jar或war存档。要使其可执行，可以使用该<code>spring-boot-antlib</code>模块，也可以按照以下说明进行操作：</p> <ol><li>如果要构建jar，请将应用程序的类和资源打包到嵌套<code>BOOT-INF/classes</code>目录中。如果要发动战争，请<code>WEB-INF/classes</code>照常将应用程序的类打包在嵌套目录中。</li> <li>在<code>BOOT-INF/lib</code>jar或<code>WEB-INF/lib</code>war 的嵌套目录中添加运行时依赖项。切记<strong>不要</strong>压缩存档中的条目。</li> <li>将<code>provided</code>（嵌入式容器）依赖项添加到<code>BOOT-INF/lib</code>jar或<code>WEB-INF/lib-provided</code>war 的嵌套目录中。切记<strong>不要</strong>压缩存档中的条目。</li> <li>将<code>spring-boot-loader</code>类添加到存档的根目录（以便<code>Main-Class</code>可用）。</li> <li>使用适当的启动器（例如<code>JarLauncher</code>jar文件）作为<code>Main-Class</code>清单中的属性，并指定其所需的其他属性作为清单条目（主要是通过设置<code>Start-Class</code>属性）。</li></ol> <p>以下示例显示了如何使用Ant构建可执行归档文件：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>build<span class="token punctuation">&quot;</span></span> <span class="token attr-name">depends</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>compile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jar</span> <span class="token attr-name">destfile</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>target/${ant.project.name}-${spring-boot.version}.jar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">compress</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappedresources</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileset</span> <span class="token attr-name">dir</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>target/classes<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>globmapper</span> <span class="token attr-name">from</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>BOOT-INF/classes/*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappedresources</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappedresources</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileset</span> <span class="token attr-name">dir</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>src/main/resources<span class="token punctuation">&quot;</span></span> <span class="token attr-name">erroronmissingdir</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>globmapper</span> <span class="token attr-name">from</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>BOOT-INF/classes/*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappedresources</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappedresources</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileset</span> <span class="token attr-name">dir</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${lib.dir}/runtime<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>globmapper</span> <span class="token attr-name">from</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>BOOT-INF/lib/*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappedresources</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>zipfileset</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${lib.dir}/loader/spring-boot-loader-jar-${spring-boot.version}.jar<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Main-Class<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>org.springframework.boot.loader.JarLauncher<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Start-Class<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${start-class}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jar</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_17-传统部署"><a href="#_17-传统部署" class="header-anchor">#</a> 17.传统部署</h2> <p>Spring Boot支持传统部署以及更现代的部署形式。本节回答有关传统部署的常见问题。</p> <h3 id="_17-1。创建可部署的战争文件"><a href="#_17-1。创建可部署的战争文件" class="header-anchor">#</a> 17.1。创建可部署的战争文件</h3> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于Spring WebFlux不严格依赖Servlet API，并且默认情况下将应用程序部署在嵌入式Reactor Netty服务器上，因此WebFlux应用程序不支持War部署。</p></div> <p>生成可部署war文件的第一步是提供一个<code>SpringBootServletInitializer</code>子类并覆盖其<code>configure</code>方法。这样做利用了Spring Framework的Servlet 3.0支持，并允许您在由Servlet容器启动应用程序时对其进行配置。通常，应将应用程序的主类更新为extend <code>SpringBootServletInitializer</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token keyword">extends</span> <span class="token class-name">SpringBootServletInitializer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">SpringApplicationBuilder</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">SpringApplicationBuilder</span> application<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> application<span class="token punctuation">.</span><span class="token function">sources</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>下一步是更新构建配置，以使您的项目生成war文件而不是jar文件。如果您使用Maven和<code>spring-boot-starter-parent</code>（为您配置Maven的war插件），那么您要做的就是修改<code>pom.xml</code>以将包装更改为war，如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">&gt;</span></span>war<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果使用Gradle，则需要进行修改，<code>build.gradle</code>以将war插件应用于项目，如下所示：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>apply plugin<span class="token punctuation">:</span> <span class="token string">'war'</span>
</code></pre></div><p>该过程的最后一步是确保嵌入式servlet容器不干扰war文件所部署到的servlet容器。为此，您需要将嵌入式Servlet容器依赖性标记为已提供。</p> <p>如果使用Maven，则以下示例将servlet容器（在本例中为Tomcat）标记为已提供：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- … --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-tomcat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- … --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果使用Gradle，则以下示例将servlet容器（在本例中为Tomcat）标记为已提供：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    <span class="token comment">// …</span>
    providedRuntime <span class="token string">'org.springframework.boot:spring-boot-starter-tomcat'</span>
    <span class="token comment">// …</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>providedRuntime</code>比Gradle的<code>compileOnly</code>配置更可取。除其他限制外，<code>compileOnly</code>依赖项不在测试类路径上，因此任何基于Web的集成测试都将失败。</p></div> <p>如果您使用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/build-tool-plugins.html#build-tool-plugins" target="_blank" rel="noopener noreferrer">Spring Boot构建工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，则将提供的嵌入式servlet容器依赖关系标记为提供将生成可执行的war文件，并将提供的依赖关系打包在<code>lib-provided</code>目录中。这意味着，除了可以部署到servlet容器之外，还可以通过<code>java -jar</code>在命令行上使用运行应用程序。</p> <h3 id="_17-2。将现有应用程序转换为spring-boot"><a href="#_17-2。将现有应用程序转换为spring-boot" class="header-anchor">#</a> 17.2。将现有应用程序转换为Spring Boot</h3> <p>对于非Web应用程序，将现有的Spring应用程序转换为Spring Boot应用程序应该很容易。为此，请丢弃创建您的代码，<code>ApplicationContext</code>并用<code>SpringApplication</code>或调用替换它<code>SpringApplicationBuilder</code>。Spring MVC Web应用程序通常适合于首先创建可部署的war应用程序，然后再将其迁移到可执行的war或jar。请参阅<a href="https://spring.io/guides/gs/convert-jar-to-war/" target="_blank" rel="noopener noreferrer">有关将罐子转换为战争的入门指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>要通过扩展<code>SpringBootServletInitializer</code>（例如，在名为的类中<code>Application</code>）并添加Spring Boot <code>@SpringBootApplication</code>注释来创建可部署的战争，请使用类似于以下示例所示的代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token keyword">extends</span> <span class="token class-name">SpringBootServletInitializer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">SpringApplicationBuilder</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">SpringApplicationBuilder</span> application<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Customize the application or call application.sources(...) to add sources</span>
        <span class="token comment">// Since our example is itself a @Configuration class (via @SpringBootApplication)</span>
        <span class="token comment">// we actually don't need to override this method.</span>
        <span class="token keyword">return</span> application<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>请记住，无论您放置什么，<code>sources</code>都只是Spring <code>ApplicationContext</code>。通常，任何已经起作用的东西都应该在这里工作。可能有些bean可以在以后删除，并让Spring Boot为它们提供自己的默认值，但是应该可以使某些东西工作，然后再执行此操作。</p> <p>可以将静态资源移到类路径根目录中<code>/public</code>（或<code>/static</code>或<code>/resources</code>或<code>/META-INF/resources</code>）。这同样适用于<code>messages.properties</code>（Spring Boot自动在类路径的根目录中检测到）。</p> <p>在Spring <code>DispatcherServlet</code>和Spring Security中使用Vanilla 不需要进一步更改。如果您的应用程序具有其他功能（例如，使用其他servlet或过滤器），则可能需要<code>Application</code>通过从中替换这些元素来为上下文添加一些配置<code>web.xml</code>，如下所示：</p> <ul><li>甲<code>@Bean</code>类型的<code>Servlet</code>或<code>ServletRegistrationBean</code>将安装豆在容器中，好像它是一个<code>&lt;servlet/&gt;</code>与<code>&lt;servlet-mapping/&gt;</code>在<code>web.xml</code>。</li> <li>甲<code>@Bean</code>型的<code>Filter</code>或<code>FilterRegistrationBean</code>表现得类似（作为<code>&lt;filter/&gt;</code>和<code>&lt;filter-mapping/&gt;</code>）。</li> <li>一个<code>ApplicationContext</code>XML文件可以通过添加<code>@ImportResource</code>在你的<code>Application</code>。或者，可以在几行中重新创建已经大量使用注释配置的简单情况作为<code>@Bean</code>定义。</li></ul> <p>war文件运行后，可以通过向中添加一个<code>main</code>方法使其变为可执行文件<code>Application</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果打算以战争或可执行应用程序的形式启动应用程序，则需要使用对<code>SpringBootServletInitializer</code>回调函数可用的方法和<code>main</code>类似于以下类的方法共享构建器的自定义项：<code>@SpringBootApplication public class Application extends SpringBootServletInitializer { @Override protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) { return configureApplication(builder); } public static void main(String[] args) { configureApplication(new SpringApplicationBuilder()).run(args); } private static SpringApplicationBuilder configureApplication(SpringApplicationBuilder builder) { return builder.sources(Application.class).bannerMode(Banner.Mode.OFF); } }</code></p></div> <p>应用程序可以分为多个类别：</p> <ul><li>没有的Servlet 3.0+应用程序<code>web.xml</code>。</li> <li>带有的应用程序<code>web.xml</code>。</li> <li>具有上下文层次结构的应用程序。</li> <li>没有上下文层次结构的应用程序。</li></ul> <p>所有这些都应该适合翻译，但是每种可能都需要稍微不同的技术。</p> <p>如果Servlet 3.0+应用程序已经使用了Spring Servlet 3.0+初始化程序支持类，那么它们可能会很容易转换。通常，来自现有代码的所有代码<code>WebApplicationInitializer</code>都可以移入<code>SpringBootServletInitializer</code>。如果您现有的应用程序有多个<code>ApplicationContext</code>（例如，如果使用<code>AbstractDispatcherServletInitializer</code>），则可以将所有上下文源组合到一个中<code>SpringApplication</code>。您可能会遇到的主要并发症是，如果合并无效，则需要维护上下文层次结构。有关示例，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-build-an-application-context-hierarchy" target="_blank" rel="noopener noreferrer">有关构建层次结构<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-build-an-application-context-hierarchy" target="_blank" rel="noopener noreferrer">条目<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。通常，需要拆分包含特定于Web的功能的现有父上下文，以便所有<code>ServletContextAware</code>组件都位于子上下文中。</p> <p>还不是Spring应用程序的应用程序可以转换为Spring Boot应用程序，前面提到的指南可能会有所帮助。但是，您可能仍然遇到问题。在这种情况下，建议您<a href="https://stackoverflow.com/questions/tagged/spring-boot" target="_blank" rel="noopener noreferrer">使用标记来在Stack Overflow上提问<code>spring-boot</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_17-3。将war部署到weblogic"><a href="#_17-3。将war部署到weblogic" class="header-anchor">#</a> 17.3。将WAR部署到WebLogic</h3> <p>要将Spring Boot应用程序部署到WebLogic，必须确保servlet初始化程序<strong>直接</strong>实现<code>WebApplicationInitializer</code>（即使从已经实现了它的基类扩展）。</p> <p>WebLogic的典型初始化程序应类似于以下示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure</span><span class="token punctuation">.</span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>support</span><span class="token punctuation">.</span><span class="token class-name">SpringBootServletInitializer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web</span><span class="token punctuation">.</span><span class="token class-name">WebApplicationInitializer</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token keyword">extends</span> <span class="token class-name">SpringBootServletInitializer</span> <span class="token keyword">implements</span> <span class="token class-name">WebApplicationInitializer</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果使用Logback，则还需要告诉WebLogic首选打包版本，而不是服务器预先安装的版本。您可以通过添加<code>WEB-INF/weblogic.xml</code>具有以下内容的文件来做到这一点：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">wls:</span>weblogic-web-app</span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>wls</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://xmlns.oracle.com/weblogic/weblogic-web-app<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://java.sun.com/xml/ns/javaee
        https://java.sun.com/xml/ns/javaee/ejb-jar_3_0.xsd
        http://xmlns.oracle.com/weblogic/weblogic-web-app
        https://xmlns.oracle.com/weblogic/weblogic-web-app/1.4/weblogic-web-app.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">wls:</span>container-descriptor</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">wls:</span>prefer-application-packages</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">wls:</span>package-name</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">wls:</span>package-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">wls:</span>prefer-application-packages</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">wls:</span>container-descriptor</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">wls:</span>weblogic-web-app</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_17-4。使用jedis代替生菜"><a href="#_17-4。使用jedis代替生菜" class="header-anchor">#</a> 17.4。使用Jedis代替生菜</h3> <p>默认情况下，Spring Boot入门（<code>spring-boot-starter-data-redis</code>）使用<a href="https://github.com/lettuce-io/lettuce-core/" target="_blank" rel="noopener noreferrer">Lettuce<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。您需要排除该依赖性，而改为包含<a href="https://github.com/xetorthio/jedis/" target="_blank" rel="noopener noreferrer">Jedis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。Spring Boot管理这些依赖关系，以帮助使此过程尽可能简单。</p> <p>以下示例显示了如何在Maven中执行此操作：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.lettuce<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lettuce-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以下示例显示了如何在Gradle中执行此操作：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>configurations <span class="token punctuation">{</span>
    compile<span class="token punctuation">.</span>exclude module<span class="token punctuation">:</span> <span class="token string gstring">&quot;lettuce&quot;</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token function">compile</span><span class="token punctuation">(</span><span class="token string gstring">&quot;redis.clients:jedis&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/spring/生成工具插件.html" class="prev">
        生成工具插件
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ab60294b.js" defer></script><script src="/assets/js/2.0769d472.js" defer></script><script src="/assets/js/82.7f8e37af.js" defer></script>
  </body>
</html>
