<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Boot功能 |  </title>
    <meta name="description" content=" ">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/img/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.6d3e66e0.css" as="style"><link rel="preload" href="/assets/js/app.ab60294b.js" as="script"><link rel="preload" href="/assets/js/2.0769d472.js" as="script"><link rel="preload" href="/assets/js/79.2dc3f78e.js" as="script"><link rel="prefetch" href="/assets/js/10.d5b488e5.js"><link rel="prefetch" href="/assets/js/100.b05fe937.js"><link rel="prefetch" href="/assets/js/101.c78118ad.js"><link rel="prefetch" href="/assets/js/11.ba7209bc.js"><link rel="prefetch" href="/assets/js/12.7eb2b639.js"><link rel="prefetch" href="/assets/js/13.319a2e91.js"><link rel="prefetch" href="/assets/js/14.fe83290c.js"><link rel="prefetch" href="/assets/js/15.8a7ec64a.js"><link rel="prefetch" href="/assets/js/16.41f2dd98.js"><link rel="prefetch" href="/assets/js/17.904bc325.js"><link rel="prefetch" href="/assets/js/18.7a6246f7.js"><link rel="prefetch" href="/assets/js/19.84ab8dd3.js"><link rel="prefetch" href="/assets/js/20.04c09d1c.js"><link rel="prefetch" href="/assets/js/21.e75a2f46.js"><link rel="prefetch" href="/assets/js/22.a14b1840.js"><link rel="prefetch" href="/assets/js/23.799a37e9.js"><link rel="prefetch" href="/assets/js/24.c3eada22.js"><link rel="prefetch" href="/assets/js/25.4f11ed3d.js"><link rel="prefetch" href="/assets/js/26.375a9c03.js"><link rel="prefetch" href="/assets/js/27.bc7c4ae2.js"><link rel="prefetch" href="/assets/js/28.2250b95c.js"><link rel="prefetch" href="/assets/js/29.f568d59e.js"><link rel="prefetch" href="/assets/js/3.79868d1c.js"><link rel="prefetch" href="/assets/js/30.f7eb4129.js"><link rel="prefetch" href="/assets/js/31.94b316c6.js"><link rel="prefetch" href="/assets/js/32.428d0721.js"><link rel="prefetch" href="/assets/js/33.6064d0ca.js"><link rel="prefetch" href="/assets/js/34.711c8d67.js"><link rel="prefetch" href="/assets/js/35.2d341b53.js"><link rel="prefetch" href="/assets/js/36.d44bf3ce.js"><link rel="prefetch" href="/assets/js/37.b6844632.js"><link rel="prefetch" href="/assets/js/38.80d006c6.js"><link rel="prefetch" href="/assets/js/39.f7bee99d.js"><link rel="prefetch" href="/assets/js/4.973e9025.js"><link rel="prefetch" href="/assets/js/40.0239e47a.js"><link rel="prefetch" href="/assets/js/41.ae2fbfaa.js"><link rel="prefetch" href="/assets/js/42.dfd29a6a.js"><link rel="prefetch" href="/assets/js/43.683daf3c.js"><link rel="prefetch" href="/assets/js/44.562e4097.js"><link rel="prefetch" href="/assets/js/45.95b98fcb.js"><link rel="prefetch" href="/assets/js/46.d96aa487.js"><link rel="prefetch" href="/assets/js/47.2aca851e.js"><link rel="prefetch" href="/assets/js/48.814b9e24.js"><link rel="prefetch" href="/assets/js/49.fe2be804.js"><link rel="prefetch" href="/assets/js/5.336b97a1.js"><link rel="prefetch" href="/assets/js/50.c5a763c1.js"><link rel="prefetch" href="/assets/js/51.41e24a47.js"><link rel="prefetch" href="/assets/js/52.6c448e60.js"><link rel="prefetch" href="/assets/js/53.8c0b5684.js"><link rel="prefetch" href="/assets/js/54.8f76ab97.js"><link rel="prefetch" href="/assets/js/55.a15238f6.js"><link rel="prefetch" href="/assets/js/56.385a70ef.js"><link rel="prefetch" href="/assets/js/57.fe5f9465.js"><link rel="prefetch" href="/assets/js/58.348704b8.js"><link rel="prefetch" href="/assets/js/59.8074fc81.js"><link rel="prefetch" href="/assets/js/6.cdc6003c.js"><link rel="prefetch" href="/assets/js/60.1886e5a2.js"><link rel="prefetch" href="/assets/js/61.8cdce743.js"><link rel="prefetch" href="/assets/js/62.ccfad9c2.js"><link rel="prefetch" href="/assets/js/63.16b1771b.js"><link rel="prefetch" href="/assets/js/64.ab84024e.js"><link rel="prefetch" href="/assets/js/65.5d7c3b7a.js"><link rel="prefetch" href="/assets/js/66.d8591a18.js"><link rel="prefetch" href="/assets/js/67.73456f7e.js"><link rel="prefetch" href="/assets/js/68.f481f8f3.js"><link rel="prefetch" href="/assets/js/69.96f25530.js"><link rel="prefetch" href="/assets/js/7.46997b0a.js"><link rel="prefetch" href="/assets/js/70.0ab0d1fd.js"><link rel="prefetch" href="/assets/js/71.dd8facc4.js"><link rel="prefetch" href="/assets/js/72.ef52962d.js"><link rel="prefetch" href="/assets/js/73.0e844bfe.js"><link rel="prefetch" href="/assets/js/74.a3f222d9.js"><link rel="prefetch" href="/assets/js/75.cbbf1e57.js"><link rel="prefetch" href="/assets/js/76.79bfac66.js"><link rel="prefetch" href="/assets/js/77.536742b4.js"><link rel="prefetch" href="/assets/js/78.44d6cb00.js"><link rel="prefetch" href="/assets/js/8.2825b7c8.js"><link rel="prefetch" href="/assets/js/80.30f2b7e8.js"><link rel="prefetch" href="/assets/js/81.ce007e74.js"><link rel="prefetch" href="/assets/js/82.7f8e37af.js"><link rel="prefetch" href="/assets/js/83.201b9f31.js"><link rel="prefetch" href="/assets/js/84.8e750285.js"><link rel="prefetch" href="/assets/js/85.b564c207.js"><link rel="prefetch" href="/assets/js/86.85da9ef3.js"><link rel="prefetch" href="/assets/js/87.61865fb9.js"><link rel="prefetch" href="/assets/js/88.2c3e8d72.js"><link rel="prefetch" href="/assets/js/89.2b99140f.js"><link rel="prefetch" href="/assets/js/9.2a76fd8c.js"><link rel="prefetch" href="/assets/js/90.6ede089c.js"><link rel="prefetch" href="/assets/js/91.4f784eb3.js"><link rel="prefetch" href="/assets/js/92.503a04a8.js"><link rel="prefetch" href="/assets/js/93.668a1616.js"><link rel="prefetch" href="/assets/js/94.78890e02.js"><link rel="prefetch" href="/assets/js/95.4eafa307.js"><link rel="prefetch" href="/assets/js/96.8be342d2.js"><link rel="prefetch" href="/assets/js/97.cff73008.js"><link rel="prefetch" href="/assets/js/98.2d7c9205.js"><link rel="prefetch" href="/assets/js/99.4e9998dc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6d3e66e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon.png" alt=" " class="logo"> <span class="site-name can-hide"> </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/disclaimer/" class="nav-link">
  免责声明
</a></div><div class="nav-item"><a href="https://github.com/codepaul-wh/ErrorDescription" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SpringBoot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/spring/" class="sidebar-link">Spring Boot参考文档</a></li><li><a href="/spring/法律.html" class="sidebar-link">法律</a></li><li><a href="/spring/文档概述.html" class="sidebar-link">文档概述</a></li><li><a href="/spring/入门.html" class="sidebar-link">入门</a></li><li><a href="/spring/使用SpringBoot.html" class="sidebar-link">使用Spring Boot</a></li><li><a href="/spring/SpringBoot功能.html" class="active sidebar-link">Spring Boot功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-springapplication" class="sidebar-link">1. SpringApplication</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-1。启动失败" class="sidebar-link">1.1。启动失败</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-2。延迟初始化" class="sidebar-link">1.2。延迟初始化</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-3。自定义横幅" class="sidebar-link">1.3。自定义横幅</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-4。自定义springapplication" class="sidebar-link">1.4。自定义SpringApplication</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-5。fluent-builder-api" class="sidebar-link">1.5。Fluent Builder API</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-6。应用程序事件和监听器" class="sidebar-link">1.6。应用程序事件和监听器</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-7。网络环境" class="sidebar-link">1.7。网络环境</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-8。访问应用程序参数" class="sidebar-link">1.8。访问应用程序参数</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-9。使用applicationrunner或commandlinerunner" class="sidebar-link">1.9。使用ApplicationRunner或CommandLineRunner</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-10。申请退出" class="sidebar-link">1.10。申请退出</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_1-11。管理员功能" class="sidebar-link">1.11。管理员功能</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_2-外部化配置" class="sidebar-link">2.外部化配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_2-1。配置随机值" class="sidebar-link">2.1。配置随机值</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_2-2。访问命令行属性" class="sidebar-link">2.2。访问命令行属性</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_2-3。应用程序属性文件" class="sidebar-link">2.3。应用程序属性文件</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_2-4。特定于配置文件的属性" class="sidebar-link">2.4。特定于配置文件的属性</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_2-5。属性中的占位符" class="sidebar-link">2.5。属性中的占位符</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_2-6。加密属性" class="sidebar-link">2.6。加密属性</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_2-7。使用yaml代替属性" class="sidebar-link">2.7。使用YAML代替属性</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_2-8。类型安全的配置属性" class="sidebar-link">2.8。类型安全的配置属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_3-个人资料" class="sidebar-link">3.个人资料</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_3-1。添加活动配置文件" class="sidebar-link">3.1。添加活动配置文件</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_3-2。以编程方式设置配置文件" class="sidebar-link">3.2。以编程方式设置配置文件</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_3-3。特定于配置文件的配置文件" class="sidebar-link">3.3。特定于配置文件的配置文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_4-记录" class="sidebar-link">4.记录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_4-1。日志格式" class="sidebar-link">4.1。日志格式</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_4-2。控制台输出" class="sidebar-link">4.2。控制台输出</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_4-3。文件输出" class="sidebar-link">4.3。文件输出</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_4-4。日志级别" class="sidebar-link">4.4。日志级别</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_4-5。日志组" class="sidebar-link">4.5。日志组</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_4-6。自定义日志配置" class="sidebar-link">4.6。自定义日志配置</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_4-7。登录扩展" class="sidebar-link">4.7。登录扩展</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_5-国际化" class="sidebar-link">5.国际化</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_6-json" class="sidebar-link">6. JSON</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_6-1。杰克逊" class="sidebar-link">6.1。杰克逊</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_6-2。格森" class="sidebar-link">6.2。格森</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_6-3。json-b" class="sidebar-link">6.3。JSON-B</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_7-开发web应用程序" class="sidebar-link">7.开发Web应用程序</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_7-1。-spring-web-mvc框架" class="sidebar-link">7.1。“ Spring Web MVC框架”</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_7-2。-spring-webflux框架" class="sidebar-link">7.2。“ Spring WebFlux框架”</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_7-3。jax-rs和泽西岛" class="sidebar-link">7.3。JAX-RS和泽西岛</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_7-4。嵌入式servlet容器支持" class="sidebar-link">7.4。嵌入式Servlet容器支持</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_7-5。嵌入式反应式服务器支持" class="sidebar-link">7.5。嵌入式反应式服务器支持</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_7-6。反应性服务器资源配置" class="sidebar-link">7.6。反应性服务器资源配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_8-rsocket" class="sidebar-link">8. RSocket</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_8-1。rsocket策略自动配置" class="sidebar-link">8.1。RSocket策略自动配置</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_8-2。rsocket服务器自动配置" class="sidebar-link">8.2。RSocket服务器自动配置</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_8-3。spring-messaging-rsocket支持" class="sidebar-link">8.3。Spring Messaging RSocket支持</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_8-4。使用以下命令调用rsocket服务rsocketrequester" class="sidebar-link">8.4。使用以下命令调用RSocket服务RSocketRequester</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_9-安全性" class="sidebar-link">9.安全性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_9-1。mvc安全" class="sidebar-link">9.1。MVC安全</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_9-2。webflux安全" class="sidebar-link">9.2。WebFlux安全</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_9-3。oauth2" class="sidebar-link">9.3。OAuth2</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_9-4。saml-2-0" class="sidebar-link">9.4。SAML 2.0</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_9-5。执行器安全" class="sidebar-link">9.5。执行器安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_10-使用sql数据库" class="sidebar-link">10.使用SQL数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_10-1。配置数据源" class="sidebar-link">10.1。配置数据源</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_10-2。使用jdbctemplate" class="sidebar-link">10.2。使用JdbcTemplate</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_10-3。jpa和spring-data-jpa" class="sidebar-link">10.3。JPA和Spring Data JPA</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_10-4。spring-data-jdbc" class="sidebar-link">10.4。Spring Data JDBC</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_10-5。使用h2的web控制台" class="sidebar-link">10.5。使用H2的Web控制台</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_10-6。使用jooq" class="sidebar-link">10.6。使用jOOQ</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-使用nosql技术" class="sidebar-link">11.使用NoSQL技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-1。redis" class="sidebar-link">11.1。Redis</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-2。mongodb" class="sidebar-link">11.2。MongoDB</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-3。neo4j" class="sidebar-link">11.3。Neo4j</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-4。索尔" class="sidebar-link">11.4。索尔</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-5。弹性搜索" class="sidebar-link">11.5。弹性搜索</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-6。卡桑德拉" class="sidebar-link">11.6。卡桑德拉</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-7。couchbase" class="sidebar-link">11.7。Couchbase</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-8。ldap" class="sidebar-link">11.8。LDAP</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_11-9。influxdb" class="sidebar-link">11.9。InfluxDB</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_12-缓存" class="sidebar-link">12.缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_12-1。支持的缓存提供程序" class="sidebar-link">12.1。支持的缓存提供程序</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_13-消息传递" class="sidebar-link">13.消息传递</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_13-1。jms" class="sidebar-link">13.1。JMS</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_13-2。amqp" class="sidebar-link">13.2。AMQP</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_13-3。apache-kafka支持" class="sidebar-link">13.3。Apache Kafka支持</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_14-通过以下方式调用rest服务-resttemplate" class="sidebar-link">14.通过以下方式调用REST服务 RestTemplate</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_14-1。resttemplate自定义" class="sidebar-link">14.1。RestTemplate自定义</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_15-通过调用rest服务-webclient" class="sidebar-link">15.通过调用REST服务 WebClient</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_15-1。webclient运行时" class="sidebar-link">15.1。WebClient运行时</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_15-2。webclient定制" class="sidebar-link">15.2。WebClient定制</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_16-验证" class="sidebar-link">16.验证</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_17-发送电子邮件" class="sidebar-link">17.发送电子邮件</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_18-jta的分布式事务" class="sidebar-link">18. JTA的分布式事务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_18-1。使用atomikos交易管理器" class="sidebar-link">18.1。使用Atomikos交易管理器</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_18-2。使用bitronix交易管理器" class="sidebar-link">18.2。使用Bitronix交易管理器</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_18-3。使用java-ee托管事务管理器" class="sidebar-link">18.3。使用Java EE托管事务管理器</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_18-4。混合xa和非xa-jms连接" class="sidebar-link">18.4。混合XA和非XA JMS连接</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_18-5。支持替代嵌入式事务管理器" class="sidebar-link">18.5。支持替代嵌入式事务管理器</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_19-hazelcast" class="sidebar-link">19. Hazelcast</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_20-quartz-scheduler" class="sidebar-link">20. Quartz Scheduler</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_21-任务执行和计划" class="sidebar-link">21.任务执行和计划</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_22-spring集成" class="sidebar-link">22. Spring集成</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_23-spring-boot会议" class="sidebar-link">23.Spring Boot会议</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_24-通过jmx进行监视和管理" class="sidebar-link">24.通过JMX进行监视和管理</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_25-测试" class="sidebar-link">25.测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_25-1。测试范围依赖性" class="sidebar-link">25.1。测试范围依赖性</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_25-2。测试spring应用程序" class="sidebar-link">25.2。测试Spring应用程序</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_25-3。测试spring-boot应用程序" class="sidebar-link">25.3。测试Spring Boot应用程序</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_25-4。测试工具" class="sidebar-link">25.4。测试工具</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_26-web套接字" class="sidebar-link">26. Web套接字</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_27-网络服务" class="sidebar-link">27.网络服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_27-1。使用调用web服务webservicetemplate" class="sidebar-link">27.1。使用调用Web服务WebServiceTemplate</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_28-创建自己的自动配置" class="sidebar-link">28.创建自己的自动配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_28-1。了解自动配置的bean" class="sidebar-link">28.1。了解自动配置的Bean</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_28-2-查找自动配置候选人" class="sidebar-link">28.2. 查找自动配置候选人</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_28-3-条件注释" class="sidebar-link">28.3. 条件注释</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_28-4-测试您的自动配置" class="sidebar-link">28.4. 测试您的自动配置</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_28-5-创建自己的入门" class="sidebar-link">28.5. 创建自己的入门</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_29-kotlin支持" class="sidebar-link">29. Kotlin支持</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_29-1。要求" class="sidebar-link">29.1。要求</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_29-2。零安全" class="sidebar-link">29.2。零安全</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_29-3。kotlin-api" class="sidebar-link">29.3。Kotlin API</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_29-4。依赖管理" class="sidebar-link">29.4。依赖管理</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_29-5。-configurationproperties" class="sidebar-link">29.5。 @ConfigurationProperties</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_29-6。测试中" class="sidebar-link">29.6。测试中</a></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_29-7。资源资源" class="sidebar-link">29.7。资源资源</a></li></ul></li><li class="sidebar-sub-header"><a href="/spring/SpringBoot功能.html#_30-下一步阅读" class="sidebar-link">30.下一步阅读</a></li></ul></li><li><a href="/spring/SpringBoot启动执行器.html" class="sidebar-link">Spring Boot启动执行器：生产就绪功能</a></li><li><a href="/spring/部署SpringBoot应用程序.html" class="sidebar-link">部署Spring Boot应用程序</a></li><li><a href="/spring/SpringBootCLI.html" class="sidebar-link">Spring Boot CLI</a></li><li><a href="/spring/生成工具插件.html" class="sidebar-link">生成工具插件</a></li><li><a href="/spring/使用方法指南.html" class="sidebar-link">“使用方法”指南</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-boot功能"><a href="#spring-boot功能" class="header-anchor">#</a> Spring Boot功能</h1> <p>本节将深入介绍Spring Boot。在这里，您可以了解可能要使用和自定义的关键功能。如果您尚未这样做，则可能需要阅读“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot" target="_blank" rel="noopener noreferrer">Getting <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/getting-started.html#getting-started" target="_blank" rel="noopener noreferrer">-started.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”和“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot" target="_blank" rel="noopener noreferrer">using-spring-boot.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”部分，以便您有足够的基础知识。</p> <h2 id="_1-springapplication"><a href="#_1-springapplication" class="header-anchor">#</a> 1. SpringApplication</h2> <p>本<code>SpringApplication</code>类提供了一个方便的方式来引导该从开始Spring应用程序<code>main()</code>的方法。在许多情况下，您可以委派给静态<code>SpringApplication.run</code>方法，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MySpringConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当您的应用程序启动时，您应该看到类似于以下输出的内容：</p> <div class="language- extra-class"><pre class="language-text"><code>  。____ _ __ _ _ _
 / \\ / ___'_ __ _ _（_）_ __ __ _ _ \ \ \ \
（（）\ ___ |'_ |'_ | |'_ \ / _` | \ \ \ \
 \\ / ___）| | _）| | | | | || （_ | |））））
  '| ____ | .__ | _ | | _ | _ | | _ \ __，| / / / /
 ======== | _ | ============= | ___ / = / _ / _ / _ /
 :: Spring Boot :: v2.2.2.RELEASE

2019-04-31 13：09：54.117信息56603 --- [main] osbsapp.SampleApplication：在我的计算机上使用PID 56603（/apps/myapp.jar由pwebb启动）启动SampleApplication v0.1.0
2019-04-31 13：09：54.166 INFO 56603 --- [main] ationConfigServletWebServerApplicationContext：刷新org.springframework.boot.web.ser vlet.context.AnnotationConfigServletWebServerApplicationContext @ 6e5a8246：启动日期[WDT Jul 31 00:08:16 PDT 2013]；上下文层次结构的根
2019-04-01 13：09：56.912信息41370 --- [main] .t.TomcatServletWebServerFactory：服务器初始化为端口：8080
2019-04-01 13：09：57.501信息41370 --- [main] osbsapp.SampleApplication：在2.992秒内启动SampleApplication（JVM运行3.658）
</code></pre></div><p>默认情况下，显示<code>INFO</code>日志消息，包括一些相关的启动详细信息，例如启动应用程序的用户。如果您需要除以外的其他日志级别<code>INFO</code>，则可以按照<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-custom-log-levels" target="_blank" rel="noopener noreferrer">日志级别中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>所述进行设置。使用主应用程序类包中的实现版本确定应用程序版本。设置<code>spring.main.log-startup-info</code>为可以关闭启动信息记录<code>false</code>。这还将关闭应用程序活动配置文件的日志记录。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>要在启动期间添加其他日志记录，可以<code>logStartupInfo(boolean)</code>在的子类中覆盖<code>SpringApplication</code>。</p></div> <h3 id="_1-1。启动失败"><a href="#_1-1。启动失败" class="header-anchor">#</a> 1.1。启动失败</h3> <p>如果您的应用程序无法启动，则注册<code>FailureAnalyzers</code>后将有机会提供专门的错误消息和解决该问题的具体措施。例如，如果您在端口上启动Web应用程序<code>8080</code>并且该端口已在使用中，则应该看到类似以下消息的内容：</p> <div class="language- extra-class"><pre class="language-text"><code>****************************
申请开始失败
****************************

描述：

嵌入式Servlet容器无法启动。端口8080已被使用。

行动：

确定并停止正在端口8080上侦听的进程，或将此应用程序配置为在另一个端口上侦听。
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot提供了许多<code>FailureAnalyzer</code>实现，您可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-failure-analyzer" target="_blank" rel="noopener noreferrer">添加自己的实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>如果没有故障分析器能够处理该异常，您仍然可以显示完整情况报告以更好地了解出了什么问题。要做到这一点，你需要<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config" target="_blank" rel="noopener noreferrer">使<code>debug</code>财产<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-custom-log-levels" target="_blank" rel="noopener noreferrer">启用<code>DEBUG</code>日志记录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<code>org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</code>。</p> <p>例如，如果使用来运行应用程序<code>java -jar</code>，则可以<code>debug</code>按如下所示启用属性：</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myproject-0.0.1-SNAPSHOT.jar --debug
</code></pre></div><h3 id="_1-2。延迟初始化"><a href="#_1-2。延迟初始化" class="header-anchor">#</a> 1.2。延迟初始化</h3> <p><code>SpringApplication</code>允许延迟初始化应用程序。启用延迟初始化后，将根据需要创建bean，而不是在应用程序启动期间创建bean。因此，启用延迟初始化可以减少应用程序启动所需的时间。在Web应用程序中，启用延迟初始化将导致许多与Web相关的Bean直到收到HTTP请求后才被初始化。</p> <p>延迟初始化的缺点是，它可能会延迟发现应用程序问题的时间。如果错误配置的Bean延迟初始化，则启动期间将不再发生故障，并且只有在初始化Bean时问题才会变得明显。还必须注意确保JVM有足够的内存来容纳所有应用程序的bean，而不仅仅是启动期间初始化的bean。由于这些原因，默认情况下不会启用延迟初始化，因此建议在启用延迟初始化之前先对JVM的堆大小进行微调。</p> <p>可以使用<code>lazyInitialization</code>on方法<code>SpringApplicationBuilder</code>或<code>setLazyInitialization</code>on 方法以编程方式启用延迟初始化<code>SpringApplication</code>。或者，可以使用<code>spring.main.lazy-initialization</code>以下示例中所示的属性来启用它：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.main.lazy-initialization</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果要在对应用程序的其余部分使用延迟初始化时禁用某些bean的延迟初始化，则可以使用<code>@Lazy(false)</code>批注将它们的延迟属性显式设置为false 。</p></div> <h3 id="_1-3。自定义横幅"><a href="#_1-3。自定义横幅" class="header-anchor">#</a> 1.3。自定义横幅</h3> <p>可以通过将<code>banner.txt</code>文件添加到类路径或将<code>spring.banner.location</code>属性设置为此类文件的位置来更改启动时打印的横幅。如果文件的编码不是UTF-8，则可以设置<code>spring.banner.charset</code>。除了一个文本文件，你还可以添加一个<code>banner.gif</code>，<code>banner.jpg</code>或<code>banner.png</code>图像文件到类路径或设置<code>spring.banner.image.location</code>属性。图像将转换为ASCII艺术作品并打印在任何文字横幅上方。</p> <p>在<code>banner.txt</code>文件内部，可以使用以下任意占位符：</p> <table><thead><tr><th style="text-align:left;">变量</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>${application.version}</code></td> <td style="text-align:left;">您的应用程序的版本号，如中所述<code>MANIFEST.MF</code>。例如，<code>Implementation-Version: 1.0</code>打印为<code>1.0</code>。</td></tr> <tr><td style="text-align:left;"><code>${application.formatted-version}</code></td> <td style="text-align:left;">您的应用程序的版本号，已声明<code>MANIFEST.MF</code>并进行了格式显示（用括号括起来，并带有前缀<code>v</code>）。例如<code>(v1.0)</code>。</td></tr> <tr><td style="text-align:left;"><code>${spring-boot.version}</code></td> <td style="text-align:left;">您正在使用的Spring Boot版本。例如<code>2.2.2.RELEASE</code>。</td></tr> <tr><td style="text-align:left;"><code>${spring-boot.formatted-version}</code></td> <td style="text-align:left;">您正在使用的Spring Boot版本，其格式用于显示（用括号括起来，并带有前缀<code>v</code>）。例如<code>(v2.2.2.RELEASE)</code>。</td></tr> <tr><td style="text-align:left;"><code>${Ansi.NAME}</code>（或<code>${AnsiColor.NAME}</code>，<code>${AnsiBackground.NAME}</code>，<code>${AnsiStyle.NAME}</code>）</td> <td style="text-align:left;"><code>NAME</code>ANSI转义代码的名称在哪里。有关<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/ansi/AnsiPropertySource.java" target="_blank" rel="noopener noreferrer"><code>AnsiPropertySource</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>详细信息，请参见。</td></tr> <tr><td style="text-align:left;"><code>${application.title}</code></td> <td style="text-align:left;">您的应用程序的标题，如中所述<code>MANIFEST.MF</code>。例如<code>Implementation-Title: MyApp</code>打印为<code>MyApp</code>。</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>SpringApplication.setBanner(…)</code>如果要以编程方式生成横幅，则可以使用 该方法。使用该<code>org.springframework.boot.Banner</code>接口并实现您自己的<code>printBanner()</code>方法。</p></div> <p>您还可以使用该<code>spring.main.banner-mode</code>属性来确定横幅是否必须在<code>System.out</code>（<code>console</code>）上打印，发送到配置的记录器（<code>log</code>）或根本不制作（<code>off</code>）。</p> <p>打印的横幅注册为下面的这名一个singleton bean： <code>springBootBanner</code>。</p> <h3 id="_1-4。自定义springapplication"><a href="#_1-4。自定义springapplication" class="header-anchor">#</a> 1.4。自定义SpringApplication</h3> <p>如果<code>SpringApplication</code>默认设置不符合您的喜好，则可以创建一个本地实例并对其进行自定义。例如，要关闭横幅，您可以编写：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span><span class="token class-name">MySpringConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">setBannerMode</span><span class="token punctuation">(</span><span class="token class-name">Banner</span><span class="token punctuation">.</span><span class="token class-name">Mode</span><span class="token punctuation">.</span>OFF<span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>传递给构造函数的参数<code>SpringApplication</code>是Spring bean的配置源。在大多数情况下，这些是对<code>@Configuration</code>类的引用，但它们也可以是对XML配置或应扫描的程序包的引用。</p></div> <p>也可以<code>SpringApplication</code>通过使用<code>application.properties</code>文件来配置。有关详细信息，请参见<em>外部化配置</em>。</p> <p>有关配置选项的完整列表，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/SpringApplication.html" target="_blank" rel="noopener noreferrer"><code>SpringApplication</code>Javadoc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_1-5。fluent-builder-api"><a href="#_1-5。fluent-builder-api" class="header-anchor">#</a> 1.5。Fluent Builder API</h3> <p>如果您需要构建<code>ApplicationContext</code>层次结构（具有父/子关系的多个上下文），或者您更喜欢使用“流利的”构建器API，则可以使用<code>SpringApplicationBuilder</code>。</p> <p>在<code>SpringApplicationBuilder</code>让要链接的多个方法调用，并且包括<code>parent</code>和<code>child</code>其让你创建层次结构，以显示在下面的示例性方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">SpringApplicationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">sources</span><span class="token punctuation">(</span><span class="token class-name">Parent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">bannerMode</span><span class="token punctuation">(</span><span class="token class-name">Banner</span><span class="token punctuation">.</span><span class="token class-name">Mode</span><span class="token punctuation">.</span>OFF<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>创建<code>ApplicationContext</code>层次结构时有一些限制。例如，Web组件<strong>必须</strong>包含在子上下文中，并且<code>Environment</code>父和子上下文都使用相同的组件。有关完整的详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/builder/SpringApplicationBuilder.html" target="_blank" rel="noopener noreferrer"><code>SpringApplicationBuilder</code>Javadoc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_1-6。应用程序事件和监听器"><a href="#_1-6。应用程序事件和监听器" class="header-anchor">#</a> 1.6。应用程序事件和监听器</h3> <p>除了通常的Spring Framework事件（例如）外<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/context/event/ContextRefreshedEvent.html" target="_blank" rel="noopener noreferrer"><code>ContextRefreshedEvent</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<code>SpringApplication</code>还会发送一些其他应用程序事件。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有些事件实际上<code>ApplicationContext</code>是在创建之前触发的，因此您无法将其注册为<code>@Bean</code>。您可以使用<code>SpringApplication.addListeners(…)</code>方法或<code>SpringApplicationBuilder.listeners(…)</code>方法注册它们。如果您希望这些侦听器自动注册，而不管创建应用程序的方式如何，都可以将<code>META-INF/spring.factories</code>文件添加到项目中，并使用<code>org.springframework.context.ApplicationListener</code>键引用您的侦听器，如以下示例所示：<code>org.springframework.context.ApplicationListener = com.example.project.MyListener</code></p></div> <p>应用程序事件在您的应用程序运行时按以下顺序发送：</p> <ol><li><code>ApplicationStartingEvent</code>在运行开始时发送an ，但在进行任何处理之前（侦听器和初始化程序的注册除外）发送。</li> <li>一个<code>ApplicationEnvironmentPreparedEvent</code>当被发送<code>Environment</code>到中已知的上下文中使用，但是在创建上下文之前。</li> <li><code>ApplicationContextInitializedEvent</code>在<code>ApplicationContext</code>准备好且已调用ApplicationContextInitializers之后但未加载任何bean定义之前，发送an 。</li> <li><code>ApplicationPreparedEvent</code>在刷新开始之前但在加载bean定义之后发送an 。</li> <li>一个<code>ApplicationStartedEvent</code>上下文已被刷新后发送，但是任何应用程序和命令行亚军都被调用前。</li> <li>的<code>ApplicationReadyEvent</code>任何应用程序和命令行亚军被呼叫后发送。它指示该应用程序已准备就绪，可以处理请求。</li> <li>一个<code>ApplicationFailedEvent</code>如果在启动时异常发送。</li></ol> <p>上面的列表仅包含<code>SpringApplicationEvent</code>与绑定的<code>SpringApplication</code>。除这些以外，以下事件也在之后<code>ApplicationPreparedEvent</code>和之前发布<code>ApplicationStartedEvent</code>：</p> <ol><li>刷新后<code>ContextRefreshedEvent</code>发送A。<code>ApplicationContext</code></li> <li>准备就绪 <code>WebServerInitializedEvent</code>后发送A。和分别是servlet和反应式变量。<code>WebServer``ServletWebServerInitializedEvent``ReactiveWebServerInitializedEvent</code></li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您通常不需要使用应用程序事件，但是很容易知道它们的存在。在内部，Spring Boot使用事件来处理各种任务。</p></div> <p>应用程序事件是通过使用Spring Framework的事件发布机制发送的。此机制的一部分确保在子级上下文中发布给侦听器的事件也可以在任何祖先上下文中发布给侦听器。结果，如果您的应用程序使用<code>SpringApplication</code>实例的层次结构，则侦听器可能会收到同一类型的应用程序事件的多个实例。</p> <p>为了使您的侦听器能够区分其上下文的事件和后代上下文的事件，它应请求注入其应用程序上下文，然后将注入的上下文与事件的上下文进行比较。可以通过实现来注入上下文，<code>ApplicationContextAware</code>或者，如果侦听器是bean，则可以使用注入上下文<code>@Autowired</code>。</p> <h3 id="_1-7。网络环境"><a href="#_1-7。网络环境" class="header-anchor">#</a> 1.7。网络环境</h3> <p>一个<code>SpringApplication</code>试图创建正确类型的<code>ApplicationContext</code>代表您。确定a的算法<code>WebApplicationType</code>非常简单：</p> <ul><li>如果存在Spring MVC，<code>AnnotationConfigServletWebServerApplicationContext</code>则使用</li> <li>如果不存在Spring MVC且存在Spring WebFlux，<code>AnnotationConfigReactiveWebServerApplicationContext</code>则使用</li> <li>否则，<code>AnnotationConfigApplicationContext</code>使用</li></ul> <p>这意味着，如果您<code>WebClient</code>在同一应用程序中使用Spring MVC和Spring WebFlux中的新功能，则默认情况下将使用Spring MVC。您可以通过调用轻松覆盖它<code>setWebApplicationType(WebApplicationType)</code>。</p> <p>也可以完全控制<code>ApplicationContext</code>调用所使用的类型<code>setApplicationContextClass(…)</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在JUnit测试中<code>setWebApplicationType(WebApplicationType.NONE)</code>使用时 通常需要调用<code>SpringApplication</code>。</p></div> <h3 id="_1-8。访问应用程序参数"><a href="#_1-8。访问应用程序参数" class="header-anchor">#</a> 1.8。访问应用程序参数</h3> <p>如果您需要访问传递给的应用程序参数，则<code>SpringApplication.run(…)</code>可以注入<code>org.springframework.boot.ApplicationArguments</code>Bean。该<code>ApplicationArguments</code>接口提供对原始<code>String[]</code>参数以及已解析<code>option</code>和<code>non-option</code>参数的访问，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> debug <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">containsOption</span><span class="token punctuation">(</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> files <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">getNonOptionArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// if run with &quot;--debug logfile.txt&quot; debug=true, files=[&quot;logfile.txt&quot;]</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot也<code>CommandLinePropertySource</code>向Spring 注册了一个<code>Environment</code>。这样，您还可以使用<code>@Value</code>注释注入单个应用程序参数。</p></div> <h3 id="_1-9。使用applicationrunner或commandlinerunner"><a href="#_1-9。使用applicationrunner或commandlinerunner" class="header-anchor">#</a> 1.9。使用ApplicationRunner或CommandLineRunner</h3> <p>如果启动后需要运行一些特定的代码<code>SpringApplication</code>，则可以实现<code>ApplicationRunner</code>或<code>CommandLineRunner</code>接口。这两个接口以相同的方式工作，并提供一个单一的<code>run</code>方法，该方法在<code>SpringApplication.run(…)</code>完成之前就被调用。</p> <p>所述<code>CommandLineRunner</code>接口提供访问的应用程序的参数作为一个简单的字符串数组，而<code>ApplicationRunner</code>用途<code>ApplicationArguments</code>接口前面讨论。以下示例显示了一个<code>CommandLineRunner</code>with <code>run</code>方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Do something...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果几个<code>CommandLineRunner</code>或<code>ApplicationRunner</code>豆类中定义必须在一个特定的顺序被调用，您还可以实现<code>org.springframework.core.Ordered</code>接口或使用<code>org.springframework.core.annotation.Order</code>注解。</p> <h3 id="_1-10。申请退出"><a href="#_1-10。申请退出" class="header-anchor">#</a> 1.10。申请退出</h3> <p>每个都<code>SpringApplication</code>向JVM注册一个关闭钩子，以确保<code>ApplicationContext</code>退出时正常关闭。可以使用所有标准的Spring生命周期回调（例如<code>DisposableBean</code>接口或<code>@PreDestroy</code>批注）。</p> <p>另外，<code>org.springframework.boot.ExitCodeGenerator</code>如果bean 希望在<code>SpringApplication.exit()</code>调用时返回特定的退出代码，则可以实现该接口。然后可以将此退出代码传递给<code>System.exit()</code>它，以将其作为状态代码返回，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExitCodeApplication</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ExitCodeGenerator</span> <span class="token function">exitCodeGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">42</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ExitCodeApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>而且，该<code>ExitCodeGenerator</code>接口可以通过异常来实现。当遇到这样的异常时，Spring Boot返回由实现的<code>getExitCode()</code>方法提供的退出代码。</p> <h3 id="_1-11。管理员功能"><a href="#_1-11。管理员功能" class="header-anchor">#</a> 1.11。管理员功能</h3> <p>通过指定<code>spring.application.admin.enabled</code>属性，可以为应用程序启用与管理员相关的功能。这将<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/admin/SpringApplicationAdminMXBean.java" target="_blank" rel="noopener noreferrer"><code>SpringApplicationAdminMXBean</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在平台上公开<code>MBeanServer</code>。您可以使用此功能来远程管理Spring Boot应用程序。此功能对于任何服务包装器实现也可能很有用。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您想知道应用程序在哪个HTTP端口上运行，请通过键获取属性<code>local.server.port</code>。</p></div> <h2 id="_2-外部化配置"><a href="#_2-外部化配置" class="header-anchor">#</a> 2.外部化配置</h2> <p>Spring Boot使您可以外部化配置，以便可以在不同环境中使用相同的应用程序代码。您可以使用属性文件，YAML文件，环境变量和命令行参数来外部化配置。属性值可以通过直接注射到你的bean <code>@Value</code>注释，通过Spring的访问<code>Environment</code>抽象，或者被<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-typesafe-configuration-properties" target="_blank" rel="noopener noreferrer">绑定到结构化对象<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>通过<code>@ConfigurationProperties</code>。</p> <p>Spring Boot使用一个非常特殊的<code>PropertySource</code>顺序，该顺序旨在允许合理地覆盖值。按以下顺序考虑属性：</p> <ol><li><code>$HOME/.config/spring-boot</code>当devtools处于活动状态时，文件夹中的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools-globalsettings" target="_blank" rel="noopener noreferrer">Devtools全局设置属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li> <li><a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/test/context/TestPropertySource.html" target="_blank" rel="noopener noreferrer"><code>@TestPropertySource</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 测试中的注释。</li> <li><code>properties</code>测试中的属性。可<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" target="_blank" rel="noopener noreferrer">用于测试应用程序的特定部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/test/context/SpringBootTest.html" target="_blank" rel="noopener noreferrer"><code>@SpringBootTest</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" target="_blank" rel="noopener noreferrer">测试注释<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" target="_blank" rel="noopener noreferrer">注释<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li> <li>命令行参数。</li> <li>来自的属性<code>SPRING_APPLICATION_JSON</code>（嵌入在环境变量或系统属性中的嵌入式JSON）。</li> <li><code>ServletConfig</code> 初始化参数。</li> <li><code>ServletContext</code> 初始化参数。</li> <li>的JNDI属性<code>java:comp/env</code>。</li> <li>Java系统属性（<code>System.getProperties()</code>）。</li> <li>操作系统环境变量。</li> <li>一<code>RandomValuePropertySource</code>，只有在拥有性能<code>random.*</code>。</li> <li>打包的jar（<code>application-{profile}.properties</code>和YAML变体）之外的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-profile-specific-properties" target="_blank" rel="noopener noreferrer">特定于配置文件的应用程序属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li> <li>打包在jar中<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-profile-specific-properties" target="_blank" rel="noopener noreferrer">的特定于配置文件的应用程序属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（<code>application-{profile}.properties</code>和YAML变体）。</li> <li>打包的jar（<code>application.properties</code>和YAML变体）之外的应用程序属性。</li> <li>打包在jar中的应用程序属性（<code>application.properties</code>和YAML变体）。</li> <li><a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/context/annotation/PropertySource.html" target="_blank" rel="noopener noreferrer"><code>@PropertySource</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><code>@Configuration</code>类上的注释。请注意，<code>Environment</code>在刷新应用程序上下文之前，不会将此类属性源添加到中。现在配置某些属性（如<code>logging.*</code>和<code>spring.main.*</code>在刷新开始之前先读取）为时已晚。</li> <li>默认属性（通过设置指定<code>SpringApplication.setDefaultProperties</code>）。</li></ol> <p>为了提供一个具体的示例，假设您开发了一个<code>@Component</code>使用<code>name</code>属性的，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${name}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在您的应用程序类路径上（例如，在jar内），您可以使用一个<code>application.properties</code>文件，该文件为提供合理的默认属性值<code>name</code>。在新环境中运行时，<code>application.properties</code>可以在jar外部提供一个文件，该文件将覆盖<code>name</code>。对于一次性测试，可以使用特定的命令行开关（例如，<code>java -jar app.jar --name=&quot;Spring&quot;</code>）启动。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这些<code>SPRING_APPLICATION_JSON</code>属性可以在命令行中提供环境变量。例如，您可以在UN * X shell中使用以下行：<code>$ SPRING_APPLICATION_JSON ='{“ acme”：{“ name”：“ test”}}}'java -jar myapp.jar</code>在前面的示例中，您最终<code>acme.name=test</code>在Spring中<code>Environment</code>。您还可以像<code>spring.application.json</code>在System属性中一样提供JSON ，如以下示例所示：<code>$ java -Dspring.application.json ='{“ name”：“ test”}'-jar myapp.jar</code>您还可以使用命令行参数来提供JSON，如以下示例所示：<code>$ java -jar myapp.jar --spring.application.json ='{“ name”：“ test”}'</code>您还可以将JSON作为JNDI变量提供，如下所示：<code>java:comp/env/spring.application.json</code>。</p></div> <h3 id="_2-1。配置随机值"><a href="#_2-1。配置随机值" class="header-anchor">#</a> 2.1。配置随机值</h3> <p>的<code>RandomValuePropertySource</code>是用于注射的随机值（例如，进入机密或试验例）是有用的。它可以产生整数，longs，uuid或字符串，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">my.secret</span><span class="token punctuation">=</span><span class="token attr-value">${random.value}</span>
<span class="token attr-name">my.number</span><span class="token punctuation">=</span><span class="token attr-value">${random.int}</span>
<span class="token attr-name">my.bignumber</span><span class="token punctuation">=</span><span class="token attr-value">${random.long}</span>
<span class="token attr-name">my.uuid</span><span class="token punctuation">=</span><span class="token attr-value">${random.uuid}</span>
<span class="token attr-name">my.number.less.than.ten</span><span class="token punctuation">=</span><span class="token attr-value">${random.int(10)}</span>
<span class="token attr-name">my.number.in.range</span><span class="token punctuation">=</span><span class="token attr-value">${random.int[1024,65536]}</span>
</code></pre></div><p>该<code>random.int*</code>语法是<code>OPEN value (,max) CLOSE</code>其中的<code>OPEN,CLOSE</code>任何字符和<code>value,max</code>是整数。如果<code>max</code>提供，<code>value</code>则为最小值，<code>max</code>为最大值（不包括）。</p> <h3 id="_2-2。访问命令行属性"><a href="#_2-2。访问命令行属性" class="header-anchor">#</a> 2.2。访问命令行属性</h3> <p>默认情况下，<code>SpringApplication</code>将所有命令行选项参数（即以开头的参数<code>--</code>，例如<code>--server.port=9000</code>）转换为a <code>property</code>并将其添加到Spring <code>Environment</code>。如前所述，命令行属性始终优先于其他属性源。</p> <p>如果您不想将命令行属性添加到中<code>Environment</code>，则可以使用禁用它们<code>SpringApplication.setAddCommandLineProperties(false)</code>。</p> <h3 id="_2-3。应用程序属性文件"><a href="#_2-3。应用程序属性文件" class="header-anchor">#</a> 2.3。应用程序属性文件</h3> <p><code>SpringApplication</code>从<code>application.properties</code>以下位置的文件加载属性并将其添加到Spring中<code>Environment</code>：</p> <ol><li>一个<code>/config</code>当前目录的子目录</li> <li>当前目录</li> <li>类路径<code>/config</code>包</li> <li>类路径根</li></ol> <p>该列表按优先级排序（在列表较高位置定义的属性会覆盖在较低位置定义的属性）。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您还可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-yaml" target="_blank" rel="noopener noreferrer">使用YAML（.yml）文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来替代.properties。</p></div> <p>如果您不喜欢<code>application.properties</code>配置文件名，则可以通过指定<code>spring.config.name</code>环境属性来切换到另一个文件名。您还可以使用<code>spring.config.location</code>环境属性（目录位置或文件路径的逗号分隔列表）来引用显式位置。下面的示例演示如何指定其他文件名：</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myproject.jar --spring.config.name = myproject
</code></pre></div><p>下面的示例演示如何指定两个位置：</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myproject.jar --spring.config.location = classpath：/default.properties,classpath：/override.properties
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>spring.config.name</code>并且<code>spring.config.location</code>很早就用于确定必须加载哪些文件。必须将它们定义为环境属性（通常是OS环境变量，系统属性或命令行参数）。</p></div> <p>如果<code>spring.config.location</code>包含目录（而不是文件），则应以目录结尾<code>/</code>（并且在运行时，在目录后附加从生成<code>spring.config.name</code>之前生成的名称，包括特定于配置文件的文件名）。指定的文件<code>spring.config.location</code>按原样使用，不支持特定于配置文件的变体，并且被任何特定于配置文件的属性覆盖。</p> <p>配置位置以相反的顺序搜索。默认情况下，配置的位置是<code>classpath:/,classpath:/config/,file:./,file:./config/</code>。结果搜索顺序如下：</p> <ol><li><code>file:./config/</code></li> <li><code>file:./</code></li> <li><code>classpath:/config/</code></li> <li><code>classpath:/</code></li></ol> <p>当使用来配置自定义配置位置时<code>spring.config.location</code>，它们将替换默认位置。例如，如果<code>spring.config.location</code>使用值配置<code>classpath:/custom-config/,file:./custom-config/</code>，则搜索顺序将变为以下内容：</p> <ol><li><code>file:./custom-config/</code></li> <li><code>classpath:custom-config/</code></li></ol> <p>另外，当使用来配置自定义配置位置时<code>spring.config.additional-location</code>，除默认位置外，还会使用它们。在默认位置之前搜索其他位置。例如，如果<code>classpath:/custom-config/,file:./custom-config/</code>配置了的其他位置，则搜索顺序变为以下内容：</p> <ol><li><code>file:./custom-config/</code></li> <li><code>classpath:custom-config/</code></li> <li><code>file:./config/</code></li> <li><code>file:./</code></li> <li><code>classpath:/config/</code></li> <li><code>classpath:/</code></li></ol> <p>通过此搜索顺序，您可以在一个配置文件中指定默认值，然后在另一个配置文件中有选择地覆盖这些值。您可以在以下默认位置之一中为您的应用程序提供默认值<code>application.properties</code>（或使用来选择的其他任何基本名称<code>spring.config.name</code>）。然后，可以在运行时使用自定义位置之一中的其他文件覆盖这些默认值。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您使用环境变量而不是系统属性，则大多数操作系统都不允许使用句点分隔的键名，但是您可以使用下划线代替（例如，<code>SPRING_CONFIG_NAME</code>代替<code>spring.config.name</code>）。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您的应用程序在容器中运行，则可以使用JNDI属性（中的<code>java:comp/env</code>）或Servlet上下文初始化参数来代替环境变量或系统属性，也可以使用它们。</p></div> <h3 id="_2-4。特定于配置文件的属性"><a href="#_2-4。特定于配置文件的属性" class="header-anchor">#</a> 2.4。特定于配置文件的属性</h3> <p>除<code>application.properties</code>文件外，还可以使用以下命名约定来定义特定于配置文件的属性：<code>application-{profile}.properties</code>。在<code>Environment</code>具有一组默认的配置文件（默认<code>[default]</code>）如果没有活动的简档设置中使用。换句话说，如果未显式激活任何概要文件，那么将从<code>application-default.properties</code>中加载属性。</p> <p>特定于配置文件的属性是从与standard相同的位置加载的<code>application.properties</code>，特定于配置文件的文件始终会覆盖非特定文件，无论特定于配置文件的文件是在打包jar的内部还是外部。</p> <p>如果指定了多个配置文件，则采用后赢策略。例如，由<code>spring.profiles.active</code>属性指定的配置文件会在通过<code>SpringApplication</code>API 配置的配置文件之后添加，因此具有优先权。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您在中指定了任何文件<code>spring.config.location</code>，则不会考虑这些文件的特定于配置文件的变体。<code>spring.config.location</code>如果您还想使用特定于配置文件的属性，请使用目录。</p></div> <h3 id="_2-5。属性中的占位符"><a href="#_2-5。属性中的占位符" class="header-anchor">#</a> 2.5。属性中的占位符</h3> <p>使用中的值时，它们会<code>application.properties</code>通过现有的值进行过滤<code>Environment</code>，因此您可以参考以前定义的值（例如，从“系统”属性中）。</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">app.name</span><span class="token punctuation">=</span><span class="token attr-value">MyApp</span>
<span class="token attr-name">app.description</span><span class="token punctuation">=</span><span class="token attr-value">${app.name} is a Spring Boot application</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您还可以使用这种技术来创建现有Spring Boot属性的“简短”变体。有关详细信息，请参见<em>howto.html操作</em>方法。</p></div> <h3 id="_2-6。加密属性"><a href="#_2-6。加密属性" class="header-anchor">#</a> 2.6。加密属性</h3> <p>Spring Boot不提供对加密属性值的任何内置支持，但是，它提供了修改Spring包含的值所必需的挂钩点<code>Environment</code>。该<code>EnvironmentPostProcessor</code>界面允许您<code>Environment</code>在应用程序启动之前进行操作。有关详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-customize-the-environment-or-application-context" target="_blank" rel="noopener noreferrer">howto.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>如果您正在寻找一种安全的方式来存储凭据和密码，则<a href="https://cloud.spring.io/spring-cloud-vault/" target="_blank" rel="noopener noreferrer">Spring Cloud Vault<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>项目提供了对在<a href="https://www.vaultproject.io/" target="_blank" rel="noopener noreferrer">HashiCorp Vault中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>存储外部化配置的支持。</p> <h3 id="_2-7。使用yaml代替属性"><a href="#_2-7。使用yaml代替属性" class="header-anchor">#</a> 2.7。使用YAML代替属性</h3> <p><a href="https://yaml.org/" target="_blank" rel="noopener noreferrer">YAML<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是JSON的超集，因此是一种用于指定层次结构配置数据的便捷格式。该<code>SpringApplication</code>级自动支持YAML来替代，只要你有属性<a href="https://bitbucket.org/asomov/snakeyaml" target="_blank" rel="noopener noreferrer">SnakeYAML<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在classpath库。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您使用“入门”，则SnakeYAML将由自动提供<code>spring-boot-starter</code>。</p></div> <h4 id="_2-7-1。加载yaml"><a href="#_2-7-1。加载yaml" class="header-anchor">#</a> 2.7.1。加载YAML</h4> <p>Spring Framework提供了两个方便的类，可用于加载YAML文档。该<code>YamlPropertiesFactoryBean</code>负载YAML作为<code>Properties</code>和<code>YamlMapFactoryBean</code>负载YAML作为<code>Map</code>。</p> <p>例如，考虑以下YAML文档：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">environments</span><span class="token punctuation">:</span>
    <span class="token key atrule">dev</span><span class="token punctuation">:</span>
        <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//dev.example.com
        <span class="token key atrule">name</span><span class="token punctuation">:</span> Developer Setup
    <span class="token key atrule">prod</span><span class="token punctuation">:</span>
        <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//another.example.com
        <span class="token key atrule">name</span><span class="token punctuation">:</span> My Cool App
</code></pre></div><p>前面的示例将转换为以下属性：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">environments.dev.url</span><span class="token punctuation">=</span><span class="token attr-value">https://dev.example.com</span>
<span class="token attr-name">environments.dev.name</span><span class="token punctuation">=</span><span class="token attr-value">Developer Setup</span>
<span class="token attr-name">environments.prod.url</span><span class="token punctuation">=</span><span class="token attr-value">https://another.example.com</span>
<span class="token attr-name">environments.prod.name</span><span class="token punctuation">=</span><span class="token attr-value">My Cool App</span>
</code></pre></div><p>YAML列表表示为带有<code>[index]</code>解引用器的属性键。例如，考虑以下YAML：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">my</span><span class="token punctuation">:</span>
   <span class="token key atrule">servers</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> dev.example.com
       <span class="token punctuation">-</span> another.example.com
</code></pre></div><p>前面的示例将转换为以下属性：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">my.servers[0]</span><span class="token punctuation">=</span><span class="token attr-value">dev.example.com</span>
<span class="token attr-name">my.servers[1]</span><span class="token punctuation">=</span><span class="token attr-value">another.example.com</span>
</code></pre></div><p>要使用Spring Boot的<code>Binder</code>实用程序绑定属性（<code>@ConfigurationProperties</code>确实如此），您需要在类型为<code>java.util.List</code>（或<code>Set</code>）的目标bean中具有一个属性，并且需要提供setter或使用可变值对其进行初始化。例如，以下示例绑定到前面显示的属性：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;my&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> servers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>servers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-7-2。在spring环境中将yaml公开为属性"><a href="#_2-7-2。在spring环境中将yaml公开为属性" class="header-anchor">#</a> 2.7.2。在Spring环境中将YAML公开为属性</h4> <p>本<code>YamlPropertySourceLoader</code>类可用于暴露YAML作为<code>PropertySource</code>在春节<code>Environment</code>。这样做使您可以将<code>@Value</code>注释和占位符语法一起使用以访问YAML属性。</p> <h4 id="_2-7-3。多配置文件的yaml文档"><a href="#_2-7-3。多配置文件的yaml文档" class="header-anchor">#</a> 2.7.3。多配置文件的YAML文档</h4> <p>您可以使用一个<code>spring.profiles</code>键来指示文档何时适用，从而在一个文件中指定多个特定于配置文件的YAML文档，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> 192.168.1.100
<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">profiles</span><span class="token punctuation">:</span> development
<span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> 127.0.0.1
<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">profiles</span><span class="token punctuation">:</span> production &amp; eu<span class="token punctuation">-</span>central
<span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> 192.168.1.120
</code></pre></div><p>在前面的示例中，如果<code>development</code>配置文件处于活动状态，则<code>server.address</code>属性为<code>127.0.0.1</code>。同样，如果<code>production</code> <strong>和</strong> <code>eu-central</code>配置文件处于活动状态，则<code>server.address</code>属性为<code>192.168.1.120</code>。如果<code>development</code>，<code>production</code>并<code>eu-central</code>在配置文件<strong>没有</strong>启用，那么该属性的值<code>192.168.1.100</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>spring.profiles</code>因此可以包含一个简单的配置文件名称（例如<code>production</code>）或一个配置文件表达式。配置文件表达式允许例如表达更复杂的配置文件逻辑<code>production &amp; (eu-central | eu-west)</code>。有关更多详细信息，请参阅<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/core.html#beans-definition-profiles-java" target="_blank" rel="noopener noreferrer">参考指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>如果在启动应用程序上下文时未明确激活任何活动，则会激活默认配置文件。因此，在以下YAML中，我们设置了一个<strong>仅</strong>在“默认”配置文件中<code>spring.security.user.password</code>可用的值：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span>
<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> default
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> weak
</code></pre></div><p>而在以下示例中，始终设置密码是因为该密码未附加到任何配置文件，并且必须根据需要在所有其他配置文件中将其显式重置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> weak
</code></pre></div><p>使用<code>spring.profiles</code>元素指定的弹簧轮廓可以选择使用<code>!</code>字符来否定。如果为单个文档指定了否定的配置文件和非否定的配置文件，则至少一个非否定的配置文件必须匹配，并且否定的配置文件不能匹配。</p> <h4 id="_2-7-4。yaml的缺点"><a href="#_2-7-4。yaml的缺点" class="header-anchor">#</a> 2.7.4。YAML的缺点</h4> <p>无法通过使用<code>@PropertySource</code>注释加载YAML文件。因此，在需要以这种方式加载值的情况下，需要使用属性文件。</p> <p>在特定于配置文件的YAML文件中使用多YAML文档语法可能会导致意外行为。例如，考虑文件中的以下配置：</p> <p>application-dev.yml</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span>
<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> <span class="token string">&quot;!test&quot;</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">&quot;secret&quot;</span>
</code></pre></div><p>如果使用参数运行应用程序，则<code>--spring.profiles.active=dev</code>可能希望<code>security.user.password</code>将其设置为“秘密”，但实际情况并非如此。</p> <p>嵌套文档将被过滤，因为主文件名为<code>application-dev.yml</code>。它已经被认为是特定于配置文件的，并且嵌套文档将被忽略。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>我们建议您不要混用特定于配置文件的YAML文件和多个YAML文档。坚持只使用其中之一。</p></div> <h3 id="_2-8。类型安全的配置属性"><a href="#_2-8。类型安全的配置属性" class="header-anchor">#</a> 2.8。类型安全的配置属性</h3> <p>使用<code>@Value(&quot;${property}&quot;)</code>注释注入配置属性有时会很麻烦，尤其是当您使用多个属性或数据本质上是分层的时。Spring Boot提供了一种使用属性的替代方法，该属性使强类型的Bean可以管理和验证应用程序的配置。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>另请参阅<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-vs-value" target="_blank" rel="noopener noreferrer">和类型安全配置属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-vs-value" target="_blank" rel="noopener noreferrer">之间<code>@Value</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-vs-value" target="_blank" rel="noopener noreferrer">区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_2-8-1。javabean属性绑定"><a href="#_2-8-1。javabean属性绑定" class="header-anchor">#</a> 2.8.1。JavaBean属性绑定</h4> <p>可以绑定一个声明标准JavaBean属性的bean，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">InetAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Collections</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties</span><span class="token punctuation">.</span><span class="token class-name">ConfigurationProperties</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> enabled<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Security</span> security <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">InetAddress</span> <span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRemoteAddress</span><span class="token punctuation">(</span><span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Security</span> <span class="token function">getSecurity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singleton</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRoles</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>前面的POJO定义了以下属性：</p> <ul><li><code>acme.enabled</code>，<code>false</code>默认值为。</li> <li><code>acme.remote-address</code>，其类型可以从强制转换<code>String</code>。</li> <li><code>acme.security.username</code>，其嵌套的“安全”对象的名称由属性的名称确定。特别是，返回类型根本不使用，可能已经使用过<code>SecurityProperties</code>。</li> <li><code>acme.security.password</code>。</li> <li><code>acme.security.roles</code>，<code>String</code>其默认值为<code>USER</code>。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot自动配置大量利用<code>@ConfigurationProperties</code>来轻松配置自动配置的Bean。与自动配置类相似<code>@ConfigurationProperties</code>，Spring Boot中可用的类仅供内部使用。通过属性文件，YAML文件，环境变量等配置的映射到该类的属性是公共API，但是该类本身的内容并不意味着可以直接使用。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这种安排依赖于默认的空构造函数，并且getter和setter通常是强制性的，因为绑定是通过标准Java Beans属性描述符进行的，就像在Spring MVC中一样。在以下情况下，可以忽略二传手：只要将地图初始化，它们就需要使用吸气剂，但不一定需要使用setter，因为它们可以被活页夹改变。可以通过索引（通常使用YAML）或使用单个逗号分隔的值（属性）来访问集合和数组。在后一种情况下，必须使用二传手。我们建议始终为此类类型添加设置器。如果初始化集合，请确保它不是不可变的（如上例所示）。如果嵌套的POJO属性已初始化（如<code>Security</code>前面示例中的字段），则不需要setter。如果希望活页夹通过使用其默认构造函数动态创建实例，则需要一个setter。有些人使用Lombok项目自动添加获取器和设置器。确保Lombok不会为这种类型生成任何特定的构造函数，因为容器会自动使用它来实例化该对象。最后，仅考虑标准Java Bean属性，不支持对静态属性的绑定。</p></div> <h4 id="_2-8-2。构造函数绑定"><a href="#_2-8-2。构造函数绑定" class="header-anchor">#</a> 2.8.2。构造函数绑定</h4> <p>上一节中的示例可以以不变的方式重写，如下例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net</span><span class="token punctuation">.</span><span class="token class-name">InetAddress</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties</span><span class="token punctuation">.</span><span class="token class-name">ConfigurationProperties</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties</span><span class="token punctuation">.</span><span class="token class-name">ConstructorBinding</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties</span><span class="token punctuation">.</span><span class="token class-name">DefaultValue</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@ConstructorBinding</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> enabled<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Security</span> security<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">AcmeProperties</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> enabled<span class="token punctuation">,</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">,</span> <span class="token class-name">Security</span> security<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> enabled<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>remoteAddress <span class="token operator">=</span> remoteAddress<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>security <span class="token operator">=</span> security<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">InetAddress</span> <span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Security</span> <span class="token function">getSecurity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span>
                <span class="token annotation punctuation">@DefaultValue</span><span class="token punctuation">(</span><span class="token string">&quot;USER&quot;</span><span class="token punctuation">)</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> password<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>roles <span class="token operator">=</span> roles<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在此设置中，<code>@ConstructorBinding</code>注释用于指示应使用构造函数绑定。这意味着绑定器将期望找到带有您希望绑定的参数的构造函数。</p> <p>类的嵌套成员<code>@ConstructorBinding</code>（<code>Security</code>例如上面的示例）也将通过其构造函数进行绑定。</p> <p>可以使用指定默认值，<code>@DefaultValue</code>并且将应用相同的转换服务将<code>String</code>值强制为缺少属性的目标类型。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>要使用构造函数绑定，必须使用<code>@EnableConfigurationProperties</code>或配置属性扫描来启用该类。您不能对通过常规Spring机制创建的bean使用构造函数绑定（例如，<code>@Component</code>bean，通过<code>@Bean</code>方法创建的bean或使用加载的bean <code>@Import</code>）</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您的类具有多个构造函数，则还可以<code>@ConstructorBinding</code>直接在应绑定的构造函数上使用。</p></div> <h4 id="_2-8-3。启用-configurationproperties注释的类型"><a href="#_2-8-3。启用-configurationproperties注释的类型" class="header-anchor">#</a> 2.8.3。启用<code>@ConfigurationProperties</code>注释的类型</h4> <p>Spring Boot提供了绑定<code>@ConfigurationProperties</code>类型并将其注册为Bean的基础架构。您可以逐类启用配置属性，也可以启用与组件扫描类似的方式进行配置属性扫描。</p> <p>有时，带注释的类<code>@ConfigurationProperties</code>可能不适合扫描，例如，如果您正在开发自己的自动配置或想要有条件地启用它们。在这些情况下，请使用<code>@EnableConfigurationProperties</code>注释指定要处理的类型列表。可以在任何<code>@Configuration</code>类上完成此操作，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">AcmeProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>要使用配置属性扫描，请将<code>@ConfigurationPropertiesScan</code>注释添加到您的应用程序。通常，它将添加到带有注释的主应用程序类中，<code>@SpringBootApplication</code>但可以将其添加到任何<code>@Configuration</code>类中。默认情况下，将从声明注释的类的包中进行扫描。如果要定义要扫描的特定程序包，可以按照以下示例所示进行操作：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@ConfigurationPropertiesScan</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;com.example.app&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.acme.another&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当<code>@ConfigurationProperties</code>bean使用配置属性扫描或通过注册<code>@EnableConfigurationProperties</code>，豆具有常规名称：<code>&lt;prefix&gt;-&lt;fqn&gt;</code>，其中，<code>&lt;prefix&gt;</code>是在指定的环境键前缀<code>@ConfigurationProperties</code>注释和<code>&lt;fqn&gt;</code>是bean的全限定名。如果注释不提供任何前缀，则仅使用Bean的完全限定名称。上例中的Bean名称为<code>acme-com.example.AcmeProperties</code>。</p></div> <p>我们建议<code>@ConfigurationProperties</code>仅处理环境，尤其不要从上下文中注入其他bean。对于特殊情况，可以使用setter注入或<code>*Aware</code>框架提供的任何接口（例如，<code>EnvironmentAware</code>如果需要访问<code>Environment</code>）。如果您仍想使用构造函数注入其他bean，则必须对配置属性bean进行注释，<code>@Component</code>并使用基于JavaBean的属性绑定。</p> <h4 id="_2-8-4。使用带-configurationproperties注释的类型"><a href="#_2-8-4。使用带-configurationproperties注释的类型" class="header-anchor">#</a> 2.8.4。使用带<code>@ConfigurationProperties</code>注释的类型</h4> <p>这种配置样式特别适用于<code>SpringApplication</code>外部YAML配置，如以下示例所示：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># application.yml</span>

<span class="token key atrule">acme</span><span class="token punctuation">:</span>
    <span class="token key atrule">remote-address</span><span class="token punctuation">:</span> 192.168.1.1
    <span class="token key atrule">security</span><span class="token punctuation">:</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> admin
        <span class="token key atrule">roles</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> USER
          <span class="token punctuation">-</span> ADMIN

<span class="token comment"># additional configuration as required</span>
</code></pre></div><p>要使用<code>@ConfigurationProperties</code>bean，可以像使用其他任何bean一样注入它们，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AcmeProperties</span> properties<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">AcmeProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//...</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Server</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Server</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>使用using <code>@ConfigurationProperties</code>还可以生成可由IDE使用的元数据文件，以为您自己的键提供自动完成功能。有关详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-configuration-metadata.html#configuration-metadata" target="_blank" rel="noopener noreferrer">附录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_2-8-5。第三方配置"><a href="#_2-8-5。第三方配置" class="header-anchor">#</a> 2.8.5。第三方配置</h4> <p>除了<code>@ConfigurationProperties</code>用于注释类之外，您还可以在公共<code>@Bean</code>方法上使用它。当您要将属性绑定到控件之外的第三方组件时，这样做特别有用。</p> <p>要通过<code>Environment</code>属性配置bean ，请添加<code>@ConfigurationProperties</code>到其bean注册中，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;another&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">AnotherComponent</span> <span class="token function">anotherComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>用<code>another</code>前缀定义的任何JavaBean属性都<code>AnotherComponent</code>以类似于前面<code>AcmeProperties</code>示例的方式映射到该bean 。</p> <h4 id="_2-8-6。轻松绑定"><a href="#_2-8-6。轻松绑定" class="header-anchor">#</a> 2.8.6。轻松绑定</h4> <p>Spring Boot使用一些宽松的规则将<code>Environment</code>属性绑定到<code>@ConfigurationProperties</code>Bean，因此<code>Environment</code>属性名称和Bean属性名称之间不需要完全匹配。有用的常见示例包括破折号分隔的环境属性（例如，<code>context-path</code>绑定到<code>contextPath</code>）和大写的环境属性（例如，<code>PORT</code>绑定到<code>port</code>）。</p> <p>例如，考虑以下<code>@ConfigurationProperties</code>类：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;acme.my-project.person&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OwnerProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> firstName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFirstName</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>使用前面的代码，可以全部使用以下属性名称：</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">注意</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>acme.my-project.person.first-name</code></td> <td style="text-align:left;">烤肉串盒，建议在<code>.properties</code>和<code>.yml</code>文件中使用。</td></tr> <tr><td style="text-align:left;"><code>acme.myProject.person.firstName</code></td> <td style="text-align:left;">标准驼峰式语法。</td></tr> <tr><td style="text-align:left;"><code>acme.my_project.person.first_name</code></td> <td style="text-align:left;">下划线表示法，是在<code>.properties</code>和<code>.yml</code>文件中使用的另一种格式。</td></tr> <tr><td style="text-align:left;"><code>ACME_MYPROJECT_PERSON_FIRSTNAME</code></td> <td style="text-align:left;">大写格式，使用系统环境变量时建议使用。</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>prefix</code>注释 的值<em>必须</em>为kebab大小写（小写并用分隔<code>-</code>，例如<code>acme.my-project.person</code>）。</p></div> <table><thead><tr><th style="text-align:left;">财产来源</th> <th style="text-align:left;">简单</th> <th style="text-align:left;">清单</th></tr></thead> <tbody><tr><td style="text-align:left;">属性文件</td> <td style="text-align:left;">骆驼案，烤肉串案或下划线</td> <td style="text-align:left;">使用<code>[ ]</code>或以逗号分隔的值的标准列表语法</td></tr> <tr><td style="text-align:left;">YAML文件</td> <td style="text-align:left;">骆驼案，烤肉串案或下划线</td> <td style="text-align:left;">标准YAML列表语法或逗号分隔的值</td></tr> <tr><td style="text-align:left;">环境变量</td> <td style="text-align:left;">以下划线作为定界符的大写格式。 <code>_</code>不应在属性名称中使用</td> <td style="text-align:left;">下划线括起来的数值，例如 <code>MY_ACME_1_OTHER = my.acme[1].other</code></td></tr> <tr><td style="text-align:left;">系统属性</td> <td style="text-align:left;">骆驼案，烤肉串案或下划线</td> <td style="text-align:left;">使用<code>[ ]</code>或以逗号分隔的值的标准列表语法</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>我们建议，如果可能的话，属性以小写的kebab格式存储，例如<code>my.property-name=acme</code>。</p></div> <p>绑定到<code>Map</code>属性时，如果<code>key</code>包含除小写字母数字字符或之外的任何内容，则<code>-</code>需要使用方括号表示法，以便保留原始值。如果键没有被包围<code>[]</code>，则所有非字母数字或<code>-</code>已删除的字符。例如，考虑将以下属性绑定到<code>Map</code>：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">acme</span><span class="token punctuation">:</span>
  <span class="token key atrule">map</span><span class="token punctuation">:</span>
    &quot;<span class="token punctuation">[</span>/key1<span class="token punctuation">]</span>&quot;<span class="token punctuation">:</span> value1
    &quot;<span class="token punctuation">[</span>/key2<span class="token punctuation">]</span>&quot;<span class="token punctuation">:</span> value2
    <span class="token key atrule">/key3</span><span class="token punctuation">:</span> value3
</code></pre></div><p>上面的性质将结合一个<code>Map</code>具有<code>/key1</code>，<code>/key2</code>并<code>key3</code>作为映射中的键。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>对于YAML文件，方括号需要用引号引起来，以便正确解析密钥。</p></div> <h4 id="_2-8-7。合并复杂类型"><a href="#_2-8-7。合并复杂类型" class="header-anchor">#</a> 2.8.7。合并复杂类型</h4> <p>如果在多个位置配置了列表，则通过替换整个列表来进行覆盖。</p> <p>例如，假定默认情况下<code>MyPojo</code>具有<code>name</code>和<code>description</code>属性的对象<code>null</code>。以下示例公开了<code>MyPojo</code>来自的对象列表<code>AcmeProperties</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyPojo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyPojo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>考虑以下配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">acme</span><span class="token punctuation">:</span>
  <span class="token key atrule">list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my name
      <span class="token key atrule">description</span><span class="token punctuation">:</span> my description
<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev
<span class="token key atrule">acme</span><span class="token punctuation">:</span>
  <span class="token key atrule">list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my another name
</code></pre></div><p>如果<code>dev</code>配置文件未激活，则<code>AcmeProperties.list</code>包含一个<code>MyPojo</code>条目，如先前所定义。<code>dev</code>但是，如果启用了配置文件，则<code>list</code> <em>仍然</em>仅包含一个条目（名称为<code>my another name</code>，说明为<code>null</code>）。此配置<em>不会</em>将第二个<code>MyPojo</code>实例添加到列表中，并且不会合并项目。</p> <p><code>List</code>在多个配置文件中指定a时，将使用优先级最高的一个（并且只有该优先级）。考虑以下示例：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">acme</span><span class="token punctuation">:</span>
  <span class="token key atrule">list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my name
      <span class="token key atrule">description</span><span class="token punctuation">:</span> my description
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> another name
      <span class="token key atrule">description</span><span class="token punctuation">:</span> another description
<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev
<span class="token key atrule">acme</span><span class="token punctuation">:</span>
  <span class="token key atrule">list</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> my another name
</code></pre></div><p>在前面的示例中，如果<code>dev</code>配置文件处于活动状态，则<code>AcmeProperties.list</code>包含<em>一个</em> <code>MyPojo</code>条目（名称为<code>my another name</code>，说明为<code>null</code>）。对于YAML，可以使用逗号分隔的列表和YAML列表来完全覆盖列表的内容。</p> <p>对于<code>Map</code>属性，可以绑定从多个来源绘制的属性值。但是，对于多个源中的同一属性，将使用优先级最高的属性。以下示例公开了一个<code>Map&lt;String, MyPojo&gt;</code>from <code>AcmeProperties</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">MyPojo</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">MyPojo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>考虑以下配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">acme</span><span class="token punctuation">:</span>
  <span class="token key atrule">map</span><span class="token punctuation">:</span>
    <span class="token key atrule">key1</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> my name 1
      <span class="token key atrule">description</span><span class="token punctuation">:</span> my description 1
<span class="token punctuation">---</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev
<span class="token key atrule">acme</span><span class="token punctuation">:</span>
  <span class="token key atrule">map</span><span class="token punctuation">:</span>
    <span class="token key atrule">key1</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> dev name 1
    <span class="token key atrule">key2</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> dev name 2
      <span class="token key atrule">description</span><span class="token punctuation">:</span> dev description 2
</code></pre></div><p>如果<code>dev</code>配置文件未处于活动状态，则<code>AcmeProperties.map</code>包含一个带有键的条目<code>key1</code>（名称为<code>my name 1</code>，说明为<code>my description 1</code>）。<code>dev</code>但是，如果启用了配置文件，则<code>map</code>包含两个带有键的条目<code>key1</code>（名称为<code>dev name 1</code>和的描述为<code>my description 1</code>和<code>key2</code>，名称为<code>dev name 2</code>和的描述为<code>dev description 2</code>）。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>前述合并规则不仅适用于YAML文件，而且适用于所有属性源中的属性。</p></div> <h4 id="_2-8-8。属性转换"><a href="#_2-8-8。属性转换" class="header-anchor">#</a> 2.8.8。属性转换</h4> <p>当Spring Boot绑定到<code>@ConfigurationProperties</code>bean 时，它试图将外部应用程序属性强制为正确的类型。如果您需要自定义类型转换，则可以提供一个<code>ConversionService</code>Bean（具有一个名为的Bean <code>conversionService</code>）或一个定制属性编辑器（通过一个<code>CustomEditorConfigurer</code>Bean）或定制<code>Converters</code>（具有定义为的Bean <code>@ConfigurationPropertiesBinding</code>）。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于在应用程序生命周期中非常早就请求了此bean，因此请确保限制您<code>ConversionService</code>正在使用的依赖项。通常，您需要的任何依赖项可能在创建时未完全初始化。<code>ConversionService</code>如果配置键强制不需要自定义，则您可能想重命名自定义，而仅依赖具有限定符的自定义转换器<code>@ConfigurationPropertiesBinding</code>。</p></div> <h5 id="转换时间"><a href="#转换时间" class="header-anchor">#</a> 转换时间</h5> <p>Spring Boot为表达持续时间提供了专门的支持。如果公开<code>java.time.Duration</code>属性，则应用程序属性中的以下格式可用：</p> <ul><li>常规<code>long</code>表示形式（使用毫秒作为默认单位，除非<code>@DurationUnit</code>已指定a）</li> <li>标准的ISO-8601格式<a href="https://docs.oracle.com/javase/8/docs/api//java/time/Duration.html#parse-java.lang.CharSequence-" target="_blank" rel="noopener noreferrer">使用<code>java.time.Duration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>值和单位耦合的更易读的格式（例如，<code>10s</code>表示10秒）</li></ul> <p>考虑以下示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.system&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppSystemProperties</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@DurationUnit</span><span class="token punctuation">(</span><span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Duration</span> sessionTimeout <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Duration</span> readTimeout <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getSessionTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sessionTimeout<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSessionTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> sessionTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sessionTimeout <span class="token operator">=</span> sessionTimeout<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Duration</span> <span class="token function">getReadTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readTimeout<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setReadTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span> readTimeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>readTimeout <span class="token operator">=</span> readTimeout<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>要指定30秒的会话超时<code>30</code>，<code>PT30S</code>和<code>30s</code>都等效。500毫秒的读取超时可以以任何形式如下指定：<code>500</code>，<code>PT0.5S</code>和<code>500ms</code>。</p> <p>您也可以使用任何受支持的单位。这些是：</p> <ul><li><code>ns</code> 十亿分之一秒</li> <li><code>us</code> 微秒</li> <li><code>ms</code> 毫秒</li> <li><code>s</code> 几秒钟</li> <li><code>m</code> 几分钟</li> <li><code>h</code> 用了几个小时</li> <li><code>d</code> 好几天</li></ul> <p>默认单位是毫秒，可以使用<code>@DurationUnit</code>上面的示例中所示的方法进行覆盖。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您要从仅<code>Long</code>用于表示持续时间的先前版本进行升级，请确保<code>@DurationUnit</code>在切换到的时间不是毫秒数的情况下（使用）定义单位<code>Duration</code>。这样做可以提供透明的升级路径，同时支持更丰富的格式。</p></div> <h5 id="转换数据大小"><a href="#转换数据大小" class="header-anchor">#</a> 转换数据大小</h5> <p>Spring Framework的<code>DataSize</code>值类型表示字节大小。如果公开<code>DataSize</code>属性，则应用程序属性中的以下格式可用：</p> <ul><li>常规<code>long</code>表示形式（除非<code>@DataSizeUnit</code>已指定，否则使用字节作为默认单位）</li> <li>值和单位耦合的更具可读性的格式（例如，<code>10MB</code>意味着10兆字节）</li></ul> <p>考虑以下示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.io&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppIoProperties</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@DataSizeUnit</span><span class="token punctuation">(</span><span class="token class-name">DataUnit</span><span class="token punctuation">.</span>MEGABYTES<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">DataSize</span> bufferSize <span class="token operator">=</span> <span class="token class-name">DataSize</span><span class="token punctuation">.</span><span class="token function">ofMegabytes</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">DataSize</span> sizeThreshold <span class="token operator">=</span> <span class="token class-name">DataSize</span><span class="token punctuation">.</span><span class="token function">ofBytes</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DataSize</span> <span class="token function">getBufferSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bufferSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBufferSize</span><span class="token punctuation">(</span><span class="token class-name">DataSize</span> bufferSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bufferSize <span class="token operator">=</span> bufferSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">DataSize</span> <span class="token function">getSizeThreshold</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizeThreshold<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSizeThreshold</span><span class="token punctuation">(</span><span class="token class-name">DataSize</span> sizeThreshold<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sizeThreshold <span class="token operator">=</span> sizeThreshold<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>指定10 MB的缓冲区大小，<code>10</code>并且<code>10MB</code>等效。可以将256个字节的大小阈值指定为<code>256</code>或<code>256B</code>。</p> <p>您也可以使用任何受支持的单位。这些是：</p> <ul><li><code>B</code> 对于字节</li> <li><code>KB</code> 千字节</li> <li><code>MB</code> 兆字节</li> <li><code>GB</code> 千兆字节</li> <li><code>TB</code> 太字节</li></ul> <p>默认单位是字节，可以使用<code>@DataSizeUnit</code>上面的示例中所示的方法覆盖它。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果要从仅<code>Long</code>用于表示大小的先前版本进行升级，请确保<code>@DataSizeUnit</code>在切换到的旁边没有字节的情况下定义单位（使用）<code>DataSize</code>。这样做可以提供透明的升级路径，同时支持更丰富的格式。</p></div> <h4 id="_2-8-9。-configurationproperties验证"><a href="#_2-8-9。-configurationproperties验证" class="header-anchor">#</a> 2.8.9。@ConfigurationProperties验证</h4> <p><code>@ConfigurationProperties</code>每当使用Spring的<code>@Validated</code>注释对其进行注释时，Spring Boot就会尝试验证类。您可以<code>javax.validation</code>直接在配置类上使用JSR-303 约束注释。为此，请确保在类路径上有兼容的JSR-303实现，然后将约束注释添加到字段中，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token keyword">private</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span>

    <span class="token comment">// ... getters and setters</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您还可以通过使用注释<code>@Bean</code>创建配置属性的方法来触发验证<code>@Validated</code>。</p></div> <p>为了确保始终为嵌套属性触发验证，即使未找到任何属性，相关字段也必须使用注释<code>@Valid</code>。下面的示例基于前面的<code>AcmeProperties</code>示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token keyword">private</span> <span class="token class-name">InetAddress</span> remoteAddress<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Valid</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Security</span> security <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ... getters and setters</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@NotEmpty</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

        <span class="token comment">// ... getters and setters</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您还可以<code>Validator</code>通过创建名为的bean定义来添加自定义Spring <code>configurationPropertiesValidator</code>。该<code>@Bean</code>方法应声明<code>static</code>。配置属性验证器是在应用程序生命周期的早期创建的，并且将<code>@Bean</code>方法声明为static可以使Bean得以创建而不必实例化<code>@Configuration</code>该类。这样做避免了由早期实例化引起的任何问题。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>该<code>spring-boot-actuator</code>模块包括一个公开所有<code>@ConfigurationProperties</code>bean 的端点。将您的Web浏览器指向<code>/actuator/configprops</code>或使用等效的JMX端点。有关详细信息，请参见“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/production-ready-features.html#production-ready-endpoints" target="_blank" rel="noopener noreferrer">生产就绪功能<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”部分。</p></div> <h4 id="_2-8-10。-configurationproperties与-value"><a href="#_2-8-10。-configurationproperties与-value" class="header-anchor">#</a> 2.8.10。@ConfigurationProperties与@Value</h4> <p>的<code>@Value</code>注释是核心容器的功能，和它不提供相同的功能，类型安全配置属性。下表总结了<code>@ConfigurationProperties</code>和支持的功能<code>@Value</code>：</p> <table><thead><tr><th style="text-align:left;">特征</th> <th style="text-align:left;"><code>@ConfigurationProperties</code></th> <th style="text-align:left;"><code>@Value</code></th></tr></thead> <tbody><tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-relaxed-binding" target="_blank" rel="noopener noreferrer">宽松的绑定<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">是</td> <td style="text-align:left;">没有</td></tr> <tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-configuration-metadata.html#configuration-metadata" target="_blank" rel="noopener noreferrer">元数据支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">是</td> <td style="text-align:left;">没有</td></tr> <tr><td style="text-align:left;"><code>SpEL</code> 评价</td> <td style="text-align:left;">没有</td> <td style="text-align:left;">是</td></tr></tbody></table> <p>如果您为自己的组件定义了一组配置键，我们建议您将它们组合在以标记的POJO中<code>@ConfigurationProperties</code>。您还应该意识到，由于<code>@Value</code>不支持宽松的绑定，因此如果您需要通过使用环境变量来提供值，则不是一个很好的选择。</p> <p>最后，尽管您可以在其中写入<code>SpEL</code>表达式<code>@Value</code>，但不会从<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-application-property-files" target="_blank" rel="noopener noreferrer">应用程序属性文件中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>处理此类表达式。</p> <h2 id="_3-个人资料"><a href="#_3-个人资料" class="header-anchor">#</a> 3.个人资料</h2> <p>Spring Profiles提供了一种隔离应用程序配置部分并使之仅在某些环境中可用的方法。任何<code>@Component</code>，<code>@Configuration</code>或<code>@ConfigurationProperties</code>可与被标记<code>@Profile</code>，当它被加载到限制，因为显示在下面的例子：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;production&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductionConfiguration</span> <span class="token punctuation">{</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果<code>@ConfigurationProperties</code>通过<code>@EnableConfigurationProperties</code>而不是自动扫描来注册bean ，则<code>@Profile</code>需要在<code>@Configuration</code>具有<code>@EnableConfigurationProperties</code>注释的类上指定注释。在<code>@ConfigurationProperties</code>被扫描的情况下，<code>@Profile</code>可以在<code>@ConfigurationProperties</code>类本身上指定。</p></div> <p>您可以使用<code>spring.profiles.active</code> <code>Environment</code>属性来指定哪些配置文件处于活动状态。您可以通过本章前面介绍的任何方式指定属性。例如，您可以将其包括在您的中<code>application.properties</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.profiles.active</span><span class="token punctuation">=</span><span class="token attr-value">dev,hsqldb</span>
</code></pre></div><p>您也可以使用以下开关在命令行中指定它：<code>--spring.profiles.active=dev,hsqldb</code>。</p> <h3 id="_3-1。添加活动配置文件"><a href="#_3-1。添加活动配置文件" class="header-anchor">#</a> 3.1。添加活动配置文件</h3> <p>该<code>spring.profiles.active</code>属性与其他属性遵循相同的排序规则：最高<code>PropertySource</code>获胜。这意味着您可以在其中指定活动配置文件<code>application.properties</code>，然后使用命令行开关<strong>替换</strong>它们。</p> <p>有时，将特定于配置文件的属性<strong>添加</strong>到活动配置文件而不是替换它们很有用。该<code>spring.profiles.include</code>属性可用于无条件添加活动配置文件。该<code>SpringApplication</code>入口点还设置附加配置文件的Java API（即，是对那些被激活的顶级<code>spring.profiles.active</code>属性）。参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/SpringApplication.html" target="_blank" rel="noopener noreferrer">SpringApplication中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<code>setAdditionalProfiles()</code>方法。</p> <p>例如，当使用开关运行具有以下属性的应用程序时<code>--spring.profiles.active=prod</code>，<code>proddb</code>和<code>prodmq</code>配置文件也会被激活：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">my.property</span><span class="token punctuation">:</span> fromyamlfile
<span class="token punctuation">---</span>
<span class="token key atrule">spring.profiles</span><span class="token punctuation">:</span> prod
<span class="token key atrule">spring.profiles.include</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> proddb
  <span class="token punctuation">-</span> prodmq
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>请记住，<code>spring.profiles</code>可以在YAML文档中定义该属性，以确定何时将该特定文档包括在配置中。有关更多详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-change-configuration-depending-on-the-environment" target="_blank" rel="noopener noreferrer">howto.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_3-2。以编程方式设置配置文件"><a href="#_3-2。以编程方式设置配置文件" class="header-anchor">#</a> 3.2。以编程方式设置配置文件</h3> <p>您可以<code>SpringApplication.setAdditionalProfiles(…)</code>在应用程序运行之前通过调用来以编程方式设置活动配置文件。也可以通过使用Spring的<code>ConfigurableEnvironment</code>界面来激活配置文件。</p> <h3 id="_3-3。特定于配置文件的配置文件"><a href="#_3-3。特定于配置文件的配置文件" class="header-anchor">#</a> 3.3。特定于配置文件的配置文件</h3> <p><code>application.properties</code>（或<code>application.yml</code>）和通过引用引用的文件的特定于档案的特定变体<code>@ConfigurationProperties</code>都被视为文件并已加载。有关详细信息，请参见“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-profile-specific-properties" target="_blank" rel="noopener noreferrer">特定<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>于<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-profile-specific-properties" target="_blank" rel="noopener noreferrer">配置文件的属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。</p> <h2 id="_4-记录"><a href="#_4-记录" class="header-anchor">#</a> 4.记录</h2> <p>Spring Boot使用<a href="https://commons.apache.org/logging" target="_blank" rel="noopener noreferrer">Commons Logging<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行所有内部日志记录，但是使底层日志实现保持打开状态。为<a href="https://docs.oracle.com/javase/8/docs/api//java/util/logging/package-summary.html" target="_blank" rel="noopener noreferrer">Java Util Logging<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="https://logging.apache.org/log4j/2.x/" target="_blank" rel="noopener noreferrer">Log4J2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://logback.qos.ch/" target="_blank" rel="noopener noreferrer">Logback<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了默认配置。在每种情况下，记录器都已预先配置为使用控制台输出，同时还提供可选文件输出。</p> <p>默认情况下，如果使用“启动器”，则使用Logback进行日志记录。还包括适当的Logback路由，以确保使用Java Util Logging，Commons Logging，Log4J或SLF4J的从属库都可以正常工作。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Java有许多可用的日志记录框架。如果上面的列表看起来令人困惑，请不要担心。通常，您不需要更改日志记录依赖项，并且Spring Boot默认值可以正常工作。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>将应用程序部署到servlet容器或应用程序服务器时，通过Java Util Logging API执行的日志记录不会路由到应用程序的日志中。这样可以防止由容器或已部署到容器中的其他应用程序执行的日志记录出现在应用程序的日志中。</p></div> <h3 id="_4-1。日志格式"><a href="#_4-1。日志格式" class="header-anchor">#</a> 4.1。日志格式</h3> <p>Spring Boot的默认日志输出类似于以下示例：</p> <div class="language- extra-class"><pre class="language-text"><code>2019-03-05 10：57：51.112信息45469 --- [main] org.apache.catalina.core.StandardEngine：启动Servlet引擎：Apache Tomcat / 7.0.52
2019-03-05 10：57：51.253信息45469-[ost-startStop-1] oaccC [Tomcat]。[localhost]。[/]：初始化Spring嵌入式WebApplicationContext
2019-03-05 10：57：51.253信息45469-[ost-startStop-1] osweb.context.ContextLoader：根WebApplicationContext：初始化在1358毫秒内完成
2019-03-05 10：57：51.698信息45469 --- [ost-startStop-1] osbceServletRegistrationBean：映射servlet：'dispatcherServlet'到[/]
2019-03-05 10：57：51.702信息45469-[ost-startStop-1] osbcembedded.FilterRegistrationBean：映射过滤器：'hiddenHttpMethodFilter'到：[/ *]
</code></pre></div><p>输出以下项目：</p> <ul><li>日期和时间：毫秒精度，易于排序。</li> <li>日志级别：<code>ERROR</code>，<code>WARN</code>，<code>INFO</code>，<code>DEBUG</code>，或<code>TRACE</code>。</li> <li>进程ID。</li> <li>一个<code>---</code>分离器来区分实际日志消息的开始。</li> <li>线程名称：用方括号括起来（对于控制台输出可能会被截断）。</li> <li>记录器名称：这通常是源类名称（通常缩写）。</li> <li>日志消息。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Logback没有<code>FATAL</code>级别。它映射到<code>ERROR</code>。</p></div> <h3 id="_4-2。控制台输出"><a href="#_4-2。控制台输出" class="header-anchor">#</a> 4.2。控制台输出</h3> <p>默认日志配置在消息写入时将消息回显到控制台。默认情况下，将记录<code>ERROR</code>-level，<code>WARN</code>-level和<code>INFO</code>-level消息。您还可以通过使用<code>--debug</code>标志启动应用程序来启用“调试”模式。</p> <div class="language- extra-class"><pre class="language-text"><code>$ java -jar myapp.jar-调试
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您也可以<code>debug=true</code>在中指定<code>application.properties</code>。</p></div> <p>启用调试模式后，将配置一些核心记录器（嵌入式容器，Hibernate和Spring Boot）以输出更多信息。启用调试模式并<em>没有</em>配置您的应用程序记录所有消息<code>DEBUG</code>的水平。</p> <p>另外，您可以通过使用<code>--trace</code>标志（或<code>trace=true</code>在中<code>application.properties</code>）启动应用程序来启用“跟踪”模式。这样做可以为某些核心记录器（嵌入式容器，Hibernate模式生成以及整个Spring产品组合）启用跟踪记录。</p> <h4 id="_4-2-1。颜色编码输出"><a href="#_4-2-1。颜色编码输出" class="header-anchor">#</a> 4.2.1。颜色编码输出</h4> <p>如果您的终端支持ANSI，则使用彩色输出来提高可读性。您可以设置<code>spring.output.ansi.enabled</code>为<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/ansi/AnsiOutput.Enabled.html" target="_blank" rel="noopener noreferrer">支持的值<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以覆盖自动检测。</p> <p>通过使用<code>%clr</code>转换字来配置颜色编码。转换器以最简单的形式根据对数级别为输出着色，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>%clr(%5p)
</code></pre></div><p>下表描述了日志级别到颜色的映射：</p> <table><thead><tr><th style="text-align:left;">水平</th> <th style="text-align:left;">颜色</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>FATAL</code></td> <td style="text-align:left;">红色</td></tr> <tr><td style="text-align:left;"><code>ERROR</code></td> <td style="text-align:left;">红色</td></tr> <tr><td style="text-align:left;"><code>WARN</code></td> <td style="text-align:left;">黄色</td></tr> <tr><td style="text-align:left;"><code>INFO</code></td> <td style="text-align:left;">绿色</td></tr> <tr><td style="text-align:left;"><code>DEBUG</code></td> <td style="text-align:left;">绿色</td></tr> <tr><td style="text-align:left;"><code>TRACE</code></td> <td style="text-align:left;">绿色</td></tr></tbody></table> <p>另外，您可以通过将其提供为转换的选项来指定应使用的颜色或样式。例如，要使文本变黄，请使用以下设置：</p> <div class="language- extra-class"><pre class="language-text"><code>%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){yellow}
</code></pre></div><p>支持以下颜色和样式：</p> <ul><li><code>blue</code></li> <li><code>cyan</code></li> <li><code>faint</code></li> <li><code>green</code></li> <li><code>magenta</code></li> <li><code>red</code></li> <li><code>yellow</code></li></ul> <h3 id="_4-3。文件输出"><a href="#_4-3。文件输出" class="header-anchor">#</a> 4.3。文件输出</h3> <p>默认情况下，Spring Boot仅记录到控制台，不写日志文件。如果除了控制台输出外还想写日志文件，则需要设置一个<code>logging.file.name</code>或<code>logging.file.path</code>属性（例如，在中<code>application.properties</code>）。</p> <p>下表显示了如何<code>logging.*</code>一起使用这些属性：</p> <table><thead><tr><th style="text-align:left;"><code>logging.file.name</code></th> <th style="text-align:left;"><code>logging.file.path</code></th> <th style="text-align:left;">例</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><em>（没有）</em></td> <td style="text-align:left;"><em>（没有）</em></td> <td style="text-align:left;"></td> <td style="text-align:left;">仅控制台记录。</td></tr> <tr><td style="text-align:left;">特定档案</td> <td style="text-align:left;"><em>（没有）</em></td> <td style="text-align:left;"><code>my.log</code></td> <td style="text-align:left;">写入指定的日志文件。名称可以是确切位置，也可以是相对于当前目录的位置。</td></tr> <tr><td style="text-align:left;"><em>（没有）</em></td> <td style="text-align:left;">具体目录</td> <td style="text-align:left;"><code>/var/log</code></td> <td style="text-align:left;">写入<code>spring.log</code>指定的目录。名称可以是确切位置，也可以是相对于当前目录的位置。</td></tr></tbody></table> <p>日志文件达到10 MB时会旋转，并且与控制台输出一样，默认情况下会记录<code>ERROR</code>-level，<code>WARN</code>-level和<code>INFO</code>-level消息。可以使用该<code>logging.file.max-size</code>属性更改大小限制。除非<code>logging.file.max-history</code>已设置属性，否则以前旋转的文件将无限期存档。日志档案的总大小可以使用设置上限<code>logging.file.total-size-cap</code>。当日志归档的总大小超过该阈值时，将删除备份。要在应用程序启动时强制清除日志存档，请使用该<code>logging.file.clean-history-on-start</code>属性。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>日志记录属性独立于实际的日志记录基础结构。结果，<code>logback.configurationFile</code>Spring Boot不会管理特定的配置密钥（例如Logback）。</p></div> <h3 id="_4-4。日志级别"><a href="#_4-4。日志级别" class="header-anchor">#</a> 4.4。日志级别</h3> <p>所有支持的日志系统可以在弹簧设置的记录器级别<code>Environment</code>（例如，<code>application.properties</code>通过使用）<code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code>，其中<code>level</code>为TRACE，DEBUG，INFO，WARN，ERROR，FATAL或OFF之一。该<code>root</code>记录器可以通过使用被配置<code>logging.level.root</code>。</p> <p>以下示例显示了中的潜在日志记录设置<code>application.properties</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">logging.level.root</span><span class="token punctuation">=</span><span class="token attr-value">warn</span>
<span class="token attr-name">logging.level.org.springframework.web</span><span class="token punctuation">=</span><span class="token attr-value">debug</span>
<span class="token attr-name">logging.level.org.hibernate</span><span class="token punctuation">=</span><span class="token attr-value">error</span>
</code></pre></div><p>也可以使用环境变量设置日志记录级别。例如，<code>LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB=DEBUG</code>将设置<code>org.springframework.web</code>为<code>DEBUG</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>以上方法仅适用于程序包级别的日志记录。由于宽松的绑定总是将环境变量转换为小写，因此无法以这种方式为单个类配置日志记录。如果需要为类配置日志记录，则可以使用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-application-json" target="_blank" rel="noopener noreferrer">该<code>SPRING_APPLICATION_JSON</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>变量。</p></div> <h3 id="_4-5。日志组"><a href="#_4-5。日志组" class="header-anchor">#</a> 4.5。日志组</h3> <p>能够将相关记录器分组在一起通常很有用，以便可以同时配置它们。例如，您可能通常会更改<em>所有</em>与Tomcat相关的记录器的记录级别，但是您不容易记住顶层软件包。</p> <p>为了解决这个问题，Spring Boot允许您在Spring中定义日志记录组<code>Environment</code>。例如，这是通过将“ tomcat”组添加到您的方式来定义它的方法<code>application.properties</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">logging.group.tomcat</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.catalina, org.apache.coyote, org.apache.tomcat</span>
</code></pre></div><p>定义后，您可以使用一行更改该组中所有记录器的级别：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">logging.level.tomcat</span><span class="token punctuation">=</span><span class="token attr-value">TRACE</span>
</code></pre></div><p>Spring Boot包含以下预定义的日志记录组，它们可以直接使用：</p> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">记录仪</th></tr></thead> <tbody><tr><td style="text-align:left;">网络</td> <td style="text-align:left;"><code>org.springframework.core.codec</code>，<code>org.springframework.http</code>，<code>org.springframework.web</code>，<code>org.springframework.boot.actuate.endpoint.web</code>，<code>org.springframework.boot.web.servlet.ServletContextInitializerBeans</code></td></tr> <tr><td style="text-align:left;">sql</td> <td style="text-align:left;"><code>org.springframework.jdbc.core</code>，<code>org.hibernate.SQL</code>，<code>org.jooq.tools.LoggerListener</code></td></tr></tbody></table> <h3 id="_4-6。自定义日志配置"><a href="#_4-6。自定义日志配置" class="header-anchor">#</a> 4.6。自定义日志配置</h3> <p>可以通过在类路径中包含适当的库来激活各种日志记录系统，并可以通过在类路径的根目录或以下Spring <code>Environment</code>属性指定的位置中提供适当的配置文件来进一步自定义各种日志记录系统<code>logging.config</code>。</p> <p>您可以通过使用<code>org.springframework.boot.logging.LoggingSystem</code>system属性来强制Spring Boot使用特定的日志系统。该值应该是实现的完全限定的类名<code>LoggingSystem</code>。您还可以通过使用值完全禁用Spring Boot的日志记录配置<code>none</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于日志记录是<strong>在</strong><code>ApplicationContext</code>创建<strong>之前</strong>初始化的，因此无法从<code>@PropertySources</code>Spring <code>@Configuration</code>文件中控制日志记录。更改日志记录系统或完全禁用它的唯一方法是通过系统属性。</p></div> <p>根据您的日志记录系统，将加载以下文件：</p> <table><thead><tr><th style="text-align:left;">测井系统</th> <th style="text-align:left;">客制化</th></tr></thead> <tbody><tr><td style="text-align:left;">登陆回</td> <td style="text-align:left;"><code>logback-spring.xml</code>，<code>logback-spring.groovy</code>，<code>logback.xml</code>，或者<code>logback.groovy</code></td></tr> <tr><td style="text-align:left;">Log4j2</td> <td style="text-align:left;"><code>log4j2-spring.xml</code> 要么 <code>log4j2.xml</code></td></tr> <tr><td style="text-align:left;">JDK（Java实用程序日志记录）</td> <td style="text-align:left;"><code>logging.properties</code></td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果可能，我们建议您将<code>-spring</code>变体用于日志记录配置（例如，<code>logback-spring.xml</code>而不是<code>logback.xml</code>）。如果使用标准配置位置，Spring将无法完全控制日志初始化。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>从“可执行jar”运行时，Java Util Logging存在一些已知的类加载问题，这些问题会引起问题。我们建议您尽可能从“可执行jar”运行时避免使用它。</p></div> <p>为了帮助进行自定义，<code>Environment</code>如下表所述，一些其他属性从Spring转移到System属性：</p> <table><thead><tr><th style="text-align:left;">春季环境</th> <th style="text-align:left;">系统属性</th> <th style="text-align:left;">注释</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>logging.exception-conversion-word</code></td> <td style="text-align:left;"><code>LOG_EXCEPTION_CONVERSION_WORD</code></td> <td style="text-align:left;">记录异常时使用的转换字。</td></tr> <tr><td style="text-align:left;"><code>logging.file.clean-history-on-start</code></td> <td style="text-align:left;"><code>LOG_FILE_CLEAN_HISTORY_ON_START</code></td> <td style="text-align:left;">是否在启动时清除存档日志文件（如果启用了LOG_FILE）。（仅默认的Logback设置受支持。）</td></tr> <tr><td style="text-align:left;"><code>logging.file.name</code></td> <td style="text-align:left;"><code>LOG_FILE</code></td> <td style="text-align:left;">如果定义，它将在默认日志配置中使用。</td></tr> <tr><td style="text-align:left;"><code>logging.file.max-size</code></td> <td style="text-align:left;"><code>LOG_FILE_MAX_SIZE</code></td> <td style="text-align:left;">最大日志文件大小（如果启用了LOG_FILE）。（仅默认的Logback设置受支持。）</td></tr> <tr><td style="text-align:left;"><code>logging.file.max-history</code></td> <td style="text-align:left;"><code>LOG_FILE_MAX_HISTORY</code></td> <td style="text-align:left;">要保留的最大归档日志文件数（如果启用了LOG_FILE）。（仅默认的Logback设置受支持。）</td></tr> <tr><td style="text-align:left;"><code>logging.file.path</code></td> <td style="text-align:left;"><code>LOG_PATH</code></td> <td style="text-align:left;">如果定义，它将在默认日志配置中使用。</td></tr> <tr><td style="text-align:left;"><code>logging.file.total-size-cap</code></td> <td style="text-align:left;"><code>LOG_FILE_TOTAL_SIZE_CAP</code></td> <td style="text-align:left;">要保留的日志备份的总大小（如果启用了LOG_FILE）。（仅默认的Logback设置受支持。）</td></tr> <tr><td style="text-align:left;"><code>logging.pattern.console</code></td> <td style="text-align:left;"><code>CONSOLE_LOG_PATTERN</code></td> <td style="text-align:left;">控制台上使用的日志模式（stdout）。（仅默认的Logback设置受支持。）</td></tr> <tr><td style="text-align:left;"><code>logging.pattern.dateformat</code></td> <td style="text-align:left;"><code>LOG_DATEFORMAT_PATTERN</code></td> <td style="text-align:left;">记录日期格式的附加模式。（仅默认的Logback设置受支持。）</td></tr> <tr><td style="text-align:left;"><code>logging.pattern.file</code></td> <td style="text-align:left;"><code>FILE_LOG_PATTERN</code></td> <td style="text-align:left;">文件中使用的日志模式（如果<code>LOG_FILE</code>已启用）。（仅默认的Logback设置受支持。）</td></tr> <tr><td style="text-align:left;"><code>logging.pattern.level</code></td> <td style="text-align:left;"><code>LOG_LEVEL_PATTERN</code></td> <td style="text-align:left;">呈现日志级别时使用的格式（默认<code>%5p</code>）。（仅默认的Logback设置受支持。）</td></tr> <tr><td style="text-align:left;"><code>logging.pattern.rolling-file-name</code></td> <td style="text-align:left;"><code>ROLLING_FILE_NAME_PATTERN</code></td> <td style="text-align:left;">过渡日志文件名的模式（默认<code>${LOG_FILE}.%d{yyyy-MM-dd}.%i.gz</code>）。（仅默认的Logback设置受支持。）</td></tr> <tr><td style="text-align:left;"><code>PID</code></td> <td style="text-align:left;"><code>PID</code></td> <td style="text-align:left;">当前进程ID（如果可能，并且尚未将其定义为OS环境变量时，将被发现）。</td></tr></tbody></table> <p>所有受支持的日志记录系统在解析其配置文件时都可以查阅系统属性。有关<code>spring-boot.jar</code>示例，请参见中的默认配置：</p> <ul><li><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/defaults.xml" target="_blank" rel="noopener noreferrer">登陆回<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/log4j2/log4j2.xml" target="_blank" rel="noopener noreferrer">Log4j 2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/java/logging-file.properties" target="_blank" rel="noopener noreferrer">Java Util日志记录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果要在日志记录属性中使用占位符，则应使用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-placeholders-in-properties" target="_blank" rel="noopener noreferrer">Spring Boot的语法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>而不是基础框架的语法。值得注意的是，如果您使用Logback，则应将其<code>:</code>用作属性名称与其默认值之间的分隔符，而不应使用<code>:-</code>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以通过仅覆盖<code>LOG_LEVEL_PATTERN</code>（或<code>logging.pattern.level</code>使用Logback）将MDC和其他临时内容添加到日志行。例如，如果使用<code>logging.pattern.level=user:%X{user} %5p</code>，则默认日志格式包含“ user”的MDC条目（如果存在），如以下示例所示。<code>2019-08-30 12：30：04.031用户：某人INFO 22174-[[nio-8080-exec-0] demo.Controller 处理已认证的请求</code></p></div> <h3 id="_4-7。登录扩展"><a href="#_4-7。登录扩展" class="header-anchor">#</a> 4.7。登录扩展</h3> <p>Spring Boot包含许多Logback扩展，可以帮助进行高级配置。您可以在<code>logback-spring.xml</code>配置文件中使用这些扩展名。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于标准<code>logback.xml</code>配置文件加载太早，因此您不能在其中使用扩展名。您需要使用<code>logback-spring.xml</code>或定义一个<code>logging.config</code>属性。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这些扩展不能与Logback的<a href="https://logback.qos.ch/manual/configuration.html#autoScan" target="_blank" rel="noopener noreferrer">配置扫描一起使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果尝试这样做，则对配置文件进行更改将导致类似于以下记录之一的错误：</p></div> <div class="language- extra-class"><pre class="language-text"><code>ch.qos.logback.core.joran.spi.Interpreter@4中的错误：71-[springProperty]没有适用的操作，当前ElementPath是[[configuration] [springProperty]]ch.qos.logback.core.joran.spi.Interpreter@4中的
错误：71-[springProfile]没有适用的操作，当前ElementPath是[[configuration] [springProfile]]
</code></pre></div><h4 id="_4-7-1。特定于配置文件的配置"><a href="#_4-7-1。特定于配置文件的配置" class="header-anchor">#</a> 4.7.1。特定于配置文件的配置</h4> <p>使用<code>&lt;springProfile&gt;</code>标签，您可以根据活动的Spring配置文件选择包括或排除配置部分。概要文件部分在<code>&lt;configuration&gt;</code>元素内的任何位置都受支持。使用<code>name</code>属性指定哪个配置文件接受配置。所述<code>&lt;springProfile&gt;</code>标记可包含一个简单的配置文件的名称（例如<code>staging</code>）或轮廓表达。配置文件表达式允许例如表达更复杂的配置文件逻辑<code>production &amp; (eu-central | eu-west)</code>。有关更多详细信息，请参阅<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/core.html#beans-definition-profiles-java" target="_blank" rel="noopener noreferrer">参考指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。以下清单显示了三个样本概要文件：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>staging<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dev | staging<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- configuration to be enabled when the &quot;dev&quot; or &quot;staging&quot; profiles are active --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>!production<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- configuration to be enabled when the &quot;production&quot; profile is not active --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>springProfile</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_4-7-2。环境特性"><a href="#_4-7-2。环境特性" class="header-anchor">#</a> 4.7.2。环境特性</h4> <p>该<code>&lt;springProperty&gt;</code>标签可以让你从Spring公开属性<code>Environment</code>的范围内的logback使用。如果您想从<code>application.properties</code>Logback配置中访问文件中的值，这样做会很有用。该标签的工作方式类似于Logback的标准<code>&lt;property&gt;</code>标签。但是，<code>value</code>您无需指定direct ，而是指定<code>source</code>属性的（来自<code>Environment</code>）。如果需要将属性存储在<code>local</code>范围之外的其他位置，则可以使用该<code>scope</code>属性。如果需要后备值（如果未在中设置属性<code>Environment</code>），则可以使用<code>defaultValue</code>属性。以下示例显示如何公开在Logback中使用的属性：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>springProperty</span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>context<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fluentHost<span class="token punctuation">&quot;</span></span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myapp.fluentd.host<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">defaultValue</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>localhost<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>FLUENT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.more.appenders.DataFluentAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>remoteHost</span><span class="token punctuation">&gt;</span></span>${fluentHost}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>remoteHost</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在<code>source</code>必须在串的情况下（如指定<code>my.property-name</code>）。但是，可以<code>Environment</code>使用宽松规则将属性添加到中。</p></div> <h2 id="_5-国际化"><a href="#_5-国际化" class="header-anchor">#</a> 5.国际化</h2> <p>Spring Boot支持本地化消息，因此您的应用程序可以迎合不同语言首选项的用户。默认情况下，Spring Boot <code>messages</code>在类路径的根目录下查找资源束的存在。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当配置的资源束的默认属性文件可用时（即<code>messages.properties</code>默认情况下），将应用自动配置。如果您的资源包仅包含特定于语言的属性文件，则需要添加默认文件。如果找不到与任何配置的基本名称匹配的属性文件，则不会自动配置<code>MessageSource</code>。</p></div> <p>可以使用<code>spring.messages</code>名称空间来配置资源包的基本名称以及其他几个属性，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.messages.basename</span><span class="token punctuation">=</span><span class="token attr-value">messages,config.i18n.messages</span>
<span class="token attr-name">spring.messages.fallback-to-system-locale</span><span class="token punctuation">=</span><span class="token attr-value">false</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>spring.messages.basename</code> 支持以逗号分隔的位置列表，即包限定符或从类路径根目录解析的资源。</p></div> <p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/context/MessageSourceProperties.java" target="_blank" rel="noopener noreferrer"><code>MessageSourceProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多受支持的选项。</p> <h2 id="_6-json"><a href="#_6-json" class="header-anchor">#</a> 6. JSON</h2> <p>Spring Boot提供了与三个JSON映射库的集成：</p> <ul><li>格森</li> <li>杰克逊</li> <li>JSON-B</li></ul> <p>Jackson是首选的默认库。</p> <h3 id="_6-1。杰克逊"><a href="#_6-1。杰克逊" class="header-anchor">#</a> 6.1。杰克逊</h3> <p>提供了Jackson的自动配置，并且Jackson是的一部分<code>spring-boot-starter-json</code>。当Jackson放在类路径上时，将<code>ObjectMapper</code>自动配置Bean。提供了几个配置属性，用于<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-customize-the-jackson-objectmapper" target="_blank" rel="noopener noreferrer">自定义的配置<code>ObjectMapper</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_6-2。格森"><a href="#_6-2。格森" class="header-anchor">#</a> 6.2。格森</h3> <p>提供了Gson的自动配置。当Gson在类路径上时，将<code>Gson</code>自动配置一个bean。<code>spring.gson.*</code>提供了几个配置属性用于自定义配置。为了获得更多控制权，<code>GsonBuilderCustomizer</code>可以使用一个或多个bean。</p> <h3 id="_6-3。json-b"><a href="#_6-3。json-b" class="header-anchor">#</a> 6.3。JSON-B</h3> <p>提供了JSON-B的自动配置。当JSON-B API和实现位于类路径上时，<code>Jsonb</code>将自动配置Bean。首选的JSON-B实现是提供依赖管理的Apache Johnzon。</p> <h2 id="_7-开发web应用程序"><a href="#_7-开发web应用程序" class="header-anchor">#</a> 7.开发Web应用程序</h2> <p>Spring Boot非常适合于Web应用程序开发。您可以使用嵌入式Tomcat，Jetty，Undertow或Netty创建独立的HTTP服务器。大多数Web应用程序都使用该<code>spring-boot-starter-web</code>模块来快速启动和运行。您还可以选择使用该<code>spring-boot-starter-webflux</code>模块来构建反应式Web应用程序。</p> <p>如果尚未开发Spring Boot Web应用程序，则可以遵循“ Hello World！”。<em>入门</em>部分中的示例。</p> <h3 id="_7-1。-spring-web-mvc框架"><a href="#_7-1。-spring-web-mvc框架" class="header-anchor">#</a> 7.1。“ Spring Web MVC框架”</h3> <p>在<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener noreferrer">春天Web MVC框架<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（通常简称为“春MVC”）是一个丰富的“模型视图控制器” Web框架。Spring MVC允许您创建特殊的<code>@Controller</code>或<code>@RestController</code>bean来处理传入的HTTP请求。控制器中的方法通过使用<code>@RequestMapping</code>注释映射到HTTP 。</p> <p>以下代码显示了<code>@RestController</code>提供JSON数据的典型代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRestController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{user}/customers&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Customer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>Spring MVC是核心Spring Framework的一部分，有关详细信息，请参阅<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener noreferrer">参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。在<a href="https://spring.io/guides" target="_blank" rel="noopener noreferrer">spring.io/guides<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上还有一些涵盖Spring MVC的指南。</p> <h4 id="_7-1-1。spring-mvc自动配置"><a href="#_7-1-1。spring-mvc自动配置" class="header-anchor">#</a> 7.1.1。Spring MVC自动配置</h4> <p>Spring Boot为Spring MVC提供了自动配置，可与大多数应用程序完美配合。</p> <p>自动配置在Spring的默认值之上添加了以下功能：</p> <ul><li>包含<code>ContentNegotiatingViewResolver</code>和<code>BeanNameViewResolver</code>。</li> <li>支持服务静态资源，包括对WebJars的支持（<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content" target="_blank" rel="noopener noreferrer">在本文档的后面部分中有介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li> <li>自动注册<code>Converter</code>，<code>GenericConverter</code>和<code>Formatter</code>豆类。</li> <li>支持<code>HttpMessageConverters</code>（<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-spring-mvc-message-converters" target="_blank" rel="noopener noreferrer">在本文档后面介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li> <li>自动注册<code>MessageCodesResolver</code>（<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-spring-message-codes" target="_blank" rel="noopener noreferrer">在本文档后面介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li> <li>静态<code>index.html</code>支持。</li> <li>定制<code>Favicon</code>支持（<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-spring-mvc-favicon" target="_blank" rel="noopener noreferrer">在本文档后面部分中介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li> <li>自动使用<code>ConfigurableWebBindingInitializer</code>bean（<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-spring-mvc-web-binding-initializer" target="_blank" rel="noopener noreferrer">在本文档后面部分中介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li></ul> <p>如果您想保留Spring Boot MVC功能，并且想要添加其他<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc" target="_blank" rel="noopener noreferrer">MVC配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（拦截器，格式化程序，视图控制器和其他功能），则可以添加自己<code>@Configuration</code>的type类，<code>WebMvcConfigurer</code>但<strong>不添加</strong> <code>@EnableWebMvc</code>。如果您希望提供，或的自定义实例<code>RequestMappingHandlerMapping</code>，则可以声明一个实例来提供此类组件。<code>RequestMappingHandlerAdapter``ExceptionHandlerExceptionResolver``WebMvcRegistrationsAdapter</code></p> <p>如果您想完全控制Spring MVC，可以使用添加自己的<code>@Configuration</code>注释<code>@EnableWebMvc</code>。</p> <h4 id="_7-1-2。httpmessageconverters"><a href="#_7-1-2。httpmessageconverters" class="header-anchor">#</a> 7.1.2。HttpMessageConverters</h4> <p>Spring MVC使用该<code>HttpMessageConverter</code>接口来转换HTTP请求和响应。开箱即用中包含明智的默认设置。例如，可以将对象自动转换为JSON（通过使用Jackson库）或XML（通过使用Jackson XML扩展（如果可用）或通过使用JAXB（如果Jackson XML扩展不可用））。默认情况下，字符串编码为<code>UTF-8</code>。</p> <p>如果您需要添加或自定义转换器，则可以使用Spring Boot的<code>HttpMessageConverters</code>类，如以下清单所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>http</span><span class="token punctuation">.</span><span class="token class-name">HttpMessageConverters</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>converter</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">HttpMessageConverters</span> <span class="token function">customConverters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> additional <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> another <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HttpMessageConverters</span><span class="token punctuation">(</span>additional<span class="token punctuation">,</span> another<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><code>HttpMessageConverter</code>上下文中存在的任何Bean都将添加到转换器列表中。您也可以用相同的方法覆盖默认转换器。</p> <h4 id="_7-1-3。自定义json序列化器和反序列化器"><a href="#_7-1-3。自定义json序列化器和反序列化器" class="header-anchor">#</a> 7.1.3。自定义JSON序列化器和反序列化器</h4> <p>如果使用Jackson来序列化和反序列化JSON数据，则可能需要编写自己的<code>JsonSerializer</code>和<code>JsonDeserializer</code>类。自定义序列化程序通常是<a href="https://github.com/FasterXML/jackson-docs/wiki/JacksonHowToCustomSerializers" target="_blank" rel="noopener noreferrer">通过模块向Jackson进行注册的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，但是Spring Boot提供了另一种<code>@JsonComponent</code>注释，使直接注册Spring Bean更加容易。</p> <p>您可以使用<code>@JsonComponent</code>直接的注解<code>JsonSerializer</code>，<code>JsonDeserializer</code>或<code>KeyDeserializer</code>实现。您还可以在包含序列化器/反序列化器作为内部类的类上使用它，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>jackson</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@JsonComponent</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Serializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SomeObject</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Deserializer</span> <span class="token keyword">extends</span> <span class="token class-name">JsonDeserializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SomeObject</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>中的所有<code>@JsonComponent</code>bean都会<code>ApplicationContext</code>自动向Jackson注册。因为使用<code>@JsonComponent</code>进行了元注释<code>@Component</code>，所以适用通常的组件扫描规则。</p> <p>Spring Boot还提供了<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectSerializer.java" target="_blank" rel="noopener noreferrer"><code>JsonObjectSerializer</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectDeserializer.java" target="_blank" rel="noopener noreferrer"><code>JsonObjectDeserializer</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>基类，它们在序列化对象时为标准Jackson版本提供了有用的替代方法。见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/jackson/JsonObjectSerializer.html" target="_blank" rel="noopener noreferrer"><code>JsonObjectSerializer</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/jackson/JsonObjectDeserializer.html" target="_blank" rel="noopener noreferrer"><code>JsonObjectDeserializer</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在Javadoc了解详情。</p> <h4 id="_7-1-4。messagecodesresolver"><a href="#_7-1-4。messagecodesresolver" class="header-anchor">#</a> 7.1.4。MessageCodesResolver</h4> <p>Spring MVC的具有产生错误代码从绑定错误的渲染错误消息的策略：<code>MessageCodesResolver</code>。如果您设置<code>spring.mvc.message-codes-resolver-format</code>属性<code>PREFIX_ERROR_CODE</code>或<code>POSTFIX_ERROR_CODE</code>，Spring Boot会为您创建一个（请参阅中的枚举<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.Format.html" target="_blank" rel="noopener noreferrer"><code>DefaultMessageCodesResolver.Format</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p> <h4 id="_7-1-5。静态内容"><a href="#_7-1-5。静态内容" class="header-anchor">#</a> 7.1.5。静态内容</h4> <p>默认情况下，Spring Boot从类路径中名为<code>/static</code>（<code>/public</code>或<code>/resources</code>或<code>/META-INF/resources</code>）的目录或根目录提供静态内容<code>ServletContext</code>。它使用<code>ResourceHttpRequestHandler</code>Spring MVC中的from，因此您可以通过添加自己<code>WebMvcConfigurer</code>的<code>addResourceHandlers</code>方法并覆盖该方法来修改该行为。</p> <p>在独立的Web应用程序中，还启用了容器中的默认servlet，并将其用作后备，从<code>ServletContext</code>Spring决定不处理它的根开始提供内容。在大多数情况下，这不会发生（除非您修改默认的MVC配置），因为Spring始终可以通过处理请求<code>DispatcherServlet</code>。</p> <p>默认情况下，资源映射到<code>/**</code>，但是您可以使用<code>spring.mvc.static-path-pattern</code>属性对其进行调整。例如，将所有资源重新定位<code>/resources/**</code>可以通过以下方式实现：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mvc.static-path-pattern</span><span class="token punctuation">=</span><span class="token attr-value">/resources/**</span>
</code></pre></div><p>您还可以通过使用<code>spring.resources.static-locations</code>属性来自定义静态资源位置（用目录位置列表替换默认值）。根Servlet上下文路径，<code>&quot;/&quot;</code>也会自动添加为一个位置。</p> <p>除了前面提到的“标准”静态资源位置，<a href="https://www.webjars.org/" target="_blank" rel="noopener noreferrer">Webjars内容也<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>有特殊情况。<code>/webjars/**</code>如果jar文件以Webjars格式打包，则从jar文件提供带有路径的所有资源。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>src/main/webapp</code>如果您的应用程序打包为jar，则 不要使用该目录。尽管此目录是一个通用标准，但它<strong>仅</strong>与war打包一起使用，并且如果生成jar，大多数构建工具都将其忽略。</p></div> <p>Spring Boot还支持Spring MVC提供的高级资源处理功能，允许使用案例，例如缓存清除静态资源或对Webjars使用版本无关的URL。</p> <p>要对Webjar使用版本无关的URL，请添加<code>webjars-locator-core</code>依赖项。然后声明您的Webjar。以jQuery为例，将<code>&quot;/webjars/jquery/jquery.min.js&quot;</code>结果添加到Webjar版本<code>&quot;/webjars/jquery/x.y.z/jquery.min.js&quot;</code>所在<code>x.y.z</code>的位置。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果使用JBoss，则需要声明<code>webjars-locator-jboss-vfs</code>依赖关系而不是<code>webjars-locator-core</code>。否则，所有Webjar都将解析为<code>404</code>。</p></div> <p>要使用缓存清除，以下配置为所有静态资源配置了缓存清除解决方案，从而有效地<code>&lt;link href=&quot;/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css&quot;/&gt;</code>在URL中添加了内容哈希，例如，：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.resources.chain.strategy.content.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.resources.chain.strategy.content.paths</span><span class="token punctuation">=</span><span class="token attr-value">/**</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于<code>ResourceUrlEncodingFilter</code>为Thymeleaf和FreeMarker自动配置了，因此在运行时可以在模板中重写资源链接。使用JSP时，您应该手动声明此过滤器。目前尚不自动支持其他模板引擎，但可以与自定义模板宏/帮助程序一起使用，也可以使用<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/servlet/resource/ResourceUrlProvider.html" target="_blank" rel="noopener noreferrer"><code>ResourceUrlProvider</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>例如，当使用JavaScript模块加载器动态加载资源时，不能重命名文件。这就是为什么其他策略也受支持并且可以组合的原因。“固定”策略在URL中添加静态版本字符串，而不更改文件名，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.resources.chain.strategy.content.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.resources.chain.strategy.content.paths</span><span class="token punctuation">=</span><span class="token attr-value">/**</span>
<span class="token attr-name">spring.resources.chain.strategy.fixed.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.resources.chain.strategy.fixed.paths</span><span class="token punctuation">=</span><span class="token attr-value">/js/lib/</span>
<span class="token attr-name">spring.resources.chain.strategy.fixed.version</span><span class="token punctuation">=</span><span class="token attr-value">v12</span>
</code></pre></div><p>通过这种配置，位于下面的JavaScript模块<code>&quot;/js/lib/&quot;</code>使用固定的版本控制策略（<code>&quot;/v12/js/lib/mymodule.js&quot;</code>），而其他资源仍使用内容版本（<code>&lt;link href=&quot;/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css&quot;/&gt;</code>）。</p> <p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ResourceProperties.java" target="_blank" rel="noopener noreferrer"><code>ResourceProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多受支持的选项。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>专门的<a href="https://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources" target="_blank" rel="noopener noreferrer">博客文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和Spring Framework的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc-config-static-resources" target="_blank" rel="noopener noreferrer">参考文档中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>已经对该功能进行了全面的描述。</p></div> <h4 id="_7-1-6。欢迎页面"><a href="#_7-1-6。欢迎页面" class="header-anchor">#</a> 7.1.6。欢迎页面</h4> <p>Spring Boot支持静态和模板欢迎页面。它首先<code>index.html</code>在配置的静态内容位置中查找文件。如果未找到，则寻找<code>index</code>模板。如果找到任何一个，它将自动用作应用程序的欢迎页面。</p> <h4 id="_7-1-7。自定义图标"><a href="#_7-1-7。自定义图标" class="header-anchor">#</a> 7.1.7。自定义图标</h4> <p>与其他静态资源一样，Spring Boot <code>favicon.ico</code>在配置的静态内容位置中查找a 。如果存在这样的文件，它将自动用作应用程序的收藏夹图标。</p> <h4 id="_7-1-8。路径匹配和内容协商"><a href="#_7-1-8。路径匹配和内容协商" class="header-anchor">#</a> 7.1.8。路径匹配和内容协商</h4> <p>Spring MVC可以通过查看请求路径并将其匹配到应用程序中定义的映射（例如，<code>@GetMapping</code>Controller方法上的注释）来将传入的HTTP请求映射到处理程序。</p> <p>Spring Boot默认选择禁用后缀模式匹配，这意味着<code>&quot;GET /projects/spring-boot.json&quot;</code>类似的请求将不会与<code>@GetMapping(&quot;/projects/spring-boot&quot;)</code>映射匹配。这被认为是<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-suffix-pattern-match" target="_blank" rel="noopener noreferrer">Spring MVC应用程序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-suffix-pattern-match" target="_blank" rel="noopener noreferrer">最佳实践<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。过去，此功能主要用于未发送正确的“ Accept”请求标头的HTTP客户端。我们需要确保将正确的内容类型发送给客户端。如今，内容协商已变得更加可靠。</p> <p>还有其他处理HTTP客户端的方法，这些客户端不能始终发送正确的“ Accept”请求标头。除了使用后缀匹配，我们还可以使用查询参数来确保将诸如这样的请求<code>&quot;GET /projects/spring-boot?format=json&quot;</code>映射到<code>@GetMapping(&quot;/projects/spring-boot&quot;)</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mvc.contentnegotiation.favor-parameter</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

<span class="token comment"># We can change the parameter name, which is &quot;format&quot; by default:</span>
<span class="token comment"># spring.mvc.contentnegotiation.parameter-name=myparam</span>

<span class="token comment"># We can also register additional file extensions/media types with:</span>
<span class="token attr-name">spring.mvc.contentnegotiation.media-types.markdown</span><span class="token punctuation">=</span><span class="token attr-value">text/markdown</span>
</code></pre></div><p>如果您了解了注意事项，但仍希望您的应用程序使用后缀模式匹配，则需要以下配置：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mvc.contentnegotiation.favor-path-extension</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.mvc.pathmatch.use-suffix-pattern</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><p>另外，与其打开所有后缀模式，不如仅支持已注册的后缀模式，这会更安全：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mvc.contentnegotiation.favor-path-extension</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.mvc.pathmatch.use-registered-suffix-pattern</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

<span class="token comment"># You can also register additional file extensions/media types with:</span>
<span class="token comment"># spring.mvc.contentnegotiation.media-types.adoc=text/asciidoc</span>
</code></pre></div><h4 id="_7-1-9。configurablewebbindinginitializer"><a href="#_7-1-9。configurablewebbindinginitializer" class="header-anchor">#</a> 7.1.9。ConfigurableWebBindingInitializer</h4> <p>Spring MVC使用a <code>WebBindingInitializer</code>初始化<code>WebDataBinder</code>特定请求。如果创建自己的<code>ConfigurableWebBindingInitializer</code> <code>@Bean</code>，Spring Boot会自动将Spring MVC配置为使用它。</p> <h4 id="_7-1-10。模板引擎"><a href="#_7-1-10。模板引擎" class="header-anchor">#</a> 7.1.10。模板引擎</h4> <p>除了REST Web服务之外，您还可以使用Spring MVC来提供动态HTML内容。Spring MVC支持各种模板技术，包括Thymeleaf，FreeMarker和JSP。同样，许多其他模板引擎包括他们自己的Spring MVC集成。</p> <p>Spring Boot包含对以下模板引擎的自动配置支持：</p> <ul><li><a href="https://freemarker.apache.org/docs/" target="_blank" rel="noopener noreferrer">FreeMarker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://docs.groovy-lang.org/docs/next/html/documentation/template-engines.html#_the_markuptemplateengine" target="_blank" rel="noopener noreferrer">Groovy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.thymeleaf.org/" target="_blank" rel="noopener noreferrer">胸腺<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mustache.github.io/" target="_blank" rel="noopener noreferrer">胡子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果可能，应避免使用JSP。将它们与嵌入式servlet容器一起使用时，存在几个<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-jsp-limitations" target="_blank" rel="noopener noreferrer">已知的限制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>在默认配置下使用这些模板引擎之一时，将从中自动提取模板<code>src/main/resources/templates</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>根据您运行应用程序的方式，IntelliJ IDEA对类路径的排序不同。与使用Maven或Gradle或从其打包的jar运行应用程序时相比，从IDE的主要方法运行应用程序的顺序会有所不同。这可能导致Spring Boot无法在类路径上找到模板。如果遇到此问题，可以在IDE中重新排序类路径，以首先放置模块的类和资源。或者，您可以配置模板前缀来搜索<code>templates</code>类路径上的每个目录，如下所示：<code>classpath*:/templates/</code>。</p></div> <h4 id="_7-1-11。错误处理"><a href="#_7-1-11。错误处理" class="header-anchor">#</a> 7.1.11。错误处理</h4> <p>默认情况下，Spring Boot提供了<code>/error</code>一种可明智地处理所有错误的映射，并且已在servlet容器中注册为“全局”错误页面。对于机器客户端，它将生成一个JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，存在一个“ whitelabel”错误视图，该视图以HTML格式呈现相同的数据（要对其进行自定义，请添加<code>View</code>解析为的<code>error</code>）。要完全替换默认行为，可以实现<code>ErrorController</code>并注册该类型的Bean定义，或添加类型的Bean <code>ErrorAttributes</code>以使用现有机制但替换其内容。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在<code>BasicErrorController</code>可以用作自定义基类<code>ErrorController</code>。如果您要为新的内容类型添加处理程序（默认是<code>text/html</code>专门处理并为其他所有内容提供后备功能），则此功能特别有用。为此，请扩展<code>BasicErrorController</code>，添加一个<code>@RequestMapping</code>具有<code>produces</code>属性的公共方法，并创建一个新类型的Bean。</p></div> <p>您还可以定义带有注释的类，<code>@ControllerAdvice</code>以自定义JSON文档以针对特定的控制器和/或异常类型返回，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ControllerAdvice</span><span class="token punctuation">(</span>basePackageClasses <span class="token operator">=</span> <span class="token class-name">AcmeController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeControllerAdvice</span> <span class="token keyword">extends</span> <span class="token class-name">ResponseEntityExceptionHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">YourException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleControllerException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token function">getStatus</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomErrorType</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">HttpStatus</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> statusCode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;javax.servlet.error.status_code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>INTERNAL_SERVER_ERROR<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在前面的示例中，如果if <code>YourException</code>由与包在同一包中定义的控制器抛出，则使用POJO <code>AcmeController</code>的JSON表示<code>CustomErrorType</code>代替该<code>ErrorAttributes</code>表示。</p> <h5 id="自定义错误页面"><a href="#自定义错误页面" class="header-anchor">#</a> 自定义错误页面</h5> <p>如果要显示给定状态代码的自定义HTML错误页面，可以将文件添加到文件<code>/error</code>夹。错误页面可以是静态HTML（即添加到任何静态资源文件夹下），也可以使用模板来构建。文件名应为确切的状态代码或系列掩码。</p> <p>例如，要映射<code>404</code>到静态HTML文件，您的文件夹结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- public/
             +- error/
             |   +- 404.html
             +- &lt;other public assets&gt;
</code></pre></div><p>要<code>5xx</code>使用FreeMarker模板映射所有错误，您的文件夹结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- templates/
             +- error/
             |   +- 5xx.ftlh
             +- &lt;other templates&gt;
</code></pre></div><p>对于更复杂的映射，还可以添加实现该<code>ErrorViewResolver</code>接口的bean ，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyErrorViewResolver</span> <span class="token keyword">implements</span> <span class="token class-name">ErrorViewResolver</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">resolveErrorView</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span>
            <span class="token class-name">HttpStatus</span> status<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Use the request or status to optionally return a ModelAndView</span>
        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您还可以使用常规的Spring MVC功能，例如<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc-exceptionhandlers" target="_blank" rel="noopener noreferrer"><code>@ExceptionHandler</code>方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc-ann-controller-advice" target="_blank" rel="noopener noreferrer"><code>@ControllerAdvice</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。在<code>ErrorController</code>随后拿起任何未处理的异常。</p> <h5 id="在spring-mvc之外映射错误页面"><a href="#在spring-mvc之外映射错误页面" class="header-anchor">#</a> 在Spring MVC之外映射错误页面</h5> <p>对于不使用Spring MVC的应用程序，您可以使用<code>ErrorPageRegistrar</code>接口直接注册<code>ErrorPages</code>。此抽象直接与基础嵌入式servlet容器一起使用，即使您没有Spring MVC也可以使用<code>DispatcherServlet</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ErrorPageRegistrar</span> <span class="token function">errorPageRegistrar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyErrorPageRegistrar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyErrorPageRegistrar</span> <span class="token keyword">implements</span> <span class="token class-name">ErrorPageRegistrar</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerErrorPages</span><span class="token punctuation">(</span><span class="token class-name">ErrorPageRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addErrorPages</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>BAD_REQUEST<span class="token punctuation">,</span> <span class="token string">&quot;/400&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您<code>ErrorPage</code>使用最终由a处理的路径注册<code>Filter</code>（这在某些非Spring Web框架中很常见，例如Jersey和Wicket），则<code>Filter</code>必须将其显式注册为<code>ERROR</code>调度程序，如以下示例所示：</p></div> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">FilterRegistrationBean</span> <span class="token function">myFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">FilterRegistrationBean</span> registration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterRegistrationBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    registration<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    registration<span class="token punctuation">.</span><span class="token function">setDispatcherTypes</span><span class="token punctuation">(</span><span class="token class-name">EnumSet</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span><span class="token class-name">DispatcherType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> registration<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>请注意，默认值<code>FilterRegistrationBean</code>不包括<code>ERROR</code>调度程序类型。</p> <p>注意：当Spring Boot部署到servlet容器时，将使用其错误页面过滤器将具有错误状态的请求转发到适当的错误页面。如果尚未提交响应，则只能将请求转发到正确的错误页面。缺省情况下，WebSphere Application Server 8.0及更高版本在成功完成servlet的服务方法后提交响应。您应该通过设置<code>com.ibm.ws.webcontainer.invokeFlushAfterService</code>为来禁用此行为<code>false</code>。</p> <h4 id="_7-1-12。春季hateoas"><a href="#_7-1-12。春季hateoas" class="header-anchor">#</a> 7.1.12。春季HATEOAS</h4> <p>如果您开发使用超媒体的RESTful API，Spring Boot将为Spring HATEOAS提供自动配置，该配置可与大多数应用程序很好地兼容。自动配置取代了使用<code>@EnableHypermediaSupport</code>和注册大量Bean的需求，以简化构建基于超媒体的应用程序，包括<code>LinkDiscoverers</code>（用于客户端支持）和<code>ObjectMapper</code>配置为正确地将响应编组为所需表示形式的Bean 。的<code>ObjectMapper</code>是通过设置各种定制的<code>spring.jackson.*</code>属性，或者，如果存在的话，通过一个<code>Jackson2ObjectMapperBuilder</code>豆。</p> <p>您可以使用来控制Spring HATEOAS的配置<code>@EnableHypermediaSupport</code>。请注意，这样做会禁用<code>ObjectMapper</code>前面所述的自定义。</p> <h4 id="_7-1-13。cors支持"><a href="#_7-1-13。cors支持" class="header-anchor">#</a> 7.1.13。CORS支持</h4> <p><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank" rel="noopener noreferrer">跨域资源共享<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（CORS）是由<a href="https://caniuse.com/#feat=cors" target="_blank" rel="noopener noreferrer">大多数浏览器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>实施的<a href="https://www.w3.org/TR/cors/" target="_blank" rel="noopener noreferrer">W3C规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可让您灵活地指定授权哪种类型的跨域请求，而不是使用诸如IFRAME或JSONP之类的安全性较低，功能较弱的方法。 。</p> <p>从4.2版本开始，Spring MVC <a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc-cors" target="_blank" rel="noopener noreferrer">支持CORS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。在Spring Boot应用程序中使用带有注释的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc-cors-controller" target="_blank" rel="noopener noreferrer">控制器方法CORS配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html" target="_blank" rel="noopener noreferrer"><code>@CrossOrigin</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>不需要任何特定的配置。 可以通过使用自定义方法注册bean 来定义<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#mvc-cors-global" target="_blank" rel="noopener noreferrer">全局CORS配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，如以下示例所示：<code>WebMvcConfigurer``addCorsMappings(CorsRegistry)</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">corsConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                registry<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-2。-spring-webflux框架"><a href="#_7-2。-spring-webflux框架" class="header-anchor">#</a> 7.2。“ Spring WebFlux框架”</h3> <p>Spring WebFlux是Spring Framework 5.0中引入的新的响应式Web框架。与Spring MVC不同，它不需要Servlet API，是完全异步且无阻塞的，并通过<a href="https://projectreactor.io/" target="_blank" rel="noopener noreferrer">Reactor项目<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>实现<a href="https://www.reactive-streams.org/" target="_blank" rel="noopener noreferrer">Reactive Streams<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>规范。</p> <p>Spring WebFlux有两种形式：功能性的和基于注释的。基于注释的模型非常类似于Spring MVC模型，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRestController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}/customers&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Customer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>功能变体“ WebFlux.fn”将路由配置与请求的实际处理分开，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoutingConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">monoRouterFunction</span><span class="token punctuation">(</span><span class="token class-name">UserHandler</span> userHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">getUser</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}/customers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">getUserCustomers</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">&quot;/{user}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token function">accept</span><span class="token punctuation">(</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userHandler<span class="token operator">::</span><span class="token function">deleteUser</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserHandler</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserCustomers</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">ServerRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>WebFlux是Spring Framework的一部分，其<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web-reactive.html#webflux-fn" target="_blank" rel="noopener noreferrer">参考文档中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了详细信息。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以根据需要定义任意数量的<code>RouterFunction</code>bean，以对路由器的定义进行模块化。如果需要应用优先级，可以订购Bean。</p></div> <p>首先，将<code>spring-boot-starter-webflux</code>模块添加到您的应用程序。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在应用程序中 同时添加<code>spring-boot-starter-web</code>和<code>spring-boot-starter-webflux</code>模块会导致Spring Boot自动配置Spring MVC，而不是WebFlux。之所以选择这种行为，是因为许多Spring开发人员将<code>spring-boot-starter-webflux</code>其添加到他们的Spring MVC应用程序中以使用反应式<code>WebClient</code>。您仍然可以通过将选定的应用程序类型设置为来强制执行选择<code>SpringApplication.setWebApplicationType(WebApplicationType.REACTIVE)</code>。</p></div> <h4 id="_7-2-1。spring-webflux自动配置"><a href="#_7-2-1。spring-webflux自动配置" class="header-anchor">#</a> 7.2.1。Spring WebFlux自动配置</h4> <p>Spring Boot为Spring WebFlux提供了自动配置，可与大多数应用程序很好地配合使用。</p> <p>自动配置在Spring的默认值之上添加了以下功能：</p> <ul><li>为<code>HttpMessageReader</code>和<code>HttpMessageWriter</code>实例配置编解码器（<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-webflux-httpcodecs" target="_blank" rel="noopener noreferrer">在本文档的后面部分中介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li> <li>支持服务静态资源，包括对WebJars的支持（<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-spring-mvc-static-content" target="_blank" rel="noopener noreferrer">在本文档的后面部分中介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</li></ul> <p>如果您想保留Spring Boot WebFlux功能并想要添加其他<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web-reactive.html#webflux-config" target="_blank" rel="noopener noreferrer">WebFlux配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，则可以添加自己<code>@Configuration</code>的类型类，<code>WebFluxConfigurer</code>但<strong>不添加</strong> <code>@EnableWebFlux</code>。</p> <p>如果要完全控制Spring WebFlux，可以使用添加自己的<code>@Configuration</code>注释<code>@EnableWebFlux</code>。</p> <h4 id="_7-2-2。带有httpmessagereaders和httpmessagewriters的http编解码器"><a href="#_7-2-2。带有httpmessagereaders和httpmessagewriters的http编解码器" class="header-anchor">#</a> 7.2.2。带有HttpMessageReaders和HttpMessageWriters的HTTP编解码器</h4> <p>Spring WebFlux使用<code>HttpMessageReader</code>and<code>HttpMessageWriter</code>接口转换HTTP请求和响应。<code>CodecConfigurer</code>通过查看类路径中可用的库，将它们配置为具有合理的默认值。</p> <p>Spring Boot为编解码器提供了专用的配置属性<code>spring.codec.*</code>。它还通过使用<code>CodecCustomizer</code>实例来应用进一步的自定义。例如，<code>spring.jackson.*</code>配置密钥应用于Jackson编解码器。</p> <p>如果需要添加或自定义编解码器，则可以创建一个自定义<code>CodecCustomizer</code>组件，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>codec</span><span class="token punctuation">.</span><span class="token class-name">CodecCustomizer</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CodecCustomizer</span> <span class="token function">myCodecCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> codecConfigurer <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您还可以利用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-json-components" target="_blank" rel="noopener noreferrer">Boot的自定义JSON序列化器和反序列化器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="_7-2-3。静态内容"><a href="#_7-2-3。静态内容" class="header-anchor">#</a> 7.2.3。静态内容</h4> <p>默认情况下，Spring Boot从类路径中名为<code>/static</code>（<code>/public</code>或<code>/resources</code>或<code>/META-INF/resources</code>）的目录中提供静态内容。它使用<code>ResourceWebHandler</code>Spring WebFlux中的，因此您可以通过添加自己<code>WebFluxConfigurer</code>的<code>addResourceHandlers</code>方法并覆盖该方法来修改该行为。</p> <p>默认情况下，资源映射在上<code>/**</code>，但是您可以通过设置<code>spring.webflux.static-path-pattern</code>属性来对其进行调整。例如，将所有资源重新定位<code>/resources/**</code>可以通过以下方式实现：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.webflux.static-path-pattern</span><span class="token punctuation">=</span><span class="token attr-value">/resources/**</span>
</code></pre></div><p>您还可以使用来自定义静态资源位置<code>spring.resources.static-locations</code>。这样做会将默认值替换为目录位置列表。如果这样做，默认的欢迎页面检测将切换到您的自定义位置。因此，如果<code>index.html</code>启动时您的任何位置都有，则为应用程序的主页。</p> <p>除了前面列出的“标准”静态资源位置外，<a href="https://www.webjars.org/" target="_blank" rel="noopener noreferrer">Webjars内容也<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>有特殊情况。<code>/webjars/**</code>如果jar文件以Webjars格式打包，则从jar文件提供带有路径的所有资源。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring WebFlux应用程序不严格依赖Servlet API，因此不能将它们部署为war文件，也不使用<code>src/main/webapp</code>目录。</p></div> <h4 id="_7-2-4。模板引擎"><a href="#_7-2-4。模板引擎" class="header-anchor">#</a> 7.2.4。模板引擎</h4> <p>除了REST Web服务之外，您还可以使用Spring WebFlux来提供动态HTML内容。Spring WebFlux支持各种模板技术，包括Thymeleaf，FreeMarker和Mustache。</p> <p>Spring Boot包含对以下模板引擎的自动配置支持：</p> <ul><li><a href="https://freemarker.apache.org/docs/" target="_blank" rel="noopener noreferrer">FreeMarker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.thymeleaf.org/" target="_blank" rel="noopener noreferrer">胸腺<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mustache.github.io/" target="_blank" rel="noopener noreferrer">胡子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>在默认配置下使用这些模板引擎之一时，将从中自动提取模板<code>src/main/resources/templates</code>。</p> <h4 id="_7-2-5。错误处理"><a href="#_7-2-5。错误处理" class="header-anchor">#</a> 7.2.5。错误处理</h4> <p>Spring Boot提供了<code>WebExceptionHandler</code>一个以合理的方式处理所有错误的工具。它在处理顺序中的位置紧靠WebFlux提供的处理程序之前，该处理程序被认为是最后一个。对于机器客户端，它将生成一个JSON响应，其中包含错误，HTTP状态和异常消息的详细信息。对于浏览器客户端，有一个“ whitelabel”错误处理程序，以HTML格式呈现相同的数据。您还可以提供自己的HTML模板来显示错误（请参阅<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-webflux-error-handling-custom-error-pages" target="_blank" rel="noopener noreferrer">下一节<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）。</p> <p>定制此功能的第一步通常涉及使用现有机制，但替换或增加错误内容。为此，您可以添加类型为ErrorAttributes的bean。</p> <p>要更改错误处理行为，可以实现<code>ErrorWebExceptionHandler</code>并注册该类型的bean定义。由于a <code>WebExceptionHandler</code>级别很低，因此Spring Boot还提供了一种方便的方式<code>AbstractErrorWebExceptionHandler</code>，使您可以通过WebFlux功能方式处理错误，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomErrorWebExceptionHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractErrorWebExceptionHandler</span> <span class="token punctuation">{</span>

    <span class="token comment">// Define constructor here</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">RouterFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerResponse</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRoutingFunction</span><span class="token punctuation">(</span><span class="token class-name">ErrorAttributes</span> errorAttributes<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token class-name">RouterFunctions</span>
                <span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>aPredicate<span class="token punctuation">,</span> aHandler<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andRoute</span><span class="token punctuation">(</span>anotherPredicate<span class="token punctuation">,</span> anotherHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>为了获得更完整的图像，您还可以<code>DefaultErrorWebExceptionHandler</code>直接继承子类并覆盖特定的方法。</p> <h5 id="自定义错误页面-2"><a href="#自定义错误页面-2" class="header-anchor">#</a> 自定义错误页面</h5> <p>如果要显示给定状态代码的自定义HTML错误页面，可以将文件添加到文件<code>/error</code>夹。错误页面可以是静态HTML（即添加到任何静态资源文件夹下），也可以使用模板构建。文件名应为确切的状态代码或系列掩码。</p> <p>例如，要映射<code>404</code>到静态HTML文件，您的文件夹结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- public/
             +- error/
             |   +- 404.html
             +- &lt;other public assets&gt;
</code></pre></div><p>要<code>5xx</code>使用Mustache模板映射所有错误，您的文件夹结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>src/
 +- main/
     +- java/
     |   + &lt;source code&gt;
     +- resources/
         +- templates/
             +- error/
             |   +- 5xx.mustache
             +- &lt;other templates&gt;
</code></pre></div><h4 id="_7-2-6。网页过滤器"><a href="#_7-2-6。网页过滤器" class="header-anchor">#</a> 7.2.6。网页过滤器</h4> <p>Spring WebFlux提供了一个<code>WebFilter</code>可以实现以过滤HTTP请求-响应交换的接口。 <code>WebFilter</code>在应用程序上下文中找到的bean将自动用于过滤每个交换。</p> <p>如果过滤器的顺序很重要，则可以使用<code>Ordered</code>或对其进行注释<code>@Order</code>。Spring Boot自动配置可能会为您配置Web过滤器。这样做时，将使用下表中显示的顺序：</p> <table><thead><tr><th style="text-align:left;">网页过滤器</th> <th style="text-align:left;">订购</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>MetricsWebFilter</code></td> <td style="text-align:left;"><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td></tr> <tr><td style="text-align:left;"><code>WebFilterChainProxy</code> （春季安全）</td> <td style="text-align:left;"><code>-100</code></td></tr> <tr><td style="text-align:left;"><code>HttpTraceWebFilter</code></td> <td style="text-align:left;"><code>Ordered.LOWEST_PRECEDENCE - 10</code></td></tr></tbody></table> <h3 id="_7-3。jax-rs和泽西岛"><a href="#_7-3。jax-rs和泽西岛" class="header-anchor">#</a> 7.3。JAX-RS和泽西岛</h3> <p>如果您更喜欢REST端点的JAX-RS编程模型，则可以使用可用的实现之一来代替Spring MVC。 <a href="https://jersey.github.io/" target="_blank" rel="noopener noreferrer">Jersey<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://cxf.apache.org/" target="_blank" rel="noopener noreferrer">Apache CXF<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>开箱即用。CXF需要您注册其<code>Servlet</code>或<code>Filter</code>为<code>@Bean</code>您的应用程序上下文。Jersey提供了一些本机的Spring支持，因此我们在Spring Boot中还与启动程序一起为其提供了自动配置支持。</p> <p>要开始使用Jersey，请将包含<code>spring-boot-starter-jersey</code>为依赖项，然后需要使用一种<code>@Bean</code>类型<code>ResourceConfig</code>注册所有端点，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JerseyConfig</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">JerseyConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">Endpoint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>泽西岛对扫描可执行归档文件的支持非常有限。例如，它无法扫描在<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/deployment.html#deployment-install" target="_blank" rel="noopener noreferrer">完全可执行的jar文件中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或在<code>WEB-INF/classes</code>运行可执行的war文件时在包中找到的端点。为避免此限制，<code>packages</code>不应该使用该方法，并且应该使用该<code>register</code>方法分别注册端点，如前面的示例所示。</p></div> <p>对于更高级的自定义，您还可以注册任意数量的实现的Bean <code>ResourceConfigCustomizer</code>。</p> <p>所有注册的端点都应<code>@Components</code>带有HTTP资源注释（<code>@GET</code>及其他注释），如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Path</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Endpoint</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@GET</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>由于<code>Endpoint</code>是Spring <code>@Component</code>，因此其生命周期由Spring管理，您可以使用<code>@Autowired</code>批注注入依赖项，并使用<code>@Value</code>批注注入外部配置。默认情况下，Jersey servlet已注册并映射到<code>/*</code>。您可以通过添加改变映射<code>@ApplicationPath</code>到你<code>ResourceConfig</code>。</p> <p>默认情况下，泽西岛被设置为在一个Servlet <code>@Bean</code>类型的<code>ServletRegistrationBean</code>命名<code>jerseyServletRegistration</code>。默认情况下，该Servlet延迟初始化，但是您可以通过设置来自定义该行为<code>spring.jersey.servlet.load-on-startup</code>。您可以通过创建自己的同名豆之一来禁用或覆盖该bean。您还可以通过设置使用过滤器而不是Servlet <code>spring.jersey.type=filter</code>（在这种情况下，<code>@Bean</code>要替换或覆盖的是<code>jerseyFilterRegistration</code>）。过滤器具有<code>@Order</code>，您可以使用设置<code>spring.jersey.filter.order</code>。可以通过<code>spring.jersey.init.*</code>指定属性映射来为servlet和过滤器注册都赋予init参数。</p> <h3 id="_7-4。嵌入式servlet容器支持"><a href="#_7-4。嵌入式servlet容器支持" class="header-anchor">#</a> 7.4。嵌入式Servlet容器支持</h3> <p>Spring Boot包含对嵌入式<a href="https://tomcat.apache.org/" target="_blank" rel="noopener noreferrer">Tomcat<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="https://www.eclipse.org/jetty/" target="_blank" rel="noopener noreferrer">Jetty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/undertow-io/undertow" target="_blank" rel="noopener noreferrer">Undertow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>服务器的支持。大多数开发人员使用适当的“入门”来获取完全配置的实例。默认情况下，嵌入式服务器在port上侦听HTTP请求<code>8080</code>。</p> <h4 id="_7-4-1。servlet，过滤器和侦听器"><a href="#_7-4-1。servlet，过滤器和侦听器" class="header-anchor">#</a> 7.4.1。Servlet，过滤器和侦听器</h4> <p>使用嵌入式Servlet容器时，您可以<code>HttpSessionListener</code>使用Spring Bean或扫描Servlet组件来注册Servlet规范中的Servlet，过滤器和所有侦听器（例如）。</p> <h5 id="将servlet，过滤器和侦听器注册为spring-bean"><a href="#将servlet，过滤器和侦听器注册为spring-bean" class="header-anchor">#</a> 将Servlet，过滤器和侦听器注册为Spring Bean</h5> <p>作为Spring bean的任何<code>Servlet</code>，<code>Filter</code>或servlet <code>*Listener</code>实例都向嵌入式容器注册。如果要<code>application.properties</code>在配置过程中引用一个值，这将特别方便。</p> <p>默认情况下，如果上下文仅包含单个Servlet，则将其映射到<code>/</code>。对于多个servlet bean，bean名称用作路径前缀。过滤器映射到<code>/*</code>。</p> <p>如果以公约为基础测绘不够灵活，你可以使用<code>ServletRegistrationBean</code>，<code>FilterRegistrationBean</code>以及<code>ServletListenerRegistrationBean</code>类的完全控制。</p> <p>通常可以使无序滤豆处于无序状态。如果需要一个特定的顺序，你应该注释<code>Filter</code>用<code>@Order</code>或使其实现<code>Ordered</code>。您无法<code>Filter</code>通过使用注释其bean方法来配置a的顺序<code>@Order</code>。如果您不能更改<code>Filter</code>要添加<code>@Order</code>或实现的类<code>Ordered</code>，则必须为定义一个<code>FilterRegistrationBean</code>，<code>Filter</code>并使用<code>setOrder(int)</code>方法设置注册bean的顺序。避免配置一个在处读取请求正文的过滤器<code>Ordered.HIGHEST_PRECEDENCE</code>，因为它可能与应用程序的字符编码配置不符。如果Servlet过滤器包装了请求，则应以小于或等于的顺序对其进行配置<code>OrderedFilter.REQUEST_WRAPPER_FILTER_MAX_ORDER</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>要查看<code>Filter</code>应用程序中每个组件的顺序，请为<code>web</code> <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-custom-log-groups" target="_blank" rel="noopener noreferrer">日志记录组<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（<code>logging.level.web=debug</code>）启用调试级别的日志<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-custom-log-groups" target="_blank" rel="noopener noreferrer">记录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。然后，将在启动时记录已注册过滤器的详细信息，包括其顺序和URL模式。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注册<code>Filter</code>bean 时要小心，因为它们在应用程序生命周期中很早就已初始化。如果您需要注册一个<code>Filter</code>与其他bean交互的，请考虑使用a <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/web/servlet/DelegatingFilterProxyRegistrationBean.html" target="_blank" rel="noopener noreferrer"><code>DelegatingFilterProxyRegistrationBean</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_7-4-2。servlet上下文初始化"><a href="#_7-4-2。servlet上下文初始化" class="header-anchor">#</a> 7.4.2。Servlet上下文初始化</h4> <p>嵌入式Servlet容器不会直接执行Servlet 3.0+ <code>javax.servlet.ServletContainerInitializer</code>接口或Spring的<code>org.springframework.web.WebApplicationInitializer</code>接口。这是一个有意的设计决定，旨在降低旨在在战争中运行的第三方库可能破坏Spring Boot应用程序的风险。</p> <p>如果您需要在Spring Boot应用程序中执行servlet上下文初始化，则应该注册一个实现该<code>org.springframework.boot.web.servlet.ServletContextInitializer</code>接口的bean 。单一<code>onStartup</code>方法提供对的访问，<code>ServletContext</code>并且在必要时可以轻松用作现有的适配器<code>WebApplicationInitializer</code>。</p> <h5 id="扫描servlet，过滤器和侦听器"><a href="#扫描servlet，过滤器和侦听器" class="header-anchor">#</a> 扫描Servlet，过滤器和侦听器</h5> <p>当使用嵌入式容器中，类自动登记注释有<code>@WebServlet</code>，<code>@WebFilter</code>和<code>@WebListener</code>可以通过使用被使能<code>@ServletComponentScan</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>@ServletComponentScan</code> 在独立的容器中无效，而是使用容器的内置发现机制。</p></div> <h4 id="_7-4-3。servletwebserverapplicationcontext"><a href="#_7-4-3。servletwebserverapplicationcontext" class="header-anchor">#</a> 7.4.3。ServletWebServerApplicationContext</h4> <p>在后台，Spring Boot <code>ApplicationContext</code>对嵌入式servlet容器使用了不同类型的支持。该<code>ServletWebServerApplicationContext</code>是一种特殊类型的<code>WebApplicationContext</code>通过搜索单说引导自身<code>ServletWebServerFactory</code>豆。通常是<code>TomcatServletWebServerFactory</code>，<code>JettyServletWebServerFactory</code>或<code>UndertowServletWebServerFactory</code>已被自动配置。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>通常，您不需要了解这些实现类。大多数应用程序都自动配置，并适当的<code>ApplicationContext</code>和<code>ServletWebServerFactory</code>以您的名义创建。</p></div> <h4 id="_7-4-4。自定义嵌入式servlet容器"><a href="#_7-4-4。自定义嵌入式servlet容器" class="header-anchor">#</a> 7.4.4。自定义嵌入式Servlet容器</h4> <p>可以使用Spring <code>Environment</code>属性来配置常见的servlet容器设置。通常，您将在<code>application.properties</code>文件中定义属性。</p> <p>常用服务器设置包括：</p> <ul><li>网络设置：侦听传入HTTP请求的端口（<code>server.port</code>），要绑定到的接口地址<code>server.address</code>，等等。</li> <li>会话设置：会话是否为持久（<code>server.servlet.session.persistent</code>），会话超时（<code>server.servlet.session.timeout</code>），会话数据位置（<code>server.servlet.session.store-dir</code>）和会话Cookie配置（<code>server.servlet.session.cookie.*</code>）。</li> <li>错误管理：错误页面的位置（<code>server.error.path</code>）等。</li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-configure-ssl" target="_blank" rel="noopener noreferrer">SSL协议<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#how-to-enable-http-response-compression" target="_blank" rel="noopener noreferrer">HTTP压缩<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Spring Boot尝试尽可能多地公开通用设置，但这并不总是可能的。在这种情况下，专用名称空间提供服务器特定的自定义（请参阅<code>server.tomcat</code>和<code>server.undertow</code>）。例如，可以使用嵌入式servlet容器的特定功能配置<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-configure-accesslogs" target="_blank" rel="noopener noreferrer">访问日志<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java" target="_blank" rel="noopener noreferrer"><code>ServerProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>完整列表，请参见课程。</p></div> <h5 id="程序定制"><a href="#程序定制" class="header-anchor">#</a> 程序定制</h5> <p>如果需要以编程方式配置嵌入式servlet容器，则可以注册一个实现该<code>WebServerFactoryCustomizer</code>接口的Spring bean 。 <code>WebServerFactoryCustomizer</code>提供对的访问<code>ConfigurableServletWebServerFactory</code>，其中包括许多自定义设置方法。以下示例显示以编程方式设置端口：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">WebServerFactoryCustomizer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">ConfigurableServletWebServerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationBean</span> <span class="token keyword">implements</span> <span class="token class-name">WebServerFactoryCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigurableServletWebServerFactory</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableServletWebServerFactory</span> server<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        server<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>TomcatServletWebServerFactory</code>，<code>JettyServletWebServerFactory</code>和<code>UndertowServletWebServerFactory</code>是的专用变体<code>ConfigurableServletWebServerFactory</code>具有用于分别的Tomcat，码头和暗流额外定制setter方法。</p></div> <h5 id="直接自定义configurableservletwebserverfactory"><a href="#直接自定义configurableservletwebserverfactory" class="header-anchor">#</a> 直接自定义ConfigurableServletWebServerFactory</h5> <p>如果前面的定制技术太有限，你可以注册<code>TomcatServletWebServerFactory</code>，<code>JettyServletWebServerFactory</code>或<code>UndertowServletWebServerFactory</code>豆你自己。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ConfigurableServletWebServerFactory</span> <span class="token function">webServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">TomcatServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setSessionTimeout</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">addErrorPages</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ErrorPage</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>NOT_FOUND<span class="token punctuation">,</span> <span class="token string">&quot;/notfound.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>提供了许多配置选项的设置器。如果您需要做一些更奇特的操作，还提供了几种受保护的方法“挂钩”。有关详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/web/servlet/server/ConfigurableServletWebServerFactory.html" target="_blank" rel="noopener noreferrer">源代码文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="_7-4-5。jsp局限性"><a href="#_7-4-5。jsp局限性" class="header-anchor">#</a> 7.4.5。JSP局限性</h4> <p>运行使用嵌入式servlet容器（并打包为可执行档案）的Spring Boot应用程序时，JSP支持存在一些限制。</p> <ul><li>对于Jetty和Tomcat，如果使用战争包装，它应该可以工作。与一起启动时<code>java -jar</code>，可执行的War将起作用，并且也可部署到任何标准容器中。使用可执行jar时，不支持JSP。</li> <li>Undertow不支持JSP。</li> <li>创建自定义<code>error.jsp</code>页面不会覆盖默认视图以进行<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-error-handling" target="_blank" rel="noopener noreferrer">错误处理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 应改用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-error-handling-custom-error-pages" target="_blank" rel="noopener noreferrer">自定义错误页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <h3 id="_7-5。嵌入式反应式服务器支持"><a href="#_7-5。嵌入式反应式服务器支持" class="header-anchor">#</a> 7.5。嵌入式反应式服务器支持</h3> <p>Spring Boot包含对以下嵌入式反应式Web服务器的支持：Reactor Netty，Tomcat，Jetty和Undertow。大多数开发人员使用适当的“入门”来获取完全配置的实例。默认情况下，嵌入式服务器在端口8080上侦听HTTP请求。</p> <h3 id="_7-6。反应性服务器资源配置"><a href="#_7-6。反应性服务器资源配置" class="header-anchor">#</a> 7.6。反应性服务器资源配置</h3> <p>在自动配置Reactor Netty或Jetty服务器时，Spring Boot将创建特定的bean，这些bean将向服务器实例提供HTTP资源：<code>ReactorResourceFactory</code>或<code>JettyResourceFactory</code>。</p> <p>默认情况下，这些资源还将与Reactor Netty和Jetty客户端共享，以实现最佳性能，前提是：</p> <ul><li>服务器和客户端使用相同的技术</li> <li>客户端实例是使用<code>WebClient.Builder</code>Spring Boot自动配置的bean 构建的</li></ul> <p>开发人员可以通过提供一个自定义<code>ReactorResourceFactory</code>或<code>JettyResourceFactory</code>bean 来覆盖Jetty和Reactor Netty的资源配置-这将同时应用于客户端和服务器。</p> <p>您可以在<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-webclient-runtime" target="_blank" rel="noopener noreferrer">WebClient Runtime部分中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>了解有关客户端资源配置的更多信息。</p> <h2 id="_8-rsocket"><a href="#_8-rsocket" class="header-anchor">#</a> 8. RSocket</h2> <p><a href="https://rsocket.io/" target="_blank" rel="noopener noreferrer">RSocket<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是用于字节流传输的二进制协议。它通过通过单个连接传递的异步消息来启用对称交互模型。</p> <p><code>spring-messaging</code>Spring框架的模块在客户端和服务器端都支持RSocket请求者和响应者。有关更多详细信息，请参见Spring Framework参考中的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web-reactive.html#rsocket-spring" target="_blank" rel="noopener noreferrer">RSocket部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，其中包括RSocket协议的概述。</p> <h3 id="_8-1。rsocket策略自动配置"><a href="#_8-1。rsocket策略自动配置" class="header-anchor">#</a> 8.1。RSocket策略自动配置</h3> <p>Spring Boot自动配置一个<code>RSocketStrategies</code>bean，该bean提供了用于编码和解码RSocket有效负载的所有必需基础结构。默认情况下，自动配置将尝试（按顺序）配置以下内容：</p> <ol><li>Jackson的<a href="https://cbor.io/" target="_blank" rel="noopener noreferrer">CBOR<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>编解码器</li> <li>杰克逊的JSON编解码器</li></ol> <p>在<code>spring-boot-starter-rsocket</code>启动同时提供的依赖。查阅<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-json-jackson" target="_blank" rel="noopener noreferrer">Jackson支持部分，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以了解有关定制可能性的更多信息。</p> <p>开发人员可以<code>RSocketStrategies</code>通过创建实现该<code>RSocketStrategiesCustomizer</code>接口的bean来自定义组件。请注意，它们<code>@Order</code>很重要，因为它确定编解码器的顺序。</p> <h3 id="_8-2。rsocket服务器自动配置"><a href="#_8-2。rsocket服务器自动配置" class="header-anchor">#</a> 8.2。RSocket服务器自动配置</h3> <p>Spring Boot提供了RSocket服务器自动配置。所需的依赖项由提供<code>spring-boot-starter-rsocket</code>。</p> <p>Spring Boot允许从WebFlux服务器通过WebSocket公开RSocket，或支持独立的RSocket服务器。这取决于应用程序的类型及其配置。</p> <p>对于WebFlux应用程序（即类型<code>WebApplicationType.REACTIVE</code>），仅当以下属性匹配时，RSocket服务器才会插入Web服务器：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.rsocket.server.mapping-path</span><span class="token punctuation">=</span><span class="token attr-value">/rsocket # a mapping path is defined</span>
<span class="token attr-name">spring.rsocket.server.transport</span><span class="token punctuation">=</span><span class="token attr-value">websocket # websocket is chosen as a transport</span>
<span class="token comment">#spring.rsocket.server.port= # no port is defined</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于RSocket本身是使用该库构建的，因此只有Reactor Netty支持将RSocket插入Web服务器。</p></div> <p>另外，RSocket TCP或Websocket服务器也可以作为独立的嵌入式服务器启动。除了依赖性要求之外，唯一需要的配置是为该服务器定义端口：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.rsocket.server.port</span><span class="token punctuation">=</span><span class="token attr-value">9898 # the only required configuration</span>
<span class="token attr-name">spring.rsocket.server.transport</span><span class="token punctuation">=</span><span class="token attr-value">tcp # you're free to configure other properties</span>
</code></pre></div><h3 id="_8-3。spring-messaging-rsocket支持"><a href="#_8-3。spring-messaging-rsocket支持" class="header-anchor">#</a> 8.3。Spring Messaging RSocket支持</h3> <p>Spring Boot将为RSocket自动配置Spring Messaging基础结构。</p> <p>这意味着Spring Boot将创建一个<code>RSocketMessageHandler</code>bean，该bean将处理对您的应用程序的RSocket请求。</p> <h3 id="_8-4。使用以下命令调用rsocket服务rsocketrequester"><a href="#_8-4。使用以下命令调用rsocket服务rsocketrequester" class="header-anchor">#</a> 8.4。使用以下命令调用RSocket服务<code>RSocketRequester</code></h3> <p>一旦<code>RSocket</code>在服务器和客户端之间建立了通道，任何一方都可以向另一方发送或接收请求。</p> <p>作为服务器，您可以<code>RSocketRequester</code>在RSocket的任何处理程序方法上注入实例<code>@Controller</code>。作为客户端，您需要首先配置和建立RSocket连接。Spring Boot会<code>RSocketRequester.Builder</code>使用预期的编解码器自动配置。</p> <p>该<code>RSocketRequester.Builder</code>实例是一个原型bean，这意味着每个注入点将为您提供一个新实例。这是有意为之的，因为此构建器是有状态的，您不应使用同一实例创建具有不同设置的请求者。</p> <p>以下代码显示了一个典型示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RSocketRequester</span> rsocketRequester<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">RSocketRequester</span><span class="token punctuation">.</span><span class="token class-name">Builder</span> rsocketRequesterBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rsocketRequester <span class="token operator">=</span> rsocketRequesterBuilder
                <span class="token punctuation">.</span><span class="token function">connectTcp</span><span class="token punctuation">(</span><span class="token string">&quot;example.org&quot;</span><span class="token punctuation">,</span> <span class="token number">9898</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">someRSocketCall</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requester<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">retrieveMono</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_9-安全性"><a href="#_9-安全性" class="header-anchor">#</a> 9.安全性</h2> <p>如果<a href="https://spring.io/projects/spring-security" target="_blank" rel="noopener noreferrer">Spring Security<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在类路径上，则默认情况下Web应用程序是安全的。Spring Boot依靠Spring Security的内容协商策略来确定使用<code>httpBasic</code>还是<code>formLogin</code>。要将方法级安全性添加到Web应用程序，您还可以添加<code>@EnableGlobalMethodSecurity</code>所需的设置。可以在《<a href="https://docs.spring.io/spring-security/site/docs/5.2.1.RELEASE/reference/htmlsingle/#jc-method" target="_blank" rel="noopener noreferrer">Spring Security参考指南》中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>找到更多信息。</p> <p>默认值<code>UserDetailsService</code>只有一个用户。用户名为<code>user</code>，密码为随机密码，并在应用程序启动时以INFO级别显示，如下例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>使用生成的安全密码：78fa095d-3f4c-48b1-ad50-e24c31d5cf35
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您微调日志记录配置，请确保将<code>org.springframework.boot.autoconfigure.security</code>类别设置为日志<code>INFO</code>级别的消息。否则，不会打印默认密码。</p></div> <p>您可以通过提供一个<code>spring.security.user.name</code>和来更改用户名和密码<code>spring.security.user.password</code>。</p> <p>默认情况下，您在Web应用程序中获得的基本功能是：</p> <ul><li>一个具有内存存储的bean <code>UserDetailsService</code>（或<code>ReactiveUserDetailsService</code>WebFlux应用程序）和一个具有生成的密码的单个用户（请参阅参考资料<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/autoconfigure/security/SecurityProperties.User.html" target="_blank" rel="noopener noreferrer"><code>SecurityProperties.User</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，获取用户的属性）。</li> <li><code>Accept</code>整个应用程序的基于表单的登录或HTTP基本安全性（取决于请求中的标头）（如果执行器位于类路径上，则包括执行器端点）。</li> <li>一个<code>DefaultAuthenticationEventPublisher</code>用于发布身份验证事件。</li></ul> <p>您可以<code>AuthenticationEventPublisher</code>通过添加一个bean 来提供不同的东西。</p> <h3 id="_9-1。mvc安全"><a href="#_9-1。mvc安全" class="header-anchor">#</a> 9.1。MVC安全</h3> <p>默认的安全配置在<code>SecurityAutoConfiguration</code>和中实现<code>UserDetailsServiceAutoConfiguration</code>。 <code>SecurityAutoConfiguration</code>导入<code>SpringBootWebSecurityConfiguration</code>Web安全性并<code>UserDetailsServiceAutoConfiguration</code>配置身份验证，这在非Web应用程序中也很重要。要完全关闭默认的Web应用程序安全性配置或合并多个Spring Security组件（例如OAuth 2 Client和Resource Server），请添加一个类型的bean <code>WebSecurityConfigurerAdapter</code>（这样做不会禁用<code>UserDetailsService</code>配置或Actuator的安全性）。</p> <p>为了还关闭<code>UserDetailsService</code>的配置，您可以添加类型的豆<code>UserDetailsService</code>，<code>AuthenticationProvider</code>或<code>AuthenticationManager</code>。</p> <p>可以通过添加自定义来覆盖访问规则<code>WebSecurityConfigurerAdapter</code>。Spring Boot提供了方便的方法，可用于覆盖执行器端点和静态资源的访问规则。 <code>EndpointRequest</code>可用于创建<code>RequestMatcher</code>基于<code>management.endpoints.web.base-path</code>属性的。 <code>PathRequest</code>可用于<code>RequestMatcher</code>在常用位置创建for资源。</p> <h3 id="_9-2。webflux安全"><a href="#_9-2。webflux安全" class="header-anchor">#</a> 9.2。WebFlux安全</h3> <p>与Spring MVC应用程序类似，您可以通过添加<code>spring-boot-starter-security</code>依赖项来保护WebFlux应用程序。默认的安全配置在<code>ReactiveSecurityAutoConfiguration</code>和中实现<code>UserDetailsServiceAutoConfiguration</code>。 <code>ReactiveSecurityAutoConfiguration</code>导入<code>WebFluxSecurityConfiguration</code>Web安全性并<code>UserDetailsServiceAutoConfiguration</code>配置身份验证，这在非Web应用程序中也很重要。要完全关闭默认的Web应用程序安全性配置，可以添加一个类型的bean <code>WebFilterChainProxy</code>（这样做不会禁用<code>UserDetailsService</code>配置或执行器的安全性）。</p> <p>要也关闭<code>UserDetailsService</code>配置，可以添加类型为<code>ReactiveUserDetailsService</code>或的Bean <code>ReactiveAuthenticationManager</code>。</p> <p>可以通过添加自定义<code>SecurityWebFilterChain</code>bean 来配置访问规则以及使用多个Spring Security组件（例如OAuth 2 Client和Resource Server）。Spring Boot提供了方便的方法，可用于覆盖执行器端点和静态资源的访问规则。 <code>EndpointRequest</code>可用于创建<code>ServerWebExchangeMatcher</code>基于<code>management.endpoints.web.base-path</code>属性的。</p> <p><code>PathRequest</code>可用于<code>ServerWebExchangeMatcher</code>在常用位置创建for资源。</p> <p>例如，您可以通过添加以下内容来自定义安全配置：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">SecurityWebFilterChain</span> <span class="token function">springSecurityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">ServerHttpSecurity</span> http<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> http
        <span class="token punctuation">.</span><span class="token function">authorizeExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">matchers</span><span class="token punctuation">(</span><span class="token class-name">PathRequest</span><span class="token punctuation">.</span><span class="token function">toStaticResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">atCommonLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">pathMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/bar&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-3。oauth2"><a href="#_9-3。oauth2" class="header-anchor">#</a> 9.3。OAuth2</h3> <p><a href="https://oauth.net/2/" target="_blank" rel="noopener noreferrer">OAuth2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是Spring支持的一种广泛使用的授权框架。</p> <h4 id="_9-3-1。客户"><a href="#_9-3-1。客户" class="header-anchor">#</a> 9.3.1。客户</h4> <p>如果您<code>spring-security-oauth2-client</code>在类路径中，则可以利用一些自动配置功能来轻松设置OAuth2 / Open ID Connect客户端。此配置使用的属性<code>OAuth2ClientProperties</code>。相同的属性适用于servlet和反应式应用程序。</p> <p>您可以在<code>spring.security.oauth2.client</code>前缀下注册多个OAuth2客户端和提供者，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.client-id</span><span class="token punctuation">=</span><span class="token attr-value">abcd</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.client-secret</span><span class="token punctuation">=</span><span class="token attr-value">password</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.client-name</span><span class="token punctuation">=</span><span class="token attr-value">Client for user scope</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.provider</span><span class="token punctuation">=</span><span class="token attr-value">my-oauth-provider</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.scope</span><span class="token punctuation">=</span><span class="token attr-value">user</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.redirect-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://my-redirect-uri.com</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.client-authentication-method</span><span class="token punctuation">=</span><span class="token attr-value">basic</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-1.authorization-grant-type</span><span class="token punctuation">=</span><span class="token attr-value">authorization_code</span>

<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.client-id</span><span class="token punctuation">=</span><span class="token attr-value">abcd</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.client-secret</span><span class="token punctuation">=</span><span class="token attr-value">password</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.client-name</span><span class="token punctuation">=</span><span class="token attr-value">Client for email scope</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.provider</span><span class="token punctuation">=</span><span class="token attr-value">my-oauth-provider</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.scope</span><span class="token punctuation">=</span><span class="token attr-value">email</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.redirect-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://my-redirect-uri.com</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.client-authentication-method</span><span class="token punctuation">=</span><span class="token attr-value">basic</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client-2.authorization-grant-type</span><span class="token punctuation">=</span><span class="token attr-value">authorization_code</span>

<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.authorization-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://my-auth-server/oauth/authorize</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.token-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://my-auth-server/oauth/token</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.user-info-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://my-auth-server/userinfo</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.user-info-authentication-method</span><span class="token punctuation">=</span><span class="token attr-value">header</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.jwk-set-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://my-auth-server/token_keys</span>
<span class="token attr-name">spring.security.oauth2.client.provider.my-oauth-provider.user-name-attribute</span><span class="token punctuation">=</span><span class="token attr-value">name</span>
</code></pre></div><p>对于支持<a href="https://openid.net/specs/openid-connect-discovery-1_0.html" target="_blank" rel="noopener noreferrer">OpenID Connect发现的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> OpenID Connect提供程序，可以进一步简化配置。提供者需要配置为，<code>issuer-uri</code>后者是它声明为其发布者标识符的URI。例如，如果<code>issuer-uri</code>提供的是“ https://example.com”，则将<code>OpenID Provider Configuration Request</code>对“ https://example.com/.well-known/openid-configuration”进行标记。结果预期为<code>OpenID Provider Configuration Response</code>。以下示例显示如何使用来配置OpenID Connect提供程序<code>issuer-uri</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.security.oauth2.client.provider.oidc-provider.issuer-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://dev-123456.oktapreview.com/oauth2/default/</span>
</code></pre></div><p>默认情况下，Spring Security <code>OAuth2LoginAuthenticationFilter</code>只处理匹配的URL <code>/login/oauth2/code/*</code>。如果要自定义，<code>redirect-uri</code>以使用其他模式，则需要提供配置以处理该自定义模式。例如，对于Servlet应用程序，您可以添加<code>WebSecurityConfigurerAdapter</code>类似于以下内容的自己的应用程序：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OAuth2LoginSecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http
            <span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">oauth2Login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">redirectionEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">baseUri</span><span class="token punctuation">(</span><span class="token string">&quot;/custom-callback&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="普通提供商的oauth2客户端注册"><a href="#普通提供商的oauth2客户端注册" class="header-anchor">#</a> 普通提供商的OAuth2客户端注册</h5> <p>对于常见的OAuth2和OpenID提供商，包括谷歌，Github上，Facebook和1563，我们提供了一组供应商默认的（<code>google</code>，<code>github</code>，<code>facebook</code>，和<code>okta</code>，分别）。</p> <p>如果不需要自定义这些提供程序，则可以将<code>provider</code>属性设置为需要为其推断默认值的属性。另外，如果用于客户端注册的密钥与默认支持的提供程序匹配，则Spring Boot也会进行推断。</p> <p>换句话说，以下示例中的两个配置都使用Google提供程序：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.security.oauth2.client.registration.my-client.client-id</span><span class="token punctuation">=</span><span class="token attr-value">abcd</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client.client-secret</span><span class="token punctuation">=</span><span class="token attr-value">password</span>
<span class="token attr-name">spring.security.oauth2.client.registration.my-client.provider</span><span class="token punctuation">=</span><span class="token attr-value">google</span>

<span class="token attr-name">spring.security.oauth2.client.registration.google.client-id</span><span class="token punctuation">=</span><span class="token attr-value">abcd</span>
<span class="token attr-name">spring.security.oauth2.client.registration.google.client-secret</span><span class="token punctuation">=</span><span class="token attr-value">password</span>
</code></pre></div><h4 id="_9-3-2。资源服务器"><a href="#_9-3-2。资源服务器" class="header-anchor">#</a> 9.3.2。资源服务器</h4> <p>如果您<code>spring-security-oauth2-resource-server</code>在类路径中，则Spring Boot可以设置OAuth2资源服务器。对于JWT配置，需要指定JWK设置URI或OIDC颁发者URI，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.security.oauth2.resourceserver.jwt.jwk-set-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://example.com/oauth2/default/v1/keys</span>
<span class="token attr-name">spring.security.oauth2.resourceserver.jwt.issuer-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://dev-123456.oktapreview.com/oauth2/default/</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果授权服务器不支持JWK设置URI，则可以使用用于验证JWT签名的公共密钥来配置资源服务器。可以使用<code>spring.security.oauth2.resourceserver.jwt.public-key-location</code>属性来完成此操作，该属性值需要指向包含PEM编码的x509格式的公钥的文件。</p></div> <p>相同的属性适用于servlet和反应式应用程序。</p> <p>另外，您可以<code>JwtDecoder</code>为Servlet应用程序或<code>ReactiveJwtDecoder</code>响应式应用程序定义自己的bean 。</p> <p>如果使用不透明令牌而不是JWT，则可以配置以下属性以通过自省来验证令牌：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.security.oauth2.resourceserver.opaquetoken.introspection-uri</span><span class="token punctuation">=</span><span class="token attr-value">https://example.com/check-token</span>
<span class="token attr-name">spring.security.oauth2.resourceserver.opaquetoken.client-id</span><span class="token punctuation">=</span><span class="token attr-value">my-client-id</span>
<span class="token attr-name">spring.security.oauth2.resourceserver.opaquetoken.client-secret</span><span class="token punctuation">=</span><span class="token attr-value">my-client-secret</span>
</code></pre></div><p>同样，相同的属性适用于servlet和反应式应用程序。</p> <p>另外，您可以<code>OpaqueTokenIntrospector</code>为Servlet应用程序或<code>ReactiveOpaqueTokenIntrospector</code>响应式应用程序定义自己的bean 。</p> <h4 id="_9-3-3。授权服务器"><a href="#_9-3-3。授权服务器" class="header-anchor">#</a> 9.3.3。授权服务器</h4> <p>当前，Spring Security不提供对实现OAuth 2.0授权服务器的支持。但是，<a href="https://spring.io/projects/spring-security-oauth" target="_blank" rel="noopener noreferrer">Spring Security OAuth<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>项目提供了此功能，最终将被Spring Security完全取代。在此之前，您可以使用该<code>spring-security-oauth2-autoconfigure</code>模块轻松设置OAuth 2.0授权服务器；有关说明，请参见其<a href="https://docs.spring.io/spring-security-oauth2-boot" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_9-4。saml-2-0"><a href="#_9-4。saml-2-0" class="header-anchor">#</a> 9.4。SAML 2.0</h3> <h4 id="_9-4-1。依赖党"><a href="#_9-4-1。依赖党" class="header-anchor">#</a> 9.4.1。依赖党</h4> <p>如果您<code>spring-security-saml2-service-provider</code>在类路径上，则可以利用一些自动配置功能来轻松设置SAML 2.0依赖方。此配置使用的属性<code>Saml2RelyingPartyProperties</code>。</p> <p>依赖方注册代表身份提供商IDP和服务提供商SP之间的配对配置。您可以在<code>spring.security.saml2.relyingparty</code>前缀下注册多个依赖方，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party1.signing.credentials[0].private-key-location</span><span class="token punctuation">=</span><span class="token attr-value">path-to-private-key</span>
<span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party1.signing.credentials[0].certificate-location</span><span class="token punctuation">=</span><span class="token attr-value">path-to-certificate</span>
<span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party1.identityprovider.verification.credentials[0].certificate-location</span><span class="token punctuation">=</span><span class="token attr-value">path-to-verification-cert</span>
<span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party1.identityprovider.entity-id</span><span class="token punctuation">=</span><span class="token attr-value">remote-idp-entity-id1</span>
<span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party1.identityprovider.sso-url</span><span class="token punctuation">=</span><span class="token attr-value">https://remoteidp1.sso.url</span>

<span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party2.signing.credentials[0].private-key-location</span><span class="token punctuation">=</span><span class="token attr-value">path-to-private-key</span>
<span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party2.signing.credentials[0].certificate-location</span><span class="token punctuation">=</span><span class="token attr-value">path-to-certificate</span>
<span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party2.identityprovider.verification.credentials[0].certificate-location</span><span class="token punctuation">=</span><span class="token attr-value">path-to-other-verification-cert</span>
<span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party2.identityprovider.entity-id</span><span class="token punctuation">=</span><span class="token attr-value">remote-idp-entity-id2</span>
<span class="token attr-name">spring.security.saml2.relyingparty.registration.my-relying-party2.identityprovider.sso-url</span><span class="token punctuation">=</span><span class="token attr-value">https://remoteidp2.sso.url</span>
</code></pre></div><h3 id="_9-5。执行器安全"><a href="#_9-5。执行器安全" class="header-anchor">#</a> 9.5。执行器安全</h3> <p>为了安全起见，默认情况下，除<code>/health</code>和以外的所有执行器<code>/info</code>都是禁用的。该<code>management.endpoints.web.exposure.include</code>属性可用于启用执行器。</p> <p>如果春季安全是在类路径上，并没有其他WebSecurityConfigurerAdapter存在，所有的执行机构以外<code>/health</code>，并<code>/info</code>通过春天开机自动配置固定。如果您定义一个custom <code>WebSecurityConfigurerAdapter</code>，Spring Boot自动配置将退出，您将完全控制执行器访问规则。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在设置之前<code>management.endpoints.web.exposure.include</code>，请确保裸露的执行器不包含敏感信息和/或通过将它们放置在防火墙后面或通过诸如Spring Security之类的东西进行保护。</p></div> <h4 id="_9-5-1。跨站点请求伪造保护"><a href="#_9-5-1。跨站点请求伪造保护" class="header-anchor">#</a> 9.5.1。跨站点请求伪造保护</h4> <p>由于Spring Boot依赖于Spring Security的默认值，因此默认情况下CSRF保护是打开的。这意味着在使用默认安全性配置时，要求<code>POST</code>（关闭和记录器端点）的执行器端点<code>PUT</code>或<code>DELETE</code>将收到403禁止错误。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>我们建议仅在创建非浏览器客户端使用的服务时完全禁用CSRF保护。</p></div> <p>关于CSRF保护的其他信息可以在<a href="https://docs.spring.io/spring-security/site/docs/5.2.1.RELEASE/reference/htmlsingle/#csrf" target="_blank" rel="noopener noreferrer">Spring Security Reference Guide中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="_10-使用sql数据库"><a href="#_10-使用sql数据库" class="header-anchor">#</a> 10.使用SQL数据库</h2> <p>在<a href="https://spring.io/projects/spring-framework" target="_blank" rel="noopener noreferrer">Spring框架<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了利用使用SQL数据库，直接JDBC访问广泛的支持<code>JdbcTemplate</code>来完成“对象关系映射”技术，比如Hibernate。 <a href="https://spring.io/projects/spring-data" target="_blank" rel="noopener noreferrer">Spring Data<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了更高级别的功能：<code>Repository</code>直接从接口创建实现，并使用约定从您的方法名称生成查询。</p> <h3 id="_10-1。配置数据源"><a href="#_10-1。配置数据源" class="header-anchor">#</a> 10.1。配置数据源</h3> <p>Java的<code>javax.sql.DataSource</code>界面提供了使用数据库连接的标准方法。传统上，“数据源”使用<code>URL</code>以及一些凭据来建立数据库连接。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关更多高级示例，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-configure-a-datasource" target="_blank" rel="noopener noreferrer">“操作方法”部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，通常可以完全控制DataSource的配置。</p></div> <h4 id="_10-1-1。嵌入式数据库支持"><a href="#_10-1-1。嵌入式数据库支持" class="header-anchor">#</a> 10.1.1。嵌入式数据库支持</h4> <p>使用内存嵌入式数据库来开发应用程序通常很方便。显然，内存数据库不提供持久存储。您需要在应用程序启动时填充数据库，并准备在应用程序结束时丢弃数据。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>“操作方法”部分包括<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-database-initialization" target="_blank" rel="noopener noreferrer">有关如何初始化数据库的部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>Spring Boot可以自动配置嵌入式<a href="https://www.h2database.com/" target="_blank" rel="noopener noreferrer">H2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="http://hsqldb.org/" target="_blank" rel="noopener noreferrer">HSQL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://db.apache.org/derby/" target="_blank" rel="noopener noreferrer">Derby<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>数据库。您无需提供任何连接URL。您只需要包含要使用的嵌入式数据库的构建依赖项即可。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您在测试中使用此功能，则可能会注意到，整个测试套件将重复使用同一数据库，而不管您使用的应用程序上下文有多少。如果要确保每个上下文都有一个单独的嵌入式数据库，则应设置<code>spring.datasource.generate-unique-name</code>为<code>true</code>。</p></div> <p>例如，典型的POM依赖关系如下：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.hsqldb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hsqldb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您需要依赖<code>spring-jdbc</code>才能自动配置嵌入式数据库。在此示例中，它通过传递<code>spring-boot-starter-data-jpa</code>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果出于某种原因确实为嵌入式数据库配置了连接URL，请确保确保禁用了数据库的自动关闭功能。如果您使用H2，则应该<code>DB_CLOSE_ON_EXIT=FALSE</code>这样做。如果使用HSQLDB，则应确保<code>shutdown=true</code>未使用它。通过禁用数据库的自动关闭功能，Spring Boot可以控制何时关闭数据库，从而确保一旦不再需要访问数据库时就可以执行该操作。</p></div> <h4 id="_10-1-2。连接到生产数据库"><a href="#_10-1-2。连接到生产数据库" class="header-anchor">#</a> 10.1.2。连接到生产数据库</h4> <p>生产数据库连接也可以通过使用pooling进行自动配置<code>DataSource</code>。Spring Boot使用以下算法来选择特定的实现：</p> <ol><li>我们更喜欢<a href="https://github.com/brettwooldridge/HikariCP" target="_blank" rel="noopener noreferrer">HikariCP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的性能和并发性。如果有HikariCP，我们总是选择它。</li> <li>否则，如果Tomcat池<code>DataSource</code>可用，我们将使用它。</li> <li>如果HikariCP和Tomcat池数据源均不可用，并且<a href="https://commons.apache.org/proper/commons-dbcp/" target="_blank" rel="noopener noreferrer">Commons DBCP2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>不可用，我们将使用它。</li></ol> <p>如果使用<code>spring-boot-starter-jdbc</code>或<code>spring-boot-starter-data-jpa</code>“启动器”，则会自动获得对的依赖<code>HikariCP</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以完全绕过该算法，并通过设置<code>spring.datasource.type</code>属性来指定要使用的连接池。如果您在<code>tomcat-jdbc</code>默认情况下提供的Tomcat容器中运行应用程序，则这一点尤其重要。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>其他连接池始终可以手动配置。如果定义自己的<code>DataSource</code>bean，则不会进行自动配置。</p></div> <p>DataSource配置由中的外部配置属性控制<code>spring.datasource.*</code>。例如，您可以在中声明以下部分<code>application.properties</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.datasource.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost/test</span>
<span class="token attr-name">spring.datasource.username</span><span class="token punctuation">=</span><span class="token attr-value">dbuser</span>
<span class="token attr-name">spring.datasource.password</span><span class="token punctuation">=</span><span class="token attr-value">dbpass</span>
<span class="token attr-name">spring.datasource.driver-class-name</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.jdbc.Driver</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您至少应通过设置<code>spring.datasource.url</code>属性来指定URL 。否则，Spring Boot会尝试自动配置嵌入式数据库。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您通常不需要指定<code>driver-class-name</code>，因为Spring Boot可以从推导大多数数据库<code>url</code>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>对于<code>DataSource</code>要创建的池，我们需要能够验证有效的<code>Driver</code>类是否可用，因此我们在进行任何操作之前都要进行检查。换句话说，如果您设置<code>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</code>，则该类必须是可加载的。</p></div> <p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceProperties.java" target="_blank" rel="noopener noreferrer"><code>DataSourceProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多受支持的选项。这些是不管实际实现如何都起作用的标准选项。它也有可能微调实现特定的设置，使用各自的前缀（<code>spring.datasource.hikari.*</code>，<code>spring.datasource.tomcat.*</code>，和<code>spring.datasource.dbcp2.*</code>）。有关更多详细信息，请参阅所用连接池实现的文档。</p> <p>例如，如果使用<a href="https://tomcat.apache.org/tomcat-8.0-doc/jdbc-pool.html#Common_Attributes" target="_blank" rel="noopener noreferrer">Tomcat连接池<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，则可以自定义许多其他设置，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># Number of ms to wait before throwing an exception if no connection is available.</span>
<span class="token attr-name">spring.datasource.tomcat.max-wait</span><span class="token punctuation">=</span><span class="token attr-value">10000</span>

<span class="token comment"># Maximum number of active connections that can be allocated from this pool at the same time.</span>
<span class="token attr-name">spring.datasource.tomcat.max-active</span><span class="token punctuation">=</span><span class="token attr-value">50</span>

<span class="token comment"># Validate the connection before borrowing it from the pool.</span>
<span class="token attr-name">spring.datasource.tomcat.test-on-borrow</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><h4 id="_10-1-3。连接到jndi数据源"><a href="#_10-1-3。连接到jndi数据源" class="header-anchor">#</a> 10.1.3。连接到JNDI数据源</h4> <p>如果您将Spring Boot应用程序部署到Application Server，则可能需要使用Application Server的内置功能来配置和管理DataSource，并使用JNDI对其进行访问。</p> <p>该<code>spring.datasource.jndi-name</code>属性可以被用作一个替代<code>spring.datasource.url</code>，<code>spring.datasource.username</code>和<code>spring.datasource.password</code>属性来访问<code>DataSource</code>从一个特定的JNDI位置。例如，以下部分<code>application.properties</code>显示了如何访问定义的JBoss AS <code>DataSource</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.datasource.jndi-name</span><span class="token punctuation">=</span><span class="token attr-value">java:jboss/datasources/customers</span>
</code></pre></div><h3 id="_10-2。使用jdbctemplate"><a href="#_10-2。使用jdbctemplate" class="header-anchor">#</a> 10.2。使用JdbcTemplate</h3> <p>Spring <code>JdbcTemplate</code>和<code>NamedParameterJdbcTemplate</code>class是自动配置的，您可以将<code>@Autowire</code>它们直接放入自己的bean中，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">JdbcTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jdbcTemplate <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以使用属性来自定义模板的某些属性<code>spring.jdbc.template.*</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.jdbc.template.max-rows</span><span class="token punctuation">=</span><span class="token attr-value">500</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在<code>NamedParameterJdbcTemplate</code>重复使用相同的<code>JdbcTemplate</code>幕后情况。如果<code>JdbcTemplate</code>定义了多个，并且不存在主要候选对象，<code>NamedParameterJdbcTemplate</code>则不会自动配置。</p></div> <h3 id="_10-3。jpa和spring-data-jpa"><a href="#_10-3。jpa和spring-data-jpa" class="header-anchor">#</a> 10.3。JPA和Spring Data JPA</h3> <p>Java Persistence API是一种标准技术，可让您将对象“映射”到关系数据库。该<code>spring-boot-starter-data-jpa</code>POM提供了上手的快捷方式。它提供以下关键依赖性：</p> <ul><li>Hibernate：最流行的JPA实现之一。</li> <li>Spring Data JPA：使基于JPA的存储库的实现变得容易。</li> <li>Spring ORM：Spring Framework提供的核心ORM支持。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在这里，我们不会过多讨论JPA或<a href="https://spring.io/projects/spring-data" target="_blank" rel="noopener noreferrer">Spring Data<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。您可以按照<a href="https://spring.io/guides/gs/accessing-data-jpa/" target="_blank" rel="noopener noreferrer">“访问数据与JPA”<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>从指导<a href="https://spring.io/" target="_blank" rel="noopener noreferrer">spring.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>并宣读了<a href="https://spring.io/projects/spring-data-jpa" target="_blank" rel="noopener noreferrer">春天的数据JPA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://hibernate.org/orm/documentation/" target="_blank" rel="noopener noreferrer">Hibernate的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>参考文档。</p></div> <h4 id="_10-3-1。实体类别"><a href="#_10-3-1。实体类别" class="header-anchor">#</a> 10.3.1。实体类别</h4> <p>传统上，JPA“实体”类在<code>persistence.xml</code>文件中指定。在Spring Boot中，此文件不是必需的，而是使用“实体扫描”。默认情况下，将搜索主配置类（用<code>@EnableAutoConfiguration</code>或注释的一个<code>@SpringBootApplication</code>）下的所有软件包。</p> <p>任何类别标注了<code>@Entity</code>，<code>@Embeddable</code>或者<code>@MappedSuperclass</code>被认为是。典型的实体类类似于以下示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">City</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> state<span class="token punctuation">;</span>

    <span class="token comment">// ... additional members, often include @OneToMany mappings</span>

    <span class="token keyword">protected</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// no-args constructor required by JPA spec</span>
        <span class="token comment">// this one is protected since it shouldn't be used directly</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ... etc</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以使用<code>@EntityScan</code>注释来自定义实体扫描位置。请参阅“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-separate-entity-definitions-from-spring-configuration" target="_blank" rel="noopener noreferrer">howto.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”方法。</p></div> <h4 id="_10-3-2。spring-data-jpa存储库"><a href="#_10-3-2。spring-data-jpa存储库" class="header-anchor">#</a> 10.3.2。Spring Data JPA存储库</h4> <p><a href="https://spring.io/projects/spring-data-jpa" target="_blank" rel="noopener noreferrer">Spring Data JPA<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>存储库是可以定义以访问数据的接口。JPA查询是根据您的方法名称自动创建的。例如，一个<code>CityRepository</code>接口可能声明了<code>findAllByState(String state)</code>一种查找给定州所有城市的方法。</p> <p>对于更复杂的查询，可以使用Spring Data的<a href="https://docs.spring.io/spring-data/jpa/docs/2.2.3.RELEASE/api/org/springframework/data/jpa/repository/Query.html" target="_blank" rel="noopener noreferrer"><code>Query</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>注释对方法进行注释。</p> <p>Spring Data存储库通常从<a href="https://docs.spring.io/spring-data/commons/docs/2.2.3.RELEASE/api/org/springframework/data/repository/Repository.html" target="_blank" rel="noopener noreferrer"><code>Repository</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或<a href="https://docs.spring.io/spring-data/commons/docs/2.2.3.RELEASE/api/org/springframework/data/repository/CrudRepository.html" target="_blank" rel="noopener noreferrer"><code>CrudRepository</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>接口扩展。如果使用自动配置，则从包含主配置类（用<code>@EnableAutoConfiguration</code>或注释的主配置类）的包中搜索存储库<code>@SpringBootApplication</code>。</p> <p>以下示例显示了典型的Spring Data存储库接口定义：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">City</span> <span class="token function">findByNameAndStateAllIgnoringCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>Spring Data JPA存储库支持三种不同的引导模式：默认，延迟和延迟。要启用延迟引导或延迟引导，请将<code>spring.data.jpa.repositories.bootstrap-mode</code>属性分别设置为<code>deferred</code>或<code>lazy</code>。当使用延迟或惰性引导时，自动配置的<code>EntityManagerFactoryBuilder</code>将使用上下文的<code>AsyncTaskExecutor</code>（如果有）作为引导执行器。如果存在多个，<code>applicationTaskExecutor</code>将使用一个命名的。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>我们几乎没有刮过Spring Data JPA的表面。有关完整的详细信息，请参见<a href="https://docs.spring.io/spring-data/jdbc/docs/1.1.3.RELEASE/reference/html/" target="_blank" rel="noopener noreferrer">Spring Data JPA参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_10-3-3。创建和删除jpa数据库"><a href="#_10-3-3。创建和删除jpa数据库" class="header-anchor">#</a> 10.3.3。创建和删除JPA数据库</h4> <p>默认情况下，<strong>仅</strong>当您使用嵌入式数据库（H2，HSQL或Derby）时，<strong>才会</strong>自动创建JPA数据库。您可以使用<code>spring.jpa.*</code>属性来显式配置JPA设置。例如，要创建和删除表，可以将以下行添加到中<code>application.properties</code>：</p> <div class="language- extra-class"><pre class="language-text"><code>spring.jpa.hibernate.ddl-auto =创建-放置
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Hibernate自己的内部属性名称是（如果您记得更好的话）是<code>hibernate.hbm2ddl.auto</code>。您可以通过使用<code>spring.jpa.properties.*</code>（与其他Hibernate本机属性一起）进行设置（将前缀添加到实体管理器之前先删除前缀）。下面的行显示了为Hibernate设置JPA属性的示例：</p></div> <div class="language- extra-class"><pre class="language-text"><code>spring.jpa.properties.hibernate.globally_quoted_identifiers = true
</code></pre></div><p>在前面的示例中的线穿过的一个值<code>true</code>的<code>hibernate.globally_quoted_identifiers</code>属性设置为休眠实体管理器。</p> <p>默认情况下，DDL执行（或验证）推迟到<code>ApplicationContext</code>开始执行之前。还有一个<code>spring.jpa.generate-ddl</code>标志，但是如果Hibernate自动配置处于活动状态，则不使用该标志，因为<code>ddl-auto</code>设置更细粒度。</p> <h4 id="_10-3-4。在视图中打开entitymanager"><a href="#_10-3-4。在视图中打开entitymanager" class="header-anchor">#</a> 10.3.4。在视图中打开EntityManager</h4> <p>如果您正在运行Web应用程序，则默认情况下，Spring Boot注册<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/orm/jpa/support/OpenEntityManagerInViewInterceptor.html" target="_blank" rel="noopener noreferrer"><code>OpenEntityManagerInViewInterceptor</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以应用“在视图中打开EntityManager”模式，以允许在Web视图中进行延迟加载。如果你不希望这种行为，你应该设置<code>spring.jpa.open-in-view</code>到<code>false</code>你<code>application.properties</code>。</p> <h3 id="_10-4。spring-data-jdbc"><a href="#_10-4。spring-data-jdbc" class="header-anchor">#</a> 10.4。Spring Data JDBC</h3> <p>Spring Data包括对JDBC的存储库支持，并将自动为上的方法生成SQL <code>CrudRepository</code>。对于更高级的查询，<code>@Query</code>提供了注释。</p> <p>当必要的依赖项位于类路径上时，Spring Boot将自动配置Spring Data的JDBC存储库。可以将它们添加到您的项目中，而只需依赖于<code>spring-boot-starter-data-jdbc</code>。如有必要，您可以通过向应用程序中添加<code>@EnableJdbcRepositories</code>注释或<code>JdbcConfiguration</code>子类来控制Spring Data JDBC的配置。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关Spring Data JDBC的完整详细信息，请参考<a href="https://docs.spring.io/spring-data/jdbc/docs/1.1.3.RELEASE/reference/html/" target="_blank" rel="noopener noreferrer">参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_10-5。使用h2的web控制台"><a href="#_10-5。使用h2的web控制台" class="header-anchor">#</a> 10.5。使用H2的Web控制台</h3> <p>该<a href="https://www.h2database.com/" target="_blank" rel="noopener noreferrer">H2数据库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了一个<a href="https://www.h2database.com/html/quickstart.html#h2_console" target="_blank" rel="noopener noreferrer">基于浏览器的控制台<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是春天开机都能自动为您配置。满足以下条件时，将自动配置控制台：</p> <ul><li>您正在开发基于servlet的Web应用程序。</li> <li><code>com.h2database:h2</code> 在类路径上。</li> <li>您正在使用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot-devtools" target="_blank" rel="noopener noreferrer">Spring Boot的开发人员工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您不使用Spring Boot的开发人员工具，但仍想使用H2的控制台，则可以将<code>spring.h2.console.enabled</code>属性配置为<code>true</code>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>H2控制台仅在开发期间使用，因此您应注意确保<code>spring.h2.console.enabled</code>不在<code>true</code>生产环境中使用。</p></div> <h4 id="_10-5-1。更改h2控制台的路径"><a href="#_10-5-1。更改h2控制台的路径" class="header-anchor">#</a> 10.5.1。更改H2控制台的路径</h4> <p>默认情况下，控制台位于<code>/h2-console</code>。您可以使用<code>spring.h2.console.path</code>属性来自定义控制台的路径。</p> <h3 id="_10-6。使用jooq"><a href="#_10-6。使用jooq" class="header-anchor">#</a> 10.6。使用jOOQ</h3> <p>jOOQ面向对象查询（<a href="https://www.jooq.org/" target="_blank" rel="noopener noreferrer">jOOQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）是<a href="https://www.datageekery.com/" target="_blank" rel="noopener noreferrer">Data Geekery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的流行产品，它可以从数据库中生成Java代码，并允许您通过其流畅的API来构建类型安全的SQL查询。商业版和开源版都可以与Spring Boot一起使用。</p> <h4 id="_10-6-1。代码生成"><a href="#_10-6-1。代码生成" class="header-anchor">#</a> 10.6.1。代码生成</h4> <p>为了使用jOOQ类型安全查询，您需要从数据库架构中生成Java类。您可以按照<a href="https://www.jooq.org/doc/3.12.3/manual-single-page/#jooq-in-7-steps-step3" target="_blank" rel="noopener noreferrer">jOOQ用户手册中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的说明进行<a href="https://www.jooq.org/doc/3.12.3/manual-single-page/#jooq-in-7-steps-step3" target="_blank" rel="noopener noreferrer">操作<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果您使用<code>jooq-codegen-maven</code>插件并且还使用<code>spring-boot-starter-parent</code>“父POM”，则可以安全地省略插件的<code>&lt;version&gt;</code>标签。您还可以使用Spring Boot定义的版本变量（例如<code>h2.version</code>）来声明插件的数据库依赖关系。以下清单显示了一个示例：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jooq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jooq-codegen-maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
        ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.h2database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${h2.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbc</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span><span class="token punctuation">&gt;</span></span>org.h2.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>driver</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>jdbc:h2:~/yourdatabase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbc</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>generator</span><span class="token punctuation">&gt;</span></span>
            ...
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>generator</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_10-6-2。使用dslcontext"><a href="#_10-6-2。使用dslcontext" class="header-anchor">#</a> 10.6.2。使用DSLContext</h4> <p>jOOQ提供的流畅的API通过该<code>org.jooq.DSLContext</code>接口启动。Spring Boot将a自动配置<code>DSLContext</code>为Spring Bean并将其连接到您的应用程序<code>DataSource</code>。要使用<code>DSLContext</code>，可以使用<code>@Autowire</code>它，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JooqExample</span> <span class="token keyword">implements</span> <span class="token class-name">CommandLineRunner</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DSLContext</span> create<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">JooqExample</span><span class="token punctuation">(</span><span class="token class-name">DSLContext</span> dslContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>create <span class="token operator">=</span> dslContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>jOOQ手册倾向于使用名为的变量<code>create</code>来保存<code>DSLContext</code>。</p></div> <p>然后，您可以使用<code>DSLContext</code>构造查询，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GregorianCalendar</span><span class="token punctuation">&gt;</span></span> <span class="token function">authorsBornAfter1980</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>create<span class="token punctuation">.</span><span class="token function">selectFrom</span><span class="token punctuation">(</span>AUTHOR<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>AUTHOR<span class="token punctuation">.</span>DATE_OF_BIRTH<span class="token punctuation">.</span><span class="token function">greaterThan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GregorianCalendar</span><span class="token punctuation">(</span><span class="token number">1980</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span>AUTHOR<span class="token punctuation">.</span>DATE_OF_BIRTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_10-6-3。jooq-sql方言"><a href="#_10-6-3。jooq-sql方言" class="header-anchor">#</a> 10.6.3。jOOQ SQL方言</h4> <p>除非<code>spring.jooq.sql-dialect</code>配置了该属性，否则Spring Boot会确定要用于数据源的SQL方言。如果Spring Boot无法检测到方言，则使用<code>DEFAULT</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot只能自动配置开源版本的jOOQ支持的方言。</p></div> <h4 id="_10-6-4。定制jooq"><a href="#_10-6-4。定制jooq" class="header-anchor">#</a> 10.6.4。定制jOOQ</h4> <p>通过定义自己的<code>@Bean</code>定义（可以在<code>Configuration</code>创建jOOQ时使用）可以实现更高级的自定义。您可以为以下jOOQ类型定义bean：</p> <ul><li><code>ConnectionProvider</code></li> <li><code>ExecutorProvider</code></li> <li><code>TransactionProvider</code></li> <li><code>RecordMapperProvider</code></li> <li><code>RecordUnmapperProvider</code></li> <li><code>Settings</code></li> <li><code>RecordListenerProvider</code></li> <li><code>ExecuteListenerProvider</code></li> <li><code>VisitListenerProvider</code></li> <li><code>TransactionListenerProvider</code></li></ul> <p><code>org.jooq.Configuration</code> <code>@Bean</code>如果要完全控制jOOQ配置，也可以创建自己的。</p> <h2 id="_11-使用nosql技术"><a href="#_11-使用nosql技术" class="header-anchor">#</a> 11.使用NoSQL技术</h2> <p>Spring Data提供了其他项目来帮助您访问各种NoSQL技术，包括：</p> <ul><li><a href="https://spring.io/projects/spring-data-mongodb" target="_blank" rel="noopener noreferrer">MongoDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/projects/spring-data-neo4j" target="_blank" rel="noopener noreferrer">Neo4J<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/projects/spring-data-elasticsearch" target="_blank" rel="noopener noreferrer">弹性搜索<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/projects/spring-data-solr" target="_blank" rel="noopener noreferrer">索尔<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/projects/spring-data-redis" target="_blank" rel="noopener noreferrer">雷迪斯<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/projects/spring-data-gemfire" target="_blank" rel="noopener noreferrer">GemFire<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或<a href="https://spring.io/projects/spring-data-geode" target="_blank" rel="noopener noreferrer">Geode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/projects/spring-data-cassandra" target="_blank" rel="noopener noreferrer">卡桑德拉<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/projects/spring-data-couchbase" target="_blank" rel="noopener noreferrer">Couchbase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/projects/spring-data-ldap" target="_blank" rel="noopener noreferrer">LDAP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Spring Boot为Redis，MongoDB，Neo4j，Elasticsearch，Solr Cassandra，Couchbase和LDAP提供自动配置。您可以使用其他项目，但必须自己进行配置。请参阅相应的参考文档，位于<a href="https://spring.io/projects/spring-data" target="_blank" rel="noopener noreferrer">spring.io/projects/spring-data<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_11-1。redis"><a href="#_11-1。redis" class="header-anchor">#</a> 11.1。Redis</h3> <p><a href="https://redis.io/" target="_blank" rel="noopener noreferrer">Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个缓存，消息代理和功能丰富的键值存储。Spring Boot为<a href="https://github.com/lettuce-io/lettuce-core/" target="_blank" rel="noopener noreferrer">Lettuce<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/xetorthio/jedis/" target="_blank" rel="noopener noreferrer">Jedis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>客户端库以及<a href="https://github.com/spring-projects/spring-data-redis" target="_blank" rel="noopener noreferrer">Spring Data Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供的最基本的抽象提供了基本的自动配置。</p> <p>有一个<code>spring-boot-starter-data-redis</code>“启动器”可以方便地收集依赖关系。默认情况下，它使用<a href="https://github.com/lettuce-io/lettuce-core/" target="_blank" rel="noopener noreferrer">Lettuce<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。该启动程序可以处理传统应用程序和响应式应用程序。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>我们还提供了一个<code>spring-boot-starter-data-redis-reactive</code>“入门级”软件，可与其他商店保持一致，并提供响应性支持。</p></div> <h4 id="_11-1-1。连接到redis"><a href="#_11-1-1。连接到redis" class="header-anchor">#</a> 11.1.1。连接到Redis</h4> <p>您可以像插入其他任何Spring Bean一样注入自动配置的<code>RedisConnectionFactory</code>，<code>StringRedisTemplate</code>或Vanilla <code>RedisTemplate</code>实例。默认情况下，实例尝试连接到Redis服务器<code>localhost:6379</code>。下面的清单显示了这种Bean的示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> template<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">StringRedisTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您还可以注册任意数量的Bean，以实现<code>LettuceClientConfigurationBuilderCustomizer</code>更高级的自定义。如果您使用Jedis，<code>JedisClientConfigurationBuilderCustomizer</code>也可以使用。</p></div> <p>如果添加自己<code>@Bean</code>的任何一种自动配置类型，它将替换默认类型（除非是<code>RedisTemplate</code>，当排除基于Bean名称<code>redisTemplate</code>而不是其类型时为）。默认情况下，如果<code>commons-pool2</code>在类路径上，则会得到一个池化连接工厂。</p> <h3 id="_11-2。mongodb"><a href="#_11-2。mongodb" class="header-anchor">#</a> 11.2。MongoDB</h3> <p><a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer">MongoDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个开源NoSQL文档数据库，它使用类似JSON的架构而不是传统的基于表的关系数据。Spring Boot为MongoDB的使用提供了许多便利，包括<code>spring-boot-starter-data-mongodb</code>和<code>spring-boot-starter-data-mongodb-reactive</code>Starters。</p> <h4 id="_11-2-1。连接到mongodb数据库"><a href="#_11-2-1。连接到mongodb数据库" class="header-anchor">#</a> 11.2.1。连接到MongoDB数据库</h4> <p>要访问Mongo数据库，您可以注入自动配置的<code>org.springframework.data.mongodb.MongoDbFactory</code>。默认情况下，该实例尝试通过连接到MongoDB服务器<code>mongodb://localhost/test</code>。以下示例显示了如何连接到MongoDB数据库：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb</span><span class="token punctuation">.</span><span class="token class-name">MongoDbFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>mongodb</span><span class="token punctuation">.</span>DB<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MongoDbFactory</span> mongo<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">MongoDbFactory</span> mongo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mongo <span class="token operator">=</span> mongo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DB</span> db <span class="token operator">=</span> mongo<span class="token punctuation">.</span><span class="token function">getDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以设置<code>spring.data.mongodb.uri</code>属性来更改URL并配置其他设置，例如<em>副本集</em>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.mongodb.uri</span><span class="token punctuation">=</span><span class="token attr-value">mongodb://user:secret@mongo1.example.com:12345,mongo2.example.com:23456/test</span>
</code></pre></div><p>另外，只要您使用Mongo 2.x，就可以指定<code>host</code>/ <code>port</code>。例如，您可以在中声明以下设置<code>application.properties</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.mongodb.host</span><span class="token punctuation">=</span><span class="token attr-value">mongoserver</span>
<span class="token attr-name">spring.data.mongodb.port</span><span class="token punctuation">=</span><span class="token attr-value">27017</span>
</code></pre></div><p>如果定义了自己的<code>MongoClient</code>，它将用于自动配置合适的<code>MongoDbFactory</code>。这两个<code>com.mongodb.MongoClient</code>和<code>com.mongodb.client.MongoClient</code>支持。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果使用蒙戈3.0 Java驱动程序，<code>spring.data.mongodb.host</code>并且<code>spring.data.mongodb.port</code>不支持。在这种情况下，<code>spring.data.mongodb.uri</code>应使用它来提供所有配置。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果<code>spring.data.mongodb.port</code>未指定，<code>27017</code>则使用默认值。您可以从前面显示的示例中删除此行。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您不使用Spring Data Mongo，则可以注入<code>com.mongodb.MongoClient</code>bean而不是使用<code>MongoDbFactory</code>。如果要完全控制建立MongoDB连接的方式，则也可以声明自己的<code>MongoDbFactory</code>或<code>MongoClient</code>bean。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您使用反应性驱动程序，则SSL需要Netty。如果可以使用Netty并且尚未自定义要使用的工厂，则自动配置会自动配置该工厂。</p></div> <h4 id="_11-2-2。mongotemplate"><a href="#_11-2-2。mongotemplate" class="header-anchor">#</a> 11.2.2。MongoTemplate</h4> <p><a href="https://spring.io/projects/spring-data-mongodb" target="_blank" rel="noopener noreferrer">Spring Data MongoDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供的<a href="https://docs.spring.io/spring-data/mongodb/docs/2.2.3.RELEASE/api/org/springframework/data/mongodb/core/MongoTemplate.html" target="_blank" rel="noopener noreferrer"><code>MongoTemplate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>类在设计上与Spring的非常相似<code>JdbcTemplate</code>。与一样<code>JdbcTemplate</code>，Spring Boot为您自动配置一个Bean来注入模板，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">MongoTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate <span class="token operator">=</span> mongoTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>有关完整的详细信息，请参见<a href="https://docs.spring.io/spring-data/mongodb/docs/2.2.3.RELEASE/api/org/springframework/data/mongodb/core/MongoOperations.html" target="_blank" rel="noopener noreferrer"><code>MongoOperations</code>Javadoc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="_11-2-3。spring-data-mongodb存储库"><a href="#_11-2-3。spring-data-mongodb存储库" class="header-anchor">#</a> 11.2.3。Spring Data MongoDB存储库</h4> <p>Spring Data包括对MongoDB的存储库支持。与前面讨论的JPA存储库一样，基本原理是根据方法名称自动构造查询。</p> <p>实际上，Spring Data JPA和Spring Data MongoDB共享相同的通用基础架构。您可以从以前的JPA示例开始，并假设它<code>City</code>现在是Mongo数据类而不是JPA <code>@Entity</code>，它的工作方式相同，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">City</span> <span class="token function">findByNameAndStateAllIgnoringCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以使用<code>@EntityScan</code>注释来自定义文档扫描位置。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关Spring Data MongoDB的完整详细信息，包括其丰富的对象映射技术，请参阅其<a href="https://spring.io/projects/spring-data-mongodb" target="_blank" rel="noopener noreferrer">参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_11-2-4。嵌入式mongo"><a href="#_11-2-4。嵌入式mongo" class="header-anchor">#</a> 11.2.4。嵌入式Mongo</h4> <p>Spring Boot为<a href="https://github.com/flapdoodle-oss/de.flapdoodle.embed.mongo" target="_blank" rel="noopener noreferrer">Embedded Mongo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供自动配置。要在您的Spring Boot应用程序中使用它，请添加对的依赖<code>de.flapdoodle.embed:de.flapdoodle.embed.mongo</code>。</p> <p>可以通过设置<code>spring.data.mongodb.port</code>属性来配置Mongo侦听的端口。要使用随机分配的空闲端口，请使用值0。created <code>MongoClient</code>by <code>MongoAutoConfiguration</code>被自动配置为使用随机分配的端口。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果未配置自定义端口，则默认情况下，嵌入式支持会使用随机端口（而不是27017）。</p></div> <p>如果类路径上有SLF4J，则Mongo产生的输出将自动路由到名为的记录器<code>org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongo</code>。</p> <p>您可以声明自己的bean <code>IMongodConfig</code>和<code>IRuntimeConfig</code>bean来控制Mongo实例的配置和日志记录路由。可以通过声明<code>DownloadConfigBuilderCustomizer</code>bean 来定制下载配置。</p> <h3 id="_11-3。neo4j"><a href="#_11-3。neo4j" class="header-anchor">#</a> 11.3。Neo4j</h3> <p><a href="https://neo4j.com/" target="_blank" rel="noopener noreferrer">Neo4j<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个开源NoSQL图形数据库，它使用通过一级关系连接的节点的丰富数据模型，与传统的RDBMS方法相比，它更适合于连接的大数据。Spring Boot为Neo4j的使用提供了许多便利，包括<code>spring-boot-starter-data-neo4j</code>“ Starter”。</p> <h4 id="_11-3-1。连接到neo4j数据库"><a href="#_11-3-1。连接到neo4j数据库" class="header-anchor">#</a> 11.3.1。连接到Neo4j数据库</h4> <p>要访问Neo4j服务器，您可以注入自动配置的<code>org.neo4j.ogm.session.Session</code>。默认情况下，实例尝试<code>localhost:7687</code>使用Bolt协议连接到Neo4j服务器。以下示例显示如何注入Neo4j <code>Session</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Session</span> session<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">Session</span> session<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>session <span class="token operator">=</span> session<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以通过设置<code>spring.data.neo4j.*</code>属性来配置要使用的uri和凭据，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.neo4j.uri</span><span class="token punctuation">=</span><span class="token attr-value">bolt://my-server:7687</span>
<span class="token attr-name">spring.data.neo4j.username</span><span class="token punctuation">=</span><span class="token attr-value">neo4j</span>
<span class="token attr-name">spring.data.neo4j.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>您可以通过添加<code>org.neo4j.ogm.config.Configuration</code>bean或<code>org.neo4j.ogm.session.SessionFactory</code>bean 来完全控制会话的创建。</p> <h4 id="_11-3-2。使用嵌入式模式"><a href="#_11-3-2。使用嵌入式模式" class="header-anchor">#</a> 11.3.2。使用嵌入式模式</h4> <p>如果添加<code>org.neo4j:neo4j-ogm-embedded-driver</code>到应用程序的依赖项，Spring Boot会自动配置Neo4j的进程内嵌入式实例，该实例在应用程序关闭时不会保留任何数据。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由于嵌入式Neo4j OGM驱动程序本身不提供Neo4j内核，因此您必须自己声明<code>org.neo4j:neo4j</code>为依赖项。有关兼容版本的列表，请参阅<a href="https://neo4j.com/docs/ogm-manual/current/reference/#reference:getting-started" target="_blank" rel="noopener noreferrer">Neo4j OGM文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>当类路径上有多个驱动程序时，嵌入式驱动程序优先于其他驱动程序。您可以通过设置显式禁用嵌入式模式<code>spring.data.neo4j.embedded.enabled=false</code>。</p> <p>如果嵌入式驱动程序和Neo4j内核位于上述类路径上，则<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-neo4j-test" target="_blank" rel="noopener noreferrer">数据Neo4j测试会<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>自动使用嵌入式Neo4j实例。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以通过在配置中提供数据库文件的路径来启用嵌入式模式的持久性<code>spring.data.neo4j.uri=file://var/tmp/graph.db</code>。</p></div> <h4 id="_11-3-3。使用本机类型"><a href="#_11-3-3。使用本机类型" class="header-anchor">#</a> 11.3.3。使用本机类型</h4> <p>Neo4j-OGM可以将某些类型（例如中的类型）映射<code>java.time.*</code>到<code>String</code>基于属性或Neo4j提供的本机类型之一。出于向后兼容的原因，Neo4j-OGM的默认设置是使用<code>String</code>基于-的表示形式。要使用本机类型，请在<code>org.neo4j:neo4j-ogm-bolt-native-types</code>或上添加依赖项<code>org.neo4j:neo4j-ogm-embedded-native-types</code>，并配置<code>spring.data.neo4j.use-native-types</code>属性，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.neo4j.use-native-types</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><h4 id="_11-3-4。neo4jsession"><a href="#_11-3-4。neo4jsession" class="header-anchor">#</a> 11.3.4。Neo4jSession</h4> <p>默认情况下，如果您正在运行Web应用程序，则会话将绑定到线程以进行请求的整个处理（即，它使用“在视图中打开会话”模式）。如果您不希望出现这种情况，请将以下行添加到您的<code>application.properties</code>文件中：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.neo4j.open-in-view</span><span class="token punctuation">=</span><span class="token attr-value">false</span>
</code></pre></div><h4 id="_11-3-5。spring-data-neo4j存储库"><a href="#_11-3-5。spring-data-neo4j存储库" class="header-anchor">#</a> 11.3.5。Spring Data Neo4j存储库</h4> <p>Spring Data包括对Neo4j的存储库支持。</p> <p>Spring Data Neo4j与许多其他Spring Data模块一样，与Spring Data JPA共享公共基础结构。您可以使用以前的JPA示例，并将其定义<code>City</code>为Neo4j OGM <code>@NodeEntity</code>而不是JPA <code>@Entity</code>，并且存储库抽象以相同的方式工作，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>myapp<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Optional</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>neo4j<span class="token punctuation">.</span>repository</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CityRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Neo4jRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">City</span><span class="token punctuation">&gt;</span></span> <span class="token function">findOneByNameAndState</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在<code>spring-boot-starter-data-neo4j</code>“入门”使仓库的支持以及事务管理。您可以通过在-bean 上分别使用<code>@EnableNeo4jRepositories</code>和来定制位置以查找存储库和实体。<code>@EntityScan``@Configuration</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关Spring Data Neo4j的完整详细信息，包括其对象映射技术，请参阅<a href="https://docs.spring.io/spring-data/neo4j/docs/5.2.3.RELEASE/reference/html/" target="_blank" rel="noopener noreferrer">参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_11-4。索尔"><a href="#_11-4。索尔" class="header-anchor">#</a> 11.4。索尔</h3> <p><a href="https://lucene.apache.org/solr/" target="_blank" rel="noopener noreferrer">Apache Solr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个搜索引擎。Spring Boot为Solr 5客户端库提供了基本的自动配置，并由<a href="https://github.com/spring-projects/spring-data-solr" target="_blank" rel="noopener noreferrer">Spring Data Solr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在其之上提供了抽象。有一个<code>spring-boot-starter-data-solr</code>“启动器”可以方便地收集依赖关系。</p> <h4 id="_11-4-1。连接到solr"><a href="#_11-4-1。连接到solr" class="header-anchor">#</a> 11.4.1。连接到Solr</h4> <p>您可以像插入<code>SolrClient</code>其他任何Spring Bean一样注入自动配置的实例。默认情况下，该实例尝试连接到的服务器<code>localhost:8983/solr</code>。以下示例显示如何注入Solr bean：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">SolrClient</span> solr<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">SolrClient</span> solr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>solr <span class="token operator">=</span> solr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果添加自己<code>@Bean</code>的type <code>SolrClient</code>，它将替换默认值。</p> <h4 id="_11-4-2。spring-data-solr存储库"><a href="#_11-4-2。spring-data-solr存储库" class="header-anchor">#</a> 11.4.2。Spring Data Solr存储库</h4> <p>Spring Data包括对Apache Solr的存储库支持。与前面讨论的JPA存储库一样，基本原理是根据方法名称自动为您构建查询。</p> <p>实际上，Spring Data JPA和Spring Data Solr共享相同的通用基础结构。您可以从以前的JPA示例开始，假设<code>City</code>现在是一个<code>@SolrDocument</code>类，而不是JPA <code>@Entity</code>，它的工作方式相同。</p> <p>IP：有关Spring Data Solr的完整详细信息，请参阅<a href="https://docs.spring.io/spring-data/solr/docs/4.1.3.RELEASE/reference/html/" target="_blank" rel="noopener noreferrer">参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_11-5。弹性搜索"><a href="#_11-5。弹性搜索" class="header-anchor">#</a> 11.5。弹性搜索</h3> <p><a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个开源，分布式，RESTful搜索和分析引擎。Spring Boot为Elasticsearch提供了基本的自动配置。</p> <p>Spring Boot支持多个客户端：</p> <ul><li>官方Java“低级”和“高级” REST客户端</li> <li>在<code>ReactiveElasticsearchClient</code>由Spring数据Elasticsearch提供</li></ul> <p>传输客户端仍然可用，但是<a href="https://github.com/spring-projects/spring-data-elasticsearch" target="_blank" rel="noopener noreferrer">Spring Data Elasticsearch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和Elasticsearch本身已弃用了它的支持。它将在将来的版本中删除。Spring Boot提供了专用的“入门” <code>spring-boot-starter-data-elasticsearch</code>。</p> <p>由于Elasticsearch和Spring Data Elasticsearch为REST客户端提供了官方支持，因此<a href="https://github.com/searchbox-io/Jest" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>客户端也已被弃用。</p> <h4 id="_11-5-1。使用rest客户端连接到elasticsearch"><a href="#_11-5-1。使用rest客户端连接到elasticsearch" class="header-anchor">#</a> 11.5.1。使用REST客户端连接到Elasticsearch</h4> <p>Elasticsearch附带了<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html" target="_blank" rel="noopener noreferrer">两个<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可用于查询集群的<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html" target="_blank" rel="noopener noreferrer">REST客户端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：“低级”客户端和“高级”客户端。</p> <p>如果您<code>org.elasticsearch.client:elasticsearch-rest-client</code>对类路径有依赖性，Spring Boot将自动配置并注册一个<code>RestClient</code>默认为target 的bean <code>localhost:9200</code>。您可以进一步调整<code>RestClient</code>配置方式，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.elasticsearch.rest.uris</span><span class="token punctuation">=</span><span class="token attr-value">https://search.example.com:9200</span>
<span class="token attr-name">spring.elasticsearch.rest.read-timeout</span><span class="token punctuation">=</span><span class="token attr-value">10s</span>
<span class="token attr-name">spring.elasticsearch.rest.username</span><span class="token punctuation">=</span><span class="token attr-value">user</span>
<span class="token attr-name">spring.elasticsearch.rest.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>您还可以注册任意数量的Bean，以实现<code>RestClientBuilderCustomizer</code>更高级的自定义。要完全控制注册，请定义一个<code>RestClient</code>bean。</p> <p>如果您<code>org.elasticsearch.client:elasticsearch-rest-high-level-client</code>对类路径有依赖性，Spring Boot将自动配置一个<code>RestHighLevelClient</code>，包装现有的<code>RestClient</code>bean，重新使用其HTTP配置。</p> <h4 id="_11-5-2。使用反应式rest客户端连接到elasticsearch"><a href="#_11-5-2。使用反应式rest客户端连接到elasticsearch" class="header-anchor">#</a> 11.5.2。使用反应式REST客户端连接到Elasticsearch</h4> <p><a href="https://spring.io/projects/spring-data-elasticsearch" target="_blank" rel="noopener noreferrer">春季数据Elasticsearch<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>船舶<code>ReactiveElasticsearchClient</code>在反应方式查询Elasticsearch实例。它建立在WebFlux的基础上<code>WebClient</code>，因此<code>spring-boot-starter-elasticsearch</code>和<code>spring-boot-starter-webflux</code>依赖项对于启用此支持都是有用的。</p> <p>默认情况下，Spring Boot将自动配置并注册一个<code>ReactiveElasticsearchClient</code> target 的bean <code>localhost:9200</code>。您可以进一步调整其配置，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.elasticsearch.client.reactive.endpoints</span><span class="token punctuation">=</span><span class="token attr-value">search.example.com:9200</span>
<span class="token attr-name">spring.data.elasticsearch.client.reactive.use-ssl</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.data.elasticsearch.client.reactive.socket-timeout</span><span class="token punctuation">=</span><span class="token attr-value">10s</span>
<span class="token attr-name">spring.data.elasticsearch.client.reactive.username</span><span class="token punctuation">=</span><span class="token attr-value">user</span>
<span class="token attr-name">spring.data.elasticsearch.client.reactive.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>如果配置属性不够，并且您想完全控制客户端配置，则可以注册一个自定义<code>ClientConfiguration</code>bean。</p> <h4 id="_11-5-3。使用jest连接到elasticsearch"><a href="#_11-5-3。使用jest连接到elasticsearch" class="header-anchor">#</a> 11.5.3。使用Jest连接到Elasticsearch</h4> <p>现在，Spring Boot支持官方<code>RestHighLevelClient</code>支持，不推荐使用Jest支持。</p> <p>如果您<code>Jest</code>在类路径上，则可以注入<code>JestClient</code>默认情况下目标为的自动配置<code>localhost:9200</code>。您可以进一步调整客户端的配置方式，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.elasticsearch.jest.uris</span><span class="token punctuation">=</span><span class="token attr-value">https://search.example.com:9200</span>
<span class="token attr-name">spring.elasticsearch.jest.read-timeout</span><span class="token punctuation">=</span><span class="token attr-value">10000</span>
<span class="token attr-name">spring.elasticsearch.jest.username</span><span class="token punctuation">=</span><span class="token attr-value">user</span>
<span class="token attr-name">spring.elasticsearch.jest.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>您还可以注册任意数量的Bean，以实现<code>HttpClientConfigBuilderCustomizer</code>更高级的自定义。以下示例调整其他HTTP设置：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">HttpSettingsCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">HttpClientConfigBuilderCustomizer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">HttpClientConfig</span><span class="token punctuation">.</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">maxTotalConnection</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultMaxTotalConnectionPerRoute</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>要完全控制注册，请定义一个<code>JestClient</code>bean。</p> <h4 id="_11-5-4。使用spring数据连接到elasticsearch"><a href="#_11-5-4。使用spring数据连接到elasticsearch" class="header-anchor">#</a> 11.5.4。使用Spring数据连接到Elasticsearch</h4> <p>要连接到Elasticsearch，<code>RestHighLevelClient</code>必须定义一个bean，它由Spring Boot自动配置或由应用程序手动提供（请参阅前面的部分）。有了此配置后，<code>ElasticsearchRestTemplate</code>可以像其他任何Spring bean一样注入an ，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ElasticsearchRestTemplate</span> template<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">ElasticsearchRestTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在存在<code>spring-data-elasticsearch</code>和使用<code>WebClient</code>（通常为<code>spring-boot-starter-webflux</code>）所需的依赖项的情况下，Spring Boot还可以自动配置<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-connecting-to-elasticsearch-reactive-rest" target="_blank" rel="noopener noreferrer">ReactiveElasticsearchClient<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<code>ReactiveElasticsearchTemplate</code>as as Bean。它们与其他REST客户端是等效的。</p> <h4 id="_11-5-5。spring-data-elasticsearch存储库"><a href="#_11-5-5。spring-data-elasticsearch存储库" class="header-anchor">#</a> 11.5.5。Spring Data Elasticsearch存储库</h4> <p>Spring Data包括对Elasticsearch的存储库支持。与前面讨论的JPA存储库一样，基本原理是根据方法名称自动为您构造查询。</p> <p>实际上，Spring Data JPA和Spring Data Elasticsearch共享相同的通用基础架构。您可以从以前的JPA示例开始，假设<code>City</code>现在是Elasticsearch <code>@Document</code>类而不是JPA <code>@Entity</code>，它的工作方式相同。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关Spring Data Elasticsearch的完整详细信息，请<a href="https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/" target="_blank" rel="noopener noreferrer">参考参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>Spring Boot使用<code>ElasticsearchRestTemplate</code>或<code>ReactiveElasticsearchTemplate</code>bean 支持经典和反应式Elasticsearch存储库。给定所需的依赖项，最有可能由Spring Boot自动配置这些bean。</p> <p>如果您希望使用自己的模板来支持Elasticsearch存储库，则可以添加自己的<code>ElasticsearchRestTemplate</code>或<code>ElasticsearchOperations</code> <code>@Bean</code>（只要命名为）<code>&quot;elasticsearchTemplate&quot;</code>。同样适用于<code>ReactiveElasticsearchTemplate</code>和<code>ReactiveElasticsearchOperations</code>，并带有Bean名称<code>&quot;reactiveElasticsearchTemplate&quot;</code>。</p> <p>您可以选择使用以下属性禁用存储库支持：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.elasticsearch.repositories.enabled</span><span class="token punctuation">=</span><span class="token attr-value">false</span>
</code></pre></div><h3 id="_11-6。卡桑德拉"><a href="#_11-6。卡桑德拉" class="header-anchor">#</a> 11.6。卡桑德拉</h3> <p><a href="https://cassandra.apache.org/" target="_blank" rel="noopener noreferrer">Cassandra<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个开放源代码的分布式数据库管理系统，旨在处理许多商用服务器上的大量数据。Spring Boot为Cassandra提供自动配置，并由<a href="https://github.com/spring-projects/spring-data-cassandra" target="_blank" rel="noopener noreferrer">Spring Data Cassandra<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在其之上提供抽象。有一个<code>spring-boot-starter-data-cassandra</code>“启动器”可以方便地收集依赖关系。</p> <h4 id="_11-6-1。连接到cassandra"><a href="#_11-6-1。连接到cassandra" class="header-anchor">#</a> 11.6.1。连接到Cassandra</h4> <p>您可以像使用其他任何Spring Bean一样注入自动配置<code>CassandraTemplate</code>的<code>Session</code>实例或Cassandra 实例。这些<code>spring.data.cassandra.*</code>属性可用于自定义连接。通常，您提供<code>keyspace-name</code>和<code>contact-points</code>属性，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.data.cassandra.keyspace-name</span><span class="token punctuation">=</span><span class="token attr-value">mykeyspace</span>
<span class="token attr-name">spring.data.cassandra.contact-points</span><span class="token punctuation">=</span><span class="token attr-value">cassandrahost1,cassandrahost2</span>
</code></pre></div><p>您还可以注册任意数量的Bean，以实现<code>ClusterBuilderCustomizer</code>更高级的自定义。</p> <p>以下代码清单显示了如何注入Cassandra bean：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">CassandraTemplate</span> template<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">CassandraTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果添加自己<code>@Bean</code>的type <code>CassandraTemplate</code>，它将替换默认值。</p> <h4 id="_11-6-2。spring-data-cassandra存储库"><a href="#_11-6-2。spring-data-cassandra存储库" class="header-anchor">#</a> 11.6.2。Spring Data Cassandra存储库</h4> <p>Spring Data包括对Cassandra的基本存储库支持。当前，此功能比前面讨论的JPA存储库更受限制，需要使用来注释finder方法<code>@Query</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关Spring Data Cassandra的完整详细信息，请<a href="https://docs.spring.io/spring-data/cassandra/docs/" target="_blank" rel="noopener noreferrer">参考参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_11-7。couchbase"><a href="#_11-7。couchbase" class="header-anchor">#</a> 11.7。Couchbase</h3> <p><a href="https://www.couchbase.com/" target="_blank" rel="noopener noreferrer">Couchbase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个开放源代码，分布式，多模型的NoSQL面向文档的数据库，已针对交互式应用程序进行了优化。Spring Boot为Couchbase提供自动配置，并由<a href="https://github.com/spring-projects/spring-data-couchbase" target="_blank" rel="noopener noreferrer">Spring Data Couchbase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在其之上提供抽象。有<code>spring-boot-starter-data-couchbase</code>和<code>spring-boot-starter-data-couchbase-reactive</code>“启动器”在一个方便的方法收集的依赖关系。</p> <h4 id="_11-7-1。连接到couchbase"><a href="#_11-7-1。连接到couchbase" class="header-anchor">#</a> 11.7.1。连接到Couchbase</h4> <p>您可以通过添加Couchbase SDK和一些配置来获得<code>Bucket</code>和<code>Cluster</code>。这些<code>spring.couchbase.*</code>属性可用于自定义连接。通常，您提供引导主机，存储桶名称和密码，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.couchbase.bootstrap-hosts</span><span class="token punctuation">=</span><span class="token attr-value">my-host-1,192.168.1.123</span>
<span class="token attr-name">spring.couchbase.bucket.name</span><span class="token punctuation">=</span><span class="token attr-value">my-bucket</span>
<span class="token attr-name">spring.couchbase.bucket.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您<em>至少</em>需要提供引导主机，在这种情况下，存储桶名称为<code>default</code>，密码为空字符串。另外，您可以定义自己的<code>org.springframework.data.couchbase.config.CouchbaseConfigurer</code> <code>@Bean</code>方式来控制整个配置。</p></div> <p>也可以自定义某些<code>CouchbaseEnvironment</code>设置。例如，以下配置更改了用于打开新<code>Bucket</code>邮件并启用SSL支持的超时：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.couchbase.env.timeouts.connect</span><span class="token punctuation">=</span><span class="token attr-value">3000</span>
<span class="token attr-name">spring.couchbase.env.ssl.key-store</span><span class="token punctuation">=</span><span class="token attr-value">/location/of/keystore.jks</span>
<span class="token attr-name">spring.couchbase.env.ssl.key-store-password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>检查<code>spring.couchbase.env.*</code>属性以获取更多详细信息。</p> <h4 id="_11-7-2。spring-data-couchbase存储库"><a href="#_11-7-2。spring-data-couchbase存储库" class="header-anchor">#</a> 11.7.2。Spring Data Couchbase存储库</h4> <p>Spring Data包括对Couchbase的存储库支持。有关Spring Data Couchbase的完整详细信息，请<a href="https://docs.spring.io/spring-data/couchbase/docs/current/reference/html/" target="_blank" rel="noopener noreferrer">参考参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>您可以<code>CouchbaseTemplate</code>像使用任何其他Spring Bean一样注入自动配置的实例，前提是可以使用<em>默认值</em> <code>CouchbaseConfigurer</code>（如前所述，启用Couchbase支持时会发生这种情况）。</p> <p>以下示例显示了如何注入Couchbase bean：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CouchbaseTemplate</span> template<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">CouchbaseTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以在自己的配置中定义一些Bean，以覆盖自动配置提供的那些：</p> <ul><li>一个<code>CouchbaseTemplate</code> <code>@Bean</code>用的名称<code>couchbaseTemplate</code>。</li> <li>一个<code>IndexManager</code> <code>@Bean</code>用的名称<code>couchbaseIndexManager</code>。</li> <li>一个<code>CustomConversions</code> <code>@Bean</code>用的名称<code>couchbaseCustomConversions</code>。</li></ul> <p>为了避免在您自己的配置中对这些名称进行硬编码，您可以重复使用<code>BeanNames</code>Spring Data Couchbase提供的名称。例如，您可以自定义要使用的转换器，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token class-name">BeanNames</span><span class="token punctuation">.</span>COUCHBASE_CUSTOM_CONVERSIONS<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CustomConversions</span> <span class="token function">myCustomConversions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomConversions</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您想完全绕过Spring Data Couchbase的自动配置，请提供您自己的实现<code>org.springframework.data.couchbase.config.AbstractCouchbaseDataConfiguration</code>。</p></div> <h3 id="_11-8。ldap"><a href="#_11-8。ldap" class="header-anchor">#</a> 11.8。LDAP</h3> <p><a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol" target="_blank" rel="noopener noreferrer">LDAP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（轻型目录访问协议）是一种开放的，与供应商无关的行业标准应用协议，用于通过IP网络访问和维护分布式目录信息服务。Spring Boot为任何兼容的LDAP服务器提供自动配置，并从<a href="https://www.ldap.com/unboundid-ldap-sdk-for-java" target="_blank" rel="noopener noreferrer">UnboundID<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>支持嵌入式内存LDAP服务器。</p> <p>LDAP抽象由<a href="https://github.com/spring-projects/spring-data-ldap" target="_blank" rel="noopener noreferrer">Spring Data LDAP提供<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。有一个<code>spring-boot-starter-data-ldap</code>“启动器”可以方便地收集依赖关系。</p> <h4 id="_11-8-1。连接到ldap服务器"><a href="#_11-8-1。连接到ldap服务器" class="header-anchor">#</a> 11.8.1。连接到LDAP服务器</h4> <p>要连接到LDAP服务器，请确保声明对<code>spring-boot-starter-data-ldap</code>“启动器” 的依赖<code>spring-ldap-core</code>，然后在application.properties中声明服务器的URL，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.ldap.urls</span><span class="token punctuation">=</span><span class="token attr-value">ldap://myserver:1235</span>
<span class="token attr-name">spring.ldap.username</span><span class="token punctuation">=</span><span class="token attr-value">admin</span>
<span class="token attr-name">spring.ldap.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>如果需要自定义连接设置，可以使用<code>spring.ldap.base</code>和<code>spring.ldap.base-environment</code>属性。</p> <p>将<code>LdapContextSource</code>根据这些设置自动配置。如果您需要对其进行自定义（例如使用）<code>PooledContextSource</code>，则仍可以注入自动配置<code>LdapContextSource</code>。确保将您的定制标记<code>ContextSource</code>为，<code>@Primary</code>以便自动配置<code>LdapTemplate</code>使用它。</p> <h4 id="_11-8-2。spring-data-ldap存储库"><a href="#_11-8-2。spring-data-ldap存储库" class="header-anchor">#</a> 11.8.2。Spring Data LDAP存储库</h4> <p>Spring Data包括对LDAP的存储库支持。有关Spring Data LDAP的完整详细信息，请<a href="https://docs.spring.io/spring-data/ldap/docs/1.0.x/reference/html/" target="_blank" rel="noopener noreferrer">参考参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>您还可以<code>LdapTemplate</code>像使用其他任何Spring Bean一样注入自动配置的实例，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LdapTemplate</span> template<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">LdapTemplate</span> template<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_11-8-3。嵌入式内存ldap服务器"><a href="#_11-8-3。嵌入式内存ldap服务器" class="header-anchor">#</a> 11.8.3。嵌入式内存LDAP服务器</h4> <p>出于测试目的，Spring Boot支持从<a href="https://www.ldap.com/unboundid-ldap-sdk-for-java" target="_blank" rel="noopener noreferrer">UnboundID<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>自动配置内存中的LDAP服务器。要配置服务器，请向其添加依赖项<code>com.unboundid:unboundid-ldapsdk</code>并声明一个<code>spring.ldap.embedded.base-dn</code>属性，如下所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.ldap.embedded.base-dn</span><span class="token punctuation">=</span><span class="token attr-value">dc=spring,dc=io</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>可以定义多个base-dn值，但是，由于可分辨的名称通常包含逗号，因此必须使用正确的符号来定义它们。在yaml文件中，您可以使用yaml列表符号：<code>spring.ldap.embedded.base-dn: - dc=spring,dc=io - dc=pivotal,dc=io</code>在属性文件中，必须将索引包括在属性名称中：<code>spring.ldap.embedded.base-dn[0]=dc=spring,dc=io spring.ldap.embedded.base-dn[1]=dc=pivotal,dc=io</code></p></div> <p>默认情况下，服务器在随机端口上启动并触发常规LDAP支持。无需指定<code>spring.ldap.urls</code>属性。</p> <p>如果<code>schema.ldif</code>您的类路径中有一个文件，它将用于初始化服务器。如果要从其他资源加载初始化脚本，则也可以使用该<code>spring.ldap.embedded.ldif</code>属性。</p> <p>默认情况下，使用标准架构来验证<code>LDIF</code>文件。您可以通过设置<code>spring.ldap.embedded.validation.enabled</code>属性来完全关闭验证。如果您具有定制属性，则可以<code>spring.ldap.embedded.validation.schema</code>用来定义定制属性类型或对象类。</p> <h3 id="_11-9。influxdb"><a href="#_11-9。influxdb" class="header-anchor">#</a> 11.9。InfluxDB</h3> <p><a href="https://www.influxdata.com/" target="_blank" rel="noopener noreferrer">InfluxDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个开放源代码的时间序列数据库，已优化用于在操作监视，应用程序度量，物联网传感器数据和实时分析等领域中快速，高可用性地存储和检索时间序列数据。</p> <h4 id="_11-9-1。连接到influxdb"><a href="#_11-9-1。连接到influxdb" class="header-anchor">#</a> 11.9.1。连接到InfluxDB</h4> <p><code>InfluxDB</code>如果<code>influxdb-java</code>客户端位于类路径上并且设置了数据库的URL，Spring Boot会自动配置一个实例，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.influx.url</span><span class="token punctuation">=</span><span class="token attr-value">https://172.0.0.1:8086</span>
</code></pre></div><p>如果与InfluxDB的连接需要用户和密码，则可以相应地设置<code>spring.influx.user</code>和<code>spring.influx.password</code>属性。</p> <p>InfluxDB依赖OkHttp。如果需要在<code>InfluxDB</code>后台调整http客户端的使用，则可以注册一个<code>InfluxDbOkHttpClientBuilderProvider</code>bean。</p> <h2 id="_12-缓存"><a href="#_12-缓存" class="header-anchor">#</a> 12.缓存</h2> <p>Spring框架提供了对向应用程序透明添加缓存的支持。从本质上讲，抽象将缓存应用于方法，从而根据缓存中可用的信息减少执行次数。缓存逻辑是透明应用的，不会对调用者造成任何干扰。只要通过<code>@EnableCaching</code>注释启用了缓存支持，Spring Boot就会自动配置缓存基础结构。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>检查Spring Framework参考的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/integration.html#cache" target="_blank" rel="noopener noreferrer">相关部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多详细信息。</p></div> <p>简而言之，将缓存添加到服务的操作就像将相关注释添加到其方法一样容易，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Cacheable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span><span class="token string">&quot;piDecimals&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">computePiDecimal</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>本示例说明了在潜在的昂贵操作上使用缓存的方法。在调用之前<code>computePiDecimal</code>，抽象将在<code>piDecimals</code>高速缓存中寻找与<code>i</code>参数匹配的条目。如果找到条目，则高速缓存中的内容会立即返回给调用方，并且不会调用该方法。否则，将调用该方法，并在返回值之前更新缓存。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您还可以<code>@CacheResult</code>透明地使用标准JSR-107（JCache）批注（例如）。但是，我们强烈建议您不要混合使用Spring Cache和JCache批注。</p></div> <p>如果您不添加任何特定的缓存库，Spring Boot会自动配置一个使用内存中并发映射的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-simple" target="_blank" rel="noopener noreferrer">简单提供程序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。当需要缓存时（例如<code>piDecimals</code>前面的示例），此提供程序将为您创建它。实际上，不建议将简单的提供程序用于生产用途，但是它对于入门并确保您了解功能非常有用。确定要使用的缓存提供程序后，请确保阅读其文档，以了解如何配置应用程序使用的缓存。几乎所有提供程序都要求您显式配置在应用程序中使用的每个缓存。有些提供了一种自定义<code>spring.cache.cache-names</code>属性定义的默认缓存的方法。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>还可以透明地<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/integration.html#cache-annotations-put" target="_blank" rel="noopener noreferrer">更新<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或从缓存中<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/integration.html#cache-annotations-evict" target="_blank" rel="noopener noreferrer">逐出<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>数据。</p></div> <h3 id="_12-1。支持的缓存提供程序"><a href="#_12-1。支持的缓存提供程序" class="header-anchor">#</a> 12.1。支持的缓存提供程序</h3> <p>缓存抽象不提供实际的存储，而是依赖于<code>org.springframework.cache.Cache</code>和<code>org.springframework.cache.CacheManager</code>接口实现的抽象。</p> <p>如果尚未定义类型<code>CacheManager</code>或<code>CacheResolver</code>名称的bean <code>cacheResolver</code>（请参阅参考资料<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html" target="_blank" rel="noopener noreferrer"><code>CachingConfigurer</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），Spring Boot会尝试检测以下提供程序（按指示的顺序）：</p> <ol><li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-generic" target="_blank" rel="noopener noreferrer">泛型<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-jcache" target="_blank" rel="noopener noreferrer">JCache（JSR-107）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（EhCache 3，Hazelcast，Infinispan等）</li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-ehcache2" target="_blank" rel="noopener noreferrer">EhCache 2.x<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-hazelcast" target="_blank" rel="noopener noreferrer">淡褐色<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-infinispan" target="_blank" rel="noopener noreferrer">Infinispan<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-couchbase" target="_blank" rel="noopener noreferrer">Couchbase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-redis" target="_blank" rel="noopener noreferrer">雷迪斯<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-caffeine" target="_blank" rel="noopener noreferrer">咖啡因<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-simple" target="_blank" rel="noopener noreferrer">简单<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>也可以通过设置属性来<em>强制</em>特定的缓存提供程序<code>spring.cache.type</code>。如果您需要在某些环境（例如测试）中<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-none" target="_blank" rel="noopener noreferrer">完全禁用缓存，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>请使用此属性。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>使用<code>spring-boot-starter-cache</code>“入门”快速添加基本的缓存依赖项。起动器带进来<code>spring-context-support</code>。如果手动添加依赖项，则必须包括<code>spring-context-support</code>才能使用JCache，EhCache 2.x或Caffeine支持。</p></div> <p>如果<code>CacheManager</code>Spring Boot自动配置了，您可以通过公开实现该<code>CacheManagerCustomizer</code>接口的bean，在完全初始化之前进一步调整其配置。下面的示例设置一个标志，指示<code>null</code>应将值向下传递到基础映射：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CacheManagerCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConcurrentMapCacheManager</span><span class="token punctuation">&gt;</span></span> <span class="token function">cacheManagerCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CacheManagerCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConcurrentMapCacheManager</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">ConcurrentMapCacheManager</span> cacheManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cacheManager<span class="token punctuation">.</span><span class="token function">setAllowNullValues</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在前面的示例中，需要进行自动配置<code>ConcurrentMapCacheManager</code>。如果不是这种情况（您提供了自己的配置，或者自动配置了其他缓存提供程序），则根本不会调用定制程序。您可以根据需要拥有任意数量的定制程序，也可以使用<code>@Order</code>或对其进行排序<code>Ordered</code>。</p></div> <h4 id="_12-1-1。泛型"><a href="#_12-1-1。泛型" class="header-anchor">#</a> 12.1.1。泛型</h4> <p>如果上下文定义<em>了至少</em>一个<code>org.springframework.cache.Cache</code>bean，则使用通用缓存。将<code>CacheManager</code>包装所有该类型的bean。</p> <h4 id="_12-1-2。jcache（jsr-107）"><a href="#_12-1-2。jcache（jsr-107）" class="header-anchor">#</a> 12.1.2。JCache（JSR-107）</h4> <p><a href="https://jcp.org/en/jsr/detail?id=107" target="_blank" rel="noopener noreferrer">JCache<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>通过<code>javax.cache.spi.CachingProvider</code>类路径上的存在进行引导（即，类路径上存在符合JSR-107的缓存库），并且<code>JCacheCacheManager</code>由<code>spring-boot-starter-cache</code>“启动器”提供。提供了各种兼容的库，Spring Boot为Ehcache 3，Hazelcast和Infinispan提供了依赖管理。也可以添加任何其他兼容的库。</p> <p>可能会出现多个提供者，在这种情况下，必须明确指定提供者。即使JSR-107标准没有强制采用标准化的方式来定义配置文件的位置，Spring Boot也会尽其所能以设置带有实现细节的缓存，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># Only necessary if more than one provider is present</span>
<span class="token attr-name">spring.cache.jcache.provider</span><span class="token punctuation">=</span><span class="token attr-value">com.acme.MyCachingProvider</span>
<span class="token attr-name">spring.cache.jcache.config</span><span class="token punctuation">=</span><span class="token attr-value">classpath:acme.xml</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当缓存库同时提供本机实现和JSR-107支持时，Spring Boot会首选JSR-107支持，因此，如果您切换到其他JSR-107实现，则可以使用相同的功能。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-hazelcast" target="_blank" rel="noopener noreferrer">对Hazelcast<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>具有<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-hazelcast" target="_blank" rel="noopener noreferrer">常规支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果单个<code>HazelcastInstance</code>可用，则<code>CacheManager</code>除非<code>spring.cache.jcache.config</code>指定了该属性，否则它也会自动重用于。</p></div> <p>有两种方法可以自定义基础<code>javax.cache.cacheManager</code>：</p> <ul><li>可以在启动时通过设置<code>spring.cache.cache-names</code>属性来创建缓存。如果定义了定制<code>javax.cache.configuration.Configuration</code>bean，则将其用于定制它们。</li> <li><code>org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer</code>使用的引用调用bean <code>CacheManager</code>进行完全定制。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果<code>javax.cache.CacheManager</code>定义了标准bean，它将自动包装在<code>org.springframework.cache.CacheManager</code>抽象期望的实现中。不再对其应用定制。</p></div> <h4 id="_12-1-3。ehcache-2-x"><a href="#_12-1-3。ehcache-2-x" class="header-anchor">#</a> 12.1.3。EhCache 2.x</h4> <p>如果<code>ehcache.xml</code>可以在类路径的根目录找到名为的文件，则使用<a href="https://www.ehcache.org/" target="_blank" rel="noopener noreferrer">EhCache2.x<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果找到EhCache 2.x，则使用“启动器” <code>EhCacheCacheManager</code>提供的<code>spring-boot-starter-cache</code>启动程序来引导缓存管理器。也可以提供备用配置文件，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cache.ehcache.config</span><span class="token punctuation">=</span><span class="token attr-value">classpath:config/another-config.xml</span>
</code></pre></div><h4 id="_12-1-4。淡褐色"><a href="#_12-1-4。淡褐色" class="header-anchor">#</a> 12.1.4。淡褐色</h4> <p>Spring Boot <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-hazelcast" target="_blank" rel="noopener noreferrer">对Hazelcast<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>具有<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-hazelcast" target="_blank" rel="noopener noreferrer">常规支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果<code>HazelcastInstance</code>已经自动配置了，则会自动将其包装在中<code>CacheManager</code>。</p> <h4 id="_12-1-5。infinispan"><a href="#_12-1-5。infinispan" class="header-anchor">#</a> 12.1.5。Infinispan</h4> <p><a href="https://infinispan.org/" target="_blank" rel="noopener noreferrer">Infinispan<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>没有默认配置文件位置，因此必须明确指定。否则，将使用默认的引导程序。</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cache.infinispan.config</span><span class="token punctuation">=</span><span class="token attr-value">infinispan.xml</span>
</code></pre></div><p>可以在启动时通过设置<code>spring.cache.cache-names</code>属性来创建缓存。如果定义了定制<code>ConfigurationBuilder</code>bean，那么它将用于定制高速缓存。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot对Infinispan的支持仅限于嵌入式模式，并且非常基础。如果您需要更多选择，则应该使用官方的Infinispan Spring Boot启动程序。有关更多详细信息，请参见<a href="https://github.com/infinispan/infinispan-spring-boot" target="_blank" rel="noopener noreferrer">Infinispan的文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_12-1-6。couchbase"><a href="#_12-1-6。couchbase" class="header-anchor">#</a> 12.1.6。Couchbase</h4> <p>如果<a href="https://www.couchbase.com/" target="_blank" rel="noopener noreferrer">Couchbase<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Java客户端和<code>couchbase-spring-cache</code>实现可用，并且已<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-couchbase" target="_blank" rel="noopener noreferrer">配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Couchbase ，<code>CouchbaseCacheManager</code>则会自动配置a。通过设置该<code>spring.cache.cache-names</code>属性，还可以在启动时创建其他缓存。这些缓存在<code>Bucket</code>自动配置的上运行。您可以<em>还</em>创建另一个附加缓存中<code>Bucket</code>，通过使用定制。假设您在“ main”上需要两个缓存（<code>cache1</code>和<code>cache2</code>），在“ another”上需要<code>Bucket</code>一个（<code>cache3</code>2）秒的自定义生存时间<code>Bucket</code>。您可以通过配置创建前两个缓存，如下所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cache.cache-names</span><span class="token punctuation">=</span><span class="token attr-value">cache1,cache2</span>
</code></pre></div><p>然后，您可以定义一个<code>@Configuration</code>类来配置Extra <code>Bucket</code>和<code>cache3</code>缓存，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CouchbaseCacheConfiguration</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Cluster</span> cluster<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CouchbaseCacheConfiguration</span><span class="token punctuation">(</span><span class="token class-name">Cluster</span> cluster<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cluster <span class="token operator">=</span> cluster<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Bucket</span> <span class="token function">anotherBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cluster<span class="token punctuation">.</span><span class="token function">openBucket</span><span class="token punctuation">(</span><span class="token string">&quot;another&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManagerCustomizer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CouchbaseCacheManager</span><span class="token punctuation">&gt;</span></span> <span class="token function">cacheManagerCustomizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> c <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            c<span class="token punctuation">.</span><span class="token function">prepareCache</span><span class="token punctuation">(</span><span class="token string">&quot;cache3&quot;</span><span class="token punctuation">,</span> <span class="token class-name">CacheBuilder</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token function">anotherBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">withExpiration</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>此样本配置重用了<code>Cluster</code>通过自动配置创建的。</p> <h4 id="_12-1-7-redis"><a href="#_12-1-7-redis" class="header-anchor">#</a> 12.1.7. Redis</h4> <p>如果<a href="https://redis.io/" target="_blank" rel="noopener noreferrer">Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可用并已配置，<code>RedisCacheManager</code>则会自动配置a。可以通过设置<code>spring.cache.cache-names</code>属性在启动时创建其他缓存，并且可以使用<code>spring.cache.redis.*</code>属性配置缓存默认值。例如，以下配置创建<code>cache1</code>和<code>cache2</code>缓存的<em>生存时间为</em> 10分钟：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cache.cache-names</span><span class="token punctuation">=</span><span class="token attr-value">cache1,cache2</span>
<span class="token attr-name">spring.cache.redis.time-to-live</span><span class="token punctuation">=</span><span class="token attr-value">600000</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>默认情况下，会添加密钥前缀，这样，如果两个单独的缓存使用相同的密钥，则Redis不会有重叠的密钥，也不会返回无效值。如果您创建自己的，我们强烈建议将此设置保持启用状态<code>RedisCacheManager</code>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以通过添加<code>RedisCacheConfiguration</code> <code>@Bean</code>自己的a来完全控制配置。如果您要自定义序列化策略，这将很有用。</p></div> <h4 id="_12-1-8。caffeine"><a href="#_12-1-8。caffeine" class="header-anchor">#</a> 12.1.8。Caffeine</h4> <p><a href="https://github.com/ben-manes/caffeine" target="_blank" rel="noopener noreferrer">Caffeine<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是对Guava缓存的Java 8重写，它取代了对Guava的支持。如果存在Caffeine，<code>CaffeineCacheManager</code>则将<code>spring-boot-starter-cache</code>自动配置（由“入门”提供）。缓存可以在启动时通过设置<code>spring.cache.cache-names</code>属性来创建，并且可以通过以下方式之一（按指示的顺序）进行自定义：</p> <ol><li>缓存规范由 <code>spring.cache.caffeine.spec</code></li> <li><code>com.github.benmanes.caffeine.cache.CaffeineSpec</code>定义了一个bean</li> <li><code>com.github.benmanes.caffeine.cache.Caffeine</code>定义了一个bean</li></ol> <p>例如，以下配置创建<code>cache1</code>和<code>cache2</code>缓存最大大小为500，<em>生存时间为</em> 10分钟</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cache.cache-names</span><span class="token punctuation">=</span><span class="token attr-value">cache1,cache2</span>
<span class="token attr-name">spring.cache.caffeine.spec</span><span class="token punctuation">=</span><span class="token attr-value">maximumSize=500,expireAfterAccess=600s</span>
</code></pre></div><p>如果<code>com.github.benmanes.caffeine.cache.CacheLoader</code>定义了bean，它将自动与关联<code>CaffeineCacheManager</code>。由于<code>CacheLoader</code>将会与缓存管理器管理的<em>所有</em>缓存相关联，因此必须将其定义为<code>CacheLoader&lt;Object, Object&gt;</code>。自动配置将忽略任何其他通用类型。</p> <h4 id="_12-1-9。简单"><a href="#_12-1-9。简单" class="header-anchor">#</a> 12.1.9。简单</h4> <p>如果找不到其他提供者，<code>ConcurrentHashMap</code>则配置使用作为缓存存储的简单实现。如果您的应用程序中不存在任何缓存库，则这是默认设置。默认情况下，将根据需要创建缓存，但是您可以通过设置<code>cache-names</code>属性来限制可用缓存的列表。例如，如果只需要<code>cache1</code>和<code>cache2</code>缓存，则按<code>cache-names</code>如下所示设置属性：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cache.cache-names</span><span class="token punctuation">=</span><span class="token attr-value">cache1,cache2</span>
</code></pre></div><p>如果这样做，并且您的应用程序使用了未列出的缓存，那么当需要该缓存时，它将在运行时失败，但不会在启动时失败。这类似于使用未声明的缓存时“实际”缓存提供程序的行为。</p> <h4 id="_12-1-10。没有"><a href="#_12-1-10。没有" class="header-anchor">#</a> 12.1.10。没有</h4> <p>当<code>@EnableCaching</code>配置中存在时，也将期望使用合适的缓存配置。如果需要在某些环境中完全禁用缓存，请强制缓存类型<code>none</code>使用无操作实现，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.cache.type</span><span class="token punctuation">=</span><span class="token attr-value">none</span>
</code></pre></div><h2 id="_13-消息传递"><a href="#_13-消息传递" class="header-anchor">#</a> 13.消息传递</h2> <p>Spring框架为与消息传递系统集成提供了广泛的支持，从JMS API的简化使用<code>JmsTemplate</code>到完整的异步接收消息的基础结构。Spring AMQP为高级消息队列协议提供了类似的功能集。Spring Boot还为<code>RabbitTemplate</code>和RabbitMQ 提供了自动配置选项。Spring WebSocket本身就包含对STOMP消息的支持，而Spring Boot通过启动程序和少量的自动配置对此提供了支持。Spring Boot还支持Apache Kafka。</p> <h3 id="_13-1。jms"><a href="#_13-1。jms" class="header-anchor">#</a> 13.1。JMS</h3> <p>该<code>javax.jms.ConnectionFactory</code>接口提供了一种<code>javax.jms.Connection</code>用于创建与JMS代理进行交互的的标准方法。尽管Spring需要a <code>ConnectionFactory</code>才能与JMS一起使用，但是您通常不需要自己直接使用它，而可以依赖于更高级别的消息抽象。（有关详细信息，请参见Spring Framework参考文档的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/integration.html#jms" target="_blank" rel="noopener noreferrer">相关部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。）Spring Boot还会自动配置必要的基础结构，以发送和接收消息。</p> <h4 id="_13-1-1。activemq支持"><a href="#_13-1-1。activemq支持" class="header-anchor">#</a> 13.1.1。ActiveMQ支持</h4> <p>当<a href="https://activemq.apache.org/" target="_blank" rel="noopener noreferrer">ActiveMQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在类路径中可用时，Spring Boot也可以配置<code>ConnectionFactory</code>。如果存在代理，则将自动启动和配置嵌入式代理（前提是未通过配置指定代理URL）。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果使用<code>spring-boot-starter-activemq</code>，则提供了连接或嵌入ActiveMQ实例的必要依赖关系，以及与JMS集成的Spring基础结构。</p></div> <p>ActiveMQ配置由中的外部配置属性控制<code>spring.activemq.*</code>。例如，您可以在中声明以下部分<code>application.properties</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.activemq.broker-url</span><span class="token punctuation">=</span><span class="token attr-value">tcp://192.168.1.210:9876</span>
<span class="token attr-name">spring.activemq.user</span><span class="token punctuation">=</span><span class="token attr-value">admin</span>
<span class="token attr-name">spring.activemq.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>默认情况下，a 用合理的设置<code>CachingConnectionFactory</code>包装本机<code>ConnectionFactory</code>，您可以通过以下方式中的外部配置属性来控制这些设置<code>spring.jms.*</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.jms.cache.session-cache-size</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
</code></pre></div><p>如果您想使用本机池，则可以通过向其添加依赖项<code>org.messaginghub:pooled-jms</code>并进行相应的配置来实现<code>JmsPoolConnectionFactory</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.activemq.pool.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.activemq.pool.max-connections</span><span class="token punctuation">=</span><span class="token attr-value">50</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/activemq/ActiveMQProperties.java" target="_blank" rel="noopener noreferrer"><code>ActiveMQProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多受支持的选项。您还可以注册任意数量的Bean，以实现<code>ActiveMQConnectionFactoryCustomizer</code>更高级的自定义。</p></div> <p>默认情况下，ActiveMQ会创建目的地（如果目的地尚不存在），以便根据其提供的名称来解析目的地。</p> <h4 id="_13-1-2。artemis支持"><a href="#_13-1-2。artemis支持" class="header-anchor">#</a> 13.1.2。Artemis支持</h4> <p>当Spring Boot <code>ConnectionFactory</code>检测到<a href="https://activemq.apache.org/artemis/" target="_blank" rel="noopener noreferrer">Artemis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>在类路径中可用时，可以自动配置a 。如果存在代理，则将自动启动和配置嵌入式代理（除非已明确设置mode属性）。支持的模式是<code>embedded</code>（明确表示需要嵌入式代理，并且如果代理在类路径上不可用，则会发生错误）和<code>native</code>（使用<code>netty</code>传输协议连接到代理）。配置后者后，Spring Boot <code>ConnectionFactory</code>将使用默认设置配置一个连接到在本地计算机上运行的代理的代理。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果使用<code>spring-boot-starter-artemis</code>，则提供了连接到现有Artemis实例所需的依赖关系，以及与JMS集成的Spring基础结构。添加<code>org.apache.activemq:artemis-jms-server</code>到您的应用程序可以让您使用嵌入式模式。</p></div> <p>Artemis配置由中的外部配置属性控制<code>spring.artemis.*</code>。例如，您可以在中声明以下部分<code>application.properties</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.artemis.mode</span><span class="token punctuation">=</span><span class="token attr-value">native</span>
<span class="token attr-name">spring.artemis.host</span><span class="token punctuation">=</span><span class="token attr-value">192.168.1.210</span>
<span class="token attr-name">spring.artemis.port</span><span class="token punctuation">=</span><span class="token attr-value">9876</span>
<span class="token attr-name">spring.artemis.user</span><span class="token punctuation">=</span><span class="token attr-value">admin</span>
<span class="token attr-name">spring.artemis.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>嵌入代理时，可以选择是否要启用持久性并列出应使其可用的目的地。可以将它们指定为以逗号分隔的列表，以使用默认选项创建它们，或者您可以分别为高级队列和主题配置定义类型为<code>org.apache.activemq.artemis.jms.server.config.JMSQueueConfiguration</code>或的bean <code>org.apache.activemq.artemis.jms.server.config.TopicConfiguration</code>。</p> <p>默认情况下，a 用合理的设置<code>CachingConnectionFactory</code>包装本机<code>ConnectionFactory</code>，您可以通过以下方式中的外部配置属性来控制这些设置<code>spring.jms.*</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.jms.cache.session-cache-size</span><span class="token punctuation">=</span><span class="token attr-value">5</span>
</code></pre></div><p>如果您想使用本机池，则可以通过向其添加依赖项<code>org.messaginghub:pooled-jms</code>并进行相应的配置来实现<code>JmsPoolConnectionFactory</code>，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.artemis.pool.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.artemis.pool.max-connections</span><span class="token punctuation">=</span><span class="token attr-value">50</span>
</code></pre></div><p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/artemis/ArtemisProperties.java" target="_blank" rel="noopener noreferrer"><code>ArtemisProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多受支持的选项。</p> <p>不涉及JNDI查找，并且使用<code>name</code>Artemis配置中的属性或通过配置提供的名称来根据目的地名称解析目的地。</p> <h4 id="_13-1-3。使用jndi-connectionfactory"><a href="#_13-1-3。使用jndi-connectionfactory" class="header-anchor">#</a> 13.1.3。使用JNDI ConnectionFactory</h4> <p>如果您正在应用程序服务器中运行应用程序，则Spring Boot会尝试<code>ConnectionFactory</code>使用JNDI 查找JMS 。默认情况下，<code>java:/JmsXA</code>和<code>java:/XAConnectionFactory</code>处于选中状态。<code>spring.jms.jndi-name</code>如果需要指定替代位置，则可以使用该属性，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.jms.jndi-name</span><span class="token punctuation">=</span><span class="token attr-value">java:/MyConnectionFactory</span>
</code></pre></div><h4 id="_13-1-4。发送信息"><a href="#_13-1-4。发送信息" class="header-anchor">#</a> 13.1.4。发送信息</h4> <p>Spring <code>JmsTemplate</code>是自动配置的，您可以将其直接自动连接到您自己的bean中，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>jms<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">JmsTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JmsTemplate</span> jmsTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">JmsTemplate</span> jmsTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>jmsTemplate <span class="token operator">=</span> jmsTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/jms/core/JmsMessagingTemplate.html" target="_blank" rel="noopener noreferrer"><code>JmsMessagingTemplate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以以类似方式注入。如果定义了a <code>DestinationResolver</code>或<code>MessageConverter</code>bean，则将其自动关联到auto-configured <code>JmsTemplate</code>。</p></div> <h4 id="_13-1-5。接收讯息"><a href="#_13-1-5。接收讯息" class="header-anchor">#</a> 13.1.5。接收讯息</h4> <p>存在JMS基础结构时，可以对任何bean进行注释<code>@JmsListener</code>以创建侦听器端点。如果<code>JmsListenerContainerFactory</code>未定义，则会自动配置一个默认值。如果定义了a <code>DestinationResolver</code>或<code>MessageConverter</code>bean，它将自动关联到默认工厂。</p> <p>默认情况下，默认工厂是事务性的。如果您在<code>JtaTransactionManager</code>存在a的基础结构中运行，则默认情况下它将与侦听器容器关联。如果不是，<code>sessionTransacted</code>则启用该标志。在后一种情况下，您可以通过添加<code>@Transactional</code>侦听器方法（或其委托）将本地数据存储事务与传入消息的处理相关联。这样可以确保本地事务完成后，传入消息得到确认。这还包括发送已在同一JMS会话上执行的响应消息。</p> <p>以下组件在<code>someQueue</code>目标上创建一个侦听器端点：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@JmsListener</span><span class="token punctuation">(</span>destination <span class="token operator">=</span> <span class="token string">&quot;someQueue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关更多详细信息，请参见<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/jms/annotation/EnableJms.html" target="_blank" rel="noopener noreferrer">的Javadoc<code>@EnableJms</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>如果您需要创建更多<code>JmsListenerContainerFactory</code>实例，或者想要覆盖默认实例，Spring Boot提供了一个<code>DefaultJmsListenerContainerFactoryConfigurer</code>，您可以使用<code>DefaultJmsListenerContainerFactory</code>与自动配置的相同的设置来初始化。</p> <p>例如，以下示例公开了另一个使用特定工厂的工厂<code>MessageConverter</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">JmsConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DefaultJmsListenerContainerFactory</span> <span class="token function">myFactory</span><span class="token punctuation">(</span>
            <span class="token class-name">DefaultJmsListenerContainerFactoryConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultJmsListenerContainerFactory</span> factory <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">DefaultJmsListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configurer<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span>factory<span class="token punctuation">,</span> <span class="token function">connectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setMessageConverter</span><span class="token punctuation">(</span><span class="token function">myMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>然后，您可以<code>@JmsListener</code>按以下任何带注释的方法使用工厂：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@JmsListener</span><span class="token punctuation">(</span>destination <span class="token operator">=</span> <span class="token string">&quot;someQueue&quot;</span><span class="token punctuation">,</span> containerFactory<span class="token operator">=</span><span class="token string">&quot;myFactory&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_13-2。amqp"><a href="#_13-2。amqp" class="header-anchor">#</a> 13.2。AMQP</h3> <p>高级消息队列协议（AMQP）是面向消息中间件的与平台无关的有线级别协议。Spring AMQP项目将Spring的核心概念应用于基于AMQP的消息传递解决方案的开发。Spring Boot为通过RabbitMQ使用AMQP提供了许多便利，包括<code>spring-boot-starter-amqp</code>“启动器”。</p> <h4 id="_13-2-1。rabbitmq支持"><a href="#_13-2-1。rabbitmq支持" class="header-anchor">#</a> 13.2.1。RabbitMQ支持</h4> <p><a href="https://www.rabbitmq.com/" target="_blank" rel="noopener noreferrer">RabbitMQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是基于AMQP协议的轻型，可靠，可伸缩和便携式消息代理。Spring用于<code>RabbitMQ</code>通过AMQP协议进行通信。</p> <p>RabbitMQ配置由中的外部配置属性控制<code>spring.rabbitmq.*</code>。例如，您可以在中声明以下部分<code>application.properties</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.rabbitmq.host</span><span class="token punctuation">=</span><span class="token attr-value">localhost</span>
<span class="token attr-name">spring.rabbitmq.port</span><span class="token punctuation">=</span><span class="token attr-value">5672</span>
<span class="token attr-name">spring.rabbitmq.username</span><span class="token punctuation">=</span><span class="token attr-value">admin</span>
<span class="token attr-name">spring.rabbitmq.password</span><span class="token punctuation">=</span><span class="token attr-value">secret</span>
</code></pre></div><p>另外，您可以使用以下<code>addresses</code>属性配置相同的连接：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.rabbitmq.addresses</span><span class="token punctuation">=</span><span class="token attr-value">amqp://admin:secret@localhost</span>
</code></pre></div><p>如果<code>ConnectionNameStrategy</code>上下文中存在bean，它将自动用于命名由auto-configured创建的连接<code>ConnectionFactory</code>。请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitProperties.java" target="_blank" rel="noopener noreferrer"><code>RabbitProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多受支持的选项。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关更多详细信息<a href="https://spring.io/blog/2010/06/14/understanding-amqp-the-protocol-used-by-rabbitmq/" target="_blank" rel="noopener noreferrer">，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>请参阅<a href="https://spring.io/blog/2010/06/14/understanding-amqp-the-protocol-used-by-rabbitmq/" target="_blank" rel="noopener noreferrer">了解RabbitMQ使用的协议AMQP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_13-2-2。发送信息"><a href="#_13-2-2。发送信息" class="header-anchor">#</a> 13.2.2。发送信息</h4> <p>Spring <code>AmqpTemplate</code>和and <code>AmqpAdmin</code>是自动配置的，您可以将它们直接自动连接到自己的bean中，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">AmqpAdmin</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">AmqpTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AmqpAdmin</span> amqpAdmin<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AmqpTemplate</span> amqpTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">AmqpAdmin</span> amqpAdmin<span class="token punctuation">,</span> <span class="token class-name">AmqpTemplate</span> amqpTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>amqpAdmin <span class="token operator">=</span> amqpAdmin<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>amqpTemplate <span class="token operator">=</span> amqpTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><a href="https://docs.spring.io/spring-amqp/docs/2.2.2.RELEASE/api/org/springframework/amqp/rabbit/core/RabbitMessagingTemplate.html" target="_blank" rel="noopener noreferrer"><code>RabbitMessagingTemplate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以以类似方式注入。如果<code>MessageConverter</code>定义了bean，它将自动关联到auto-configured <code>AmqpTemplate</code>。</p></div> <p>如有必要，任何<code>org.springframework.amqp.core.Queue</code>定义为bean的对象都会自动用于在RabbitMQ实例上声明相应的队列。</p> <p>要重试操作，可以在以下位置启用重试<code>AmqpTemplate</code>（例如，在代理连接丢失的情况下）：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.rabbitmq.template.retry.enabled</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">spring.rabbitmq.template.retry.initial-interval</span><span class="token punctuation">=</span><span class="token attr-value">2s</span>
</code></pre></div><p>默认情况下，重试是禁用的。您也可以<code>RetryTemplate</code>通过声明<code>RabbitRetryTemplateCustomizer</code>bean来以编程方式自定义。</p> <h4 id="_13-2-3。接收讯息"><a href="#_13-2-3。接收讯息" class="header-anchor">#</a> 13.2.3。接收讯息</h4> <p>存在Rabbit基础结构时，可以对任何bean进行注释<code>@RabbitListener</code>以创建侦听器端点。如果<code>RabbitListenerContainerFactory</code>未定义，则将<code>SimpleRabbitListenerContainerFactory</code>自动配置默认值，并且您可以使用<code>spring.rabbitmq.listener.type</code>属性切换到直接容器。如果定义了a <code>MessageConverter</code>或<code>MessageRecoverer</code>bean，它将自动与默认工厂关联。</p> <p>以下示例组件在<code>someQueue</code>队列上创建一个侦听器端点：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;someQueue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关更多详细信息，请参见<a href="https://docs.spring.io/spring-amqp/docs/2.2.2.RELEASE/api/org/springframework/amqp/rabbit/annotation/EnableRabbit.html" target="_blank" rel="noopener noreferrer">的Javadoc<code>@EnableRabbit</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>如果您需要创建更多<code>RabbitListenerContainerFactory</code>实例，或者想要覆盖默认实例，Spring Boot提供了一个<code>SimpleRabbitListenerContainerFactoryConfigurer</code>和<code>DirectRabbitListenerContainerFactoryConfigurer</code>，您可以使用<code>SimpleRabbitListenerContainerFactory</code>和<code>DirectRabbitListenerContainerFactory</code>自动配置所使用的工厂相同的设置来初始化一个和。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>选择哪种容器都没有关系。这两个bean通过自动配置公开。</p></div> <p>例如，以下配置类公开了另一个使用特定工厂的工厂<code>MessageConverter</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">RabbitConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SimpleRabbitListenerContainerFactory</span> <span class="token function">myFactory</span><span class="token punctuation">(</span>
            <span class="token class-name">SimpleRabbitListenerContainerFactoryConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SimpleRabbitListenerContainerFactory</span> factory <span class="token operator">=</span>
                <span class="token keyword">new</span> <span class="token class-name">SimpleRabbitListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configurer<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span>factory<span class="token punctuation">,</span> connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setMessageConverter</span><span class="token punctuation">(</span><span class="token function">myMessageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>然后，您可以按任何带<code>@RabbitListener</code>注释的方法使用工厂，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;someQueue&quot;</span><span class="token punctuation">,</span> containerFactory<span class="token operator">=</span><span class="token string">&quot;myFactory&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>您可以启用重试来处理侦听器引发异常的情况。默认情况下，<code>RejectAndDontRequeueRecoverer</code>使用，但是您可以定义<code>MessageRecoverer</code>自己的a。重试用尽后，如果将代理配置为这样做，则消息将被拒绝并被丢弃或路由到死信交换。默认情况下，重试是禁用的。您也可以<code>RetryTemplate</code>通过声明<code>RabbitRetryTemplateCustomizer</code>bean来以编程方式自定义。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>默认情况下，如果禁用了重试，并且侦听器抛出异常，则会无限期地重试传递。您可以通过两种方式修改此行为：将<code>defaultRequeueRejected</code>属性设置为，<code>false</code>以便尝试进行零次重新传递，或者抛出<code>AmqpRejectAndDontRequeueException</code>来指示应该拒绝该消息。后者是启用重试并达到最大传递尝试次数时使用的机制。</p></div> <h3 id="_13-3。apache-kafka支持"><a href="#_13-3。apache-kafka支持" class="header-anchor">#</a> 13.3。Apache Kafka支持</h3> <p>通过提供<code>spring-kafka</code>项目的自动配置来支持<a href="https://kafka.apache.org/" target="_blank" rel="noopener noreferrer">Apache Kafka<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>Kafka配置由中的外部配置属性控制<code>spring.kafka.*</code>。例如，您可以在中声明以下部分<code>application.properties</code>：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.kafka.bootstrap-servers</span><span class="token punctuation">=</span><span class="token attr-value">localhost:9092</span>
<span class="token attr-name">spring.kafka.consumer.group-id</span><span class="token punctuation">=</span><span class="token attr-value">myGroup</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>要在启动时创建主题，请添加类型为的Bean <code>NewTopic</code>。如果该主题已经存在，则将忽略Bean。</p></div> <p>请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/kafka/KafkaProperties.java" target="_blank" rel="noopener noreferrer"><code>KafkaProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多受支持的选项。</p> <h4 id="_13-3-1。发送信息"><a href="#_13-3-1。发送信息" class="header-anchor">#</a> 13.3.1。发送信息</h4> <p>Spring <code>KafkaTemplate</code>是自动配置的，您可以直接在自己的Bean中自动对其进行布线，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">KafkaTemplate</span> kafkaTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">MyBean</span><span class="token punctuation">(</span><span class="token class-name">KafkaTemplate</span> kafkaTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>kafkaTemplate <span class="token operator">=</span> kafkaTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果<code>spring.kafka.producer.transaction-id-prefix</code>定义了属性，<code>KafkaTransactionManager</code>则会自动配置a。另外，如果<code>RecordMessageConverter</code>定义了bean，它将自动关联到auto-configured <code>KafkaTemplate</code>。</p></div> <h4 id="_13-3-2。接收讯息"><a href="#_13-3-2。接收讯息" class="header-anchor">#</a> 13.3.2。接收讯息</h4> <p>存在Apache Kafka基础结构时，可以对任何bean进行注释<code>@KafkaListener</code>以创建侦听器端点。如果<code>KafkaListenerContainerFactory</code>尚未定义，则会使用中定义的键自动配置默认值<code>spring.kafka.listener.*</code>。</p> <p>以下组件在该<code>someTopic</code>主题上创建一个侦听器端点：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">&quot;someTopic&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果<code>KafkaTransactionManager</code>定义了bean，它将自动关联到容器工厂。类似地，如果一个<code>ErrorHandler</code>，<code>AfterRollbackProcessor</code>或<code>ConsumerAwareRebalanceListener</code>豆被定义，它被自动关联为出厂默认。</p> <p>根据侦听器的类型，a <code>RecordMessageConverter</code>或<code>BatchMessageConverter</code>bean与默认工厂关联。如果<code>RecordMessageConverter</code>对于批处理侦听器仅存在一个bean，则将其包装在中<code>BatchMessageConverter</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>ChainedKafkaTransactionManager</code>必须标记 一个自定义，<code>@Primary</code>因为它通常引用自动配置的<code>KafkaTransactionManager</code>bean。</p></div> <h4 id="_13-3-3。卡夫卡流"><a href="#_13-3-3。卡夫卡流" class="header-anchor">#</a> 13.3.3。卡夫卡流</h4> <p>用于Apache Kafka的Spring提供了一个工厂bean来创建<code>StreamsBuilder</code>对象并管理其流的生命周期。<code>KafkaStreamsConfiguration</code>只要<code>kafka-streams</code>在类路径上是Spring Boot 并通过<code>@EnableKafkaStreams</code>注释启用Kafka Streams，Spring Boot就会自动配置所需的bean 。</p> <p>启用Kafka Streams意味着必须设置应用程序ID和引导服务器。可以使用来配置前者<code>spring.kafka.streams.application-id</code>，<code>spring.application.name</code>如果未设置，则默认为。后者可以全局设置，也可以仅针对流进行覆盖。</p> <p>使用专用属性可以使用几个附加属性。可以使用<code>spring.kafka.streams.properties</code>名称空间设置其他任意Kafka属性。另请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-kafka-extra-props" target="_blank" rel="noopener noreferrer">其他Kafka属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>要使用工厂bean，只需将其连接<code>StreamsBuilder</code>到您的工厂，<code>@Bean</code>如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableKafkaStreams</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">KafkaStreamsExampleConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">KStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">kStream</span><span class="token punctuation">(</span><span class="token class-name">StreamsBuilder</span> streamsBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">KStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> streamsBuilder<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token string">&quot;ks1In&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stream<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">KeyValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token string">&quot;ks1Out&quot;</span><span class="token punctuation">,</span>
                <span class="token class-name">Produced</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token class-name">Serdes</span><span class="token punctuation">.</span><span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JsonSerde</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> stream<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，由<code>StreamBuilder</code>它创建的对象管理的流将自动启动。您可以使用<code>spring.kafka.streams.auto-startup</code>属性来自定义此行为。</p> <h4 id="_13-3-4。卡夫卡的其他属性"><a href="#_13-3-4。卡夫卡的其他属性" class="header-anchor">#</a> 13.3.4。卡夫卡的其他属性</h4> <p>自动配置支持的属性显示在<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-application-properties.html#common-application-properties" target="_blank" rel="noopener noreferrer">appendix-application-properties.html中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。请注意，在大多数情况下，这些属性（连字符或camelCase）直接映射到Apache Kafka点缀的属性。有关详细信息，请参阅Apache Kafka文档。</p> <p>这些属性的前几个属性适用于所有组件（生产者，使用者，管理员和流），但如果您希望使用不同的值，则可以在组件级别上指定。Apache Kafka指定重要性为HIGH，MEDIUM或LOW的属性。Spring Boot自动配置支持所有HIGH重要性属性，一些选定的MEDIUM和LOW属性以及任何没有默认值的属性。</p> <p><code>KafkaProperties</code>该类直接提供了Kafka支持的属性的子集。如果希望使用不直接支持的其他属性来配置生产者或使用者，请使用以下属性：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.kafka.properties.prop.one</span><span class="token punctuation">=</span><span class="token attr-value">first</span>
<span class="token attr-name">spring.kafka.admin.properties.prop.two</span><span class="token punctuation">=</span><span class="token attr-value">second</span>
<span class="token attr-name">spring.kafka.consumer.properties.prop.three</span><span class="token punctuation">=</span><span class="token attr-value">third</span>
<span class="token attr-name">spring.kafka.producer.properties.prop.four</span><span class="token punctuation">=</span><span class="token attr-value">fourth</span>
<span class="token attr-name">spring.kafka.streams.properties.prop.five</span><span class="token punctuation">=</span><span class="token attr-value">fifth</span>
</code></pre></div><p>这会将常见的<code>prop.one</code>Kafka属性设置为<code>first</code>（适用于生产者，消费者和管理员），将<code>prop.two</code>admin属性设置为<code>second</code>，将<code>prop.three</code>消费者属性设置为<code>third</code>，将<code>prop.four</code>生产者属性设置为<code>fourth</code>，并将<code>prop.five</code>stream属性设置为<code>fifth</code>。</p> <p>您还可以<code>JsonDeserializer</code>按如下方式配置Spring Kafka ：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.kafka.consumer.value-deserializer</span><span class="token punctuation">=</span><span class="token attr-value">org.springframework.kafka.support.serializer.JsonDeserializer</span>
<span class="token attr-name">spring.kafka.consumer.properties.spring.json.value.default.type</span><span class="token punctuation">=</span><span class="token attr-value">com.example.Invoice</span>
<span class="token attr-name">spring.kafka.consumer.properties.spring.json.trusted.packages</span><span class="token punctuation">=</span><span class="token attr-value">com.example,org.acme</span>
</code></pre></div><p>同样，您可以禁用<code>JsonSerializer</code>在标头中发送类型信息的默认行为：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.kafka.producer.value-serializer</span><span class="token punctuation">=</span><span class="token attr-value">org.springframework.kafka.support.serializer.JsonSerializer</span>
<span class="token attr-name">spring.kafka.producer.properties.spring.json.add.type.headers</span><span class="token punctuation">=</span><span class="token attr-value">false</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>以这种方式设置的属性将覆盖Spring Boot显式支持的任何配置项。</p></div> <h4 id="_13-3-5。使用嵌入式kafka进行测试"><a href="#_13-3-5。使用嵌入式kafka进行测试" class="header-anchor">#</a> 13.3.5。使用嵌入式Kafka进行测试</h4> <p>Spring for Apache Kafka提供了一种使用嵌入式Apache Kafka代理测试项目的便捷方法。要使用此功能，请<code>@EmbeddedKafka</code>在<code>spring-kafka-test</code>模块中使用注释测试类。有关更多信息，请参阅Spring for Apache Kafka <a href="https://docs.spring.io/spring-kafka/docs/current/reference/html/#embedded-kafka-annotation" target="_blank" rel="noopener noreferrer">参考手册<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>要使Spring Boot自动配置与上述嵌入式Apache Kafka代理一起使用，您需要将嵌入式代理地址（由填充<code>EmbeddedKafkaBroker</code>）的系统属性重新映射到Apache Kafka的Spring Boot配置属性中。有几种方法可以做到这一点：</p> <ul><li>提供系统属性以将嵌入式代理地址映射到<code>spring.kafka.bootstrap-servers</code>测试类中：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token class-name">EmbeddedKafkaBroker</span><span class="token punctuation">.</span>BROKER_LIST_PROPERTY<span class="token punctuation">,</span> <span class="token string">&quot;spring.kafka.bootstrap-servers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在<code>@EmbeddedKafka</code>注释上配置属性名称：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EmbeddedKafka</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">&quot;someTopic&quot;</span><span class="token punctuation">,</span>
        bootstrapServersProperty <span class="token operator">=</span> <span class="token string">&quot;spring.kafka.bootstrap-servers&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>在配置属性中使用占位符：</li></ul> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.kafka.bootstrap-servers</span><span class="token punctuation">=</span><span class="token attr-value">${spring.embedded.kafka.brokers}</span>
</code></pre></div><h2 id="_14-通过以下方式调用rest服务-resttemplate"><a href="#_14-通过以下方式调用rest服务-resttemplate" class="header-anchor">#</a> 14.通过以下方式调用REST服务 <code>RestTemplate</code></h2> <p>如果需要从应用程序调用远程REST服务，则可以使用Spring Framework的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html" target="_blank" rel="noopener noreferrer"><code>RestTemplate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>类。由于<code>RestTemplate</code>实例通常需要在使用前进行自定义，因此Spring Boot不提供任何单个自动配置的<code>RestTemplate</code>bean。但是，它会自动配置a <code>RestTemplateBuilder</code>，可以<code>RestTemplate</code>在需要时创建实例。自动配置<code>RestTemplateBuilder</code>可确保明智<code>HttpMessageConverters</code>地应用于<code>RestTemplate</code>实例。</p> <p>以下代码显示了一个典型示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">RestTemplateBuilder</span> restTemplateBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate <span class="token operator">=</span> restTemplateBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Details</span> <span class="token function">someRestCall</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;/{name}/details&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Details</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>RestTemplateBuilder</code>包括许多有用的方法，可用于快速配置<code>RestTemplate</code>。例如，要添加BASIC身份验证支持，可以使用<code>builder.basicAuthentication(&quot;user&quot;, &quot;password&quot;).build()</code>。</p></div> <h3 id="_14-1。resttemplate自定义"><a href="#_14-1。resttemplate自定义" class="header-anchor">#</a> 14.1。RestTemplate自定义</h3> <p>有三种主要的<code>RestTemplate</code>自定义方法，具体取决于您希望自定义应用的范围。</p> <p>为了使所有定制的范围尽可能狭窄，请注入自动配置的对象<code>RestTemplateBuilder</code>，然后根据需要调用其方法。每个方法调用都返回一个新<code>RestTemplateBuilder</code>实例，因此自定义仅影响构建器的使用。</p> <p>要进行应用程序范围的附加自定义，请使用<code>RestTemplateCustomizer</code>Bean。所有此类bean都会自动向自动配置中注册，<code>RestTemplateBuilder</code>并应用于自动生成的任何模板。</p> <p>以下示例显示了一个定制程序，该定制程序为除以下之外的所有主机配置代理的使用<code>192.168.0.5</code>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ProxyCustomizer</span> <span class="token keyword">implements</span> <span class="token class-name">RestTemplateCustomizer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpHost</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span><span class="token string">&quot;proxy.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpClient</span> httpClient <span class="token operator">=</span> <span class="token class-name">HttpClientBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRoutePlanner</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultProxyRoutePlanner</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">HttpHost</span> <span class="token function">determineProxy</span><span class="token punctuation">(</span><span class="token class-name">HttpHost</span> target<span class="token punctuation">,</span> <span class="token class-name">HttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpContext</span> context<span class="token punctuation">)</span>
                    <span class="token keyword">throws</span> <span class="token class-name">HttpException</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getHostName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.0.5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">determineProxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> request<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        restTemplate<span class="token punctuation">.</span><span class="token function">setRequestFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpComponentsClientHttpRequestFactory</span><span class="token punctuation">(</span>httpClient<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>最后，最极端（很少使用）的选项是创建自己的<code>RestTemplateBuilder</code>bean。这样做会关闭a的自动配置，<code>RestTemplateBuilder</code>并防止使用任何<code>RestTemplateCustomizer</code>bean。</p> <h2 id="_15-通过调用rest服务-webclient"><a href="#_15-通过调用rest服务-webclient" class="header-anchor">#</a> 15.通过调用REST服务 <code>WebClient</code></h2> <p>如果您的类路径上具有Spring WebFlux，则还可以选择<code>WebClient</code>用于调用远程REST服务。与相比<code>RestTemplate</code>，此客户具有更实用的感觉并且完全反应灵敏。您可以<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web-reactive.html#webflux-client" target="_blank" rel="noopener noreferrer">在Spring Framework文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><code>WebClient</code>的专用<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web-reactive.html#webflux-client" target="_blank" rel="noopener noreferrer">部分中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>了解有关的更多信息。</p> <p>Spring Boot <code>WebClient.Builder</code>为您创建并预配置a ；强烈建议将其注入您的组件中并使用它来创建<code>WebClient</code>实例。Spring Boot正在配置该构建器以共享HTTP资源，以与服务器相同的方式反映编解码器的设置（请参阅<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-webflux-httpcodecs" target="_blank" rel="noopener noreferrer">WebFlux HTTP编解码器自动配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），以及更多内容。</p> <p>以下代码显示了一个典型示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">WebClient</span> webClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token class-name">Builder</span> webClientBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>webClient <span class="token operator">=</span> webClientBuilder<span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://example.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Details</span><span class="token punctuation">&gt;</span></span> <span class="token function">someRestCall</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/{name}/details&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span><span class="token class-name">Details</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_15-1。webclient运行时"><a href="#_15-1。webclient运行时" class="header-anchor">#</a> 15.1。WebClient运行时</h3> <p>Spring Boot将根据应用程序类路径上可用的库自动检测<code>ClientHttpConnector</code>要使用哪个驱动器<code>WebClient</code>。目前，还支持Reactor Netty和Jetty RS客户端。</p> <p>在<code>spring-boot-starter-webflux</code>启动依赖于<code>io.projectreactor.netty:reactor-netty</code>默认情况下，这使服务器和客户端的实现。如果选择使用Jetty作为反应式服务器，则应在Jetty反应式HTTP客户端库上添加依赖项<code>org.eclipse.jetty:jetty-reactive-httpclient</code>。对服务器和客户端使用相同的技术具有其优势，因为它将自动在客户端和服务器之间共享HTTP资源。</p> <p>开发人员可以通过提供一个自定义<code>ReactorResourceFactory</code>或<code>JettyResourceFactory</code>bean 来覆盖Jetty和Reactor Netty的资源配置-这将同时应用于客户端和服务器。</p> <p>如果您希望为客户端覆盖该选择，则可以定义自己的<code>ClientHttpConnector</code>bean并完全控制客户端配置。</p> <p>您可以<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web-reactive.html#webflux-client-builder" target="_blank" rel="noopener noreferrer"><code>WebClient</code>在Spring Framework参考文档中<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>了解有关<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web-reactive.html#webflux-client-builder" target="_blank" rel="noopener noreferrer">配置选项的<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更多信息。</p> <h3 id="_15-2。webclient定制"><a href="#_15-2。webclient定制" class="header-anchor">#</a> 15.2。WebClient定制</h3> <p>有三种主要的<code>WebClient</code>自定义方法，具体取决于您希望自定义应用的范围。</p> <p>为了使所有定制的范围尽可能狭窄，请注入自动配置的对象<code>WebClient.Builder</code>，然后根据需要调用其方法。 <code>WebClient.Builder</code>实例是有状态的：构建器上的任何更改都会反映在随后使用它创建的所有客户端中。如果要使用同一构建器创建多个客户端，则也可以考虑使用克隆该构建器<code>WebClient.Builder other = builder.clone();</code>。</p> <p>要对所有<code>WebClient.Builder</code>实例进行应用程序级的附加自定义，您可以声明<code>WebClientCustomizer</code>bean并<code>WebClient.Builder</code>在注入点更改本地实例。</p> <p>最后，您可以使用原始API并使用<code>WebClient.create()</code>。在这种情况下，不会应用自动配置或<code>WebClientCustomizer</code>。</p> <h2 id="_16-验证"><a href="#_16-验证" class="header-anchor">#</a> 16.验证</h2> <p>只要JSR-303实现（例如Hibernate验证器）位于类路径上，就会自动启用Bean验证1.1支持的方法验证功能。这样就可以在bean方法<code>javax.validation</code>的参数和/或返回值上加约束来注释它们。具有此类带注释方法的目标类需要<code>@Validated</code>在类型级别用注释进行注释，以便在其方法中搜索内联约束注释。</p> <p>例如，以下服务触发第一个参数的验证，确保其大小在8到10之间：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">Archive</span> <span class="token function">findByCodeAndAuthor</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Size</span><span class="token punctuation">(</span>min <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> max <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">,</span>
            <span class="token class-name">Author</span> author<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_17-发送电子邮件"><a href="#_17-发送电子邮件" class="header-anchor">#</a> 17.发送电子邮件</h2> <p>Spring框架提供了一种使用<code>JavaMailSender</code>接口发送电子邮件的简单抽象方法，而Spring Boot为其提供了自动配置以及启动程序模块。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有关如何使用的详细说明，请参见<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/integration.html#mail" target="_blank" rel="noopener noreferrer">参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><code>JavaMailSender</code>。</p></div> <p>如果<code>spring.mail.host</code>和相关库（由定义<code>spring-boot-starter-mail</code>）可用，<code>JavaMailSender</code>则如果不存在则创建默认库。可以通过<code>spring.mail</code>名称空间中的配置项进一步自定义发送方。请参阅<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mail/MailProperties.java" target="_blank" rel="noopener noreferrer"><code>MailProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以获取更多详细信息。</p> <p>特别是，某些默认超时值是无限的，您可能需要更改此值，以避免线程被无响应的邮件服务器阻塞，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mail.properties.mail.smtp.connectiontimeout</span><span class="token punctuation">=</span><span class="token attr-value">5000</span>
<span class="token attr-name">spring.mail.properties.mail.smtp.timeout</span><span class="token punctuation">=</span><span class="token attr-value">3000</span>
<span class="token attr-name">spring.mail.properties.mail.smtp.writetimeout</span><span class="token punctuation">=</span><span class="token attr-value">5000</span>
</code></pre></div><p>也可以<code>JavaMailSender</code>使用<code>Session</code>JNDI中的现有配置进行配置：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.mail.jndi-name</span><span class="token punctuation">=</span><span class="token attr-value">mail/Session</span>
</code></pre></div><p>当<code>jndi-name</code>设置，它优先于所有其他会话相关的设置。</p> <h2 id="_18-jta的分布式事务"><a href="#_18-jta的分布式事务" class="header-anchor">#</a> 18. JTA的分布式事务</h2> <p>通过使用<a href="https://www.atomikos.com/" target="_blank" rel="noopener noreferrer">Atomikos<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或<a href="https://github.com/bitronix/btm" target="_blank" rel="noopener noreferrer">Bitronix<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>嵌入式事务管理器，Spring Boot支持跨多个XA资源的分布式JTA事务。部署到合适的Java EE应用程序服务器时，还支持JTA事务。</p> <p>当检测到JTA环境时，<code>JtaTransactionManager</code>将使用Spring 来管理事务。自动配置的JMS，DataSource和JPA Bean已升级为支持XA事务。您可以使用标准Spring习惯用法（例如<code>@Transactional</code>）来参与分布式事务。如果您在JTA环境中，但仍要使用本地事务，则可以将该<code>spring.jta.enabled</code>属性设置<code>false</code>为禁用JTA自动配置。</p> <h3 id="_18-1。使用atomikos交易管理器"><a href="#_18-1。使用atomikos交易管理器" class="header-anchor">#</a> 18.1。使用Atomikos交易管理器</h3> <p><a href="https://www.atomikos.com/" target="_blank" rel="noopener noreferrer">Atomikos<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一种流行的开源事务管理器，可以嵌入到您的Spring Boot应用程序中。您可以使用<code>spring-boot-starter-jta-atomikos</code>入门程序来引入适当的Atomikos库。Spring Boot自动配置Atomikos，并确保将适当的<code>depends-on</code>设置应用于您的Spring Bean，以正确启动和关闭命令。</p> <p>默认情况下，Atomikos事务日志将写入<code>transaction-logs</code>应用程序主目录中的目录（应用程序jar文件所在的目录）。您可以通过<code>spring.jta.log-dir</code>在<code>application.properties</code>文件中设置属性来自定义此目录的位置。以开头的属性<code>spring.jta.atomikos.properties</code>也可以用于自定义Atomikos <code>UserTransactionServiceImp</code>。有关完整的详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/jta/atomikos/AtomikosProperties.html" target="_blank" rel="noopener noreferrer"><code>AtomikosProperties</code>Javadoc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>为了确保多个事务管理器可以安全地协调同一资源管理器，必须为每个Atomikos实例配置一个唯一的ID。默认情况下，此ID是运行Atomikos的计算机的IP地址。为确保生产中的唯一性，应<code>spring.jta.transaction-manager-id</code>为应用程序的每个实例为属性配置一个不同的值。</p></div> <h3 id="_18-2。使用bitronix交易管理器"><a href="#_18-2。使用bitronix交易管理器" class="header-anchor">#</a> 18.2。使用Bitronix交易管理器</h3> <p><a href="https://github.com/bitronix/btm" target="_blank" rel="noopener noreferrer">Bitronix<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是流行的开源JTA事务管理器实现。您可以使用<code>spring-boot-starter-jta-bitronix</code>启动器将适当的Bitronix依赖项添加到项目中。与Atomikos一样，Spring Boot自动配置Bitronix并对您的bean进行后处理，以确保启动和关闭顺序正确。</p> <p>默认情况下，Bitronix事务日志文件（<code>part1.btm</code>和<code>part2.btm</code>）被写入<code>transaction-logs</code>应用程序主目录中的目录。您可以通过设置<code>spring.jta.log-dir</code>属性来自定义此目录的位置。以开头的属性<code>spring.jta.bitronix.properties</code>也绑定到<code>bitronix.tm.Configuration</code>Bean，从而可以进行完全自定义。有关详细信息，请参见<a href="https://github.com/bitronix/btm/wiki/Transaction-manager-configuration" target="_blank" rel="noopener noreferrer">Bitronix文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>为了确保多个事务管理器可以安全地协调同一资源管理器，必须为每个Bitronix实例配置唯一的ID。默认情况下，此ID是运行Bitronix的计算机的IP地址。为确保生产中的唯一性，应<code>spring.jta.transaction-manager-id</code>为应用程序的每个实例为属性配置一个不同的值。</p></div> <h3 id="_18-3。使用java-ee托管事务管理器"><a href="#_18-3。使用java-ee托管事务管理器" class="header-anchor">#</a> 18.3。使用Java EE托管事务管理器</h3> <p>如果将Spring Boot应用程序打包为<code>war</code>或<code>ear</code>文件，并将其部署到Java EE应用程序服务器，则可以使用应用程序服务器的内置事务管理器。Spring Boot尝试通过查看常见的JNDI位置（<code>java:comp/UserTransaction</code>，<code>java:comp/TransactionManager</code>等）来自动配置事务管理器。如果使用应用程序服务器提供的事务服务，通常还需要确保所有资源都由服务器管理并通过JNDI公开。Spring Boot尝试通过<code>ConnectionFactory</code>在JNDI路径（<code>java:/JmsXA</code>或<code>java:/XAConnectionFactory</code>）中查找来尝试自动配置JMS ，您可以使用该<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-connecting-to-a-jndi-datasource" target="_blank" rel="noopener noreferrer"><code>spring.datasource.jndi-name</code>属性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来配置<code>DataSource</code>。</p> <h3 id="_18-4。混合xa和非xa-jms连接"><a href="#_18-4。混合xa和非xa-jms连接" class="header-anchor">#</a> 18.4。混合XA和非XA JMS连接</h3> <p>使用JTA时，主要的JMS <code>ConnectionFactory</code>Bean可识别XA，并参与分布式事务。在某些情况下，您可能想通过使用非XA处理某些JMS消息<code>ConnectionFactory</code>。例如，您的JMS处理逻辑可能需要比XA超时更长的时间。</p> <p>如果要使用非XA <code>ConnectionFactory</code>，则可以注入<code>nonXaJmsConnectionFactory</code>bean而不是<code>@Primary</code> <code>jmsConnectionFactory</code>bean。为了保持一致性，<code>jmsConnectionFactory</code>还使用bean别名提供了bean <code>xaJmsConnectionFactory</code>。</p> <p>以下示例显示了如何注入<code>ConnectionFactory</code>实例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Inject the primary (XA aware) ConnectionFactory</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">ConnectionFactory</span> defaultConnectionFactory<span class="token punctuation">;</span>

<span class="token comment">// Inject the XA aware ConnectionFactory (uses the alias and injects the same as above)</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;xaJmsConnectionFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">ConnectionFactory</span> xaConnectionFactory<span class="token punctuation">;</span>

<span class="token comment">// Inject the non-XA aware ConnectionFactory</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;nonXaJmsConnectionFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">ConnectionFactory</span> nonXaConnectionFactory<span class="token punctuation">;</span>
</code></pre></div><h3 id="_18-5。支持替代嵌入式事务管理器"><a href="#_18-5。支持替代嵌入式事务管理器" class="header-anchor">#</a> 18.5。支持替代嵌入式事务管理器</h3> <p>该<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jms/XAConnectionFactoryWrapper.java" target="_blank" rel="noopener noreferrer"><code>XAConnectionFactoryWrapper</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jdbc/XADataSourceWrapper.java" target="_blank" rel="noopener noreferrer"><code>XADataSourceWrapper</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>接口可用于支持替代嵌入式事务经理。这些接口负责包装<code>XAConnectionFactory</code>和<code>XADataSource</code>bean，并将它们作为常规<code>ConnectionFactory</code>和<code>DataSource</code>bean 公开，它们透明地注册到分布式事务中。数据源和JMS自动配置使用JTA变体，前提是您拥有一个<code>JtaTransactionManager</code>Bean并在其中注册了适当的XA包装器Bean <code>ApplicationContext</code>。</p> <p>该<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jta/bitronix/BitronixXAConnectionFactoryWrapper.java" target="_blank" rel="noopener noreferrer">BitronixXAConnectionFactoryWrapper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jta/bitronix/BitronixXADataSourceWrapper.java" target="_blank" rel="noopener noreferrer">BitronixXADataSourceWrapper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了如何编写XA包装很好的例子。</p> <h2 id="_19-hazelcast"><a href="#_19-hazelcast" class="header-anchor">#</a> 19. Hazelcast</h2> <p>如果<a href="https://hazelcast.com/" target="_blank" rel="noopener noreferrer">Hazelcast<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>位于类路径上，并且找到了合适的配置，则Spring Boot会自动配置一个<code>HazelcastInstance</code>您可以在应用程序中注入的。</p> <p>如果定义一个<code>com.hazelcast.config.Config</code>bean，Spring Boot会使用它。如果您的配置定义了一个实例名称，Spring Boot会尝试查找现有实例，而不是创建一个新实例。</p> <p>如果定义一个<code>com.hazelcast.config.Config</code>bean，Spring Boot会使用它。如果您的配置定义了一个实例名称，Spring Boot会尝试查找现有实例，而不是创建一个新实例。</p> <p>您还可以指定通过配置使用的Hazelcast配置文件，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.hazelcast.config</span><span class="token punctuation">=</span><span class="token attr-value">classpath:config/my-hazelcast.xml</span>
</code></pre></div><p>否则，Spring Boot会尝试从默认位置查找Hazelcast配置：<code>hazelcast.xml</code>在工作目录中或类路径的根目录中，或<code>.yaml</code>在相同位置的对应目录中。我们还检查是否<code>hazelcast.config</code>设置了系统属性。有关更多详细信息，请参见<a href="https://docs.hazelcast.org/docs/latest/manual/html-single/" target="_blank" rel="noopener noreferrer">Hazelcast文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>如果<code>hazelcast-client</code>类路径中存在，Spring Boot首先尝试通过检查以下配置选项来创建客户端：</p> <ul><li><code>com.hazelcast.client.config.ClientConfig</code>豆子的存在。</li> <li>该<code>spring.hazelcast.config</code>属性定义的配置文件。</li> <li><code>hazelcast.client.config</code>系统属性的存在。</li> <li>一个<code>hazelcast-client.xml</code>在工作目录或在classpath的根目录。</li> <li>一个<code>hazelcast-client.yaml</code>在工作目录或在classpath的根目录。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Boot还具有<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-caching-provider-hazelcast" target="_blank" rel="noopener noreferrer">对Hazelcast的显式缓存支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果启用了缓存，<code>HazelcastInstance</code>则会自动将其包装在<code>CacheManager</code>实现中。</p></div> <h2 id="_20-quartz-scheduler"><a href="#_20-quartz-scheduler" class="header-anchor">#</a> 20. Quartz Scheduler</h2> <p>Spring Boot为使用<a href="https://www.quartz-scheduler.org/" target="_blank" rel="noopener noreferrer">Quartz Scheduler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了许多便利，包括<code>spring-boot-starter-quartz</code>“ Starter”。如果Quartz可用，<code>Scheduler</code>则自动配置a（通过<code>SchedulerFactoryBean</code>抽象）。</p> <p>以下类型的Bean会被自动拾取并与关联<code>Scheduler</code>：</p> <ul><li><code>JobDetail</code>：定义特定的作业。 <code>JobDetail</code>实例可以使用<code>JobBuilder</code>API 构建。</li> <li><code>Calendar</code>。</li> <li><code>Trigger</code>：定义何时触发特定作业。</li></ul> <p>默认情况下，使用内存<code>JobStore</code>。但是，如果<code>DataSource</code>应用程序中有可用的bean，并且<code>spring.quartz.job-store-type</code>属性已相应配置，则可以配置基于JDBC的存储，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.quartz.job-store-type</span><span class="token punctuation">=</span><span class="token attr-value">jdbc</span>
</code></pre></div><p>使用JDBC存储时，可以在启动时初始化模式，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.quartz.jdbc.initialize-schema</span><span class="token punctuation">=</span><span class="token attr-value">always</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>默认情况下，使用Quartz库随附的标准脚本检测并初始化数据库。这些脚本将删除现有表，并在每次重新启动时删除所有触发器。也可以通过设置<code>spring.quartz.jdbc.schema</code>属性来提供自定义脚本。</p></div> <p>要让Quartz使用<code>DataSource</code>应用程序的main之外的其他代码<code>DataSource</code>，请声明一个<code>DataSource</code>bean，并用注释其<code>@Bean</code>方法<code>@QuartzDataSource</code>。这样做可确保和<code>DataSource</code>都使用特定于Quartz的<code>SchedulerFactoryBean</code>模式进行初始化。</p> <p>默认情况下，通过配置创建的作业将不会覆盖从持久性作业存储中读取的已注册作业。要启用覆盖现有作业定义的功能，请设置该<code>spring.quartz.overwrite-existing-jobs</code>属性。</p> <p>可以使用<code>spring.quartz</code>属性和<code>SchedulerFactoryBeanCustomizer</code>bean 来定制Quartz Scheduler配置，从而允许以编程方式进行<code>SchedulerFactoryBean</code>定制。可以使用来定制高级Quartz配置属性<code>spring.quartz.properties.*</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>特别是，<code>Executor</code>bean没有与调度程序相关联，因为Quartz通过提供了一种配置调度程序的方法<code>spring.quartz.properties</code>。如果您需要自定义任务执行器，请考虑实现<code>SchedulerFactoryBeanCustomizer</code>。</p></div> <p>作业可以定义设置器以注入数据映射属性。常规豆也可以类似的方式注入，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleJob</span> <span class="token keyword">extends</span> <span class="token class-name">QuartzJobBean</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">MyService</span> myService<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token comment">// Inject &quot;MyService&quot; bean</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMyService</span><span class="token punctuation">(</span><span class="token class-name">MyService</span> myService<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token comment">// Inject the &quot;name&quot; job data property</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">executeInternal</span><span class="token punctuation">(</span><span class="token class-name">JobExecutionContext</span> context<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">JobExecutionException</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_21-任务执行和计划"><a href="#_21-任务执行和计划" class="header-anchor">#</a> 21.任务执行和计划</h2> <p>在<code>Executor</code>上下文中没有bean的情况下，Spring Boot会<code>ThreadPoolTaskExecutor</code>使用合理的默认值自动配置a ，这些默认值可以自动与异步任务执行（<code>@EnableAsync</code>）和Spring MVC异步请求处理相关联。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您<code>Executor</code>在上下文中定义了一个自定义，则常规任务执行（即<code>@EnableAsync</code>）将透明地使用它，但由于需要<code>AsyncTaskExecutor</code>实现（名为<code>applicationTaskExecutor</code>），因此不会配置Spring MVC支持。根据你的目标的安排，你可以改变你<code>Executor</code>到一个<code>ThreadPoolTaskExecutor</code>或同时定义一个<code>ThreadPoolTaskExecutor</code>和<code>AsyncConfigurer</code>包装您的自定义<code>Executor</code>。通过自动配置<code>TaskExecutorBuilder</code>，您可以轻松创建实例，以重现默认情况下自动配置的功能。</p></div> <p>线程池使用8个核心线程，这些线程可以根据负载增长和收缩。可以使用<code>spring.task.execution</code>名称空间对这些默认设置进行微调，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.task.execution.pool.max-size</span><span class="token punctuation">=</span><span class="token attr-value">16</span>
<span class="token attr-name">spring.task.execution.pool.queue-capacity</span><span class="token punctuation">=</span><span class="token attr-value">100</span>
<span class="token attr-name">spring.task.execution.pool.keep-alive</span><span class="token punctuation">=</span><span class="token attr-value">10s</span>
</code></pre></div><p>这会将线程池更改为使用有界队列，以便在队列已满（100个任务）时，线程池最多增加到16个线程。池的收缩更加激进，因为当线程空闲10秒（而不是默认情况下的60秒）时，它们将被回收。</p> <p><code>ThreadPoolTaskScheduler</code>如果需要与计划的任务执行（<code>@EnableScheduling</code>）关联，也可以自动配置A。线程池默认使用一个线程，可以使用<code>spring.task.scheduling</code>名称空间对这些设置进行微调。</p> <p>既是<code>TaskExecutorBuilder</code>豆和<code>TaskSchedulerBuilder</code>绿豆可在上下文提供如果要创建一个自定义的遗嘱执行人或调度的需求。</p> <h2 id="_22-spring集成"><a href="#_22-spring集成" class="header-anchor">#</a> 22. Spring集成</h2> <p>Spring Boot为使用<a href="https://spring.io/projects/spring-integration" target="_blank" rel="noopener noreferrer">Spring Integration<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了许多便利，包括<code>spring-boot-starter-integration</code>“ Starter”。Spring Integration通过消息传递以及其他传输（例如HTTP，TCP等）提供抽象。如果您的类路径上有Spring Integration，则可以通过<code>@EnableIntegration</code>注释对其进行初始化。</p> <p>Spring Boot还配置了一些功能，这些功能由其他Spring Integration模块的存在触发。如果<code>spring-integration-jmx</code>还在类路径上，则消息处理统计信息将通过JMX发布。如果<code>spring-integration-jdbc</code>可用，则可以在启动时创建默认的数据库架构，如以下行所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.integration.jdbc.initialize-schema</span><span class="token punctuation">=</span><span class="token attr-value">always</span>
</code></pre></div><p>有关更多详细信息，请参见<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/integration/IntegrationAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>IntegrationAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/integration/IntegrationProperties.java" target="_blank" rel="noopener noreferrer"><code>IntegrationProperties</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>类。</p> <p>默认情况下，如果存在Micrometer <code>meterRegistry</code>bean，Spring Integration指标将由Micrometer管理。如果您希望使用旧版Spring Integration指标，请将<code>DefaultMetricsFactory</code>Bean 添加到应用程序上下文中。</p> <h2 id="_23-spring-boot会议"><a href="#_23-spring-boot会议" class="header-anchor">#</a> 23.Spring Boot会议</h2> <p>Spring Boot为各种数据存储提供了<a href="https://spring.io/projects/spring-session" target="_blank" rel="noopener noreferrer">Spring Session<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>自动配置。在构建Servlet Web应用程序时，可以自动配置以下存储：</p> <ul><li>JDBC</li> <li>Redis</li> <li>淡褐色</li> <li>MongoDB</li></ul> <p>构建反应式Web应用程序时，可以自动配置以下存储：</p> <ul><li>Redis</li> <li>MongoDB</li></ul> <p>如果类路径上存在单个Spring Session模块，则Spring Boot会自动使用该存储实现。如果您有多个实现，则必须选择<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/session/StoreType.java" target="_blank" rel="noopener noreferrer"><code>StoreType</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>要用于存储会话的实现。例如，要将JDBC用作后端存储，可以按以下方式配置应用程序：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.session.store-type</span><span class="token punctuation">=</span><span class="token attr-value">jdbc</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您可以通过将设置为<code>store-type</code>来禁用Spring Session <code>none</code>。</p></div> <p>每个商店都有特定的附加设置。例如，可以为JDBC存储定制表的名称，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.session.jdbc.table-name</span><span class="token punctuation">=</span><span class="token attr-value">SESSIONS</span>
</code></pre></div><p>要设置会话超时，您可以使用<code>spring.session.timeout</code>属性。如果未设置该属性，则自动配置将回退到的值<code>server.servlet.session.timeout</code>。</p> <h2 id="_24-通过jmx进行监视和管理"><a href="#_24-通过jmx进行监视和管理" class="header-anchor">#</a> 24.通过JMX进行监视和管理</h2> <p>Java管理扩展（JMX）提供了监视和管理应用程序的标准机制。Spring Boot将最适合<code>MBeanServer</code>作为ID为的bean 公开<code>mbeanServer</code>。您的任何豆被标注有春天JMX注释（<code>@ManagedResource</code>，<code>@ManagedAttribute</code>，或<code>@ManagedOperation</code>）接触到它。</p> <p>如果您的平台提供了标准<code>MBeanServer</code>，则Spring Boot将使用该标准，并<code>MBeanServer</code>在必要时默认使用VM 。如果全部失败，<code>MBeanServer</code>将创建一个新的。</p> <p>有关<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jmx/JmxAutoConfiguration.java" target="_blank" rel="noopener noreferrer"><code>JmxAutoConfiguration</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更多详细信息，请参见课程。</p> <h2 id="_25-测试"><a href="#_25-测试" class="header-anchor">#</a> 25.测试</h2> <p>Spring Boot提供了许多实用程序和注释，可以在测试应用程序时提供帮助。测试支持由两个模块提供：<code>spring-boot-test</code>包含核心项，并<code>spring-boot-test-autoconfigure</code>支持测试的自动配置。</p> <p>大多数开发人员都使用<code>spring-boot-starter-test</code>“入门程序”，该程序同时导入Spring Boot测试模块以及JUnit Jupiter，AssertJ，Hamcrest和许多其他有用的库。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>启动程序还带来了老式引擎，因此您可以运行JUnit 4和JUnit 5测试。如果已将测试迁移到JUnit 5，则应排除对JUnit 4的支持，如以下示例所示：<code>&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt;</code></p></div> <h3 id="_25-1。测试范围依赖性"><a href="#_25-1。测试范围依赖性" class="header-anchor">#</a> 25.1。测试范围依赖性</h3> <p>在<code>spring-boot-starter-test</code>“入门”（中<code>test</code> <code>scope</code>）包含以下提供的库：</p> <ul><li><a href="https://junit.org/junit5" target="_blank" rel="noopener noreferrer">JUnit 5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（包括用于与JUnit 4向后兼容的老式引擎）：用于进行Java应用程序单元测试的事实上的标准。</li> <li><a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/testing.html#integration-testing" target="_blank" rel="noopener noreferrer">Spring测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和Spring Boot测试：对Spring Boot应用程序的实用程序和集成测试支持。</li> <li><a href="https://joel-costigliola.github.io/assertj/" target="_blank" rel="noopener noreferrer">AssertJ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：流畅的断言库。</li> <li><a href="https://github.com/hamcrest/JavaHamcrest" target="_blank" rel="noopener noreferrer">Hamcrest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：匹配对象库（也称为约束或谓词）。</li> <li><a href="https://mockito.github.io/" target="_blank" rel="noopener noreferrer">Mockito<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：一个Java <a href="https://mockito.github.io/" target="_blank" rel="noopener noreferrer">模拟<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>框架。</li> <li><a href="https://github.com/skyscreamer/JSONassert" target="_blank" rel="noopener noreferrer">JSONassert<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：JSON的断言库。</li> <li><a href="https://github.com/jayway/JsonPath" target="_blank" rel="noopener noreferrer">JsonPath<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：JSON的XPath。</li></ul> <p>通常，我们发现这些通用库在编写测试时很有用。如果这些库不满足您的需求，则可以添加自己的其他测试依赖项。</p> <h3 id="_25-2。测试spring应用程序"><a href="#_25-2。测试spring应用程序" class="header-anchor">#</a> 25.2。测试Spring应用程序</h3> <p>依赖注入的主要优点之一是，它应该使您的代码更易于进行单元测试。您可以使用<code>new</code>运算符实例化对象，而无需使用Spring。您还可以使用<em>模拟对象</em>而不是实际的依赖项。</p> <p>通常，您需要超越单元测试并开始集成测试（使用Spring <code>ApplicationContext</code>）。能够进行集成测试而无需部署应用程序或连接到其他基础结构是很有用的。</p> <p>Spring框架包括用于此类集成测试的专用测试模块。您可以直接向其声明依赖项，<code>org.springframework:spring-test</code>也可以使用<code>spring-boot-starter-test</code>“启动器”将其引入。</p> <p>如果您以前没有使用过该<code>spring-test</code>模块，则应先阅读Spring Framework参考文档的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/testing.html#testing" target="_blank" rel="noopener noreferrer">相关部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_25-3。测试spring-boot应用程序"><a href="#_25-3。测试spring-boot应用程序" class="header-anchor">#</a> 25.3。测试Spring Boot应用程序</h3> <p>Spring Boot应用程序是Spring <code>ApplicationContext</code>，因此除了对普通Spring上下文进行正常测试以外，无需执行任何其他特殊操作即可对其进行测试。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>默认情况下，Spring Boot的外部属性，日志记录和其他功能仅在<code>SpringApplication</code>用于创建时才安装在上下文中。</p></div> <p>Spring Boot提供了一个<code>@SpringBootTest</code>注释，<code>spring-test</code> <code>@ContextConfiguration</code>当您需要Spring Boot功能时，它可以用作标准注释的替代。注释通过<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-detecting-config" target="_blank" rel="noopener noreferrer">创建<code>ApplicationContext</code>在测试中使用过的来<code>SpringApplication</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>起作用。除了<code>@SpringBootTest</code>提供许多其他注释外，还用于<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" target="_blank" rel="noopener noreferrer">测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>应用程序的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" target="_blank" rel="noopener noreferrer">更多特定<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>部分。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果使用的是JUnit 4，请不要忘记也将其添加<code>@RunWith(SpringRunner.class)</code>到测试中，否则注释将被忽略。如果您使用的是JUnit 5，则无需添加等价项<code>@ExtendWith(SpringExtension.class)</code>，<code>@SpringBootTest</code>并且其他<code>@…Test</code>注释已经在其中进行了注释。</p></div> <p>默认情况下，<code>@SpringBootTest</code>不会启动服务器。您可以使用的<code>webEnvironment</code>属性<code>@SpringBootTest</code>进一步优化测试的运行方式：</p> <ul><li><code>MOCK</code>（默认）：加载Web <code>ApplicationContext</code>并提供模拟Web环境。使用此注释时，不会启动嵌入式服务器。如果您的类路径中没有网络环境，则此模式将透明地退回到创建常规非网络<code>ApplicationContext</code>。它可以与Web应用程序结合使用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-with-mock-environment" target="_blank" rel="noopener noreferrer"><code>@AutoConfigureMockMvc</code>或<code>@AutoConfigureWebTestClient</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>用于基于模拟的测试。</li> <li><code>RANDOM_PORT</code>：加载<code>WebServerApplicationContext</code>并提供真实的网络环境。嵌入式服务器将启动并在随机端口上侦听。</li> <li><code>DEFINED_PORT</code>：加载<code>WebServerApplicationContext</code>并提供真实的网络环境。嵌入式服务器将启动并在已定义的端口（来自<code>application.properties</code>）上或在的默认端口上进行侦听<code>8080</code>。</li> <li><code>NONE</code>：<code>ApplicationContext</code>通过使用加载，<code>SpringApplication</code>但不提供<em>任何</em>网络环境（模拟或其他方式）。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您的测试是<code>@Transactional</code>，则默认情况下它将在每个测试方法的末尾回滚事务。但是，由于将这种安排与一个<code>RANDOM_PORT</code>或多个<code>DEFINED_PORT</code>隐式提供真实的servlet环境一起使用，HTTP客户端和服务器在单独的线程中运行，因此在单独的事务中运行。在这种情况下，服务器上启动的任何事务都不会回滚。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>@SpringBootTest``webEnvironment = WebEnvironment.RANDOM_PORT</code>如果您的应用程序对管理服务器使用其他端口，则with 也将在单独的随机端口上启动管理服务器。</p></div> <h4 id="_25-3-1。检测web应用程序类型"><a href="#_25-3-1。检测web应用程序类型" class="header-anchor">#</a> 25.3.1。检测Web应用程序类型</h4> <p>如果Spring MVC可用，则配置基于常规MVC的应用程序上下文。如果您只有Spring WebFlux，我们将检测到它并配置基于WebFlux的应用程序上下文。</p> <p>如果两者都存在，则Spring MVC优先。如果要在这种情况下测试反应式Web应用程序，则必须设置<code>spring.main.web-application-type</code>属性：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token string">&quot;spring.main.web-application-type=reactive&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyWebFluxTests</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-2。检测测试配置"><a href="#_25-3-2。检测测试配置" class="header-anchor">#</a> 25.3.2。检测测试配置</h4> <p>如果您熟悉Spring Test Framework，则可能习惯于使用<code>@ContextConfiguration(classes=…)</code>来指定<code>@Configuration</code>要加载哪个Spring 。另外，您可能经常<code>@Configuration</code>在测试中使用嵌套类。</p> <p>在测试Spring Boot应用程序时，通常不需要这样做。<code>@*Test</code>只要您没有明确定义Spring Boot的注释，它就会自动搜索您的主要配置。</p> <p>搜索算法从包含测试的程序包开始工作，直到找到带有<code>@SpringBootApplication</code>或注释的类<code>@SpringBootConfiguration</code>。只要您以合理的方式<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot-structuring-your-code" target="_blank" rel="noopener noreferrer">对代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/using-spring-boot.html#using-boot-structuring-your-code" target="_blank" rel="noopener noreferrer">结构化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，通常就可以找到您的主要配置。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果使用<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests" target="_blank" rel="noopener noreferrer">测试注释来测试应用程序的更特定的部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，则应避免在<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-user-configuration" target="_blank" rel="noopener noreferrer">main方法的应用程序类<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上添加特定于特定区域的配置设置。define的基础组件扫描配置<code>@SpringBootApplication</code>排除了用于确保切片按预期工作的过滤器。如果<code>@ComponentScan</code>在<code>@SpringBootApplication</code>-annotated类上使用显式指令，请注意这些过滤器将被禁用。如果使用切片，则应再次定义它们。</p></div> <p>如果要自定义主要配置，则可以使用嵌套<code>@TestConfiguration</code>类。与<code>@Configuration</code>将使用嵌套类代替应用程序的主要配置的嵌套<code>@TestConfiguration</code>类不同，除了应用程序的主要配置之外，还使用了嵌套类。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring的测试框架在测试之间缓存应用程序上下文。因此，只要您的测试共享相同的配置（无论如何发现），加载上下文的潜在耗时过程就只会发生一次。</p></div> <h4 id="_25-3-3。排除测试配置"><a href="#_25-3-3。排除测试配置" class="header-anchor">#</a> 25.3.3。排除测试配置</h4> <p>如果您的应用程序使用组件扫描（例如，如果使用<code>@SpringBootApplication</code>或<code>@ComponentScan</code>），则可能会偶然发现到处仅为特定测试创建的顶级配置类。</p> <p>如我们<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-detecting-config" target="_blank" rel="noopener noreferrer">先前所见<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<code>@TestConfiguration</code>可以在测试的内部类上使用来自定义主要配置。当放置在顶级类上时，<code>@TestConfiguration</code>指示<code>src/test/java</code>不应通过扫描来拾取其中的类。然后，可以在需要的位置显式导入该类，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">MyTestsConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您直接使用<code>@ComponentScan</code>（即不是通过<code>@SpringBootApplication</code>），则需要向其注册<code>TypeExcludeFilter</code>。有关详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/context/TypeExcludeFilter.html" target="_blank" rel="noopener noreferrer">Javadoc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_25-3-4。使用应用程序参数"><a href="#_25-3-4。使用应用程序参数" class="header-anchor">#</a> 25.3.4。使用应用程序参数</h4> <p>如果您的应用程序需要<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-application-arguments" target="_blank" rel="noopener noreferrer">参数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，则可以<code>@SpringBootTest</code>使用<code>args</code>属性将其注入。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>args <span class="token operator">=</span> <span class="token string">&quot;--app.test=one&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ApplicationArgumentsExampleTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">applicationArgumentsPopulated</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">ApplicationArguments</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">getOptionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">containsOnly</span><span class="token punctuation">(</span><span class="token string">&quot;app.test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">getOptionValues</span><span class="token punctuation">(</span><span class="token string">&quot;app.test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">containsOnly</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-5。在模拟环境中进行测试"><a href="#_25-3-5。在模拟环境中进行测试" class="header-anchor">#</a> 25.3.5。在模拟环境中进行测试</h4> <p>默认情况下，<code>@SpringBootTest</code>不启动服务器。如果您有要在此模拟环境下进行测试的Web终结点，则可以另外配置<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference//testing.html#spring-mvc-test-framework" target="_blank" rel="noopener noreferrer"><code>MockMvc</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span><span class="token class-name">AutoConfigureMockMvc</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span><span class="token class-name">MockMvc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request</span><span class="token punctuation">.</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span>get<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result</span><span class="token punctuation">.</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>content<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result</span><span class="token punctuation">.</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>status<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">class</span> <span class="token class-name">MockMvcExampleTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您只想专注于Web层而不希望完全完成<code>ApplicationContext</code>，请考虑<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests" target="_blank" rel="noopener noreferrer">使用<code>@WebMvcTest</code>代替<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>或者，您可以配置<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/testing.html#webtestclient-tests" target="_blank" rel="noopener noreferrer"><code>WebTestClient</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive</span><span class="token punctuation">.</span><span class="token class-name">AutoConfigureWebTestClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">WebTestClient</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@AutoConfigureWebTestClient</span>
<span class="token keyword">class</span> <span class="token class-name">MockWebTestClientExampleTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">WebTestClient</span> webClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expectBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在模拟环境中进行测试通常比在完整的Servlet容器中运行更快。但是，由于模拟发生在Spring MVC层，因此无法使用MockMvc直接测试依赖于较低级别Servlet容器行为的代码。例如，Spring Boot的错误处理基于Servlet容器提供的“错误页面”支持。这意味着，尽管您可以按预期测试MVC层引发和处理异常，但是您无法直接测试特定的是否呈现<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-error-handling-custom-error-pages" target="_blank" rel="noopener noreferrer">自定义错误页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果需要测试这些较低级别的问题，则可以按照下一节中的描述启动一个完全运行的服务器。</p></div> <h4 id="_25-3-6。使用正在运行的服务器进行测试"><a href="#_25-3-6。使用正在运行的服务器进行测试" class="header-anchor">#</a> 25.3.6。使用正在运行的服务器进行测试</h4> <p>如果需要启动完全运行的服务器，建议您使用随机端口。如果使用<code>@SpringBootTest(webEnvironment=WebEnvironment.RANDOM_PORT)</code>，则每次运行测试时都会随机选择一个可用端口。</p> <p>该<code>@LocalServerPort</code>注释可用于<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto-discover-the-http-port-at-runtime" target="_blank" rel="noopener noreferrer">注射使用的实际端口<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>到您的测试。为了方便起见，需要对启动的服务器进行REST调用的测试可以另外<code>@Autowire</code>使用<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/testing.html#webtestclient-tests" target="_blank" rel="noopener noreferrer"><code>WebTestClient</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它解析到正在运行的服务器的相对链接，并带有用于验证响应的专用API，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">.</span><span class="token class-name">WebEnvironment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">WebTestClient</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RandomPortWebTestClientExampleTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">WebTestClient</span> webClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expectBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>此设置要求<code>spring-webflux</code>在类路径上。如果您不能或不会添加webflux，Spring Boot还提供了以下<code>TestRestTemplate</code>功能：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">.</span><span class="token class-name">WebEnvironment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client</span><span class="token punctuation">.</span><span class="token class-name">TestRestTemplate</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">RandomPortTestRestTemplateExampleTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">TestRestTemplate</span> restTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-7。自定义webtestclient"><a href="#_25-3-7。自定义webtestclient" class="header-anchor">#</a> 25.3.7。自定义WebTestClient</h4> <p>自定义 <code>WebTestClient</code> Bean，请配置<code>WebTestClientBuilderCustomizer</code>Bean。<code>WebTestClient.Builder</code>会使用用来创建的任何此类bean进行调用<code>WebTestClient</code>。</p> <h4 id="_25-3-8。使用jmx"><a href="#_25-3-8。使用jmx" class="header-anchor">#</a> 25.3.8。使用JMX</h4> <p>由于测试上下文框架缓存上下文，因此默认情况下禁用JMX以防止相同组件在同一域上注册。如果此类测试需要访问<code>MBeanServer</code>，请考虑将其标记为脏：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">SpringExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token string">&quot;spring.jmx.enabled=true&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@DirtiesContext</span>
<span class="token keyword">class</span> <span class="token class-name">SampleJmxTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MBeanServer</span> mBeanServer<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-9。模拟豆和间谍豆"><a href="#_25-3-9。模拟豆和间谍豆" class="header-anchor">#</a> 25.3.9。模拟豆和间谍豆</h4> <p>运行测试时，有时有必要在应用程序上下文中模拟某些组件。例如，您可能在开发过程中无法使用某些远程服务的外观。当您要模拟在实际环境中可能难以触发的故障时，模拟也很有用。</p> <p>Spring Boot包含一个<code>@MockBean</code>注释，可用于为您的Bean中的bean定义Mockito模拟<code>ApplicationContext</code>。您可以使用批注添加新bean或替换单个现有bean定义。注释可以直接用于测试类，测试中的字段或<code>@Configuration</code>类和字段。在字段上使用时，还将注入创建的模拟的实例。每种测试方法后，模拟豆都会自动重置。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您的测试使用Spring Boot的测试注释之一（例如<code>@SpringBootTest</code>），则此功能会自动启用。要以其他方式使用此功能，必须显式添加侦听器，如以下示例所示：<code>@TestExecutionListeners(MockitoTestExecutionListener.class)</code></p></div> <p>下面的示例用<code>RemoteService</code>模拟实现替换现有的bean：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span><span class="token class-name">BDDMockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">MyTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@MockBean</span>
    <span class="token keyword">private</span> <span class="token class-name">RemoteService</span> remoteService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">Reverser</span> reverser<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">exampleTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// RemoteService has been injected into the reverser bean</span>
        <span class="token function">given</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>remoteService<span class="token punctuation">.</span><span class="token function">someCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token string">&quot;mock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> reverse <span class="token operator">=</span> reverser<span class="token punctuation">.</span><span class="token function">reverseSomeCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>reverse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;kcom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>@MockBean</code>不能用于模拟应用程序上下文刷新期间执行的bean的行为。到执行测试时，应用程序上下文刷新已完成，并且配置模拟行为为时已晚。我们建议<code>@Bean</code>在这种情况下使用一种方法来创建和配置模拟。</p></div> <p>另外，您可以使用<code>@SpyBean</code>Mockito来包装任何现有的bean <code>spy</code>。有关完整的详细信息，请参见<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api//org/springframework/boot/test/mock/mockito/SpyBean.html" target="_blank" rel="noopener noreferrer">Javadoc<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>CGLib代理（例如为范围内的Bean创建的代理）将代理方法声明为<code>final</code>。这会阻止Mockito正常运行，因为它无法模拟或监视<code>final</code>其默认配置中的方法。如果要模拟或监视此类bean，请通过添加<code>org.mockito:mockito-inline</code>到应用程序的测试依赖项中，将Mockito配置为使用其内联模拟生成器。这允许Mockito模拟和监视<code>final</code>方法。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring的测试框架在测试之间缓存应用程序上下文，并为共享相同配置的测试重用上下文，但是缓存密钥的使用<code>@MockBean</code>或<code>@SpyBean</code>影响缓存密钥，这很可能会增加上下文的数量。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您使用<code>@SpyBean</code>带有<code>@Cacheable</code>通过名称引用参数的方法来监视Bean，则必须使用编译应用程序<code>-parameters</code>。这样可以确保一旦侦察到bean，参数名称就可用于缓存基础结构。</p></div> <h4 id="_25-3-10。自动配置的测试"><a href="#_25-3-10。自动配置的测试" class="header-anchor">#</a> 25.3.10。自动配置的测试</h4> <p>Spring Boot的自动配置系统适用于应用程序，但有时对于测试来说可能有点过多。它通常仅有助于加载测试应用程序“切片”所需的配置部分。例如，您可能想要测试Spring MVC控制器是否正确映射了URL，并且您不想在这些测试中涉及数据库调用，或者您想要测试JPA实体，并且对那些JPA实体不感兴趣。测试运行。</p> <p>该<code>spring-boot-test-autoconfigure</code>模块包括许多注释，可用于自动配置此类“切片”。它们中的每一个都以类似的方式工作，提供了一个<code>@…Test</code>加载的注释<code>ApplicationContext</code>以及一个或多个<code>@AutoConfigure…</code>可用于自定义自动配置设置的注释。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>每个切片将组件扫描限制为适当的组件，并加载一组非常受限制的自动配置类。如果您需要排除其中之一，则大多数<code>@…Test</code>注释都提供一个<code>excludeAutoConfiguration</code>属性。或者，您可以使用<code>@ImportAutoConfiguration#exclude</code>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>@…Test</code>不支持在一个测试中 通过使用多个注释来包含多个“切片” 。如果需要多个“切片”，请选择其中一个<code>@…Test</code>注释，并<code>@AutoConfigure…</code>手动添加其他“切片” 的注释。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>也可以将<code>@AutoConfigure…</code>注释与标准<code>@SpringBootTest</code>注释一起使用。如果您对“切片”应用程序不感兴趣，但需要一些自动配置的测试bean，则可以使用此组合。</p></div> <h4 id="_25-3-11。自动配置的json测试"><a href="#_25-3-11。自动配置的json测试" class="header-anchor">#</a> 25.3.11。自动配置的JSON测试</h4> <p>要测试对象JSON序列化和反序列化是否按预期工作，可以使用<code>@JsonTest</code>批注。 <code>@JsonTest</code>自动配置可用的受支持的JSON映射器，该映射器可以是以下库之一：</p> <ul><li>杰克逊<code>ObjectMapper</code>，任何<code>@JsonComponent</code>豆子和任何杰克逊<code>Module</code>的</li> <li><code>Gson</code></li> <li><code>Jsonb</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由启用了自动配置的列表<code>@JsonTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>如果需要配置自动配置的元素，则可以使用<code>@AutoConfigureJsonTesters</code>注释。</p> <p>Spring Boot包含基于AssertJ的帮助程序，这些帮助程序可与JSONAssert和JsonPath库一起使用，以检查JSON是否按预期方式显示。的<code>JacksonTester</code>，<code>GsonTester</code>，<code>JsonbTester</code>，和<code>BasicJsonTester</code>类可以分别用于杰克逊，GSON，Jsonb，和字符串。<code>@Autowired</code>使用时，可以在测试类上使用任何帮助程序字段<code>@JsonTest</code>。以下示例显示了Jackson的测试类：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>json</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>json</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@JsonTest</span>
<span class="token keyword">class</span> <span class="token class-name">MyJsonTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JacksonTester</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">VehicleDetails</span><span class="token punctuation">&gt;</span></span> json<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testSerialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">VehicleDetails</span> details <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Assert against a `.json` file in the same package as the test</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualToJson</span><span class="token punctuation">(</span><span class="token string">&quot;expected.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Or use JSON path based assertions</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasJsonPathStringValue</span><span class="token punctuation">(</span><span class="token string">&quot;@.make&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extractingJsonPathStringValue</span><span class="token punctuation">(</span><span class="token string">&quot;@.make&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testDeserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;{\&quot;make\&quot;:\&quot;Ford\&quot;,\&quot;model\&quot;:\&quot;Focus\&quot;}&quot;</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Ford&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Focus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Ford&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>JSON帮助程序类也可以直接在标准单元测试中使用。为此，如果不使用，请<code>initFields</code>在您的<code>@Before</code>方法中调用辅助方法<code>@JsonTest</code>。</p></div> <p>如果您正在使用基于Spring Boot的基于AssertJ的助手来声明给定JSON路径上的数字值，则可能无法使用，<code>isEqualTo</code>具体取决于类型。相反，您可以使用AssertJ <code>satisfies</code>声明该值匹配给定条件。例如，以下示例断言实际数字是一个接近于<code>0.15</code>偏移量内的浮点值<code>0.01</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token function">assertThat</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">extractingJsonPathNumberValue</span><span class="token punctuation">(</span><span class="token string">&quot;@.test.numberValue&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">satisfies</span><span class="token punctuation">(</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">assertThat</span><span class="token punctuation">(</span>number<span class="token punctuation">.</span><span class="token function">floatValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isCloseTo</span><span class="token punctuation">(</span><span class="token number">0.15f</span><span class="token punctuation">,</span> <span class="token function">within</span><span class="token punctuation">(</span><span class="token number">0.01f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_25-3-12。自动配置的spring-mvc测试"><a href="#_25-3-12。自动配置的spring-mvc测试" class="header-anchor">#</a> 25.3.12。自动配置的Spring MVC测试</h4> <p>要测试Spring MVC控制器是否按预期工作，请使用<code>@WebMvcTest</code>注释。 <code>@WebMvcTest</code>自动配置Spring MVC的基础设施和限制扫描豆<code>@Controller</code>，<code>@ControllerAdvice</code>，<code>@JsonComponent</code>，<code>Converter</code>，<code>GenericConverter</code>，<code>Filter</code>，<code>HandlerInterceptor</code>，<code>WebMvcConfigurer</code>，和<code>HandlerMethodArgumentResolver</code>。<code>@Component</code>使用此注释时，不扫描常规bean。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>启用的自动配置设置列表<code>@WebMvcTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果需要注册其他组件，例如Jackson <code>Module</code>，则可以<code>@Import</code>在测试中使用来导入其他配置类。</p></div> <p>通常，<code>@WebMvcTest</code>它仅限于单个控制器，并且与<code>@MockBean</code>以为所需的协作者提供模拟实现。</p> <p><code>@WebMvcTest</code>也可以自动配置<code>MockMvc</code>。Mock MVC提供了一种强大的方法来快速测试MVC控制器，而无需启动完整的HTTP服务器。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您还可以通过使用注释<code>MockMvc</code>在非<code>@WebMvcTest</code>（例如<code>@SpringBootTest</code>）中进行自动配置<code>@AutoConfigureMockMvc</code>。以下示例使用<code>MockMvc</code>：</p></div> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span><span class="token class-name">BDDMockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request</span><span class="token punctuation">.</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result</span><span class="token punctuation">.</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebMvcTest</span><span class="token punctuation">(</span><span class="token class-name">UserVehicleController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyControllerTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@MockBean</span>
    <span class="token keyword">private</span> <span class="token class-name">UserVehicleService</span> userVehicleService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token function">given</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userVehicleService<span class="token punctuation">.</span><span class="token function">getVehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/sboot/vehicle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;Honda Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您需要配置自动配置的元素（例如，当应该应用servlet过滤器时），则可以在<code>@AutoConfigureMockMvc</code>注释中使用属性。</p></div> <p>如果使用HtmlUnit或Selenium，则自动配置还会提供HtmlUnit <code>WebClient</code>bean和/或Selenium <code>WebDriver</code>bean。以下示例使用HtmlUnit：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>gargoylesoftware<span class="token punctuation">.</span>htmlunit</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito</span><span class="token punctuation">.</span><span class="token class-name">BDDMockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebMvcTest</span><span class="token punctuation">(</span><span class="token class-name">UserVehicleController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyHtmlUnitTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">WebClient</span> webClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@MockBean</span>
    <span class="token keyword">private</span> <span class="token class-name">UserVehicleService</span> userVehicleService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token function">given</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userVehicleService<span class="token punctuation">.</span><span class="token function">getVehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HtmlPage</span> page <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webClient<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token string">&quot;/sboot/vehicle.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTextContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Honda Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>默认情况下，Spring Boot将<code>WebDriver</code>bean放入一个特殊的“作用域”中，以确保驱动程序在每次测试后退出并注入新实例。如果您不希望出现这种情况，可以将其添加<code>@Scope(&quot;singleton&quot;)</code>到<code>WebDriver</code> <code>@Bean</code>定义中。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>webDriver</code>Spring Boot创建 的作用域将替换任何用户定义的同名作用域。如果您定义自己的<code>webDriver</code>范围，则可能会发现它在使用时停止工作<code>@WebMvcTest</code>。</p></div> <p>如果您在类路径上具有Spring Security，<code>@WebMvcTest</code>还将扫描<code>WebSecurityConfigurer</code>bean。您可以使用Spring Security的测试支持，而不是完全禁用此类测试的安全性。有关如何使用Spring Security <code>MockMvc</code>支持的更多详细信息，请参见<em>howto.html操作</em>方法部分。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有时编写Spring MVC测试是不够的。Spring Boot可以帮助您在<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener noreferrer">实际服务器上<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>运行<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener noreferrer">完整的端到端测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_25-3-13。自动配置的spring-webflux测试"><a href="#_25-3-13。自动配置的spring-webflux测试" class="header-anchor">#</a> 25.3.13。自动配置的Spring WebFlux测试</h4> <p>要测试<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference//web-reactive.html" target="_blank" rel="noopener noreferrer">Spring WebFlux<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>控制器是否按预期工作，可以使用<code>@WebFluxTest</code>注释。 <code>@WebFluxTest</code>自动配置春季WebFlux基础设施和限制扫描豆<code>@Controller</code>，<code>@ControllerAdvice</code>，<code>@JsonComponent</code>，<code>Converter</code>，<code>GenericConverter</code>，<code>WebFilter</code>，和<code>WebFluxConfigurer</code>。使用注释<code>@Component</code>时，不扫描常规Bean <code>@WebFluxTest</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由启用了自动配置的列表<code>@WebFluxTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果需要注册其他组件，例如Jackson <code>Module</code>，则可以<code>@Import</code>在测试中使用导入其他配置类。</p></div> <p>通常，<code>@WebFluxTest</code>它仅限于单个控制器，并且与<code>@MockBean</code>注释结合使用以为所需的协作者提供模拟实现。</p> <p><code>@WebFluxTest</code>还自动配置<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/testing.html#webtestclient" target="_blank" rel="noopener noreferrer"><code>WebTestClient</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它提供了一种强大的方法来快速测试WebFlux控制器，而无需启动完整的HTTP服务器。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您还可以通过使用注释<code>WebTestClient</code>在非<code>@WebFluxTest</code>（例如<code>@SpringBootTest</code>）中进行自动配置<code>@AutoConfigureWebTestClient</code>。以下示例显示了同时使用<code>@WebFluxTest</code>和的类<code>WebTestClient</code>：</p></div> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive</span><span class="token punctuation">.</span><span class="token class-name">WebFluxTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http</span><span class="token punctuation">.</span><span class="token class-name">MediaType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">WebTestClient</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebFluxTest</span><span class="token punctuation">(</span><span class="token class-name">UserVehicleController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyControllerTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">WebTestClient</span> webClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@MockBean</span>
    <span class="token keyword">private</span> <span class="token class-name">UserVehicleService</span> userVehicleService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token function">given</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userVehicleService<span class="token punctuation">.</span><span class="token function">getVehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">willReturn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VehicleDetails</span><span class="token punctuation">(</span><span class="token string">&quot;Honda&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/sboot/vehicle&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">expectBody</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;Honda Civic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>WebFlux应用程序仅支持此设置，因为<code>WebTestClient</code>在模拟Web应用程序中使用的设置目前仅适用于WebFlux。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>@WebFluxTest</code>无法检测通过功能Web框架注册的路由。要<code>RouterFunction</code>在上下文中测试Bean，请考虑<code>RouterFunction</code>通过<code>@Import</code>或使用导入自己<code>@SpringBootTest</code>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>@WebFluxTest</code>无法检测通过<code>@Bean</code>类型为的注册的自定义安全配置<code>SecurityWebFilterChain</code>。要将其包括在测试中，您将需要通过<code>@Import</code>或使用导入注册Bean的配置<code>@SpringBootTest</code>。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>有时编写Spring WebFlux测试是不够的。Spring Boot可以帮助您在<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener noreferrer">实际服务器上<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>运行<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener noreferrer">完整的端到端测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h4 id="_25-3-14。自动配置的数据jpa测试"><a href="#_25-3-14。自动配置的数据jpa测试" class="header-anchor">#</a> 25.3.14。自动配置的数据JPA测试</h4> <p>您可以使用<code>@DataJpaTest</code>注释来测试JPA应用程序。默认情况下，它将扫描<code>@Entity</code>类并配置Spring Data JPA存储库。如果在类路径上有嵌入式数据库，它也将配置一个。常规<code>@Component</code>Bean未加载到中<code>ApplicationContext</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>启用的自动配置设置列表<code>@DataJpaTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>默认情况下，数据JPA测试是事务性的，并在每次测试结束时回滚。有关更多详细信息，请参见《Spring Framework参考文档》中的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_blank" rel="noopener noreferrer">相关部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果这不是您想要的，则可以按以下方式禁用测试或整个类的事务管理：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa</span><span class="token punctuation">.</span><span class="token class-name">DataJpaTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Propagation</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@DataJpaTest</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>NOT_SUPPORTED<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleNonTransactionalTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>数据JPA测试也可以注入<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/orm/jpa/TestEntityManager.java" target="_blank" rel="noopener noreferrer"><code>TestEntityManager</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>Bean，这<code>EntityManager</code>是专门为测试设计的标准JPA的替代方法。如果要<code>TestEntityManager</code>在<code>@DataJpaTest</code>实例外部使用，也可以使用<code>@AutoConfigureTestEntityManager</code>注释。<code>JdbcTemplate</code>如果需要，也可以使用A。以下示例显示了<code>@DataJpaTest</code>正在使用的注释：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@DataJpaTest</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleRepositoryTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TestEntityManager</span> entityManager<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> repository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>entityManager<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>repository<span class="token punctuation">.</span><span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;sboot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getVin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>内存嵌入式数据库通常运行良好，不需要任何安装，因此通常可以很好地进行测试。但是，如果您希望对真实数据库运行测试，则可以使用<code>@AutoConfigureTestDatabase</code>注释，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DataJpaTest</span>
<span class="token annotation punctuation">@AutoConfigureTestDatabase</span><span class="token punctuation">(</span>replace<span class="token operator">=</span><span class="token class-name">Replace</span><span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleRepositoryTests</span> <span class="token punctuation">{</span>

    <span class="token comment">// ...</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-15。自动配置的jdbc测试"><a href="#_25-3-15。自动配置的jdbc测试" class="header-anchor">#</a> 25.3.15。自动配置的JDBC测试</h4> <p><code>@JdbcTest</code>与相似，<code>@DataJpaTest</code>但适用于仅需<code>DataSource</code>使用且不使用Spring Data JDBC的测试。默认情况下，它配置一个内存嵌入式数据库和一个<code>JdbcTemplate</code>。常规<code>@Component</code>Bean未加载到中<code>ApplicationContext</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由启用了自动配置的列表<code>@JdbcTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>缺省情况下，JDBC测试是事务性的，并在每个测试结束时回滚。有关更多详细信息，请参见《Spring Framework参考文档》中的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_blank" rel="noopener noreferrer">相关部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果这不是您想要的，则可以为测试或整个类禁用事务管理，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jdbc</span><span class="token punctuation">.</span><span class="token class-name">JdbcTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Propagation</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@JdbcTest</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>NOT_SUPPORTED<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleNonTransactionalTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您希望测试针对真实的数据库运行，则可以使用<code>@AutoConfigureTestDatabase</code>与相同的注释方式<code>DataJpaTest</code>。（请参阅“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test" target="_blank" rel="noopener noreferrer">自动配置的数据JPA测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。）</p> <h4 id="_25-3-16。自动配置的数据jdbc测试"><a href="#_25-3-16。自动配置的数据jdbc测试" class="header-anchor">#</a> 25.3.16。自动配置的数据JDBC测试</h4> <p><code>@DataJdbcTest</code>类似于<code>@JdbcTest</code>但适用于使用Spring Data JDBC存储库的测试。默认情况下，它配置一个内存嵌入式数据库，一个<code>JdbcTemplate</code>和Spring Data JDBC存储库。常规<code>@Component</code>Bean未加载到中<code>ApplicationContext</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由启用了自动配置的列表<code>@DataJdbcTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>默认情况下，Data JDBC测试是事务性的，并在每个测试结束时回滚。有关更多详细信息，请参见《Spring Framework参考文档》中的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_blank" rel="noopener noreferrer">相关部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果这不是您想要的，则可以禁用测试或整个测试类的事务管理，如<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test" target="_blank" rel="noopener noreferrer">JDBC示例所示<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>如果您希望测试针对真实的数据库运行，则可以使用<code>@AutoConfigureTestDatabase</code>与相同的注释方式<code>DataJpaTest</code>。（请参阅“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jpa-test" target="_blank" rel="noopener noreferrer">自动配置的数据JPA测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。）</p> <h4 id="_25-3-17。自动配置的jooq测试"><a href="#_25-3-17。自动配置的jooq测试" class="header-anchor">#</a> 25.3.17。自动配置的jOOQ测试</h4> <p>您可以使用<code>@JooqTest</code>与<code>@JdbcTest</code>jOOQ相关的测试类似的方式进行测试。由于jOOQ严重依赖与数据库模式相对应的基于Java的模式，因此<code>DataSource</code>将使用现有模式。如果要用内存数据库替换它，可以使用<code>@AutoConfigureTestDatabase</code>覆盖这些设置。（有关将jOOQ与Spring Boot结合使用的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-jooq" target="_blank" rel="noopener noreferrer">使用jOOQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。）常规<code>@Component</code>bean未加载到中<code>ApplicationContext</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>由启用了自动配置的列表<code>@JooqTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p><code>@JooqTest</code>配置一个<code>DSLContext</code>。常规<code>@Component</code>Bean未加载到中<code>ApplicationContext</code>。以下示例显示了<code>@JooqTest</code>正在使用的注释：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jooq</span><span class="token punctuation">.</span><span class="token class-name">DSLContext</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>jooq</span><span class="token punctuation">.</span><span class="token class-name">JooqTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@JooqTest</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleJooqTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">DSLContext</span> dslContext<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>JOOQ测试是事务性的，默认情况下会在每个测试结束时回滚。如果这不是您想要的，则可以禁用测试或整个测试类的事务管理，如<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-jdbc-test" target="_blank" rel="noopener noreferrer">JDBC示例所示<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="_25-3-18。自动配置的数据mongodb测试"><a href="#_25-3-18。自动配置的数据mongodb测试" class="header-anchor">#</a> 25.3.18。自动配置的数据MongoDB测试</h4> <p>您可以<code>@DataMongoTest</code>用来测试MongoDB应用程序。默认情况下，它配置内存嵌入式MongoDB（如果可用），配置<code>MongoTemplate</code>，扫描<code>@Document</code>类，并配置Spring Data MongoDB存储库。常规<code>@Component</code>Bean未加载到中<code>ApplicationContext</code>。（有关在Spring Boot中结合使用MongoDB的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-mongodb" target="_blank" rel="noopener noreferrer">MongoDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。）</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>启用的自动配置设置列表<code>@DataMongoTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>此类显示<code>@DataMongoTest</code>正在使用的注释：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongo</span><span class="token punctuation">.</span><span class="token class-name">DataMongoTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">MongoTemplate</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@DataMongoTest</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleDataMongoTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>

    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>内存嵌入式MongoDB通常运行良好，并且不需要任何开发人员安装，因此通常可以很好地用于测试。但是，如果您希望对真实的MongoDB服务器运行测试，则应排除嵌入式MongoDB自动配置，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>mongo<span class="token punctuation">.</span>embedded</span><span class="token punctuation">.</span><span class="token class-name">EmbeddedMongoAutoConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongo</span><span class="token punctuation">.</span><span class="token class-name">DataMongoTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@DataMongoTest</span><span class="token punctuation">(</span>excludeAutoConfiguration <span class="token operator">=</span> <span class="token class-name">EmbeddedMongoAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleDataMongoNonEmbeddedTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-19。自动配置的数据neo4j测试"><a href="#_25-3-19。自动配置的数据neo4j测试" class="header-anchor">#</a> 25.3.19。自动配置的数据Neo4j测试</h4> <p>您可以<code>@DataNeo4jTest</code>用来测试Neo4j应用程序。默认情况下，它使用内存中嵌入式Neo4j（如果有嵌入式驱动程序可用），扫描<code>@NodeEntity</code>类并配置Spring Data Neo4j存储库。常规<code>@Component</code>Bean未加载到中<code>ApplicationContext</code>。（有关将Neo4J与Spring Boot结合使用的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-neo4j" target="_blank" rel="noopener noreferrer">Neo4j<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。）</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>启用的自动配置设置列表<code>@DataNeo4jTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>以下示例显示了在Spring Boot中使用Neo4J测试的典型设置：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>neo4j</span><span class="token punctuation">.</span><span class="token class-name">DataNeo4jTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@DataNeo4jTest</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleDataNeo4jTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">YourRepository</span> repository<span class="token punctuation">;</span>

    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，Data Neo4j测试是事务性的，并在每次测试结束时回滚。有关更多详细信息，请参见《Spring Framework参考文档》中的<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions" target="_blank" rel="noopener noreferrer">相关部分<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果这不是您想要的，则可以为测试或整个类禁用事务管理，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>neo4j</span><span class="token punctuation">.</span><span class="token class-name">DataNeo4jTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Propagation</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@DataNeo4jTest</span>
<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span>NOT_SUPPORTED<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleNonTransactionalTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-20。自动配置的数据redis测试"><a href="#_25-3-20。自动配置的数据redis测试" class="header-anchor">#</a> 25.3.20。自动配置的数据Redis测试</h4> <p>您可以<code>@DataRedisTest</code>用来测试Redis应用程序。默认情况下，它会扫描<code>@RedisHash</code>类并配置Spring Data Redis存储库。常规<code>@Component</code>Bean未加载到中<code>ApplicationContext</code>。（有关在Spring Boot中使用Redis的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-redis" target="_blank" rel="noopener noreferrer">Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。）</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>启用的自动配置设置列表<code>@DataRedisTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>以下示例显示了<code>@DataRedisTest</code>正在使用的注释：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis</span><span class="token punctuation">.</span><span class="token class-name">DataRedisTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@DataRedisTest</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleDataRedisTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">YourRepository</span> repository<span class="token punctuation">;</span>

    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-21。自动配置的数据ldap测试"><a href="#_25-3-21。自动配置的数据ldap测试" class="header-anchor">#</a> 25.3.21。自动配置的数据LDAP测试</h4> <p>您可以<code>@DataLdapTest</code>用来测试LDAP应用程序。默认情况下，它配置内存嵌入式LDAP（如果可用），配置<code>LdapTemplate</code>，扫描<code>@Entry</code>类，并配置Spring Data LDAP存储库。常规<code>@Component</code>Bean未加载到中<code>ApplicationContext</code>。（有关将LDAP与Spring Boot结合使用的更多信息，请参阅本章前面的“ <a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-ldap" target="_blank" rel="noopener noreferrer">LDAP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ”。）</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>启用的自动配置设置列表<code>@DataLdapTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>以下示例显示了<code>@DataLdapTest</code>正在使用的注释：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ldap</span><span class="token punctuation">.</span><span class="token class-name">DataLdapTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>core</span><span class="token punctuation">.</span><span class="token class-name">LdapTemplate</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@DataLdapTest</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleDataLdapTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LdapTemplate</span> ldapTemplate<span class="token punctuation">;</span>

    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>内存嵌入式LDAP通常非常适合测试，因为它速度快并且不需要安装任何开发人员。但是，如果您希望针对真实的LDAP服务器运行测试，则应排除嵌入式LDAP自动配置，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>ldap<span class="token punctuation">.</span>embedded</span><span class="token punctuation">.</span><span class="token class-name">EmbeddedLdapAutoConfiguration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ldap</span><span class="token punctuation">.</span><span class="token class-name">DataLdapTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@DataLdapTest</span><span class="token punctuation">(</span>excludeAutoConfiguration <span class="token operator">=</span> <span class="token class-name">EmbeddedLdapAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleDataLdapNonEmbeddedTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-22。自动配置的rest客户端"><a href="#_25-3-22。自动配置的rest客户端" class="header-anchor">#</a> 25.3.22。自动配置的REST客户端</h4> <p>您可以使用<code>@RestClientTest</code>注释来测试REST客户端。默认情况下，它会自动配置Jackson，GSON和Jsonb支持，配置<code>RestTemplateBuilder</code>，并添加对的支持<code>MockRestServiceServer</code>。常规<code>@Component</code>Bean未加载到中<code>ApplicationContext</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>启用的自动配置设置列表<code>@RestClientTest</code>可以<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-test-auto-configuration.html#test-auto-configuration" target="_blank" rel="noopener noreferrer">在附录中找到<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <p>应该使用的<code>value</code>或<code>components</code>属性来指定要测试的特定Bean <code>@RestClientTest</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestClientTest</span><span class="token punctuation">(</span><span class="token class-name">RemoteVehicleDetailsService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleRestClientTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RemoteVehicleDetailsService</span> service<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MockRestServiceServer</span> server<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">getVehicleDetailsWhenResultIsSuccessShouldReturnDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">requestTo</span><span class="token punctuation">(</span><span class="token string">&quot;/greet/details&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andRespond</span><span class="token punctuation">(</span><span class="token function">withSuccess</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> greeting <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token function">callRestService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-23。自动配置的spring-rest-docs测试"><a href="#_25-3-23。自动配置的spring-rest-docs测试" class="header-anchor">#</a> 25.3.23。自动配置的Spring REST Docs测试</h4> <p>您可以在Mock MVC，REST Assured或WebTestClient的测试中使用<code>@AutoConfigureRestDocs</code>批注来使用<a href="https://spring.io/projects/spring-restdocs" target="_blank" rel="noopener noreferrer">Spring REST Docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。它消除了Spring REST Docs中对JUnit扩展的需求。</p> <p><code>@AutoConfigureRestDocs</code>可以用来覆盖默认的输出目录（<code>target/generated-snippets</code>如果您使用的是Maven或<code>build/generated-snippets</code>Gradle）。它也可以用于配置出现在任何记录的URI中的主机，方案和端口。</p> <h5 id="使用mock-mvc自动配置的spring-rest-docs测试"><a href="#使用mock-mvc自动配置的spring-rest-docs测试" class="header-anchor">#</a> 使用Mock MVC自动配置的Spring REST Docs测试</h5> <p><code>@AutoConfigureRestDocs</code>自定义<code>MockMvc</code>bean以使用Spring REST Docs。您可以<code>@Autowired</code>像使用Mock MVC和Spring REST Docs一样，通过在测试中使用和使用它来注入它，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span><span class="token class-name">WebMvcTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http</span><span class="token punctuation">.</span><span class="token class-name">MediaType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet</span><span class="token punctuation">.</span><span class="token class-name">MockMvc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>restdocs<span class="token punctuation">.</span>mockmvc</span><span class="token punctuation">.</span><span class="token class-name">MockMvcRestDocumentation</span><span class="token punctuation">.</span>document<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request</span><span class="token punctuation">.</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span>get<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result</span><span class="token punctuation">.</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebMvcTest</span><span class="token punctuation">(</span><span class="token class-name">UserController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureRestDocs</span>
<span class="token keyword">class</span> <span class="token class-name">UserDocumentationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mvc<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">listUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token string">&quot;list-users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您需要对Spring REST Docs配置进行更多控制，而不是的属性所提供的控制<code>@AutoConfigureRestDocs</code>，则可以使用<code>RestDocsMockMvcConfigurationCustomizer</code>Bean，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@TestConfiguration</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationConfiguration</span>
        <span class="token keyword">implements</span> <span class="token class-name">RestDocsMockMvcConfigurationCustomizer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRestDocumentationConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        configurer<span class="token punctuation">.</span><span class="token function">snippets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withTemplateFormat</span><span class="token punctuation">(</span><span class="token class-name">TemplateFormats</span><span class="token punctuation">.</span><span class="token function">markdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果要使用Spring REST Docs对参数化输出目录的支持，则可以创建一个<code>RestDocumentationResultHandler</code>bean。<code>alwaysDo</code>使用此结果处理程序的自动配置调用，从而使每个<code>MockMvc</code>调用自动生成默认片段。以下示例显示了一个<code>RestDocumentationResultHandler</code>正在定义的对象：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@TestConfiguration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ResultHandlerConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestDocumentationResultHandler</span> <span class="token function">restDocumentation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">MockMvcRestDocumentation</span><span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token string">&quot;{method-name}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h5 id="使用webtestclient自动配置的spring-rest-docs测试"><a href="#使用webtestclient自动配置的spring-rest-docs测试" class="header-anchor">#</a> 使用WebTestClient自动配置的Spring REST Docs测试</h5> <p><code>@AutoConfigureRestDocs</code>也可以与一起使用<code>WebTestClient</code>。您可以<code>@Autowired</code>像在使用<code>@WebFluxTest</code>Spring REST Docs 时一样，通过在测试中使用和注入它来进行注入，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>restdocs</span><span class="token punctuation">.</span><span class="token class-name">AutoConfigureRestDocs</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive</span><span class="token punctuation">.</span><span class="token class-name">WebFluxTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">WebTestClient</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>restdocs<span class="token punctuation">.</span>webtestclient</span><span class="token punctuation">.</span><span class="token class-name">WebTestClientRestDocumentation</span><span class="token punctuation">.</span>document<span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebFluxTest</span>
<span class="token annotation punctuation">@AutoConfigureRestDocs</span>
<span class="token keyword">class</span> <span class="token class-name">UsersDocumentationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">WebTestClient</span> webTestClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">listUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>webTestClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expectStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expectBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">consumeWith</span><span class="token punctuation">(</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token string">&quot;list-users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您需要对Spring REST Docs配置进行更多控制，而不是的属性所提供的控制<code>@AutoConfigureRestDocs</code>，则可以使用<code>RestDocsWebTestClientConfigurationCustomizer</code>Bean，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@TestConfiguration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationConfiguration</span> <span class="token keyword">implements</span> <span class="token class-name">RestDocsWebTestClientConfigurationCustomizer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">WebTestClientRestDocumentationConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        configurer<span class="token punctuation">.</span><span class="token function">snippets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withEncoding</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h5 id="具有rest保证的自动配置的spring-rest-docs测试"><a href="#具有rest保证的自动配置的spring-rest-docs测试" class="header-anchor">#</a> 具有REST保证的自动配置的Spring REST Docs测试</h5> <p><code>@AutoConfigureRestDocs</code>使<code>RequestSpecification</code>预配置为使用Spring REST Docs 的bean可用于您的测试。您可以<code>@Autowired</code>像在使用REST Assured和Spring REST Docs时一样，通过在测试中使用和使用它来注入它，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>restassured<span class="token punctuation">.</span>specification</span><span class="token punctuation">.</span><span class="token class-name">RequestSpecification</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>restdocs</span><span class="token punctuation">.</span><span class="token class-name">AutoConfigureRestDocs</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">.</span><span class="token class-name">WebEnvironment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">LocalServerPort</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">io<span class="token punctuation">.</span>restassured</span><span class="token punctuation">.</span><span class="token class-name">RestAssured</span><span class="token punctuation">.</span>given<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>hamcrest</span><span class="token punctuation">.</span><span class="token class-name">Matchers</span><span class="token punctuation">.</span>is<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>restdocs<span class="token punctuation">.</span>restassured3</span><span class="token punctuation">.</span><span class="token class-name">RestAssuredRestDocumentation</span><span class="token punctuation">.</span>document<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureRestDocs</span>
<span class="token keyword">class</span> <span class="token class-name">UserDocumentationTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">listUsers</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Autowired</span> <span class="token class-name">RequestSpecification</span> documentationSpec<span class="token punctuation">,</span> <span class="token annotation punctuation">@LocalServerPort</span> <span class="token keyword">int</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">given</span><span class="token punctuation">(</span>documentationSpec<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token string">&quot;list-users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">port</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">assertThat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>如果您需要对Spring REST Docs配置进行更多控制，而不是的属性所提供的控制<code>@AutoConfigureRestDocs</code>，<code>RestDocsRestAssuredConfigurationCustomizer</code>则可以使用Bean，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@TestConfiguration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomizationConfiguration</span> <span class="token keyword">implements</span> <span class="token class-name">RestDocsRestAssuredConfigurationCustomizer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">customize</span><span class="token punctuation">(</span><span class="token class-name">RestAssuredRestDocumentationConfigurer</span> configurer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        configurer<span class="token punctuation">.</span><span class="token function">snippets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withTemplateFormat</span><span class="token punctuation">(</span><span class="token class-name">TemplateFormats</span><span class="token punctuation">.</span><span class="token function">markdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-3-24。额外的自动配置和切片"><a href="#_25-3-24。额外的自动配置和切片" class="header-anchor">#</a> 25.3.24。额外的自动配置和切片</h4> <p>每个切片提供一个或多个<code>@AutoConfigure…</code>注释，这些注释即定义应包含在切片中的自动配置。可以通过创建自定义<code>@AutoConfigure…</code>注释或简单地通过添加<code>@ImportAutoConfiguration</code>到测试中来添加其他自动配置，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@JdbcTest</span>
<span class="token annotation punctuation">@ImportAutoConfiguration</span><span class="token punctuation">(</span><span class="token class-name">IntegrationAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">ExampleJdbcTests</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>确保不要使用常规<code>@Import</code>注释来导入自动配置，因为它们是由Spring Boot以特定方式处理的。</p></div> <h4 id="_25-3-25。用户配置和切片"><a href="#_25-3-25。用户配置和切片" class="header-anchor">#</a> 25.3.25。用户配置和切片</h4> <p>如果您以合理的方式<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#using-boot-structuring-your-code" target="_blank" rel="noopener noreferrer">构建代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<code>@SpringBootApplication</code>则<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-detecting-config" target="_blank" rel="noopener noreferrer">默认情况下<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>将<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-detecting-config" target="_blank" rel="noopener noreferrer">使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>类作为测试的配置。</p> <p>因此，重要的是不要用特定于其功能特定区域的配置设置来乱扔应用程序的主类。</p> <p>假设您正在使用Spring Batch，并且依赖于它的自动配置。您可以定义<code>@SpringBootApplication</code>如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableBatchProcessing</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleApplication</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>因为此类是测试的源配置，所以任何切片测试实际上都尝试启动Spring Batch，这绝对不是您想要执行的操作。建议的方法是将特定于区域的配置移到<code>@Configuration</code>与您的应用程序相同级别的单独的类，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableBatchProcessing</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BatchConfiguration</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>根据您应用程序的复杂性，您可以<code>@Configuration</code>为您的自定义设置一个类，也可以为每个域区域指定一个类。后一种方法使您可以在其中的一个测试中启用该<code>@Import</code>注释（如有必要），并带有注释。</p></div> <p>测试切片将<code>@Configuration</code>类别排除在扫描范围之外。例如，对于a <code>@WebMvcTest</code>，以下配置将<code>WebMvcConfigurer</code>在测试切片加载的应用程序上下文中不包括给定的bean：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfiguration</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token function">testConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是，以下配置将导致自定义<code>WebMvcConfigurer</code>由测试片加载。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestWebMvcConfigurer</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>混乱的另一个来源是类路径扫描。假定在以合理的方式组织代码的同时，您需要扫描其他程序包。您的应用程序可能类似于以下代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;com.example.app&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;org.acme.another&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleApplication</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><p>这样做有效地覆盖了默认的组件扫描指令，并且具有扫描这两个软件包的副作用，而与您选择的切片无关。例如，a <code>@DataJpaTest</code>似乎突然扫描了应用程序的组件和用户配置。同样，将自定义指令移至单独的类是解决此问题的好方法。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果这不是您的选择，则可以<code>@SpringBootConfiguration</code>在测试层次结构中的某个位置创建一个位置，以代替使用它。或者，您可以为测试指定一个源，从而禁用查找默认源的行为。</p></div> <h4 id="_25-3-26。使用spock测试spring-boot应用程序"><a href="#_25-3-26。使用spock测试spring-boot应用程序" class="header-anchor">#</a> 25.3.26。使用Spock测试Spring Boot应用程序</h4> <p>如果您希望使用Spock测试Spring Boot应用程序，则应在<code>spock-spring</code>应用程序的构建中添加对Spock 模块的依赖。 <code>spock-spring</code>将Spring的测试框架集成到Spock中。建议您使用Spock 1.2或更高版本，以受益于Spock的Spring框架和Spring Boot集成的许多改进。有关更多详细信息，请参见<a href="http://spockframework.org/spock/docs/1.2/modules.html#_spring_module" target="_blank" rel="noopener noreferrer">Spock的Spring模块的文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_25-4。测试工具"><a href="#_25-4。测试工具" class="header-anchor">#</a> 25.4。测试工具</h3> <p>在测试应用程序时通常有用的一些测试实用程序类作为的一部分打包在一起<code>spring-boot</code>。</p> <h4 id="_25-4-1。configfileapplicationcontextinitializer"><a href="#_25-4-1。configfileapplicationcontextinitializer" class="header-anchor">#</a> 25.4.1。ConfigFileApplicationContextInitializer</h4> <p><code>ConfigFileApplicationContextInitializer</code>是一个<code>ApplicationContextInitializer</code>可以应用于测试以加载Spring Boot <code>application.properties</code>文件的工具。当您不需要所提供的全部功能时，可以使用它<code>@SpringBootTest</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    initializers <span class="token operator">=</span> <span class="token class-name">ConfigFileApplicationContextInitializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>ConfigFileApplicationContextInitializer</code>单独 使用不能为<code>@Value(&quot;${…}&quot;)</code>注射提供支持。唯一的工作就是确保将<code>application.properties</code>文件加载到Spring的中<code>Environment</code>。为了获得<code>@Value</code>支持，您需要另外配置a <code>PropertySourcesPlaceholderConfigurer</code>或使用<code>@SpringBootTest</code>，后者会为您自动配置一个。</p></div> <h4 id="_25-4-2。testpropertyvalues"><a href="#_25-4-2。testpropertyvalues" class="header-anchor">#</a> 25.4.2。TestPropertyValues</h4> <p><code>TestPropertyValues</code>可让您快速将属性添加到<code>ConfigurableEnvironment</code>或<code>ConfigurableApplicationContext</code>。您可以使用<code>key=value</code>字符串来调用它，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">TestPropertyValues</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;org=Spring&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name=Boot&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyTo</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_25-4-3。outputcapture"><a href="#_25-4-3。outputcapture" class="header-anchor">#</a> 25.4.3。OutputCapture</h4> <p><code>OutputCapture</code>是一个<code>Extension</code>可用于捕获<code>System.out</code>和<code>System.err</code>输出的JUnit 。要使用add <code>@ExtendWith(OutputCaptureExtension.class)</code>和ject <code>CapturedOutput</code>作为测试类构造函数或测试方法的参数，如下所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">OutputCaptureExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">OutputCaptureTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testName</span><span class="token punctuation">(</span><span class="token class-name">CapturedOutput</span> output<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_25-4-4。testresttemplate"><a href="#_25-4-4。testresttemplate" class="header-anchor">#</a> 25.4.4。TestRestTemplate</h4> <p><code>TestRestTemplate</code>是Spring的一种方便替代方法，<code>RestTemplate</code>在集成测试中很有用。您可以使用普通模板或发送基本HTTP身份验证（带有用户名和密码）的模板。在这两种情况下，模板都不会通过在服务器端错误上引发异常来以易于测试的方式运行。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Spring Framework 5.0提供了一个新功能<code>WebTestClient</code>，适用于<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests" target="_blank" rel="noopener noreferrer">WebFlux集成测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以及<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-with-running-server" target="_blank" rel="noopener noreferrer">WebFlux和MVC端到端测试<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。与相比，它为声明提供了流畅的API <code>TestRestTemplate</code>。</p></div> <p>建议（但不是强制性的）使用Apache HTTP Client（版本4.3.2或更高版本）。如果您在类路径中具有该名称，则<code>TestRestTemplate</code>通过适当配置客户端来做出响应。如果确实使用Apache的HTTP客户端，则会启用一些其他易于测试的功能：</p> <ul><li>不遵循重定向（因此您可以声明响应位置）。</li> <li>Cookies被忽略（因此模板是无状态的）。</li></ul> <p><code>TestRestTemplate</code> 可以在集成测试中直接实例化，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">TestRestTemplate</span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TestRestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span>
                <span class="token string">&quot;https://myhost.example.com/example&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasHost</span><span class="token punctuation">(</span><span class="token string">&quot;other.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>或者，如果将<code>@SpringBootTest</code>注释与<code>WebEnvironment.RANDOM_PORT</code>或结合使用，则<code>WebEnvironment.DEFINED_PORT</code>可以注入完全配置的注释<code>TestRestTemplate</code>并开始使用它。如有必要，可以通过<code>RestTemplateBuilder</code>Bean 应用其他定制。未指定主机和端口的所有URL都会自动连接到嵌入式服务器，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">SampleWebClientTests</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TestRestTemplate</span> template<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token string">&quot;/example&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasHost</span><span class="token punctuation">(</span><span class="token string">&quot;other.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@TestConfiguration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Bean</span>
        <span class="token class-name">RestTemplateBuilder</span> <span class="token function">restTemplateBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplateBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setReadTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_26-web套接字"><a href="#_26-web套接字" class="header-anchor">#</a> 26. Web套接字</h2> <p>Spring Boot为嵌入式Tomcat，Jetty和Undertow提供了WebSockets自动配置。如果将war文件部署到独立容器，Spring Boot会假定该容器负责其WebSocket支持的配置。</p> <p>Spring Framework 为MVC Web应用程序提供了<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web.html#websocket" target="_blank" rel="noopener noreferrer">丰富的WebSocket支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可以通过该<code>spring-boot-starter-websocket</code>模块轻松访问。</p> <p>WebSocket支持也可用于<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/web-reactive.html#webflux-websocket" target="_blank" rel="noopener noreferrer">反应式Web应用程序，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>并且需要在以下位置包括WebSocket API <code>spring-boot-starter-webflux</code>：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.websocket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.websocket-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_27-网络服务"><a href="#_27-网络服务" class="header-anchor">#</a> 27.网络服务</h2> <p>Spring Boot提供了Web服务自动配置，因此您所需要做的就是定义您的<code>Endpoints</code>。</p> <p>在<a href="https://docs.spring.io/spring-ws/docs/3.0.8.RELEASE/reference/" target="_blank" rel="noopener noreferrer">春天的Web服务功能<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以与轻松访问<code>spring-boot-starter-webservices</code>模块。</p> <p><code>SimpleWsdl11Definition</code>并且<code>SimpleXsdSchema</code>可以分别为您的WSDL和XSD自动创建bean。为此，请配置其位置，如以下示例所示：</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">spring.webservices.wsdl-locations</span><span class="token punctuation">=</span><span class="token attr-value">classpath:/wsdl</span>
</code></pre></div><h3 id="_27-1。使用调用web服务webservicetemplate"><a href="#_27-1。使用调用web服务webservicetemplate" class="header-anchor">#</a> 27.1。使用调用Web服务<code>WebServiceTemplate</code></h3> <p>如果需要从应用程序调用远程Web服务，则可以使用<a href="https://docs.spring.io/spring-ws/docs/3.0.8.RELEASE/reference/#client-web-service-template" target="_blank" rel="noopener noreferrer"><code>WebServiceTemplate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>该类。由于<code>WebServiceTemplate</code>实例通常需要在使用前进行自定义，因此Spring Boot不提供任何单个自动配置的<code>WebServiceTemplate</code>bean。但是，它会自动配置a <code>WebServiceTemplateBuilder</code>，可以<code>WebServiceTemplate</code>在需要时创建实例。</p> <p>以下代码显示了一个典型示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">WebServiceTemplate</span> webServiceTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyService</span><span class="token punctuation">(</span><span class="token class-name">WebServiceTemplateBuilder</span> webServiceTemplateBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>webServiceTemplate <span class="token operator">=</span> webServiceTemplateBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">DetailsResp</span> <span class="token function">someWsCall</span><span class="token punctuation">(</span><span class="token class-name">DetailsReq</span> detailsReq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">DetailsResp</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webServiceTemplate<span class="token punctuation">.</span><span class="token function">marshalSendAndReceive</span><span class="token punctuation">(</span>detailsReq<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SoapActionCallback</span><span class="token punctuation">(</span>ACTION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>默认情况下，使用类路径上的可用HTTP客户端库来<code>WebServiceTemplateBuilder</code>检测合适的基于<code>WebServiceMessageSender</code>HTTP的服务器。您还可以如下自定义读取和连接超时：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">WebServiceTemplate</span> <span class="token function">webServiceTemplate</span><span class="token punctuation">(</span><span class="token class-name">WebServiceTemplateBuilder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">messageSenders</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpWebServiceMessageSenderBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setReadTimeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_28-创建自己的自动配置"><a href="#_28-创建自己的自动配置" class="header-anchor">#</a> 28.创建自己的自动配置</h2> <p>如果您在开发共享库的公司中工作，或者在开源或商业库中工作，则可能需要开发自己的自动配置。自动配置类可以捆绑在外部jar中，并且仍由Spring Boot拾取。</p> <p>自动配置可以与“启动器”相关联，该“启动器”提供自动配置代码以及您将使用的典型库。我们首先介绍您构建自己的自动配置所需的知识，然后继续<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-custom-starter" target="_blank" rel="noopener noreferrer">进行创建自定义启动器所需<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-custom-starter" target="_blank" rel="noopener noreferrer">典型步骤<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>可以使用一个<a href="https://github.com/snicoll-demos/spring-boot-master-auto-configuration" target="_blank" rel="noopener noreferrer">演示项目<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来展示如何逐步创建入门程序。</p></div> <h3 id="_28-1。了解自动配置的bean"><a href="#_28-1。了解自动配置的bean" class="header-anchor">#</a> 28.1。了解自动配置的Bean</h3> <p>在后台，自动配置是通过标准<code>@Configuration</code>类实现的。其他<code>@Conditional</code>注释用于约束何时应应用自动配置。通常，自动配置类使用<code>@ConditionalOnClass</code>和<code>@ConditionalOnMissingBean</code>注释。这样可以确保仅当找到相关的类并且尚未声明自己的类时，自动配置才适用<code>@Configuration</code>。</p> <p>您可以浏览的源代码<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure" target="_blank" rel="noopener noreferrer"><code>spring-boot-autoconfigure</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以查看<code>@Configuration</code>Spring提供的类（请参见<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring.factories" target="_blank" rel="noopener noreferrer"><code>META-INF/spring.factories</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>文件）。</p> <h3 id="_28-2-查找自动配置候选人"><a href="#_28-2-查找自动配置候选人" class="header-anchor">#</a> 28.2. 查找自动配置候选人</h3> <p>Spring Boot检查<code>META-INF/spring.factories</code>发布的jar中是否存在文件。该文件应在<code>EnableAutoConfiguration</code>键下列出您的配置类，如以下示例所示：</p> <div class="language- extra-class"><pre class="language-text"><code>org.springframework.boot.autoconfigure.EnableAutoConfiguration = \
com.mycorp.libx.autoconfigure.LibXAutoConfiguration，\
com.mycorp.libx.autoconfigure.LibXWebAutoConfiguration
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>自动配置<em>只能</em>以这种方式加载。确保在特定的程序包空间中定义它们，并且决不要将它们作为组件扫描的目标。此外，自动配置类不应启用组件扫描以查找其他组件。<code>@Import</code>应该使用特定的。</p></div> <p>如果需要按特定顺序应用配置，则可以使用<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/AutoConfigureAfter.java" target="_blank" rel="noopener noreferrer"><code>@AutoConfigureAfter</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/AutoConfigureBefore.java" target="_blank" rel="noopener noreferrer"><code>@AutoConfigureBefore</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>注释。例如，如果您提供特定于Web的配置，则可能需要在之后应用类<code>WebMvcAutoConfiguration</code>。</p> <p>如果要订购某些彼此之间不具有直接知识的自动配置，则也可以使用<code>@AutoConfigureOrder</code>。该注释与常规注释具有相同的语义，<code>@Order</code>但为自动配置类提供了专用顺序。</p> <h3 id="_28-3-条件注释"><a href="#_28-3-条件注释" class="header-anchor">#</a> 28.3. 条件注释</h3> <p>您几乎总是希望<code>@Conditional</code>在自动配置类中包含一个或多个注释。该<code>@ConditionalOnMissingBean</code>注释是用来让开发者重写自动配置，如果他们不满意自己的缺省值一个常见的例子。</p> <p>Spring Boot包含许多<code>@Conditional</code>注释，您可以通过注释<code>@Configuration</code>类或单个<code>@Bean</code>方法在自己的代码中重用它们。这些注释包括：</p> <ul><li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-class-conditions" target="_blank" rel="noopener noreferrer">上课条件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-bean-conditions" target="_blank" rel="noopener noreferrer">豆条件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-property-conditions" target="_blank" rel="noopener noreferrer">物业条件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-resource-conditions" target="_blank" rel="noopener noreferrer">资源条件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-web-application-conditions" target="_blank" rel="noopener noreferrer">Web应用条件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-spel-conditions" target="_blank" rel="noopener noreferrer">SpEL表达条件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="_28-3-1-上课条件"><a href="#_28-3-1-上课条件" class="header-anchor">#</a> 28.3.1. 上课条件</h4> <p>的<code>@ConditionalOnClass</code>和<code>@ConditionalOnMissingClass</code>注解让<code>@Configuration</code>类基于特定类的存在或不存在被包括在内。由于注释元数据是使用<a href="https://asm.ow2.org/" target="_blank" rel="noopener noreferrer">ASM<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行解析的<code>value</code>，因此即使该类实际上未真正出现在正在运行的应用程序类路径上，您也可以使用该属性来引用真实的类。<code>name</code>如果您更喜欢通过使用<code>String</code>值来指定类名，则也可以使用该属性。</p> <p>这种机制不适用于<code>@Bean</code>通常以返回类型为条件目标的方法：在方法的条件适用之前，JVM将加载该类以及可能处理的方法引用，如果该类不是当下。</p> <p>要处理这种情况，<code>@Configuration</code>可以使用一个单独的类来隔离条件，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token comment">// Some conditions</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAutoConfiguration</span> <span class="token punctuation">{</span>

    <span class="token comment">// Auto-configured beans</span>

    <span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">EmbeddedAcmeService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmbeddedConfiguration</span> <span class="token punctuation">{</span>

        <span class="token annotation punctuation">@Bean</span>
        <span class="token annotation punctuation">@ConditionalOnMissingBean</span>
        <span class="token keyword">public</span> <span class="token class-name">EmbeddedAcmeService</span> <span class="token function">embeddedAcmeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您使用元批注<code>@ConditionalOnClass</code>或<code>@ConditionalOnMissingClass</code>作为元批注的一部分来组成自己的组合批注，<code>name</code>则在不处理这种情况下，必须使用引用类。</p></div> <h4 id="_28-3-2。豆条件"><a href="#_28-3-2。豆条件" class="header-anchor">#</a> 28.3.2。豆条件</h4> <p>的<code>@ConditionalOnBean</code>和<code>@ConditionalOnMissingBean</code>注解让豆基于特定豆的存在或不存在被包括在内。您可以使用该<code>value</code>属性按类型<code>name</code>指定bean 或按名称指定bean。该<code>search</code>属性使您可以限制<code>ApplicationContext</code>搜索bean时应考虑的层次结构。</p> <p>当放置在<code>@Bean</code>方法上时，目标类型默认为方法的返回类型，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAutoConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span>
    <span class="token keyword">public</span> <span class="token class-name">MyService</span> <span class="token function">myService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在前面的例子中，<code>myService</code>豆将被创建如果没有类型的豆<code>MyService</code>已经包含在所述<code>ApplicationContext</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您需要非常注意添加bean定义的顺序，因为这些条件是根据到目前为止已处理的内容来评估的。出于这个原因，我们建议在自动配置类上仅使用<code>@ConditionalOnBean</code>和<code>@ConditionalOnMissingBean</code>注释（因为保证在添加任何用户定义的Bean定义之后可以加载这些注释）。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>@ConditionalOnBean</code>并且<code>@ConditionalOnMissingBean</code>不要阻止<code>@Configuration</code>类的创建。在类级别使用这些条件<code>@Bean</code>与使用注释标记每个包含的方法之间的唯一区别是，<code>@Configuration</code>如果条件不匹配，则前者会阻止将该类注册为bean。</p></div> <h4 id="_28-3-3-物业条件"><a href="#_28-3-3-物业条件" class="header-anchor">#</a> 28.3.3. 物业条件</h4> <p>该<code>@ConditionalOnProperty</code>注解让基于Spring的环境属性配置包括在内。使用<code>prefix</code>和<code>name</code>属性来指定应检查的属性。默认情况下，<code>false</code>匹配存在且不等于的任何属性。您还可以使用<code>havingValue</code>和<code>matchIfMissing</code>属性创建更高级的检查。</p> <h4 id="_28-3-4-资源条件"><a href="#_28-3-4-资源条件" class="header-anchor">#</a> 28.3.4. 资源条件</h4> <p>该<code>@ConditionalOnResource</code>注解让配置被包括仅当特定资源是否存在。资源可通过使用通常的弹簧约定来指定，如显示在下面的例子：<code>file:/home/user/test.dat</code>。</p> <h4 id="_28-3-5-web应用条件"><a href="#_28-3-5-web应用条件" class="header-anchor">#</a> 28.3.5. Web应用条件</h4> <p>在<code>@ConditionalOnWebApplication</code>和<code>@ConditionalOnNotWebApplication</code>注释，让配置包含依赖于应用程序是否是一个“Web应用程序”。基于Servlet的Web应用程序是使用Spring <code>WebApplicationContext</code>，定义<code>session</code>范围或具有的任何应用程序<code>ConfigurableWebEnvironment</code>。响应式Web应用程序是使用<code>ReactiveWebApplicationContext</code>或具有的任何应用程序<code>ConfigurableReactiveWebEnvironment</code>。</p> <h4 id="_28-3-6-spel表达条件"><a href="#_28-3-6-spel表达条件" class="header-anchor">#</a> 28.3.6. SpEL表达条件</h4> <p>该<code>@ConditionalOnExpression</code>注解让基于一个的结果配置被包括<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/core.html#expressions" target="_blank" rel="noopener noreferrer">使用SpEL表达<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h3 id="_28-4-测试您的自动配置"><a href="#_28-4-测试您的自动配置" class="header-anchor">#</a> 28.4. 测试您的自动配置</h3> <p>自动配置可能受许多因素影响：用户配置（<code>@Bean</code>定义和<code>Environment</code>自定义），条件评估（特定库的存在）以及其他因素。具体而言，每个测试都应创建一个良好的定义<code>ApplicationContext</code>，以代表这些定制的组合。 <code>ApplicationContextRunner</code>提供了实现此目标的好方法。</p> <p><code>ApplicationContextRunner</code>通常定义为测试类的一个字段，以收集基本的通用配置。以下示例确保<code>UserServiceAutoConfiguration</code>始终调用该示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ApplicationContextRunner</span> contextRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApplicationContextRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withConfiguration</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurations</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">UserServiceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果必须定义多个自动配置，则无需按与运行应用程序时完全相同的顺序调用它们的声明。</p></div> <p>每个测试都可以使用运行器来表示特定的用例。例如，下面的示例调用一个用户配置（<code>UserConfiguration</code>），并检查自动配置是否正确退出。调用<code>run</code>提供了可与一起使用的回调上下文<code>Assert4J</code>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">defaultServiceBacksOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>contextRunner<span class="token punctuation">.</span><span class="token function">withUserConfiguration</span><span class="token punctuation">(</span><span class="token class-name">UserConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasSingleBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;myUserService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isSameAs</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UserConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">UserService</span> <span class="token function">myUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token string">&quot;mine&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>也可以轻松自定义<code>Environment</code>，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">serviceNameCanBeConfigured</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>contextRunner<span class="token punctuation">.</span><span class="token function">withPropertyValues</span><span class="token punctuation">(</span><span class="token string">&quot;user.name=test123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasSingleBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token string">&quot;test123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>跑步者也可以用来显示<code>ConditionEvaluationReport</code>。可以按级别<code>INFO</code>或<code>DEBUG</code>水平打印报告。以下示例显示了如何<code>ConditionEvaluationReportLoggingListener</code>在自动配置测试中使用来打印报告。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> autoConfigTest <span class="token punctuation">{</span>
    <span class="token class-name">ConditionEvaluationReportLoggingListener</span> initializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConditionEvaluationReportLoggingListener</span><span class="token punctuation">(</span>
            <span class="token class-name">LogLevel</span><span class="token punctuation">.</span>INFO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ApplicationContextRunner</span> contextRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApplicationContextRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withInitializer</span><span class="token punctuation">(</span>initializer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Do something...</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_28-4-1-模拟网络环境"><a href="#_28-4-1-模拟网络环境" class="header-anchor">#</a> 28.4.1. 模拟网络环境</h4> <p>如果您需要测试仅在Servlet或Reactive Web应用程序上下文中运行的自动配置，请分别使用<code>WebApplicationContextRunner</code>或<code>ReactiveWebApplicationContextRunner</code>。</p> <h4 id="_28-4-2-覆盖类路径"><a href="#_28-4-2-覆盖类路径" class="header-anchor">#</a> 28.4.2. 覆盖类路径</h4> <p>还可以测试在运行时不存在特定的类和/或程序包时发生的情况。Spring Boot附带了一个<code>FilteredClassLoader</code>跑步者可以轻松使用的。在以下示例中，我们断言，如果<code>UserService</code>不存在，则将自动禁用自动配置：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">serviceIsIgnoredIfLibraryIsNotPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>contextRunner<span class="token punctuation">.</span><span class="token function">withClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FilteredClassLoader</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">assertThat</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doesNotHaveBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_28-5-创建自己的入门"><a href="#_28-5-创建自己的入门" class="header-anchor">#</a> 28.5. 创建自己的入门</h3> <p>库的完整Spring Boot入门程序可能包含以下组件：</p> <ul><li><code>autoconfigure</code>包含自动配置代码的模块。</li> <li>将<code>starter</code>其提供给一个依赖模块<code>autoconfigure</code>模块以及库和通常是有用的任何附加的依赖性。简而言之，添加启动程序应提供开始使用该库所需的一切。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果不需要将这两个问题分开，则可以将自动配置代码和依赖性管理结合在一起。</p></div> <h4 id="_28-5-1-命名"><a href="#_28-5-1-命名" class="header-anchor">#</a> 28.5.1. 命名</h4> <p>您应该确保为启动器提供适当的名称空间。<code>spring-boot</code>即使使用其他Maven，也不要以模块名称开头<code>groupId</code>。将来，我们可能会为您自动配置的内容提供官方支持。</p> <p>根据经验，您应该在启动器后命名一个组合模块。例如，假设您要为“ acme”创建启动器，并命名自动配置模块<code>acme-spring-boot-autoconfigure</code>和启动器<code>acme-spring-boot-starter</code>。如果只有一个将两者结合的模块，请命名为<code>acme-spring-boot-starter</code>。</p> <h4 id="_28-5-2-配置键"><a href="#_28-5-2-配置键" class="header-anchor">#</a> 28.5.2. 配置键</h4> <p>如果您的入门者提供了配置密钥，请为其使用唯一的名称空间。特别是，不包括你的名字空间去春Boot使用键（如<code>server</code>，<code>management</code>，<code>spring</code>，等）。如果使用相同的名称空间，将来我们可能会以破坏模块的方式修改这些名称空间。根据经验，所有键都以您拥有的名称空间（例如<code>acme</code>）为前缀。</p> <p>通过为每个属性添加字段javadoc来确保记录了配置键，如以下示例所示：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;acme&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * Whether to check the location of acme resources.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> checkLocation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Timeout for establishing a connection to the acme server.
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Duration</span> loginTimeout <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// getters &amp; setters</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您仅应将简单文本与<code>@ConfigurationProperties</code>Javadoc字段一起使用，因为在将它们添加到JSON之前不会对其进行处理。</p></div> <p>这是我们内部遵循的一些规则，以确保描述一致：</p> <ul><li>请勿以“ The”或“ A”开头描述。</li> <li>对于<code>boolean</code>类型，请从“是否”或“启用”开始描述。</li> <li>对于基于集合的类型，请以“以逗号分隔的列表”开始描述</li> <li>如果默认单位与毫秒不同，请使用<code>java.time.Duration</code>而不是<code>long</code>并描述默认单位，例如“如果未指定持续时间后缀，将使用秒”。</li> <li>除非必须在运行时确定默认值，否则请不要在描述中提供默认值。</li></ul> <p>确保<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-configuration-metadata.html#configuration-metadata-annotation-processor" target="_blank" rel="noopener noreferrer">触发元数据生成，<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以便IDE协助也可用于您的密钥。您可能需要查看生成的元数据（<code>META-INF/spring-configuration-metadata.json</code>），以确保正确记录了您的密钥。在兼容的IDE中使用自己的启动程序也是验证元数据质量的好主意。</p> <h4 id="_28-5-3。autoconfigure模组"><a href="#_28-5-3。autoconfigure模组" class="header-anchor">#</a> 28.5.3。<code>autoconfigure</code>模组</h4> <p>该<code>autoconfigure</code>模块包含开始使用该库所需的所有内容。它还可能包含配置键定义（例如<code>@ConfigurationProperties</code>）和可用于进一步自定义组件初始化方式的任何回调接口。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>您应该将对库的依赖项标记为可选，以便可以<code>autoconfigure</code>更轻松地将模块包含在项目中。如果这样做，则不提供该库，并且默认情况下，Spring Boot会后退。</p></div> <p>Spring Boot使用注释处理器来收集元数据文件（<code>META-INF/spring-autoconfigure-metadata.properties</code>）中自动配置的条件。如果存在该文件，它将用于急切过滤不匹配的自动配置，这将缩短启动时间。建议在包含自动配置的模块中添加以下依赖项：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-autoconfigure-processor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对于Gradle 4.5和更早版本，应在<code>compileOnly</code>配置中声明依赖项，如以下示例所示：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    compileOnly <span class="token string gstring">&quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对于Gradle 4.6及更高版本，应在<code>annotationProcessor</code>配置中声明依赖项，如以下示例所示：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    annotationProcessor <span class="token string gstring">&quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_28-5-4。启动模块"><a href="#_28-5-4。启动模块" class="header-anchor">#</a> 28.5.4。启动模块</h4> <p>起动器确实是一个空罐子。其唯一目的是提供必要的依赖关系以使用库。您可以将其视为对入门所需的看法。</p> <p>不要对添加了启动器的项目做任何假设。如果您要自动配置的库通常需要其他启动器，请同时提及它们。如果可选依赖项的数量很高，则提供一组适当的<em>默认</em>依赖项可能会很困难，因为您应避免包括对于库的典型用法而言不必要的依赖项。换句话说，您不应包括可选的依赖项。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>无论哪种方式，您的启动程序都必须<code>spring-boot-starter</code>直接或间接引用核心Spring Boot启动程序（）（即，如果您的启动程序依赖于另一个启动程序，则无需添加它）。如果仅使用您的自定义启动程序创建项目，则通过使用该核心启动程序来兑现Spring Boot的核心功能。</p></div> <h2 id="_29-kotlin支持"><a href="#_29-kotlin支持" class="header-anchor">#</a> 29. Kotlin支持</h2> <p><a href="https://kotlinlang.org/" target="_blank" rel="noopener noreferrer">Kotlin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是针对JVM（和其他平台）的静态类型的语言，它允许编写简洁明了的代码，同时提供与用Java编写的现有库的<a href="https://kotlinlang.org/docs/reference/java-interop.html" target="_blank" rel="noopener noreferrer">互操作性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>Spring Boot通过利用其他Spring项目（例如Spring Framework，Spring Data和Reactor）中的支持来提供Kotlin支持。有关更多信息，请参见<a href="https://docs.spring.io/spring/docs/5.2.2.RELEASE/spring-framework-reference/languages.html#kotlin" target="_blank" rel="noopener noreferrer">Spring Framework Kotlin支持文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>从Spring Boot和Kotlin入手的最简单方法是遵循<a href="https://spring.io/guides/tutorials/spring-boot-kotlin/" target="_blank" rel="noopener noreferrer">这个全面的教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。您可以通过<a href="https://start.spring.io/#!language=kotlin" target="_blank" rel="noopener noreferrer">start.spring.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>创建新的Kotlin项目。如果需要支持，请随时加入<a href="https://slack.kotlinlang.org/" target="_blank" rel="noopener noreferrer">Kotlin Slack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的#spring频道，或通过<a href="https://stackoverflow.com/questions/tagged/spring+kotlin" target="_blank" rel="noopener noreferrer">Stack Overflow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上的<code>spring</code>and <code>kotlin</code>标签提问。</p> <h3 id="_29-1。要求"><a href="#_29-1。要求" class="header-anchor">#</a> 29.1。要求</h3> <p>Spring Boot支持Kotlin1.3.x。要使用Kotlin，<code>org.jetbrains.kotlin:kotlin-stdlib</code>并且<code>org.jetbrains.kotlin:kotlin-reflect</code>必须存在于类路径中。该<code>kotlin-stdlib</code>变种<code>kotlin-stdlib-jdk7</code>和<code>kotlin-stdlib-jdk8</code>也可以使用。</p> <p>由于<a href="https://discuss.kotlinlang.org/t/classes-final-by-default/166" target="_blank" rel="noopener noreferrer">默认情况下Kotlin类是final类<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，因此您可能需要配置<a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#spring-support" target="_blank" rel="noopener noreferrer">kotlin-spring<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>插件，以便自动打开<a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#spring-support" target="_blank" rel="noopener noreferrer">带有<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Spring注释的类，以便对其进行代理。</p> <p><a href="https://github.com/FasterXML/jackson-module-kotlin" target="_blank" rel="noopener noreferrer">在Kotlin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中序列化/反序列化JSON数据时需要<a href="https://github.com/FasterXML/jackson-module-kotlin" target="_blank" rel="noopener noreferrer">Jackson的Kotlin模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。在类路径上找到它会自动注册。如果存在Jackson和Kotlin但不存在Jackson Kotlin模块，则会记录一条警告消息。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果一个人在<a href="https://start.spring.io/#!language=kotlin" target="_blank" rel="noopener noreferrer">start.spring.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上引导Kotlin项目，<a href="https://start.spring.io/#!language=kotlin" target="_blank" rel="noopener noreferrer">则<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>默认情况下会提供这些依赖项和插件。</p></div> <h3 id="_29-2。零安全"><a href="#_29-2。零安全" class="header-anchor">#</a> 29.2。零安全</h3> <p>Kotlin的主要功能之一是<a href="https://kotlinlang.org/docs/reference/null-safety.html" target="_blank" rel="noopener noreferrer">null安全<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。它<code>null</code>在编译时处理值，而不是将问题推迟到运行时并遇到<code>NullPointerException</code>。这有助于消除常见的bug来源，而无需支付包装费用，例如<code>Optional</code>。Kotlin还允许使用具有可为空值的功能结构，如《<a href="https://www.baeldung.com/kotlin-null-safety" target="_blank" rel="noopener noreferrer">Kotlin中关于null安全的全面指南》中所述<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>尽管Java不允许人们在其类型系统中表示null安全，但是Spring Framework，Spring Data和Reactor现在通过易于使用工具的注释为API提供了null安全。默认情况下，将Kotlin中使用的Java API中的<a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types" target="_blank" rel="noopener noreferrer">类型<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>识别为放松了空检查的<a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types" target="_blank" rel="noopener noreferrer">平台类型<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 <a href="https://kotlinlang.org/docs/reference/java-interop.html#jsr-305-support" target="_blank" rel="noopener noreferrer">Kotlin对JSR 305批注的支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>与可空性<a href="https://kotlinlang.org/docs/reference/java-interop.html#jsr-305-support" target="_blank" rel="noopener noreferrer">批注<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>相结合，为Kotlin中的相关Spring API提供了空安全性。</p> <p>的JSR 305检查可以通过添加被配置<code>-Xjsr305</code>具有以下选项的编译标志：<code>-Xjsr305={strict|warn|ignore}</code>。默认行为与相同<code>-Xjsr305=warn</code>。<code>strict</code>从Spring API推断得出的Kotlin类型中，该值必须考虑到null安全性，但在了解Spring API nullability声明即使在次要发行版之间可能会演变，并且将来可能添加更多检查的前提下，也应使用该值。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>尚不支持通用类型参数，varargs和数组元素的可空性。有关最新信息，请参见<a href="https://jira.spring.io/browse/SPR-15942" target="_blank" rel="noopener noreferrer">SPR-15942<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。另外请注意，Spring Boot自己的API <a href="https://github.com/spring-projects/spring-boot/issues/10712" target="_blank" rel="noopener noreferrer">尚未注释<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <h3 id="_29-3。kotlin-api"><a href="#_29-3。kotlin-api" class="header-anchor">#</a> 29.3。Kotlin API</h3> <h4 id="_29-3-1。runapplication"><a href="#_29-3-1。runapplication" class="header-anchor">#</a> 29.3.1。runApplication</h4> <p>Spring Boot提供了一种惯用的方式来运行应用程序，<code>runApplication&lt;MyApplication&gt;(*args)</code>如下例所示：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>runApplication

<span class="token annotation builtin">@SpringBootApplication</span>
<span class="token keyword">class</span> MyApplication

<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    runApplication<span class="token operator">&lt;</span>MyApplication<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这是的直接替代<code>SpringApplication.run(MyApplication::class.java, *args)</code>。它还允许自定义应用程序，如以下示例所示：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code>runApplication<span class="token operator">&lt;</span>MyApplication<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setBannerMode</span><span class="token punctuation">(</span>OFF<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_29-3-2。扩展名"><a href="#_29-3-2。扩展名" class="header-anchor">#</a> 29.3.2。扩展名</h4> <p>Kotlin <a href="https://kotlinlang.org/docs/reference/extensions.html" target="_blank" rel="noopener noreferrer">扩展<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供了使用其他功能扩展现有类的功能。Spring Boot Kotlin API利用这些扩展为现有的API添加了新的Kotlin特定的便利。</p> <p><code>TestRestTemplate</code>提供了与Spring Framework中为<code>RestOperations</code>Spring Framework 提供的扩展类似的扩展。除其他事项外，这些扩展使利用Kotlin修饰类型参数成为可能。</p> <h3 id="_29-4。依赖管理"><a href="#_29-4。依赖管理" class="header-anchor">#</a> 29.4。依赖管理</h3> <p>为了避免在类路径中混合使用不同版本的Kotlin依赖项，Spring Boot会导入Kotlin BOM。</p> <p>使用Maven，可以通过<code>kotlin.version</code>属性自定义Kotlin版本，并为提供插件管理<code>kotlin-maven-plugin</code>。使用Gradle，Spring Boot插件会自动将其<code>kotlin.version</code>与Kotlin插件的版本对齐。</p> <p>Spring Boot还通过导入Kotlin Coroutines BOM管理Coroutines依赖项的版本。可以通过<code>kotlin-coroutines.version</code>属性自定义版本。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>org.jetbrains.kotlinx:kotlinx-coroutines-reactor</code>如果一个引导程序对<a href="https://start.spring.io/#!language=kotlin" target="_blank" rel="noopener noreferrer">start.spring.io<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>至少有一个反应依赖的Kotlin项目，则默认提供依赖。</p></div> <h3 id="_29-5。-configurationproperties"><a href="#_29-5。-configurationproperties" class="header-anchor">#</a> 29.5。 <code>@ConfigurationProperties</code></h3> <p><code>@ConfigurationProperties</code>当与<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-external-config-constructor-binding" target="_blank" rel="noopener noreferrer"><code>@ConstructorBinding</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>具有不可变<code>val</code>属性的支持类结合使用时，如以下示例所示：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token annotation builtin">@ConstructorBinding</span>
<span class="token annotation builtin">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;example.kotlin&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">KotlinExampleProperties</span><span class="token punctuation">(</span>
        <span class="token keyword">val</span> name<span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token keyword">val</span> description<span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token keyword">val</span> myService<span class="token operator">:</span> MyService<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">MyService</span><span class="token punctuation">(</span>
            <span class="token keyword">val</span> apiToken<span class="token operator">:</span> String<span class="token punctuation">,</span>
            <span class="token keyword">val</span> uri<span class="token operator">:</span> URI
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>要生成<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/appendix-configuration-metadata.html#configuration-metadata-annotation-processor" target="_blank" rel="noopener noreferrer">自己的元数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>使用注释处理器，<a href="https://kotlinlang.org/docs/reference/kapt.html" target="_blank" rel="noopener noreferrer"><code>kapt</code>应该配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>与<code>spring-boot-configuration-processor</code>依赖。请注意，由于kapt提供的模型的限制，某些功能（例如检测默认值或不推荐使用的项目）无法正常工作。</p></div> <h3 id="_29-6。测试中"><a href="#_29-6。测试中" class="header-anchor">#</a> 29.6。测试中</h3> <p>虽然可以使用JUnit 4测试Kotlin代码，但默认情况下建议使用JUnit 5。JUnit 5使一个测试类可以实例化一次，并可以重新用于该类的所有测试。这样就可以在非静态方法上使用<code>@BeforeClass</code>和<code>@AfterClass</code>注释，这非常适合Kotlin。</p> <p>JUnit 5是默认的，并且提供了vintage引擎是为了与JUnit 4向后兼容。如果不使用它，请排除<code>org.junit.vintange:junit-vintage-engine</code>。您还需要将<a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle-changing-default" target="_blank" rel="noopener noreferrer">测试实例生命周期切换为“ per-class”<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>要模拟Kotlin类，建议使用<a href="https://mockk.io/" target="_blank" rel="noopener noreferrer">MockK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果需要<code>Mockk</code>Mockito特定于<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-mocking-beans" target="_blank" rel="noopener noreferrer"><code>@MockBean</code>和<code>@SpyBean</code>注释<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的等效项，则可以使用<a href="https://github.com/Ninja-Squad/springmockk" target="_blank" rel="noopener noreferrer">SpringMockK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，它提供相似的<code>@MockkBean</code>和<code>@SpykBean</code>注释。</p> <h3 id="_29-7。资源资源"><a href="#_29-7。资源资源" class="header-anchor">#</a> 29.7。资源资源</h3> <h4 id="_29-7-1。进一步阅读"><a href="#_29-7-1。进一步阅读" class="header-anchor">#</a> 29.7.1。进一步阅读</h4> <ul><li><a href="https://kotlinlang.org/docs/reference/" target="_blank" rel="noopener noreferrer">Kotlin语言参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://slack.kotlinlang.org/" target="_blank" rel="noopener noreferrer">Kotlin Slack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（带有专用的#spring频道）</li> <li><a href="https://stackoverflow.com/questions/tagged/spring+kotlin" target="_blank" rel="noopener noreferrer">带<code>spring</code>和<code>kotlin</code>标签的Stackoverflow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://try.kotlinlang.org/" target="_blank" rel="noopener noreferrer">在浏览器中尝试Kotlin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.jetbrains.com/kotlin/" target="_blank" rel="noopener noreferrer">Kotlin博客<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://kotlin.link/" target="_blank" rel="noopener noreferrer">很棒的科特林<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/guides/tutorials/spring-boot-kotlin/" target="_blank" rel="noopener noreferrer">教程：使用Spring Boot和Kotlin构建Web应用程序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/blog/2016/02/15/developing-spring-boot-applications-with-kotlin" target="_blank" rel="noopener noreferrer">使用Kotlin开发Spring Boot应用程序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/blog/2016/03/20/a-geospatial-messenger-with-kotlin-spring-boot-and-postgresql" target="_blank" rel="noopener noreferrer">带有Kotlin，Spring Boot和PostgreSQL的地理空间Messenger<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/blog/2017/01/04/introducing-kotlin-support-in-spring-framework-5-0" target="_blank" rel="noopener noreferrer">在Spring Framework 5.0中引入Kotlin支持<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://spring.io/blog/2017/08/01/spring-framework-5-kotlin-apis-the-functional-way" target="_blank" rel="noopener noreferrer">Spring Framework 5 Kotlin API的功能方式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="_29-7-2。例子"><a href="#_29-7-2。例子" class="header-anchor">#</a> 29.7.2。例子</h4> <ul><li><a href="https://github.com/sdeleuze/spring-boot-kotlin-demo" target="_blank" rel="noopener noreferrer">spring-boot-kotlin-demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：常规Spring Boot + Spring Data JPA项目</li> <li><a href="https://github.com/mixitconf/mixit" target="_blank" rel="noopener noreferrer">mixit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：Spring Boot 2 + WebFlux +响应式Spring Data MongoDB</li> <li><a href="https://github.com/sdeleuze/spring-kotlin-fullstack" target="_blank" rel="noopener noreferrer">spring-kotlin-fullstack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：WebFlux Kotlin完整示例，其中Kotlin2js用于前端，而不是JavaScript或TypeScript</li> <li><a href="https://github.com/spring-petclinic/spring-petclinic-kotlin" target="_blank" rel="noopener noreferrer">spring-petclinic-kotlin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：Spring PetClinic示例应用程序的Kotlin版本</li> <li><a href="https://github.com/sdeleuze/spring-kotlin-deepdive" target="_blank" rel="noopener noreferrer">spring-kotlin-deepdive<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：从Boot 1.0 + Java到Boot 2.0 + Kotlin的逐步迁移</li> <li><a href="https://github.com/sdeleuze/spring-boot-coroutines-demo" target="_blank" rel="noopener noreferrer">spring-boot-coroutines-demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：<a href="https://github.com/sdeleuze/spring-boot-coroutines-demo" target="_blank" rel="noopener noreferrer">协程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>示例项目</li></ul> <h2 id="_30-下一步阅读"><a href="#_30-下一步阅读" class="header-anchor">#</a> 30.下一步阅读</h2> <p>如果您想了解有关本节中讨论的任何类的更多信息，可以查看<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/api/" target="_blank" rel="noopener noreferrer">Spring Boot API文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，也可以<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE" target="_blank" rel="noopener noreferrer">直接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>浏览<a href="https://github.com/spring-projects/spring-boot/tree/v2.2.2.RELEASE" target="_blank" rel="noopener noreferrer">源代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果您有特定问题，请查看<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/howto.html#howto" target="_blank" rel="noopener noreferrer">操作方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>部分。</p> <p>如果您熟悉Spring Boot的核心功能，则可以继续阅读有关<a href="https://docs.spring.io/spring-boot/docs/2.2.2.RELEASE/reference/html/production-ready-features.html#production-ready" target="_blank" rel="noopener noreferrer">准备就绪的功能的信息<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/spring/使用SpringBoot.html" class="prev">
        使用Spring Boot
      </a></span> <span class="next"><a href="/spring/SpringBoot启动执行器.html">
        Spring Boot启动执行器：生产就绪功能
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.ab60294b.js" defer></script><script src="/assets/js/2.0769d472.js" defer></script><script src="/assets/js/79.2dc3f78e.js" defer></script>
  </body>
</html>
